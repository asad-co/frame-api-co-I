/*! For license information please see main.21741427.js.LICENSE.txt */
!function(){var e={741:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=741,e.exports=t},282:function(e,t,n){var r=n(141),a=n(619),i=n(422),o=n(304),s=n(597),u=n(982),c=n(274);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},141:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},982:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},619:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},597:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},304:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},422:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},274:function(e,t,n){var r;!function(a,i){var o,s=this,u=256,c="random",l=i.pow(u,6),p=i.pow(2,52),h=2*p,d=u-1;function f(e,t,n){var r=[],d=y(g((t=1==t?{entropy:!0}:t||{}).entropy?[e,b(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(u):(e=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(e)),b(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,b(a)]}}():e,3),r),f=new m(r),x=function(){for(var e=f.g(6),t=l,n=0;e<p;)e=(e+n)*u,t*=u,n=f.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|f.g(4)},x.quick=function(){return f.g(4)/4294967296},x.double=x,y(b(f.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&v(r,f),e.state=function(){return v(f,{})}),n?(i[c]=e,t):e})(x,d,"global"in t?t.global:this==i,t.state)}function m(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=d&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=d&a+1],n=n*u+o[d&(o[a]=o[i=d&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function g(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(g(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function y(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(i["seed"+c]=f,y(i.random(),a),e.exports){e.exports=f;try{o=n(778)}catch(x){}}else void 0===(r=function(){return f}.call(t,n,t,e))||(e.exports=r)}([],Math)},987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(N){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:v;if(t){if(e<0)return g;if(e>=d)return w}else{if(e<=-f)return I;if(e+1>=f)return k}return e<0?s(-e,t).neg():u(e%h|0,e/h|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return v;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=v,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),p=parseInt(e.substring(o,o+u),n);if(u<8){var h=s(c(n,u));i=i.mul(h).add(s(p))}else i=(i=i.mul(a)).add(s(p))}return i.unsigned=t,i}function p(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=p;var h=4294967296,d=h*h,f=d/2,m=o(1<<24),v=o(0);n.ZERO=v;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var k=u(-1,2147483647,!1);n.MAX_VALUE=k;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var I=u(0,-2147483648,!1);n.MIN_VALUE=I;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return r(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(y)},S.neg=S.negate,S.add=function(e){r(e)||(e=p(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,h=0,d=0,f=0;return d+=(f+=i+(65535&e.low))>>>16,h+=(d+=a+c)>>>16,l+=(h+=n+s)>>>16,l+=t+o,u((d&=65535)<<16|(f&=65535),(l&=65535)<<16|(h&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=p(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return v;if(r(e)||(e=p(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return v;if(this.eq(I))return e.isOdd()?I:v;if(e.eq(I))return this.isOdd()?I:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(m)&&e.lt(m))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,h=e.low>>>16,d=65535&e.low,f=0,g=0,y=0,b=0;return y+=(b+=o*d)>>>16,g+=(y+=i*d)>>>16,y&=65535,g+=(y+=o*h)>>>16,f+=(g+=a*d)>>>16,g&=65535,f+=(g+=i*h)>>>16,g&=65535,f+=(g+=o*l)>>>16,f+=n*d+a*h+i*l+o*c,u((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(g&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=p(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:v;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(I))return e.eq(y)||e.eq(x)?I:e.eq(I)?y:(n=this.shr(1).div(e).shl(1)).eq(v)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(I))return this.unsigned?g:v;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=v}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),h=s(n),d=h.mul(e);d.isNegative()||d.gt(a);)d=(h=s(n-=l,this.unsigned)).mul(e);h.isZero()&&(h=y),i=i.add(h),a=a.sub(d)}return i},S.div=S.divide,S.modulo=function(e){return r(e)||(e=p(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return u(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=p(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=p(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=p(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},463:function(e,t,n){"use strict";var r=n(791),a=n(296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),p=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function m(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=v.hasOwnProperty(t)?v[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!p.call(f,e)||!p.call(d,e)&&(h.test(e)?f[e]=!0:(d[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),I=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var L,z=Object.assign;function P(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var B=!1;function W(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?P(e):""}function V(e){switch(e.tag){case 5:return P(e.type);case 16:return P("Lazy");case 13:return P("Suspense");case 19:return P("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 1:return e=W(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case I:return"Fragment";case w:return"Portal";case N:return"Profiler";case S:return"StrictMode";case _:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case E:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case F:t=e._payload,e=e._init;try{return U(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function j(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=j(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=j(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return z({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function Z(e,t){Q(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return z({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function ie(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,pe=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var de={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||de.hasOwnProperty(e)&&de[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(de).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),de[t]=de[e]}))}));var ge=z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Ie=null,Se=null;function Ne(e){if(e=ba(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=ka(t),we(e.stateNode,e.type,t))}}function Te(e){Ie?Se?Se.push(e):Se=[e]:Ie=e}function Ce(){if(Ie){var e=Ie,t=Se;if(Se=Ie=null,Ne(e),t)for(e=0;e<t.length;e++)Ne(t[e])}}function Ee(e,t){return e(t)}function _e(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ee(e,t,n)}finally{Ae=!1,(null!==Ie||null!==Se)&&(_e(),Ce())}}function Fe(e,t){var n=e.stateNode;if(null===n)return null;var r=ka(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(l)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){De=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(le){De=!1}function Oe(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Le=!1,ze=null,Pe=!1,Be=null,We={onError:function(e){Le=!0,ze=e}};function Ve(e,t,n,r,a,i,o,s,u){Le=!1,ze=null,Oe.apply(We,arguments)}function Ue(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ue(e)!==e)throw Error(i(188))}function je(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return He(a),e;if(o===r)return He(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=a.unstable_scheduleCallback,Xe=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,Je=a.unstable_requestPaint,Qe=a.unstable_now,Ze=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function pt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=pt(s):0!==(i&=o)&&(r=pt(i))}else 0!==(o=n&~a)?r=pt(o):0!==i&&(r=pt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function dt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,wt,It,St,Nt,Tt=!1,Ct=[],Et=null,_t=null,At=null,Rt=new Map,Ft=new Map,Dt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Et=null;break;case"dragenter":case"dragleave":_t=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ft.delete(t.pointerId)}}function Lt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function zt(e){var t=ya(e.target);if(null!==t){var n=Ue(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Nt(e.priority,(function(){It(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){Pt(e)&&n.delete(t)}function Wt(){Tt=!1,null!==Et&&Pt(Et)&&(Et=null),null!==_t&&Pt(_t)&&(_t=null),null!==At&&Pt(At)&&(At=null),Rt.forEach(Bt),Ft.forEach(Bt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Wt)))}function Ut(e){function t(t){return Vt(t,e)}if(0<Ct.length){Vt(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Vt(Et,e),null!==_t&&Vt(_t,e),null!==At&&Vt(At,e),Rt.forEach(t),Ft.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)zt(n),null===n.blockedOn&&Dt.shift()}var Gt=x.ReactCurrentBatchConfig,Ht=!0;function jt(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function qt(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function Kt(e,t,n,r){if(Ht){var a=Yt(e,t,n,r);if(null===a)Hr(e,t,r,Xt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Et=Lt(Et,e,t,n,r,a),!0;case"dragenter":return _t=Lt(_t,e,t,n,r,a),!0;case"mouseover":return At=Lt(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Lt(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ft.set(i,Lt(Ft.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Mt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&kt(i),null===(i=Yt(e,t,n,r))&&Hr(e,t,r,Xt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Xt=null;function Yt(e,t,n,r){if(Xt=null,null!==(e=ya(e=ke(r))))if(null===(t=Ue(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Qt=null,Zt=null,$t=null;function en(){if($t)return $t;var e,t,n=Zt,r=n.length,a="value"in Qt?Qt.value:Qt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return z(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),pn=z({},cn,{view:0,detail:0}),hn=an(pn),dn=z({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Nn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),fn=an(dn),mn=an(z({},dn,{dataTransfer:0})),vn=an(z({},pn,{relatedTarget:0})),gn=an(z({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=z({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(z({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},In={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=In[e])&&!!t[e]}function Nn(){return Sn}var Tn=z({},pn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Nn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(Tn),En=an(z({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),_n=an(z({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Nn})),An=an(z({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=z({},dn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Fn=an(Rn),Dn=[9,13,27,32],Mn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Ln=l&&"TextEvent"in window&&!On,zn=l&&(!Mn||On&&8<On&&11>=On),Pn=String.fromCharCode(32),Bn=!1;function Wn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Un=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function jn(e,t,n,r){Te(r),0<(t=qr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function Xn(e){Pr(e,0)}function Yn(e){if(K(xa(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Zn=$n}else Zn=!1;Qn=Zn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];jn(t,Kn,e,ke(e)),Re(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!p.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pr(n.ownerDocument.documentElement,n)){if(null!==r&&dr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==X(r)||("selectionStart"in(r=vr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=qr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function kr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},Ir={},Sr={};function Nr(e){if(Ir[e])return Ir[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return Ir[e]=n[t];return e}l&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Tr=Nr("animationend"),Cr=Nr("animationiteration"),Er=Nr("animationstart"),_r=Nr("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(e,t){Ar.set(e,t),u(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Mr=Rr[Dr];Fr(Mr.toLowerCase(),"on"+(Mr[0].toUpperCase()+Mr.slice(1)))}Fr(Tr,"onAnimationEnd"),Fr(Cr,"onAnimationIteration"),Fr(Er,"onAnimationStart"),Fr("dblclick","onDoubleClick"),Fr("focusin","onFocus"),Fr("focusout","onBlur"),Fr(_r,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function zr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(Ve.apply(this,arguments),Le){if(!Le)throw Error(i(198));var l=ze;Le=!1,ze=null,Pe||(Pe=!0,Be=l)}}(r,t,void 0,e),e.currentTarget=null}function Pr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;zr(a,s,c),i=u}}}if(Pe)throw e=Be,Pe=!1,Be=null,e}function Br(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function Wr(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Ur(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Wr(t,!1,e),Wr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Wr("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Jt(t)){case 1:var a=jt;break;case 4:a=qt;break;default:a=Kt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=ke(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Cn;break;case"focusin":c="focus",u=vn;break;case"focusout":c="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=_n;break;case Tr:case Cr:case Er:u=gn;break;case _r:u=An;break;case"scroll":u=hn;break;case"wheel":u=Fn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=En}var l=0!==(4&t),p=!l&&"scroll"===e,h=l?null!==s?s+"Capture":null:s;l=[];for(var d,f=r;null!==f;){var m=(d=f).stateNode;if(5===d.tag&&null!==m&&(d=m,null!==h&&(null!=(m=Fe(f,h))&&l.push(jr(f,m,d)))),p)break;f=f.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[fa])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(p=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(l=En,m="onPointerLeave",h="onPointerEnter",f="pointer"),p=null==u?s:xa(u),d=null==c?s:xa(c),(s=new l(m,f+"leave",u,n,a)).target=p,s.relatedTarget=d,m=null,ya(a)===r&&((l=new l(h,f+"enter",c,n,a)).target=d,l.relatedTarget=p,m=l),p=m,u&&c)e:{for(h=c,f=0,d=l=u;d;d=Kr(d))f++;for(d=0,m=h;m;m=Kr(m))d++;for(;0<f-d;)l=Kr(l),f--;for(;0<d-f;)h=Kr(h),d--;for(;f--;){if(l===h||null!==h&&l===h.alternate)break e;l=Kr(l),h=Kr(h)}l=null}else l=null;null!==u&&Xr(o,s,u,l,!1),null!==c&&null!==p&&Xr(o,p,c,l,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=Jn;else if(Hn(s))if(Qn)v=or;else{v=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ir);switch(v&&(v=v(e,r))?jn(o,v,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(Hn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Un?Wn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(zn&&"ko"!==n.locale&&(Un||"onCompositionStart"!==b?"onCompositionEnd"===b&&Un&&(y=en()):(Zt="value"in(Qt=a)?Qt.value:Qt.textContent,Un=!0)),0<(g=qr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Vn(n))&&(b.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Pn);case"textInput":return(e=t.data)===Pn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Un)return"compositionend"===e||!Mn&&Wn(e,t)?(e=en(),$t=Zt=Qt=null,Un=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}Pr(o,t)}))}function jr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Fe(e,n))&&r.unshift(jr(e,i,a)),null!=(i=Fe(e,t))&&r.push(jr(e,i,a))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=Fe(n,i))&&o.unshift(jr(n,u,s)):a||null!=(u=Fe(n,i))&&o.push(jr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Qr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Jr,"")}function Zr(e,t,n){if(t=Qr(t),Qr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Ut(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Ut(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var pa=Math.random().toString(36).slice(2),ha="__reactFiber$"+pa,da="__reactProps$"+pa,fa="__reactContainer$"+pa,ma="__reactEvents$"+pa,va="__reactListeners$"+pa,ga="__reactHandles$"+pa;function ya(e){var t=e[ha];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fa]||n[ha]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[ha])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[ha]||e[fa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function ka(e){return e[da]||null}var wa=[],Ia=-1;function Sa(e){return{current:e}}function Na(e){0>Ia||(e.current=wa[Ia],wa[Ia]=null,Ia--)}function Ta(e,t){Ia++,wa[Ia]=e.current,e.current=t}var Ca={},Ea=Sa(Ca),_a=Sa(!1),Aa=Ca;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ca;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Fa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){Na(_a),Na(Ea)}function Ma(e,t,n){if(Ea.current!==Ca)throw Error(i(168));Ta(Ea,t),Ta(_a,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,G(e)||"Unknown",a));return z({},n,r)}function La(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ca,Aa=Ea.current,Ta(Ea,e),Ta(_a,_a.current),!0}function za(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,Na(_a),Na(Ea),Ta(Ea,e)):Na(_a),Ta(_a,n)}var Pa=null,Ba=!1,Wa=!1;function Va(e){null===Pa?Pa=[e]:Pa.push(e)}function Ua(){if(!Wa&&null!==Pa){Wa=!0;var e=0,t=bt;try{var n=Pa;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Pa=null,Ba=!1}catch(a){throw null!==Pa&&(Pa=Pa.slice(e+1)),Ke($e,Ua),a}finally{bt=t,Wa=!1}}return null}var Ga=[],Ha=0,ja=null,qa=0,Ka=[],Xa=0,Ya=null,Ja=1,Qa="";function Za(e,t){Ga[Ha++]=qa,Ga[Ha++]=ja,ja=e,qa=t}function $a(e,t,n){Ka[Xa++]=Ja,Ka[Xa++]=Qa,Ka[Xa++]=Ya,Ya=e;var r=Ja;e=Qa;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Ja=1<<32-ot(t)+a|n<<a|r,Qa=i+e}else Ja=1<<i|n<<a|r,Qa=e}function ei(e){null!==e.return&&(Za(e,1),$a(e,1,0))}function ti(e){for(;e===ja;)ja=Ga[--Ha],Ga[Ha]=null,qa=Ga[--Ha],Ga[Ha]=null;for(;e===Ya;)Ya=Ka[--Xa],Ka[Xa]=null,Qa=Ka[--Xa],Ka[Xa]=null,Ja=Ka[--Xa],Ka[Xa]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Fc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:Ja,overflow:Qa}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Fc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function pi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw hi(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function hi(){for(var e=ri;e;)e=ca(e.nextSibling)}function di(){ri=ni=null,ai=!1}function fi(e){null===ii?ii=[e]:ii.push(e)}var mi=x.ReactCurrentBatchConfig;function vi(e,t){if(e&&e.defaultProps){for(var n in t=z({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Sa(null),yi=null,bi=null,xi=null;function ki(){xi=bi=yi=null}function wi(e){var t=gi.current;Na(gi),e._currentValue=t}function Ii(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Si(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ni(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ti=null;function Ci(e){null===Ti?Ti=[e]:Ti.push(e)}function Ei(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ci(t)):(n.next=a.next,a.next=n),t.interleaved=n,_i(e,r)}function _i(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ai=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Mi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&_u)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,_i(e,n)}return null===(a=r.interleaved)?(t.next=t,Ci(r)):(t.next=a.next,a.next=t),r.interleaved=t,_i(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Li(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function zi(e,t,n,r){var a=e.updateQueue;Ai=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var p=a.baseState;for(o=0,l=c=u=null,s=i;;){var h=s.lane,d=s.eventTime;if((r&h)===h){null!==l&&(l=l.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,d=n,m.tag){case 1:if("function"===typeof(f=m.payload)){p=f.call(d,p,h);break e}p=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(d,p,h):f)||void 0===h)break e;p=z({},p,h);break e;case 2:Ai=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=a.effects)?a.effects=[s]:h.push(s))}else d={eventTime:d,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=d,u=p):l=l.next=d,o|=h;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(h=s).next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}if(null===l&&(u=p),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);zu|=o,e.lanes=o,e.memoizedState=p}}function Pi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Bi=(new r.Component).refs;function Wi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:z({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vi={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Mi(e,i,a))&&(rc(t,e,a,r),Oi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Mi(e,i,a))&&(rc(t,e,a,r),Oi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Mi(e,a,r))&&(rc(t,e,r,n),Oi(t,e,r))}};function Ui(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function Gi(e,t,n){var r=!1,a=Ca,i=t.contextType;return"object"===typeof i&&null!==i?i=Ni(i):(a=Fa(t)?Aa:Ea.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ca),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Hi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Vi.enqueueReplaceState(t,t.state,null)}function ji(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Bi,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ni(i):(i=Fa(t)?Aa:Ea.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Wi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Vi.enqueueReplaceState(a,a.state,null),zi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function qi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Bi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function Ki(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xi(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Pc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===I?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===F&&Xi(i)===t.type)?((r=a(t,n.props)).ref=qi(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=qi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Pc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=qi(e,null,t),n.return=e,n;case w:return(t=Bc(t,e.mode,n)).return=e,t;case F:return h(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Lc(t,e.mode,n,null)).return=e,t;Ki(e,t)}return null}function d(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===a?c(e,t,n,r):null;case w:return n.key===a?l(e,t,n,r):null;case F:return d(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:p(e,t,n,r,null);Ki(e,n)}return null}function f(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case F:return f(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return p(t,e=e.get(n)||null,r,a,null);Ki(t,r)}return null}function m(a,i,s,u){for(var c=null,l=null,p=i,m=i=0,v=null;null!==p&&m<s.length;m++){p.index>m?(v=p,p=null):v=p.sibling;var g=d(a,p,s[m],u);if(null===g){null===p&&(p=v);break}e&&p&&null===g.alternate&&t(a,p),i=o(g,i,m),null===l?c=g:l.sibling=g,l=g,p=v}if(m===s.length)return n(a,p),ai&&Za(a,m),c;if(null===p){for(;m<s.length;m++)null!==(p=h(a,s[m],u))&&(i=o(p,i,m),null===l?c=p:l.sibling=p,l=p);return ai&&Za(a,m),c}for(p=r(a,p);m<s.length;m++)null!==(v=f(p,a,m,s[m],u))&&(e&&null!==v.alternate&&p.delete(null===v.key?m:v.key),i=o(v,i,m),null===l?c=v:l.sibling=v,l=v);return e&&p.forEach((function(e){return t(a,e)})),ai&&Za(a,m),c}function v(a,s,u,c){var l=O(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var p=l=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=d(a,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),s=o(b,s,v),null===p?l=b:p.sibling=b,p=b,m=g}if(y.done)return n(a,m),ai&&Za(a,v),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=h(a,y.value,c))&&(s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return ai&&Za(a,v),l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=f(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return e&&m.forEach((function(e){return t(a,e)})),ai&&Za(a,v),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===I&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===I){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===F&&Xi(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=qi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===I?((i=Lc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Oc(o.type,o.key,o.props,null,r.mode,u)).ref=qi(r,i,o),u.return=r,r=u)}return s(r);case w:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Bc(o,r.mode,u)).return=r,r=i}return s(r);case F:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return m(r,i,o,u);if(O(o))return v(r,i,o,u);Ki(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Pc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Ji=Yi(!0),Qi=Yi(!1),Zi={},$i=Sa(Zi),eo=Sa(Zi),to=Sa(Zi);function no(e){if(e===Zi)throw Error(i(174));return e}function ro(e,t){switch(Ta(to,t),Ta(eo,e),Ta($i,Zi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Na($i),Ta($i,t)}function ao(){Na($i),Na(eo),Na(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ta(eo,e),Ta($i,n))}function oo(e){eo.current===e&&(Na($i),Na(eo))}var so=Sa(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var po=x.ReactCurrentDispatcher,ho=x.ReactCurrentBatchConfig,fo=0,mo=null,vo=null,go=null,yo=!1,bo=!1,xo=0,ko=0;function wo(){throw Error(i(321))}function Io(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function So(e,t,n,r,a,o){if(fo=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,po.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=vo=null,t.updateQueue=null,po.current=cs,e=n(r,a)}while(bo)}if(po.current=os,t=null!==vo&&null!==vo.next,fo=0,go=vo=mo=null,yo=!1,t)throw Error(i(300));return e}function No(){var e=0!==xo;return xo=0,e}function To(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===vo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,vo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function Eo(e,t){return"function"===typeof t?t(e):t}function _o(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=vo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var p=l.lane;if((fo&p)===p)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var h={lane:p,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=h,s=r):c=c.next=h,mo.lanes|=p,zu|=p}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,mo.lanes|=o,zu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Fo(e,t){var n=mo,r=Co(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,Ho(Oo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Bo(9,Mo.bind(null,n,r,a,t),void 0,null),null===Au)throw Error(i(349));0!==(30&fo)||Do(n,t,a)}return a}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Mo(e,t,n,r){t.value=n,t.getSnapshot=r,Lo(t)&&zo(e)}function Oo(e,t,n){return n((function(){Lo(t)&&zo(e)}))}function Lo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function zo(e){var t=_i(e,1);null!==t&&rc(t,e,1,-1)}function Po(e){var t=To();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Wo(){return Co().memoizedState}function Vo(e,t,n,r){var a=To();mo.flags|=e,a.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function Uo(e,t,n,r){var a=Co();r=void 0===r?null:r;var i=void 0;if(null!==vo){var o=vo.memoizedState;if(i=o.destroy,null!==r&&Io(r,o.deps))return void(a.memoizedState=Bo(t,n,i,r))}mo.flags|=e,a.memoizedState=Bo(1|t,n,i,r)}function Go(e,t){return Vo(8390656,8,e,t)}function Ho(e,t){return Uo(2048,8,e,t)}function jo(e,t){return Uo(4,2,e,t)}function qo(e,t){return Uo(4,4,e,t)}function Ko(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4,4,Ko.bind(null,t,e),n)}function Yo(){}function Jo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Io(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Qo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Io(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Zo(e,t,n){return 0===(21&fo)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),mo.lanes|=n,zu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=ho.transition;ho.transition={};try{e(!1),t()}finally{bt=n,ho.transition=r}}function es(){return Co().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ei(e,t,n,r))){rc(n,e,r,tc()),is(n,t,r)}}function ns(e,t,n){var r=nc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ci(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ei(e,t,a,r))&&(rc(n,e,r,a=tc()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ni,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ni,useCallback:function(e,t){return To().memoizedState=[e,void 0===t?null:t],e},useContext:Ni,useEffect:Go,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Vo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vo(4,2,e,t)},useMemo:function(e,t){var n=To();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=To();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,mo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},To().memoizedState=e},useState:Po,useDebugValue:Yo,useDeferredValue:function(e){return To().memoizedState=e},useTransition:function(){var e=Po(!1),t=e[0];return e=$o.bind(null,e[1]),To().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=mo,a=To();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Au)throw Error(i(349));0!==(30&fo)||Do(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Go(Oo.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Mo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=To(),t=Au.identifierPrefix;if(ai){var n=Qa;t=":"+t+"R"+(n=(Ja&~(1<<32-ot(Ja)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ko++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ni,useCallback:Jo,useContext:Ni,useEffect:Ho,useImperativeHandle:Xo,useInsertionEffect:jo,useLayoutEffect:qo,useMemo:Qo,useReducer:_o,useRef:Wo,useState:function(){return _o(Eo)},useDebugValue:Yo,useDeferredValue:function(e){return Zo(Co(),vo.memoizedState,e)},useTransition:function(){return[_o(Eo)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1},cs={readContext:Ni,useCallback:Jo,useContext:Ni,useEffect:Ho,useImperativeHandle:Xo,useInsertionEffect:jo,useLayoutEffect:qo,useMemo:Qo,useReducer:Ao,useRef:Wo,useState:function(){return Ao(Eo)},useDebugValue:Yo,useDeferredValue:function(e){var t=Co();return null===vo?t.memoizedState=e:Zo(t,vo.memoizedState,e)},useTransition:function(){return[Ao(Eo)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function ps(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function hs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ju||(ju=!0,qu=r),hs(0,t)},n}function ms(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){hs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){hs(0,t),"function"!==typeof r&&(null===Ku?Ku=new Set([this]):Ku.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Tc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Mi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ks(e,t,n,r){t.child=null===e?Qi(t,null,n,r):Ji(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return Si(t,a),r=So(e,t,n,r,i,a),n=No(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ks(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function Is(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Dc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ss(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return js(e,t,a)}return t.flags|=1,(e=Mc(i,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,js(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Cs(e,t,n,r,a)}function Ns(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ta(Mu,Du),Du|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ta(Mu,Du),Du|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ta(Mu,Du),Du|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ta(Mu,Du),Du|=r;return ks(e,t,a,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,r,a){var i=Fa(n)?Aa:Ea.current;return i=Ra(t,i),Si(t,a),n=So(e,t,n,r,i,a),r=No(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ks(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function Es(e,t,n,r,a){if(Fa(n)){var i=!0;La(t)}else i=!1;if(Si(t,a),null===t.stateNode)Hs(e,t),Gi(t,n,r),ji(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ni(c):c=Ra(t,c=Fa(n)?Aa:Ea.current);var l=n.getDerivedStateFromProps,p="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;p||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Hi(t,o,r,c),Ai=!1;var h=t.memoizedState;o.state=h,zi(t,r,o,a),u=t.memoizedState,s!==r||h!==u||_a.current||Ai?("function"===typeof l&&(Wi(t,n,l,r),u=t.memoizedState),(s=Ai||Ui(t,n,s,r,h,u,c))?(p||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Fi(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:vi(t.type,s),o.props=c,p=t.pendingProps,h=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ni(u):u=Ra(t,u=Fa(n)?Aa:Ea.current);var d=n.getDerivedStateFromProps;(l="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==p||h!==u)&&Hi(t,o,r,u),Ai=!1,h=t.memoizedState,o.state=h,zi(t,r,o,a);var f=t.memoizedState;s!==p||h!==f||_a.current||Ai?("function"===typeof d&&(Wi(t,n,d,r),f=t.memoizedState),(c=Ai||Ui(t,n,c,r,h,f,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return _s(e,t,n,r,i,a)}function _s(e,t,n,r,a,i){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&za(t,n,!1),js(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ji(t,e.child,null,i),t.child=Ji(t,null,s,i)):ks(e,t,s,i),t.memoizedState=r.state,a&&za(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Ma(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ma(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return di(),fi(a),t.flags|=256,ks(e,t,n,r),t.child}var Fs,Ds,Ms,Os,Ls={dehydrated:null,treeContext:null,retryLane:0};function zs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ps(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ta(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=zc(u,a,0,null),e=Lc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=zs(n),t.memoizedState=Ls,e):Bs(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ws(e,t,s,r=ps(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=zc({mode:"visible",children:r.children},a,0,null),(o=Lc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Ji(t,e.child,null,s),t.child.memoizedState=zs(s),t.memoizedState=Ls,o);if(0===(1&t.mode))return Ws(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Ws(e,t,s,r=ps(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=Au)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,_i(e,a),rc(r,e,a,-1))}return vc(),Ws(e,t,s,r=ps(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Ka[Xa++]=Ja,Ka[Xa++]=Qa,Ka[Xa++]=Ya,Ja=e.id,Qa=e.overflow,Ya=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Mc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Mc(r,s):(s=Lc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?zs(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ls,a}return e=(s=e.child).sibling,a=Mc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Bs(e,t){return(t=zc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ws(e,t,n,r){return null!==r&&fi(r),Ji(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ii(e.return,t,n)}function Us(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Gs(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vs(e,n,t);else if(19===e.tag)Vs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ta(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Us(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Us(t,!0,n,null,i);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Hs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return Fa(t.type)&&Da(),Ks(t),null;case 3:return r=t.stateNode,ao(),Na(_a),Na(Ea),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(pi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(sc(ii),ii=null))),Ds(e,t),Ks(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ks(t),null}if(e=no($i.current),pi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[ha]=t,r[da]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":J(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ae(r,o),Br("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Zr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":q(r),$(r,o,!0);break;case"textarea":q(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[ha]=t,e[da]=r,Fs(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),a=r;break;case"iframe":case"object":case"embed":Br("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],e);a=r;break;case"source":Br("error",e),a=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),a=r;break;case"details":Br("toggle",e),a=r;break;case"input":J(e,r),a=Y(e,r),Br("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=z({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Br("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?ve(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&pe(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&he(e,l):"number"===typeof l&&he(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Br("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":q(e),$(e,r,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Os(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),pi(t)){if(r=t.stateNode,n=t.memoizedProps,r[ha]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Zr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ha]=t,t.stateNode=r}return Ks(t),null;case 13:if(Na(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))hi(),di(),t.flags|=98560,o=!1;else if(o=pi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[ha]=t}else di(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),o=!1}else null!==ii&&(sc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Ou&&(Ou=3):vc())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return ao(),Ds(e,t),null===e&&Ur(t.stateNode.containerInfo),Ks(t),null;case 10:return wi(t.type._context),Ks(t),null;case 19:if(Na(so),null===(o=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)qs(o,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,qs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ta(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Qe()>Gu&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Ks(t),null}else 2*Qe()-o.renderingStartTime>Gu&&1073741824!==n&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Qe(),t.sibling=null,n=so.current,Ta(so,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Du)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ys(e,t){switch(ti(t),t.tag){case 1:return Fa(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Na(_a),Na(Ea),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Na(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));di()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Na(so),null;case 4:return ao(),null;case 10:return wi(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Fs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ms=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=z({},a,{value:void 0}),r=z({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Br("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Js=!1,Qs=!1,Zs="function"===typeof WeakSet?WeakSet:Set,$s=null;function eu(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Nc(e,t,r)}else n.current=null}function tu(e,t,n){try{n()}catch(r){Nc(e,t,r)}}var nu=!1;function ru(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&tu(t,n,i)}a=a.next}while(a!==r)}}function au(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ha],delete t[da],delete t[ma],delete t[va],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function uu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var pu=null,hu=!1;function du(e,t,n){for(n=n.child;null!==n;)fu(e,t,n),n=n.sibling}function fu(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Qs||eu(n,t);case 6:var r=pu,a=hu;pu=null,du(e,t,n),hu=a,null!==(pu=r)&&(hu?(e=pu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):pu.removeChild(n.stateNode));break;case 18:null!==pu&&(hu?(e=pu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Ut(e)):ua(pu,n.stateNode));break;case 4:r=pu,a=hu,pu=n.stateNode.containerInfo,hu=!0,du(e,t,n),pu=r,hu=a;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&tu(n,t,o),a=a.next}while(a!==r)}du(e,t,n);break;case 1:if(!Qs&&(eu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Nc(n,t,s)}du(e,t,n);break;case 21:du(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,du(e,t,n),Qs=r):du(e,t,n);break;default:du(e,t,n)}}function mu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zs),t.forEach((function(t){var r=_c.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:pu=u.stateNode,hu=!1;break e;case 3:case 4:pu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===pu)throw Error(i(160));fu(o,s,a),pu=null,hu=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){Nc(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),yu(e),4&r){try{ru(3,e,e.return),au(3,e)}catch(v){Nc(e,e.return,v)}try{ru(5,e,e.return)}catch(v){Nc(e,e.return,v)}}break;case 1:vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return);break;case 5:if(vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return),32&e.flags){var a=e.stateNode;try{he(a,"")}catch(v){Nc(e,e.return,v)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&Q(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var p=c[s],h=c[s+1];"style"===p?ve(a,h):"dangerouslySetInnerHTML"===p?pe(a,h):"children"===p?he(a,h):b(a,p,h,l)}switch(u){case"input":Z(a,o);break;case"textarea":ie(a,o);break;case"select":var d=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ne(a,!!o.multiple,f,!1):d!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[da]=o}catch(v){Nc(e,e.return,v)}}break;case 6:if(vu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(v){Nc(e,e.return,v)}}break;case 3:if(vu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(v){Nc(e,e.return,v)}break;case 4:default:vu(t,e),yu(e);break;case 13:vu(t,e),yu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Uu=Qe())),4&r&&mu(e);break;case 22:if(p=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||p,vu(t,e),Qs=l):vu(t,e),yu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!p&&0!==(1&e.mode))for($s=e,p=e.child;null!==p;){for(h=$s=p;null!==$s;){switch(f=(d=$s).child,d.tag){case 0:case 11:case 14:case 15:ru(4,d,d.return);break;case 1:eu(d,d.return);var m=d.stateNode;if("function"===typeof m.componentWillUnmount){r=d,n=d.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){Nc(r,n,v)}}break;case 5:eu(d,d.return);break;case 22:if(null!==d.memoizedState){wu(h);continue}}null!==f?(f.return=d,$s=f):wu(h)}p=p.sibling}e:for(p=null,h=e;;){if(5===h.tag){if(null===p){p=h;try{a=h.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=me("display",s))}catch(v){Nc(e,e.return,v)}}}else if(6===h.tag){if(null===p)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){Nc(e,e.return,v)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;p===h&&(p=null),h=h.return}p===h&&(p=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:vu(t,e),yu(e),4&r&&mu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(he(a,""),r.flags&=-33),lu(e,uu(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;cu(e,uu(e),o);break;default:throw Error(i(161))}}catch(s){Nc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bu(e,t,n){$s=e,xu(e,t,n)}function xu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var a=$s,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Js;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Qs;s=Js;var c=Qs;if(Js=o,(Qs=u)&&!c)for($s=a;null!==$s;)u=(o=$s).child,22===o.tag&&null!==o.memoizedState?Iu(a):null!==u?(u.return=o,$s=u):Iu(a);for(;null!==i;)$s=i,xu(i,t,n),i=i.sibling;$s=a,Js=s,Qs=c}ku(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,$s=i):ku(e)}}function ku(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||au(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Pi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Pi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var p=l.memoizedState;if(null!==p){var h=p.dehydrated;null!==h&&Ut(h)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&iu(t)}catch(d){Nc(t,t.return,d)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wu(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Iu(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{au(4,t)}catch(u){Nc(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){Nc(t,a,u)}}var i=t.return;try{iu(t)}catch(u){Nc(t,i,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){Nc(t,o,u)}}}catch(u){Nc(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Su,Nu=Math.ceil,Tu=x.ReactCurrentDispatcher,Cu=x.ReactCurrentOwner,Eu=x.ReactCurrentBatchConfig,_u=0,Au=null,Ru=null,Fu=0,Du=0,Mu=Sa(0),Ou=0,Lu=null,zu=0,Pu=0,Bu=0,Wu=null,Vu=null,Uu=0,Gu=1/0,Hu=null,ju=!1,qu=null,Ku=null,Xu=!1,Yu=null,Ju=0,Qu=0,Zu=null,$u=-1,ec=0;function tc(){return 0!==(6&_u)?Qe():-1!==$u?$u:$u=Qe()}function nc(e){return 0===(1&e.mode)?1:0!==(2&_u)&&0!==Fu?Fu&-Fu:null!==mi.transition?(0===ec&&(ec=mt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function rc(e,t,n,r){if(50<Qu)throw Qu=0,Zu=null,Error(i(185));gt(e,n,r),0!==(2&_u)&&e===Au||(e===Au&&(0===(2&_u)&&(Pu|=n),4===Ou&&uc(e,Fu)),ac(e,r),1===n&&0===_u&&0===(1&t.mode)&&(Gu=Qe()+500,Ba&&Ua()))}function ac(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=dt(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=ht(e,e===Au?Fu:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Ba=!0,Va(e)}(cc.bind(null,e)):Va(cc.bind(null,e)),oa((function(){0===(6&_u)&&Ua()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ac(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if($u=-1,ec=0,0!==(6&_u))throw Error(i(327));var n=e.callbackNode;if(Ic()&&e.callbackNode!==n)return null;var r=ht(e,e===Au?Fu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var a=_u;_u|=2;var o=mc();for(Au===e&&Fu===t||(Hu=null,Gu=Qe()+500,dc(e,t));;)try{bc();break}catch(u){fc(e,u)}ki(),Tu.current=o,_u=a,null!==Ru?t=0:(Au=null,Fu=0,t=Ou)}if(0!==t){if(2===t&&(0!==(a=ft(e))&&(r=a,t=oc(e,a))),1===t)throw n=Lu,dc(e,0),uc(e,r),ac(e,Qe()),n;if(6===t)uc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gc(e,r))&&(0!==(o=ft(e))&&(r=o,t=oc(e,o))),1===t))throw n=Lu,dc(e,0),uc(e,r),ac(e,Qe()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wc(e,Vu,Hu);break;case 3:if(uc(e,r),(130023424&r)===r&&10<(t=Uu+500-Qe())){if(0!==ht(e,0))break;if(((a=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(wc.bind(null,e,Vu,Hu),t);break}wc(e,Vu,Hu);break;case 4:if(uc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Qe()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Nu(r/1960))-r)){e.timeoutHandle=ra(wc.bind(null,e,Vu,Hu),r);break}wc(e,Vu,Hu);break;default:throw Error(i(329))}}}return ac(e,Qe()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=Wu;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Vu,Vu=n,null!==t&&sc(t)),e}function sc(e){null===Vu?Vu=e:Vu.push.apply(Vu,e)}function uc(e,t){for(t&=~Bu,t&=~Pu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&_u))throw Error(i(327));Ic();var t=ht(e,0);if(0===(1&t))return ac(e,Qe()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Lu,dc(e,0),uc(e,t),ac(e,Qe()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Vu,Hu),ac(e,Qe()),null}function lc(e,t){var n=_u;_u|=1;try{return e(t)}finally{0===(_u=n)&&(Gu=Qe()+500,Ba&&Ua())}}function pc(e){null!==Yu&&0===Yu.tag&&0===(6&_u)&&Ic();var t=_u;_u|=1;var n=Eu.transition,r=bt;try{if(Eu.transition=null,bt=1,e)return e()}finally{bt=r,Eu.transition=n,0===(6&(_u=t))&&Ua()}}function hc(){Du=Mu.current,Na(Mu)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ru)for(n=Ru.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:ao(),Na(_a),Na(Ea),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:Na(so);break;case 10:wi(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Au=e,Ru=e=Mc(e.current,null),Fu=Du=t,Ou=0,Lu=null,Bu=Pu=zu=0,Vu=Wu=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(r=(n=Ti[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ti=null}return e}function fc(e,t){for(;;){var n=Ru;try{if(ki(),po.current=os,yo){for(var r=mo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(fo=0,go=vo=mo=null,bo=!1,xo=0,Cu.current=null,null===n||null===n.return){Ou=1,Lu=t,Ru=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Fu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,p=u,h=p.tag;if(0===(1&p.mode)&&(0===h||11===h||15===h)){var d=p.alternate;d?(p.updateQueue=d.updateQueue,p.memoizedState=d.memoizedState,p.lanes=d.lanes):(p.updateQueue=null,p.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,ys(f,s,u,0,t),1&f.mode&&vs(o,l,t),c=l;var m=(t=f).updateQueue;if(null===m){var v=new Set;v.add(c),t.updateQueue=v}else m.add(c);break e}if(0===(1&t)){vs(o,l,t),vc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),fi(ls(c,u));break e}}o=c=ls(c,u),4!==Ou&&(Ou=2),null===Wu?Wu=[o]:Wu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Li(o,fs(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ku||!Ku.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Li(o,ms(o,u,t));break e}}o=o.return}while(null!==o)}kc(n)}catch(x){t=x,Ru===n&&null!==n&&(Ru=n=n.return);continue}break}}function mc(){var e=Tu.current;return Tu.current=os,null===e?os:e}function vc(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Au||0===(268435455&zu)&&0===(268435455&Pu)||uc(Au,Fu)}function gc(e,t){var n=_u;_u|=2;var r=mc();for(Au===e&&Fu===t||(Hu=null,dc(e,t));;)try{yc();break}catch(a){fc(e,a)}if(ki(),_u=n,Tu.current=r,null!==Ru)throw Error(i(261));return Au=null,Fu=0,Ou}function yc(){for(;null!==Ru;)xc(Ru)}function bc(){for(;null!==Ru&&!Ye();)xc(Ru)}function xc(e){var t=Su(e.alternate,e,Du);e.memoizedProps=e.pendingProps,null===t?kc(e):Ru=t,Cu.current=null}function kc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Du)))return void(Ru=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Ru=n);if(null===e)return Ou=6,void(Ru=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ru=t);Ru=t=e}while(null!==t);0===Ou&&(Ou=5)}function wc(e,t,n){var r=bt,a=Eu.transition;try{Eu.transition=null,bt=1,function(e,t,n,r){do{Ic()}while(null!==Yu);if(0!==(6&_u))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Au&&(Ru=Au=null,Fu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xu||(Xu=!0,Ac(tt,(function(){return Ic(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Eu.transition,Eu.transition=null;var s=bt;bt=1;var u=_u;_u|=4,Cu.current=null,function(e,t){if(ea=Ht,dr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(k){n=null;break e}var s=0,u=-1,c=-1,l=0,p=0,h=e,d=null;t:for(;;){for(var f;h!==n||0!==a&&3!==h.nodeType||(u=s+a),h!==o||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)d=h,h=f;for(;;){if(h===e)break t;if(d===n&&++l===a&&(u=s),d===o&&++p===r&&(c=s),null!==(f=h.nextSibling))break;d=(h=d).parentNode}h=f}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Ht=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:vi(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(k){Nc(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=nu,nu=!1}(e,n),gu(n,e),fr(ta),Ht=!!ea,ta=ea=null,e.current=n,bu(n,e,a),Je(),_u=u,bt=s,Eu.transition=o}else e.current=n;if(Xu&&(Xu=!1,Yu=e,Ju=a),o=e.pendingLanes,0===o&&(Ku=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ac(e,Qe()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(ju)throw ju=!1,e=qu,qu=null,e;0!==(1&Ju)&&0!==e.tag&&Ic(),o=e.pendingLanes,0!==(1&o)?e===Zu?Qu++:(Qu=0,Zu=e):Qu=0,Ua()}(e,t,n,r)}finally{Eu.transition=a,bt=r}return null}function Ic(){if(null!==Yu){var e=xt(Ju),t=Eu.transition,n=bt;try{if(Eu.transition=null,bt=16>e?16:e,null===Yu)var r=!1;else{if(e=Yu,Yu=null,Ju=0,0!==(6&_u))throw Error(i(331));var a=_u;for(_u|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for($s=l;null!==$s;){var p=$s;switch(p.tag){case 0:case 11:case 15:ru(8,p,o)}var h=p.child;if(null!==h)h.return=p,$s=h;else for(;null!==$s;){var d=(p=$s).sibling,f=p.return;if(ou(p),p===l){$s=null;break}if(null!==d){d.return=f,$s=d;break}$s=f}}}var m=o.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var b=e.current;for($s=b;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:au(9,u)}}catch(w){Nc(u,u.return,w)}if(u===s){$s=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,$s=k;break e}$s=u.return}}if(_u=a,Ua(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(w){}r=!0}return r}finally{bt=n,Eu.transition=t}}return!1}function Sc(e,t,n){e=Mi(e,t=fs(0,t=ls(n,t),1),1),t=tc(),null!==e&&(gt(e,1,t),ac(e,t))}function Nc(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ku||!Ku.has(r))){t=Mi(t,e=ms(t,e=ls(n,e),1),1),e=tc(),null!==t&&(gt(t,1,e),ac(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Au===e&&(Fu&n)===n&&(4===Ou||3===Ou&&(130023424&Fu)===Fu&&500>Qe()-Uu?dc(e,0):Bu|=n),ac(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=tc();null!==(e=_i(e,t))&&(gt(e,t,n),ac(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function _c(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Cc(e,n)}function Ac(e,t){return Ke(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fc(e,t,n,r){return new Rc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Fc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case I:return Lc(n.children,a,o,t);case S:s=8,a|=8;break;case N:return(e=Fc(12,n,t,2|a)).elementType=N,e.lanes=o,e;case _:return(e=Fc(13,n,t,a)).elementType=_,e.lanes=o,e;case A:return(e=Fc(19,n,t,a)).elementType=A,e.lanes=o,e;case D:return zc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case C:s=9;break e;case E:s=11;break e;case R:s=14;break e;case F:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Fc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Lc(e,t,n,r){return(e=Fc(7,e,r,t)).lanes=n,e}function zc(e,t,n,r){return(e=Fc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Pc(e,t,n){return(e=Fc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=Fc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Vc(e,t,n,r,a,i,o,s,u){return e=new Wc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Fc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Uc(e){if(!e)return Ca;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Fa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Fa(n))return Oa(e,n,t)}return t}function Gc(e,t,n,r,a,i,o,s,u){return(e=Vc(n,r,!0,e,0,i,0,s,u)).context=Uc(null),n=e.current,(i=Di(r=tc(),a=nc(n))).callback=void 0!==t&&null!==t?t:null,Mi(n,i,a),e.current.lanes=a,gt(e,a,r),ac(e,r),e}function Hc(e,t,n,r){var a=t.current,i=tc(),o=nc(a);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Mi(a,t,o))&&(rc(e,a,o,i),Oi(e,a,o)),o}function jc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}Su=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||_a.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:As(t),di();break;case 5:io(t);break;case 1:Fa(t.type)&&La(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ta(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ta(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ps(e,t,n):(Ta(so,1&so.current),null!==(e=js(e,t,n))?e.sibling:null);Ta(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Gs(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ta(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Ns(e,t,n)}return js(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,qa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Hs(e,t),e=t.pendingProps;var a=Ra(t,Ea.current);Si(t,n),a=So(null,t,r,e,a,n);var o=No();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Fa(r)?(o=!0,La(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Vi,t.stateNode=a,a._reactInternals=t,ji(t,r,e,n),t=_s(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ks(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Hs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===E)return 11;if(e===R)return 14}return 2}(r),e=vi(r,e),a){case 0:t=Cs(null,t,r,e,n);break e;case 1:t=Es(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Is(null,t,r,vi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Cs(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 3:e:{if(As(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Fi(e,t),zi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Qi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(di(),r===a){t=js(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Ts(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Ps(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ji(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ta(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!_a.current){t=js(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Di(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var p=(l=l.shared).pending;null===p?c.next=c:(c.next=p.next,p.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ii(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Ii(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ks(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Si(t,n),r=r(a=Ni(a)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return a=vi(r=t.type,t.pendingProps),Is(e,t,r,a=vi(r.type,a),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:vi(r,a),Hs(e,t),t.tag=1,Fa(r)?(e=!0,La(t)):e=!1,Si(t,n),Gi(t,r,a),ji(t,r,a,n),_s(null,t,r,!0,e,n);case 19:return Gs(e,t,n);case 22:return Ns(e,t,n)}throw Error(i(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Jc(e){this._internalRoot=e}function Qc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=jc(o);s.call(e)}}Hc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=jc(o);i.call(e)}}var o=Gc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[fa]=o.current,Ur(8===e.nodeType?e.parentNode:e),pc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=jc(u);s.call(e)}}var u=Vc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[fa]=u.current,Ur(8===e.nodeType?e.parentNode:e),pc((function(){Hc(t,u,n,r)})),u}(n,t,e,a,r);return jc(o)}Jc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Hc(e,t,null,null)},Jc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;pc((function(){Hc(null,e,null,null)})),t[fa]=null}},Jc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&zt(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=pt(t.pendingLanes);0!==n&&(yt(t,1|n),ac(t,Qe()),0===(6&_u)&&(Gu=Qe()+500,Ua()))}break;case 13:pc((function(){var t=_i(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Kc(e,1)}},wt=function(e){if(13===e.tag){var t=_i(e,134217728);if(null!==t)rc(t,e,134217728,tc());Kc(e,134217728)}},It=function(e){if(13===e.tag){var t=nc(e),n=_i(e,t);if(null!==n)rc(n,e,t,tc());Kc(e,t)}},St=function(){return bt},Nt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=ka(r);if(!a)throw Error(i(90));K(r),Z(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ee=lc,_e=pc;var tl={usingClientEntryPoint:!1,Events:[ba,xa,ka,Te,Ce,lc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=je(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Qc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Qc(e))throw Error(i(299));var n=!1,r="",a=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Vc(e,1,!1,null,0,n,0,r,a),e[fa]=t.current,Ur(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=je(t))?null:e.stateNode},t.flushSync=function(e){return pc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Qc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,a,0,o,s),e[fa]=t.current,Ur(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Jc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(i(40));return!!e._reactRootContainer&&(pc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[fa]=null}))})),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},97:function(e,t,n){var r;r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},i.apply(this,arguments)},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n};function s(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)}"undefined"!==typeof window&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,r){t.call(navigator,e,n,r)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}));var u=function(e){function t(t){var n=e.call(this,t)||this;return n.canvas=null,n.ctx=null,n.requestUserMediaId=0,n.unmounted=!1,n.state={hasUserMedia:!1},n}return a(t,e),t.prototype.componentDidMount=function(){var e=this.state,t=this.props;this.unmounted=!1,s()?(e.hasUserMedia||this.requestUserMedia(),t.children&&"function"!=typeof t.children&&console.warn("children must be a function")):t.onUserMediaError("getUserMedia not supported")},t.prototype.componentDidUpdate=function(e){var t=this.props;if(s()){var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),r=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),a=e.minScreenshotWidth!==t.minScreenshotWidth,i=e.minScreenshotHeight!==t.minScreenshotHeight;(r||a||i)&&(this.canvas=null,this.ctx=null),(n||r)&&(this.stopAndCleanup(),this.requestUserMedia())}else t.onUserMediaError("getUserMedia not supported")},t.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},t.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().map((function(t){e.removeTrack(t),t.stop()}))):e.stop())},t.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(t.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},t.prototype.getScreenshot=function(e){var t=this.state,n=this.props;if(!t.hasUserMedia)return null;var r=this.getCanvas(e);return r&&r.toDataURL(n.screenshotFormat,n.screenshotQuality)},t.prototype.getCanvas=function(e){var t=this.state,n=this.props;if(!this.video)return null;if(!t.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var r=this.video.videoWidth,a=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var i=r/a;a=(r=n.minScreenshotWidth||this.video.clientWidth)/i,n.minScreenshotHeight&&a<n.minScreenshotHeight&&(r=(a=n.minScreenshotHeight)*i)}this.canvas=document.createElement("canvas"),this.canvas.width=(null===e||void 0===e?void 0:e.width)||r,this.canvas.height=(null===e||void 0===e?void 0:e.height)||a,this.ctx=this.canvas.getContext("2d")}var o=this.ctx,s=this.canvas;return o&&s&&(n.mirrored&&(o.translate(s.width,0),o.scale(-1,1)),o.imageSmoothingEnabled=n.imageSmoothing,o.drawImage(this.video,0,0,(null===e||void 0===e?void 0:e.width)||s.width,(null===e||void 0===e?void 0:e.height)||s.height),n.mirrored&&(o.scale(-1,1),o.translate(-s.width,0))),s},t.prototype.requestUserMedia=function(){var e=this,n=this.props,r=function(r,a){var i={video:"undefined"===typeof a||a};n.audio&&(i.audio="undefined"===typeof r||r),e.requestUserMediaId++;var o=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(i).then((function(n){e.unmounted||o!==e.requestUserMediaId?t.stopMediaStream(n):e.handleUserMedia(null,n)})).catch((function(t){e.handleUserMedia(t)}))};if("mediaDevices"in navigator)r(n.audioConstraints,n.videoConstraints);else{var a=function(e){return{optional:[{sourceId:e}]}},i=function(e){var t=e.deviceId;return"string"===typeof t?t:Array.isArray(t)&&t.length>0?t[0]:"object"===typeof t&&t.ideal?t.ideal:null};MediaStreamTrack.getSources((function(e){var t=null,o=null;e.forEach((function(e){"audio"===e.kind?t=e.id:"video"===e.kind&&(o=e.id)}));var s=i(n.audioConstraints);s&&(t=s);var u=i(n.videoConstraints);u&&(o=u),r(a(t),a(o))}))}},t.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t)return this.setState({hasUserMedia:!1}),void n.onUserMediaError(e);this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch(r){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},t.prototype.render=function(){var e=this,t=this.state,n=this.props,a=n.audio,s=(n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing,n.mirrored),u=n.style,c=void 0===u?{}:u,l=n.children,p=o(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),h=s?i(i({},c),{transform:(c.transform||"")+" scaleX(-1)"}):c,d={getScreenshot:this.getScreenshot.bind(this)};return r.createElement(r.Fragment,null,r.createElement("video",i({autoPlay:!0,src:t.src,muted:!a,playsInline:!0,ref:function(t){e.video=t},style:h},p)),l&&l(d))},t.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},t}(r.Component);t.default=u},react:function(t,n){t.exports=e}}).default},e.exports=r(n(791))},374:function(e,t,n){"use strict";var r=n(791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),d=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,m(x,g.prototype),x.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,I={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function N(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,a)&&!S.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:I.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function _(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+E(u,0):i,k(o)?(a="",null!=e&&(a=e.replace(C,"$&/")+"/"),_(o,t,a,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",k(e))for(var c=0;c<e.length;c++){var l=i+E(s=e[c],c);u+=_(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=_(s=s.value,t,a,l=i+E(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return _(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var F={current:null},D={transition:null},M={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:D,ReactCurrentOwner:I};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=I.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)w.call(t,c)&&!S.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=N,t.createFactory=function(e){var t=N.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return F.current.useCallback(e,t)},t.useContext=function(e){return F.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return F.current.useDeferredValue(e)},t.useEffect=function(e,t){return F.current.useEffect(e,t)},t.useId=function(){return F.current.useId()},t.useImperativeHandle=function(e,t,n){return F.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return F.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return F.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return F.current.useMemo(e,t)},t.useReducer=function(e,t,n){return F.current.useReducer(e,t,n)},t.useRef=function(e){return F.current.useRef(e)},t.useState=function(e){return F.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return F.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return F.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],p=1,h=null,d=3,f=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(v=!1,x(e),!m)if(null!==r(c))m=!0,D(w);else{var t=r(l);null!==t&&M(k,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(T),T=-1),f=!0;var i=d;try{for(x(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!_());){var o=h.callback;if("function"===typeof o){h.callback=null,d=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(c)&&a(c),x(n)}else a(c);h=r(c)}if(null!==h)var u=!0;else{var p=r(l);null!==p&&M(k,p.startTime-n),u=!1}return u}finally{h=null,d=i,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var I,S=!1,N=null,T=-1,C=5,E=-1;function _(){return!(t.unstable_now()-E<C)}function A(){if(null!==N){var e=t.unstable_now();E=e;var n=!0;try{n=N(!0,e)}finally{n?I():(S=!1,N=null)}}else S=!1}if("function"===typeof b)I=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,F=R.port2;R.port1.onmessage=A,I=function(){F.postMessage(null)}}else I=function(){g(A,0)};function D(e){N=e,S||(S=!0,I())}function M(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:p++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(v?(y(T),T=-1):v=!0,M(k,i-o))):(e.sortIndex=s,n(c,e),m||f||(m=!0,D(w))),e},t.unstable_shouldYield=_,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},699:function(e,t,n){var r=n(501),a=n(112),i=n(132),o=n(890),s=n(113),u=n(725),c=n(411);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},725:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},411:function(e,t,n){var r;!function(a,i,o){var s,u=256,c=o.pow(u,6),l=o.pow(2,52),p=2*l,h=u-1;function d(e,t,n){var r=[],h=g(v((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),d=new f(r),b=function(){for(var e=d.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=d.g(1);for(;e>=p;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|d.g(4)},b.quick=function(){return d.g(4)/4294967296},b.double=b,g(y(d.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&m(r,d),e.state=function(){return m(d,{})}),n?(o.random=e,t):e})(b,h,"global"in t?t.global:this==o,t.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=h&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=h&a+1],n=n*u+o[h&(o[a]=o[i=h&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[h&a]=h&(n^=19*t[h&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(o.random(),i),e.exports){e.exports=d;try{s=n(42)}catch(b){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},410:function(){},628:function(){},778:function(){},755:function(){},4:function(){},759:function(){},549:function(){},401:function(){},42:function(){}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".295b1846.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="combined-project:";n.l=function(r,a,i,o){if(e[r])e[r].push(a);else{var s,u;if(void 0!==i)for(var c=document.getElementsByTagName("script"),l=0;l<c.length;l++){var p=c[l];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==t+i){s=p;break}}s||(u=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+i),s.src=r),e[r]=[a];var h=function(t,n){s.onerror=s.onload=null,clearTimeout(d);var a=e[r];if(delete e[r],s.parentNode&&s.parentNode.removeChild(s),a&&a.forEach((function(e){return e(n)})),t)return t(n)},d=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),u&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/frame-api-co-I/",function(){var e={179:0};n.f.j=function(t,r){var a=n.o(e,t)?e[t]:void 0;if(0!==a)if(a)r.push(a[2]);else{var i=new Promise((function(n,r){a=e[t]=[n,r]}));r.push(a[2]=i);var o=n.p+n.u(t),s=new Error;n.l(o,(function(r){if(n.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",s.name="ChunkLoadError",s.type=i,s.request=o,a[1](s)}}),"chunk-"+t,t)}};var t=function(t,r){var a,i,o=r[0],s=r[1],u=r[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(u)u(n)}for(t&&t(r);c<o.length;c++)i=o[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunkcombined_project=self.webpackChunkcombined_project||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}(),function(){"use strict";var e={};n.r(e),n.d(e,{CompositeArrayBuffer:function(){return E9},browserFiles:function(){return See},browserHTTPRequest:function(){return Lee},concatenateArrayBuffers:function(){return P9},copyModel:function(){return E7},decodeWeights:function(){return F9},encodeWeights:function(){return A9},fromMemory:function(){return Wee},fromMemorySync:function(){return Vee},getLoadHandlers:function(){return Q9},getModelArtifactsForJSON:function(){return U9},getModelArtifactsForJSONSync:function(){return V9},getModelArtifactsInfoForJSON:function(){return H9},getSaveHandlers:function(){return J9},getWeightSpecs:function(){return j9},http:function(){return Oee},isHTTPScheme:function(){return Dee},listModels:function(){return S7},loadWeights:function(){return Eee},moveModel:function(){return A7},registerLoadRouter:function(){return Y9},registerSaveRouter:function(){return X9},removeModel:function(){return T7},weightsLoaderFactory:function(){return Aee},withSaveHandler:function(){return Uee},withSaveHandlerSync:function(){return Gee}});var t={};n.r(t),n.d(t,{json:function(){return BWe}});var r={};n.r(r),n.d(r,{json:function(){return WWe}});var a={};n.r(a),n.d(a,{json:function(){return VWe}});var i={};n.r(i),n.d(i,{json:function(){return UWe}});var o={};n.r(o),n.d(o,{json:function(){return GWe}});var s={};n.r(s),n.d(s,{json:function(){return HWe}});var u={};n.r(u),n.d(u,{json:function(){return jWe}});var c={};n.r(c),n.d(c,{json:function(){return qWe}});var l={};n.r(l),n.d(l,{json:function(){return KWe}});var p={};n.r(p),n.d(p,{json:function(){return XWe}});var h={};n.r(h),n.d(h,{json:function(){return YWe}});var d={};n.r(d),n.d(d,{json:function(){return JWe}});var f={};n.r(f),n.d(f,{json:function(){return QWe}});var m={};n.r(m),n.d(m,{json:function(){return ZWe}});var v={};n.r(v),n.d(v,{json:function(){return $We}});var g={};n.r(g),n.d(g,{json:function(){return eVe}});var y={};n.r(y),n.d(y,{json:function(){return tVe}});var b=n(791),x=n(250);function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function w(){w=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(A){u=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),s=new C(a||[]);return r(o,"_invoke",{value:I(e,n,s)}),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=c;var p={};function h(){}function d(){}function f(){}var m={};u(m,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(E([])));g&&g!==t&&n.call(g,i)&&(m=g);var y=f.prototype=h.prototype=Object.create(m);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function a(r,i,o,s){var u=l(e[r],e,i);if("throw"!==u.type){var c=u.arg,p=c.value;return p&&"object"==k(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(p).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,s)}))}s(u.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function I(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return _()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=S(o,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var a=l(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,p;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:_}}function _(){return{value:void 0,done:!0}}return d.prototype=f,r(y,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:d,configurable:!0}),d.displayName=u(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},b(x.prototype),u(x.prototype,o,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new x(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(y),u(y,s,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=E,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function I(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){I(i,r,a,o,s,"next",e)}function s(e){I(i,r,a,o,s,"throw",e)}o(void 0)}))}}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t){if(e){if("string"===typeof e)return N(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(e,t):void 0}}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,a=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.p;var E=[],_=[];var A,R=function(e){!function(e){var t;t="male"==e[0].gender?1:0,E.push(e[0].age),_.push(t)}(e)};var F=function(e,t,n){e.length>0&&e.forEach((function(e){var t=e.scaledMesh;!function(e){var t=Math.abs(e[454][0]-e[234][0]),n=Math.abs(e[136][0]-e[365][0]),r=Math.abs(e[21][0]-e[251][0]),a=Math.abs(e[10][1]-e[152][1]),i=Math.abs(e[136][1]-e[152][1]),o=Math.abs(e[365][1]-e[152][1]),s=Math.abs(e[234][0]-e[58][0]),u=Math.abs(e[288][0]-e[454][0]),c=Math.abs(e[21][0]-e[234][0]),l=Math.abs(e[251][0]-e[454][0]),p=re(e[58],e[172]),h=re(e[172],e[136]),d=re(e[136],e[150]),f=re(e[150],e[149]),m=re(e[149],e[176]),v=re(e[176],e[148]),g=re(e[148],e[152]),y=re(e[288],e[397]),b=re(e[397],e[365]),x=re(e[365],e[379]),k=re(e[379],e[378]),w=re(e[378],e[400]),I=re(e[400],e[377]),S=re(e[377],e[152]);D.push(t),M.push(n),O.push(a),L.push(r),z.push(i),P.push(o),B.push(s),W.push(u),V.push(c),U.push(l),G.push(p),H.push(h),j.push(d),q.push(f),K.push(m),X.push(v),Y.push(g),J.push(S),Q.push(I),Z.push(w),$.push(k),ee.push(x),te.push(b),ne.push(y)}(t);var r=document.createElement("canvas");r.width=n.width,r.height=n.height;var a=r.getContext("2d");a.drawImage(n,0,0,n.width,n.height);var i=a.getImageData(t[168][0],t[168][1],1,1).data;console.log(i);var o={red:i[0],green:i[1],blue:i[2]};A=function(e){var t=e.red<=20&&e.green<=20&&e.blue<=20,n=e.red>=220&&e.green>=220&&e.blue>=220;return t?"Black":n?"White":"Brown"}(o),console.log(o)}))};var D=[],M=[],O=[],L=[],z=[],P=[],B=[],W=[],V=[],U=[],G=[],H=[],j=[],q=[],K=[],X=[],Y=[],J=[],Q=[],Z=[],$=[],ee=[],te=[],ne=[];function re(e,t){var n=e[0]-t[0],r=e[1]-t[1];return 180*Math.atan2(r,n)/Math.PI}function ae(e){var t=e.reduce((function(e,t){return e+t}),0);return t/e.length||0}function ie(e){var t=function(e,t){if("object"!==k(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===k(t)?t:String(t)}function oe(e,t,n){return(t=ie(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){oe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ce(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function le(e){return le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},le(e)}function pe(){return pe="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=le(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},pe.apply(this,arguments)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t){return de=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},de(e,t)}function fe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function me(e,t,n){return me=fe()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&de(a,n.prototype),a},me.apply(null,arguments)}function ve(e){var t="function"===typeof Map?new Map:void 0;return ve=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return me(e,arguments,le(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),de(n,e)},ve(e)}function ge(e,t){if(t&&("object"===k(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return he(e)}function ye(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}function be(e){var t=fe();return function(){var n,r=le(e);if(t){var a=le(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return ge(this,n)}}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,ie(r.key),r)}}function we(e,t,n){return t&&ke(e.prototype,t),n&&ke(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ie(e){return function(e){if(Array.isArray(e))return N(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Se(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=T(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}var Ne="/index.js",Te=Object.defineProperty,Ce=n(741),Ee=function(e,t){for(var n in t)Te(e,n,{get:t[n],enumerable:!0})};Ee({},{Abs:function(){return pn},Acos:function(){return hn},Acosh:function(){return dn},AdadeltaOptimizer:function(){return mm},AdagradOptimizer:function(){return vm},AdamOptimizer:function(){return gm},AdamaxOptimizer:function(){return ym},Add:function(){return fn},AddN:function(){return mn},All:function(){return vn},Any:function(){return gn},ArgMax:function(){return yn},ArgMin:function(){return bn},Asin:function(){return xn},Asinh:function(){return kn},Atan:function(){return wn},Atan2:function(){return Sn},Atanh:function(){return In},AvgPool:function(){return Nn},AvgPool3D:function(){return Cn},AvgPool3DGrad:function(){return En},AvgPoolGrad:function(){return Tn},BackendWasm:function(){return T$},BatchMatMul:function(){return _n},BatchToSpaceND:function(){return An},Bincount:function(){return Rn},BitwiseAnd:function(){return Fn},BroadcastArgs:function(){return Mn},BroadcastTo:function(){return Dn},Callback:function(){return cE},CallbackList:function(){return Ow},Cast:function(){return On},Ceil:function(){return Ln},ClipByValue:function(){return zn},Complex:function(){return Pn},ComplexAbs:function(){return Bn},Concat:function(){return Wn},Conv2D:function(){return Vn},Conv2DBackpropFilter:function(){return Un},Conv2DBackpropInput:function(){return Gn},Conv3D:function(){return Hn},Conv3DBackpropFilterV2:function(){return jn},Conv3DBackpropInputV2:function(){return qn},Cos:function(){return Kn},Cosh:function(){return Xn},CropAndResize:function(){return Qn},Cumprod:function(){return Yn},Cumsum:function(){return Jn},CustomCallback:function(){return Pw},DataStorage:function(){return it},DenseBincount:function(){return Zn},DepthToSpace:function(){return $n},DepthwiseConv2dNative:function(){return er},DepthwiseConv2dNativeBackpropFilter:function(){return tr},DepthwiseConv2dNativeBackpropInput:function(){return nr},Diag:function(){return rr},Dilation2D:function(){return ar},Dilation2DBackpropFilter:function(){return or},Dilation2DBackpropInput:function(){return ir},ENV:function(){return un},EarlyStopping:function(){return hE},Einsum:function(){return ur},Elu:function(){return cr},EluGrad:function(){return lr},Environment:function(){return rn},Equal:function(){return hr},Erf:function(){return pr},Exp:function(){return dr},ExpandDims:function(){return fr},Expm1:function(){return mr},FFT:function(){return vr},Fill:function(){return gr},FlipLeftRight:function(){return yr},Floor:function(){return br},FloorDiv:function(){return xr},FromPixels:function(){return Ii},FusedBatchNorm:function(){return kr},FusedConv2D:function(){return Ti},FusedDepthwiseConv2D:function(){return Ci},GPGPUContext:function(){return NW},GatherNd:function(){return Ir},GatherV2:function(){return wr},GraphModel:function(){return oA},Greater:function(){return Sr},GreaterEqual:function(){return Nr},History:function(){return zw},IFFT:function(){return Cr},Identity:function(){return Tr},Imag:function(){return Er},InputSpec:function(){return Lk},IsFinite:function(){return _r},IsInf:function(){return Ar},IsNan:function(){return Rr},KernelBackend:function(){return ot},LRN:function(){return Hr},LRNGrad:function(){return jr},LayerVariable:function(){return Dk},LayersModel:function(){return qI},LeakyRelu:function(){return Fr},Less:function(){return Dr},LessEqual:function(){return Mr},LinSpace:function(){return Or},Log:function(){return Lr},Log1p:function(){return zr},LogSoftmax:function(){return Ur},LogicalAnd:function(){return Pr},LogicalNot:function(){return Br},LogicalOr:function(){return Wr},LogicalXor:function(){return Vr},LowerBound:function(){return Gr},MathBackendCPU:function(){return MR},MathBackendWebGL:function(){return KV},MatrixBandPart:function(){return qr},Max:function(){return Kr},MaxPool:function(){return Yr},MaxPool3D:function(){return Qr},MaxPool3DGrad:function(){return Zr},MaxPoolGrad:function(){return Jr},MaxPoolWithArgmax:function(){return $r},Maximum:function(){return Xr},Mean:function(){return ea},Min:function(){return ta},Minimum:function(){return na},MirrorPad:function(){return ra},Mod:function(){return aa},MomentumOptimizer:function(){return xm},Multinomial:function(){return ia},Multiply:function(){return oa},Neg:function(){return sa},NonMaxSuppressionV3:function(){return ca},NonMaxSuppressionV4:function(){return la},NonMaxSuppressionV5:function(){return pa},NotEqual:function(){return ua},OP_SCOPE_SUFFIX:function(){return ss},OneHot:function(){return da},OnesLike:function(){return ha},Optimizer:function(){return fm},OptimizerConstructors:function(){return Ev},Pack:function(){return fa},PadV2:function(){return ma},Pool:function(){return va},Pow:function(){return ga},Prelu:function(){return ya},Prod:function(){return ba},RMSPropOptimizer:function(){return km},RNN:function(){return rN},RaggedGather:function(){return xa},RaggedRange:function(){return ka},RaggedTensorToTensor:function(){return wa},Range:function(){return Ia},Rank:function(){return Eo},Real:function(){return Sa},RealDiv:function(){return sr},Reciprocal:function(){return Na},Reduction:function(){return Pf},Relu:function(){return Ta},Relu6:function(){return Fa},Reshape:function(){return Ca},ResizeBilinear:function(){return Aa},ResizeBilinearGrad:function(){return Ra},ResizeNearestNeighbor:function(){return Ea},ResizeNearestNeighborGrad:function(){return _a},Reverse:function(){return Da},RotateWithOffset:function(){return Si},Round:function(){return Ma},Rsqrt:function(){return Oa},SGDOptimizer:function(){return bm},ScatterNd:function(){return La},SearchSorted:function(){return Pa},Select:function(){return Ba},Selu:function(){return Wa},Sequential:function(){return tS},Sigmoid:function(){return ja},Sign:function(){return Ha},Sin:function(){return Ua},Sinh:function(){return Ga},Slice:function(){return Va},Softmax:function(){return Qa},Softplus:function(){return qa},SpaceToBatchND:function(){return Ya},SparseFillEmptyRows:function(){return Za},SparseReshape:function(){return $a},SparseSegmentMean:function(){return ei},SparseSegmentSum:function(){return ti},SparseToDense:function(){return ni},SplitV:function(){return Ja},Sqrt:function(){return Ka},Square:function(){return ai},SquaredDifference:function(){return ri},StaticRegexReplace:function(){return ii},Step:function(){return wi},StridedSlice:function(){return oi},StringNGrams:function(){return si},StringSplit:function(){return ui},StringToHashBucketFast:function(){return ci},Sub:function(){return li},Sum:function(){return Xa},SymbolicTensor:function(){return zk},Tan:function(){return pi},Tanh:function(){return hi},Tensor:function(){return No},TensorBuffer:function(){return wo},TensorScatterUpdate:function(){return za},Tile:function(){return di},TopK:function(){return fi},Transform:function(){return mi},Transpose:function(){return vi},Unique:function(){return gi},Unpack:function(){return yi},UnsortedSegmentSum:function(){return bi},UpperBound:function(){return xi},Variable:function(){return Co},ZerosLike:function(){return ki},_FusedMatMul:function(){return Ni},abs:function(){return Qu},acos:function(){return Zu},acosh:function(){return $u},add:function(){return Ku},addN:function(){return ec},all:function(){return tc},any:function(){return nc},argMax:function(){return rc},argMin:function(){return ac},asin:function(){return ic},asinh:function(){return oc},atan:function(){return sc},atan2:function(){return uc},atanh:function(){return cc},avgPool:function(){return Tc},avgPool3d:function(){return Cc},backend:function(){return ju},backend_util:function(){return Dv},basicLSTMCell:function(){return Dc},batchNorm:function(){return Lc},batchNorm2d:function(){return zc},batchNorm3d:function(){return Pc},batchNorm4d:function(){return Bc},batchToSpaceND:function(){return Mc},bincount:function(){return Wc},bitwiseAnd:function(){return Vc},booleanMaskAsync:function(){return Od},broadcastArgs:function(){return Uc},broadcastTo:function(){return Gc},broadcast_util:function(){return dl},browser:function(){return Qm},buffer:function(){return wu},callbacks:function(){return mE},cast:function(){return Iu},ceil:function(){return Hc},clipByValue:function(){return qc},clone:function(){return Su},complex:function(){return cs},concat:function(){return Ec},concat1d:function(){return Kc},concat2d:function(){return Xc},concat3d:function(){return Yc},concat4d:function(){return Jc},constraints:function(){return Zk},conv1d:function(){return Zc},conv2d:function(){return Qc},conv2dTranspose:function(){return el},conv3d:function(){return tl},conv3dTranspose:function(){return rl},copyRegisteredKernels:function(){return Bi},cos:function(){return al},cosh:function(){return il},cosineWindow:function(){return Gd},cumprod:function(){return ol},cumsum:function(){return sl},customGrad:function(){return mp},data:function(){return hA},denseBincount:function(){return ul},deprecationWarn:function(){return _u},depthToSpace:function(){return cl},depthwiseConv2d:function(){return ll},deregisterOp:function(){return bE},device_util:function(){return Qo},diag:function(){return pl},dilation2d:function(){return hl},disableDeprecationWarnings:function(){return Eu},dispose:function(){return Ou},disposeVariables:function(){return Au},div:function(){return Yu},divNoNan:function(){return xl},dot:function(){return kl},dropout:function(){return Vd},einsum:function(){return wl},elu:function(){return Il},enableDebugMode:function(){return Cu},enableProdMode:function(){return Tu},enclosingPowerOfTwo:function(){return Ud},engine:function(){return Ru},ensureShape:function(){return Sl},env:function(){return on},equal:function(){return gl},erf:function(){return Nl},euclideanNorm:function(){return Gl},exp:function(){return Hl},expandDims:function(){return jl},expm1:function(){return ql},eye:function(){return Xl},fft:function(){return nd},fill:function(){return jc},findBackend:function(){return Uu},findBackendFactory:function(){return Gu},floor:function(){return Yl},floorDiv:function(){return Xu},forceHalfFloat:function(){return YV},fused:function(){return qd},gather:function(){return Jl},gatherND:function(){return Wd},gather_util:function(){return iv},getBackend:function(){return Wu},getGradient:function(){return Di},getKernel:function(){return Fi},getKernelsForBackend:function(){return Mi},getThreadsCount:function(){return U$},gpgpu_util:function(){return nW},grad:function(){return lp},grads:function(){return pp},greater:function(){return Ql},greaterEqual:function(){return Zl},ifft:function(){return rd},imag:function(){return $l},image:function(){return im},inTopKAsync:function(){return jd},initializers:function(){return dw},input:function(){return aS},io:function(){return Im},irfft:function(){return ad},isFinite:function(){return ep},isInf:function(){return tp},isNaN:function(){return np},keep:function(){return Lu},kernel_impls:function(){return Bg},layers:function(){return Aw},leakyRelu:function(){return rp},less:function(){return ap},lessEqual:function(){return ip},linalg:function(){return om},linspace:function(){return op},loadGraphModel:function(){return sA},loadGraphModelSync:function(){return cA},loadLayersModel:function(){return JI},localResponseNormalization:function(){return sp},log:function(){return up},log1p:function(){return cp},logSigmoid:function(){return bp},logSoftmax:function(){return kp},logSumExp:function(){return wp},logicalAnd:function(){return Ip},logicalNot:function(){return Sp},logicalOr:function(){return Np},logicalXor:function(){return Tp},losses:function(){return sm},lowerBound:function(){return _p},matMul:function(){return _c},math:function(){return Xm},max:function(){return Ml},maxPool:function(){return Ap},maxPool3d:function(){return Rp},maxPoolWithArgmax:function(){return Fp},maximum:function(){return Dp},mean:function(){return Mp},memory:function(){return Fu},meshgrid:function(){return zp},metrics:function(){return UC},min:function(){return Ol},minimum:function(){return Pp},mirrorPad:function(){return Bp},mod:function(){return Wp},model:function(){return nS},models:function(){return aE},moments:function(){return Vp},movingAverage:function(){return zd},mul:function(){return Ju},multiRNNCell:function(){return Up},multinomial:function(){return Gp},neg:function(){return gp},nextFrame:function(){return Rv},norm:function(){return Ul},notEqual:function(){return Hp},oneHot:function(){return jp},ones:function(){return Lp},onesLike:function(){return qp},op:function(){return us},outerProduct:function(){return Kp},pad:function(){return Xp},pad1d:function(){return Yp},pad2d:function(){return Jp},pad3d:function(){return Qp},pad4d:function(){return Zp},pool:function(){return eh},pow:function(){return Ll},prelu:function(){return th},print:function(){return Nu},prod:function(){return nh},profile:function(){return Du},raggedGather:function(){return rh},raggedRange:function(){return ah},raggedTensorToTensor:function(){return ih},rand:function(){return oh},randomGamma:function(){return Ch},randomNormal:function(){return Eh},randomStandardNormal:function(){return _h},randomUniform:function(){return Ah},randomUniformInt:function(){return Rh},range:function(){return Fh},ready:function(){return Bu},real:function(){return Dh},reciprocal:function(){return Mh},registerBackend:function(){return Hu},registerCallbackConstructor:function(){return iS},registerGradient:function(){return Li},registerKernel:function(){return Oi},registerOp:function(){return gE},regularizers:function(){return iE},relu:function(){return Oh},relu6:function(){return Lh},removeBackend:function(){return Vu},reshape:function(){return Nc},reverse:function(){return zh},reverse1d:function(){return Ph},reverse2d:function(){return Bh},reverse3d:function(){return Wh},reverse4d:function(){return Vh},rfft:function(){return od},round:function(){return Uh},rsqrt:function(){return Gh},scalar:function(){return zl},scatterND:function(){return Pd},scatter_util:function(){return bd},searchSorted:function(){return Ep},selu:function(){return Hh},separableConv2d:function(){return jh},sequential:function(){return rS},serialization:function(){return lm},setBackend:function(){return Pu},setPlatform:function(){return qu},setThreadsCount:function(){return V$},setWasmPath:function(){return z$},setWasmPaths:function(){return P$},setWebGLContext:function(){return kP},setdiff1dAsync:function(){return Kh},shared:function(){return OR},sigmoid:function(){return Ac},sign:function(){return Xh},signal:function(){return am},sin:function(){return Yh},sinh:function(){return Jh},slice:function(){return Rc},slice1d:function(){return Qh},slice2d:function(){return Zh},slice3d:function(){return $h},slice4d:function(){return ed},slice_util:function(){return sv},softmax:function(){return td},softplus:function(){return yp},spaceToBatchND:function(){return $p},sparse:function(){return um},sparseToDense:function(){return Bd},spectral:function(){return rm},split:function(){return id},sqrt:function(){return Pl},square:function(){return Bl},squaredDifference:function(){return sd},squeeze:function(){return ud},stack:function(){return cd},step:function(){return ld},stridedSlice:function(){return pd},string:function(){return cm},sub:function(){return xp},sum:function(){return Wl},sumOutType:function(){return Lo},tan:function(){return hd},tanh:function(){return Fc},tensor:function(){return ps},tensor1d:function(){return dd},tensor2d:function(){return fd},tensor3d:function(){return md},tensor4d:function(){return vd},tensor5d:function(){return gd},tensor6d:function(){return yd},tensorScatterUpdate:function(){return Id},tensor_util:function(){return Do},test_util:function(){return uh},tidy:function(){return Mu},tile:function(){return Kl},time:function(){return zu},topk:function(){return Sd},train:function(){return _v},transpose:function(){return Ld},truncatedNormal:function(){return Nd},unique:function(){return Td},unregisterGradient:function(){return Pi},unregisterKernel:function(){return zi},unsortedSegmentSum:function(){return Cd},unstack:function(){return Ed},upcastType:function(){return Oo},upperBound:function(){return _d},util:function(){return Vi},valueAndGrad:function(){return hp},valueAndGrads:function(){return dp},variable:function(){return Ad},variableGrads:function(){return fp},version:function(){return j$},version_converter:function(){return pA},version_core:function(){return Cv},version_cpu:function(){return uM},version_layers:function(){return bI},version_wasm:function(){return G$},version_webgl:function(){return XV},webgl:function(){return JV},webgl_util:function(){return mP},where:function(){return yl},whereAsync:function(){return Dd},zeros:function(){return Op},zerosLike:function(){return bl}});var _e=Object.create,Ae=Object.defineProperty,Re=Object.getOwnPropertyDescriptor,Fe=Object.getOwnPropertyNames,De=Object.getPrototypeOf,Me=Object.prototype.hasOwnProperty,Oe=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},Le=function(e,t){for(var n in t)Ae(e,n,{get:t[n],enumerable:!0})},ze=function(e,t,n){return n=null!=e?_e(De(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var a,i=Se(Fe(t));try{var o=function(){var i=a.value;!Me.call(e,i)&&i!==n&&Ae(e,i,{get:function(){return t[i]},enumerable:!(r=Re(t,i))||r.enumerable})};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}return e}(!t&&e&&e.__esModule?n:Ae(n,"default",{value:e,enumerable:!0}),e)},Pe=Oe((function(e,t){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(UUe){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?y:g;if(t){if(e<0)return y;if(e>=f)return I}else{if(e<=-m)return S;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%d|0,e/d|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function p(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return p(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=g,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var h=u(l(n,s));i=i.mul(h).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function h(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?p(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=p,r.fromValue=h;var d=4294967296,f=d*d,m=f/2,v=s(1<<24),g=s(0);r.ZERO=g;var y=s(0,!0);r.UZERO=y;var b=s(1);r.ONE=b;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var I=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=I;var S=c(0,-2147483648,!1);r.MIN_VALUE=S;var N=r.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1===(1&this.low)},N.isEven=function(){return 0===(1&this.low)},N.equals=function(e){return a(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(a(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(b)},N.neg=N.negate,N.add=function(e){a(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,p=0,d=0,f=0;return d+=(f+=i+(65535&e.low))>>>16,p+=(d+=r+u)>>>16,l+=(p+=n+s)>>>16,l+=t+o,c((d&=65535)<<16|(f&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},N.subtract=function(e){return a(e)||(e=h(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return g;if(a(e)||(e=h(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(S))return e.isOdd()?S:g;if(e.eq(S))return this.isOdd()?S:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,p=e.low>>>16,d=65535&e.low,f=0,m=0,y=0,b=0;return y+=(b+=o*d)>>>16,m+=(y+=i*d)>>>16,y&=65535,m+=(y+=o*p)>>>16,f+=(m+=r*d)>>>16,m&=65535,f+=(m+=i*p)>>>16,m&=65535,f+=(m+=o*l)>>>16,f+=t*d+r*p+i*l+o*s,c((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(a(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return x;i=y}else{if(this.eq(S))return e.eq(b)||e.eq(k)?S:e.eq(S)?b:(t=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(S))return this.unsigned?y:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=g}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),p=u(t),d=p.mul(e);d.isNegative()||d.gt(r);)d=(p=u(t-=s,this.unsigned)).mul(e);p.isZero()&&(p=b),i=i.add(p),r=r.sub(d)}return i},N.div=N.divide,N.modulo=function(e){return a(e)||(e=h(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return c(~this.low,~this.high,this.unsigned)},N.and=function(e){return a(e)||(e=h(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return a(e)||(e=h(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return a(e)||(e=h(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),Be=Oe((function(){})),We=Oe((function(){})),Ve=Oe((function(e,t){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),Ue=Oe((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),Ge=Oe((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),He=Oe((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),je=Oe((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),qe=Oe((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),Ke=Oe((function(){})),Xe=Oe((function(e,t){!function(e,r,a){var i,o=256,s="random",u=a.pow(o,6),c=a.pow(2,52),l=2*c,p=o-1;function h(t,n,p){var h=[],y=v(m((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),g(t)}catch(h){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,g(r)]}}():t,3),h),b=new d(h),x=function(){for(var e=b.g(6),t=u,n=0;e<c;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,v(g(b.S),r),(n.pass||p||function(e,t,n,r){return r&&(r.S&&f(r,b),e.state=function(){return f(b,{})}),n?(a[s]=e,t):e})(x,y,"global"in n?n.global:this==a,n.state)}function d(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=p&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=p&a+1],n=n*o+s[p&(s[a]=s[i=p&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function f(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(WUe){}return r.length?r:"string"==a?e:e+"\0"}function v(e,t){for(var n,r=e+"",a=0;a<r.length;)t[p&a]=p&(n^=19*t[p&a])+r.charCodeAt(a++);return g(t)}function g(e){return String.fromCharCode.apply(0,e)}if(v(a.random(),r),"object"==typeof t&&t.exports){t.exports=h;try{i=Ke()}catch(OUe){}}else"function"==typeof define&&n.amdO?define((function(){return h})):a["seed"+s]=h}("undefined"!=typeof self?self:e,[],Math)})),Ye=Oe((function(e,t){var n=Ve(),r=Ue(),a=Ge(),i=He(),o=je(),s=qe(),u=Xe();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=i,u.xor4096=o,u.tychei=s,t.exports=u})),Je=Oe((function(){})),Qe=Oe((function(){})),Ze=Oe((function(){})),$e=Oe((function(){})),et=Oe((function(){})),tt=Oe((function(){})),nt=Oe((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||Ne,function(t){function r(){return F.buffer!=L&&j(F.buffer),P}function a(){return F.buffer!=L&&j(F.buffer),B}function i(){return F.buffer!=L&&j(F.buffer),W}function o(){return F.buffer!=L&&j(F.buffer),V}var s,u,c,l="undefined"!=typeof(t=t||{})?t:{};l.ready=new Promise((function(e,t){s=e,u=t})),"undefined"!=typeof process&&process.listeners&&(c={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var p,h,d,f=Object.assign({},l),m=[],v=function(e,t){throw t},g="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,x=l.ENVIRONMENT_IS_PTHREAD||!1,k="";function w(e){return l.locateFile?l.locateFile(e,k):k+e}if(b){var I,S=Qe(),N=Ze();k=y?N.dirname(k)+"/":"//",p=function(e,t){return e=ue(e)?new URL(e):N.normalize(e),S.readFileSync(e,t?void 0:"utf8")},d=function(e){var t=p(e,!0);return t.buffer||(t=new Uint8Array(t)),t},h=function(e,t,n){e=ue(e)?new URL(e):N.normalize(e),S.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),m=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof pe))throw e})),process.on("unhandledRejection",(function(e){throw e})),v=function(e,t){if(Q())throw process.exitCode=e,t;(function(e){e instanceof pe||_("exiting due to exception: "+e)})(t),process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{I=$e()}catch(KUe){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),KUe}n.g.Worker=I.Worker}else(g||y)&&(y?k=self.location.href:"undefined"!=typeof document&&document.currentScript&&(k=document.currentScript.src),"undefined"!=typeof e&&e&&(k=e),k=0!==k.indexOf("blob:")?k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1):"",b||(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},y&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}),function(e){return document.title=e});b&&"undefined"==typeof performance&&(n.g.performance=et().performance);var T=console.log.bind(console),C=console.warn.bind(console);b&&(T=function(e){return S.writeSync(1,e+"\n")},C=function(e){return S.writeSync(2,e+"\n")});var E=l.print||T,_=l.printErr||C;Object.assign(l,f),f=null,l.arguments&&(m=l.arguments),l.thisProgram&&l.thisProgram,l.quit&&(v=l.quit);var A;Atomics.load,Atomics.store,Atomics.compareExchange;l.wasmBinary&&(A=l.wasmBinary);var R=l.noExitRuntime||!0;"object"!=typeof WebAssembly&&ae("no native wasm support detected");var F,D,M,O=!1;var L,z,P,B,W,V,U="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function G(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&U)return U.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function H(e,t){return(e>>>=0)?G(r(),e,t):""}function j(e){L=e,l.HEAP8=z=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=B=new Int32Array(e),l.HEAPU8=P=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=W=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=V=new Float64Array(e)}x&&(L=l.buffer);var q=l.INITIAL_MEMORY||16777216;if(x)F=l.wasmMemory,L=l.buffer;else if(l.wasmMemory)F=l.wasmMemory;else if(!((F=new WebAssembly.Memory({initial:q/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw _("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),b&&_("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");F&&(L=F.buffer),q=L.byteLength,j(L);var K,X=[],Y=[],J=[];function Q(){return R}function Z(){!0,!x&&ge(Y)}function $(e){X.unshift(e)}function ee(e){J.unshift(e)}var te=0,ne=null,re=null;function ae(e){l.onAbort&&l.onAbort(e),_(e="Aborted("+e+")"),O=!0,M=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}var ie,oe="data:application/octet-stream;base64,";function se(e){return e.startsWith(oe)}function ue(e){return e.startsWith("file://")}function ce(e){try{if(e==ie&&A)return new Uint8Array(A);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(KUe){ae(KUe)}}se(ie="tfjs-backend-wasm-threaded-simd.wasm")||(ie=w(ie));var le={};function pe(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function he(e){var t=ve.pthreads[e];(function(e,t){e||ae(t)})(t),ve.returnWorkerToPool(t)}function de(e){var t=ve.getNewWorker();if(!t)return 6;ve.runningWorkers.push(t),ve.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=function(){b&&t.ref(),t.postMessage(n,e.transferList),delete t.runPthread},t.loaded&&t.runPthread(),0}function fe(e){if(x)return Ce(1,1,e);M=e,Q()||(ve.terminateAllThreads(),l.onExit&&l.onExit(e),O=!0),v(e,new pe(e))}var me=function(e,t){if(M=e,!t&&x)throw ye(e),"unwind";fe(e)};var ve={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){x?ve.initWorker():ve.initMainThread()},initMainThread:function(){for(var e=8;e--;)ve.allocateUnusedWorker()},initWorker:function(){R=!1},setExitStatus:function(e){M=e},terminateAllThreads:function(){for(var e=0,t=Object.values(ve.pthreads);e<t.length;e++){var n=t[e];ve.returnWorkerToPool(n)}var r,a=Se(ve.unusedWorkers);try{for(a.s();!(r=a.n()).done;){(n=r.value).terminate()}}catch(i){a.e(i)}finally{a.f()}ve.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete ve.pthreads[t],ve.unusedWorkers.push(e),ve.runningWorkers.splice(ve.runningWorkers.indexOf(e),1),e.pthread_ptr=0,b&&e.unref(),Ke(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){ve.tlsInitFunctions.forEach((function(e){return e()}))},loadWasmModuleToWorker:function(t,n){t.onmessage=function(e){var r=e.data,a=r.cmd;if(t.pthread_ptr&&(ve.currentProxiedOperationCallerThread=t.pthread_ptr),r.targetThread&&r.targetThread!=Ge()){var i=ve.pthreads[r.targetThread];return i?i.postMessage(r,r.transferList):_('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(ve.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===a?Ne(r.queue):"spawnThread"===a?de(r):"cleanupThread"===a?he(r.thread):"killThread"===a?function(e){var t=ve.pthreads[e];delete ve.pthreads[e],t.terminate(),Ke(e),ve.runningWorkers.splice(ve.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(r.thread):"cancelThread"===a?function(e){ve.pthreads[e].postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(t.loaded=!0,b&&t.unref(),n&&n(t),t.runPthread&&t.runPthread()):"print"===a?E("Thread "+r.threadId+": "+r.text):"printErr"===a?_("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?t.postMessage(r):"callHandler"===a?l[r.handler].apply(l,Ie(r.args)):a&&_("worker sent an unknown command "+a),ve.currentProxiedOperationCallerThread=void 0},t.onerror=function(e){throw _("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},b&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){})));for(var r=[],a=0,i=["onExit","onAbort","print","printErr"];a<i.length;a++){var o=i[a];l.hasOwnProperty(o)&&r.push(o)}t.postMessage({cmd:"load",handlers:r,urlOrBlob:l.mainScriptUrlOrBlob||e,wasmMemory:F,wasmModule:D})},allocateUnusedWorker:function(){var e,t=w("tfjs-backend-wasm-threaded-simd.worker.js");e=new Worker(t),ve.unusedWorkers.push(e)},getNewWorker:function(){return 0==ve.unusedWorkers.length&&(ve.allocateUnusedWorker(),ve.loadWasmModuleToWorker(ve.unusedWorkers[0])),ve.unusedWorkers.pop()}};function ge(e){for(;e.length>0;)e.shift()(l)}function ye(e){if(x)return Ce(2,0,e);try{me(e)}catch(KUe){!function(e){if(e instanceof pe||"unwind"==e)return M;v(1,e)}(KUe)}}l.PThread=ve,l.establishStackSpace=function(){var e=Ge(),t=a()[e+52>>>2],n=a()[e+56>>>2];Ye(t,t-n),nt(t)};var be=[];function xe(e,t,n,r){return x?Ce(3,1,e,t,n,r):ke(e,t,n,r)}function ke(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return _("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(x&&0===a.length)return xe(e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return x?(i.cmd="spawnThread",postMessage(i,a),0):de(i)}l.invokeEntryPoint=function(e,t){var n=function(e){var t=be[e];return t||(e>=be.length&&(be.length=e+1),be[e]=t=K.get(e)),t}(e)(t);Q()?ve.setExitStatus(n):Xe(n)};var we;function Ne(e){Atomics.store(a(),e>>2,1),Ge()&&qe(e),Atomics.compareExchange(a(),e>>2,1,0)}function Te(e){Te.shown||(Te.shown={}),Te.shown[e]||(Te.shown[e]=1,b&&(e="warning: "+e),_(e))}function Ce(e,t){var n=arguments.length-2,r=arguments;return function(e){var t=Je(),n=e();return nt(t),n}((function(){for(var a=n,i=rt(8*a),s=i>>3,u=0;u<n;u++){var c=r[2+u];o()[s+u>>>0]=c}return je(e,a,i,t)}))}l.executeNotifiedProxyingQueue=Ne,we=b?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.timeOrigin+performance.now()};var Ee=[];function _e(e){try{return F.grow(e-L.byteLength+65535>>>16),j(F.buffer),1}catch(KUe){}}function Ae(e){return x?Ce(4,1,e):52}function Re(e,t,n,r,a){return x?Ce(5,1,e,t,n,r,a):70}var Fe=[null,[],[]];function De(e,t){var n=Fe[e];0===t||10===t?((1===e?E:_)(G(n,0)),n.length=0):n.push(t)}function Me(e,t,n,a){if(x)return Ce(6,1,e,t,n,a);for(var o=0,s=0;s<n;s++){var u=i()[t>>>2],c=i()[t+4>>>2];t+=8;for(var l=0;l<c;l++)De(e,r()[u+l>>>0]);o+=c}return i()[a>>>2]=o,0}function Oe(e){return l["_"+e]}function Le(e,t){(F.buffer!=L&&j(F.buffer),z).set(e,t>>>0)}function ze(e,t,n,a,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n>>>=0,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=i)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=i)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0})(e,r(),t,n)})(e,t=rt(n),n)}return t},array:function(e){var t=rt(e.length);return Le(e,t),t}};var s=Oe(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var p=o[n[l]];p?(0===c&&(c=Je()),u[l]=p(a[l])):u[l]=a[l]}var h,d=s.apply(null,u);return h=d,0!==c&&nt(c),d=function(e){return"string"===t?H(e):"boolean"===t?!!e:e}(h),d}ve.init();var Pe,Be,We,Ve=[null,fe,ye,xe,Ae,Re,Me],Ue={__emscripten_init_main_thread_js:function(e){He(e,!y,1,!g),ve.threadInitTLS()},__emscripten_thread_cleanup:function(e){x?postMessage({cmd:"cleanupThread",thread:e}):he(e)},__pthread_create_js:ke,_emscripten_default_pthread_stack_size:function(){return 65536},_emscripten_get_now_is_monotonic:function(){return true},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((function(){return Ne(r)}));else if(x)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=ve.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){ae("")},emscripten_check_blocking_allowed:function(){b||y||Te("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 4294901760},emscripten_get_now:we,emscripten_memcpy_big:function(e,t,n){r().copyWithin(e>>>0,t>>>0,t+n>>>0)},emscripten_num_logical_cores:function(){return b?tt().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){Ee.length=t;for(var r=n>>3,a=0;a<t;a++)Ee[a]=o()[r+a>>>0];return(e<0?le[-e-1]:Ve[e]).apply(null,Ee)},emscripten_resize_heap:function(e){var t=r().length;if((e>>>=0)<=t)return!1;var n=4294901760;if(e>n)return!1;for(var a,i,o=1;o<=4;o*=2){var s=t*(1+.2/o);if(s=Math.min(s,e+100663296),_e(Math.min(n,(a=Math.max(e,s))+((i=65536)-a%i)%i)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:me,fd_close:Ae,fd_seek:Re,fd_write:Me,memory:F||l.wasmMemory},Ge=(function(){var e={env:Ue,wasi_snapshot_preview1:Ue};function t(e,t){var n=e.exports;if(l.asm=n,function(e){ve.tlsInitFunctions.push(e)}(l.asm._emscripten_tls_init),K=l.asm.__indirect_function_table,function(e){Y.unshift(e)}(l.asm.__wasm_call_ctors),D=t,!x){var r=ve.unusedWorkers.length;ve.unusedWorkers.forEach((function(e){ve.loadWasmModuleToWorker(e,(function(){--r||function(e){if(te--,l.monitorRunDependencies&&l.monitorRunDependencies(te),0==te&&(null!==ne&&(clearInterval(ne),ne=null),re)){var t=re;re=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!A&&(g||y)){if("function"==typeof fetch&&!ue(ie))return fetch(ie,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ie+"'";return e.arrayBuffer()})).catch((function(){return ce(ie)}));if(h)return new Promise((function(e,t){h(ie,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ce(ie)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),ae(e)}))}if(x||(te++,l.monitorRunDependencies&&l.monitorRunDependencies(te)),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(a){_("Module.instantiateWasm callback failed with error: "+a),u(a)}(A||"function"!=typeof WebAssembly.instantiateStreaming||se(ie)||ue(ie)||b||"function"!=typeof fetch?r(n):fetch(ie,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u)}(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.__wasm_call_ctors).apply(null,arguments)},l._init=function(){return(l._init=l.asm.init).apply(null,arguments)},l._init_with_threads_count=function(){return(l._init_with_threads_count=l.asm.init_with_threads_count).apply(null,arguments)},l._get_threads_count=function(){return(l._get_threads_count=l.asm.get_threads_count).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.register_tensor).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.dispose_data).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.dispose).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.Abs).apply(null,arguments)},l._Acos=function(){return(l._Acos=l.asm.Acos).apply(null,arguments)},l._Acosh=function(){return(l._Acosh=l.asm.Acosh).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.Add).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.AddN).apply(null,arguments)},l._All=function(){return(l._All=l.asm.All).apply(null,arguments)},l._Any=function(){return(l._Any=l.asm.Any).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.ArgMax).apply(null,arguments)},l._ArgMin=function(){return(l._ArgMin=l.asm.ArgMin).apply(null,arguments)},l._Asin=function(){return(l._Asin=l.asm.Asin).apply(null,arguments)},l._Asinh=function(){return(l._Asinh=l.asm.Asinh).apply(null,arguments)},l._Atan=function(){return(l._Atan=l.asm.Atan).apply(null,arguments)},l._Atan2=function(){return(l._Atan2=l.asm.Atan2).apply(null,arguments)},l._Atanh=function(){return(l._Atanh=l.asm.Atanh).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.AvgPool).apply(null,arguments)},l._AvgPool3D=function(){return(l._AvgPool3D=l.asm.AvgPool3D).apply(null,arguments)},l._AvgPool3DGrad=function(){return(l._AvgPool3DGrad=l.asm.AvgPool3DGrad).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.BatchMatMul).apply(null,arguments)},l._Bincount=function(){return(l._Bincount=l.asm.Bincount).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.Ceil).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.ClipByValue).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.Conv2D).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.Conv2DBackpropInput).apply(null,arguments)},l._Conv3D=function(){return(l._Conv3D=l.asm.Conv3D).apply(null,arguments)},l._Conv3DBackpropFilterV2=function(){return(l._Conv3DBackpropFilterV2=l.asm.Conv3DBackpropFilterV2).apply(null,arguments)},l._Conv3DBackpropInputV2=function(){return(l._Conv3DBackpropInputV2=l.asm.Conv3DBackpropInputV2).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Cos).apply(null,arguments)},l._Cosh=function(){return(l._Cosh=l.asm.Cosh).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.CropAndResize).apply(null,arguments)},l._Cumprod=function(){return(l._Cumprod=l.asm.Cumprod).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.Cumsum).apply(null,arguments)},l._DenseBincount=function(){return(l._DenseBincount=l.asm.DenseBincount).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.DepthToSpace).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.DepthwiseConv2dNative).apply(null,arguments)},l._Diag=function(){return(l._Diag=l.asm.Diag).apply(null,arguments)},l._Dilation2D=function(){return(l._Dilation2D=l.asm.Dilation2D).apply(null,arguments)},l._Dilation2DBackpropFilter=function(){return(l._Dilation2DBackpropFilter=l.asm.Dilation2DBackpropFilter).apply(null,arguments)},l._Dilation2DBackpropInput=function(){return(l._Dilation2DBackpropInput=l.asm.Dilation2DBackpropInput).apply(null,arguments)},l._Elu=function(){return(l._Elu=l.asm.Elu).apply(null,arguments)},l._EluGrad=function(){return(l._EluGrad=l.asm.EluGrad).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.Equal).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.Exp).apply(null,arguments)},l._Expm1=function(){return(l._Expm1=l.asm.Expm1).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.FlipLeftRight).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Floor).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.FloorDiv).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm.FusedBatchNorm).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.FusedConv2D).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.FusedDepthwiseConv2D).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.Gather).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.GatherNd).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.Greater).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.GreaterEqual).apply(null,arguments)},l._IsFinite=function(){return(l._IsFinite=l.asm.IsFinite).apply(null,arguments)},l._IsInf=function(){return(l._IsInf=l.asm.IsInf).apply(null,arguments)},l._IsNan=function(){return(l._IsNan=l.asm.IsNan).apply(null,arguments)},l._LRN=function(){return(l._LRN=l.asm.LRN).apply(null,arguments)},l._LRNGrad=function(){return(l._LRNGrad=l.asm.LRNGrad).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.LeakyRelu).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.Less).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.LessEqual).apply(null,arguments)},l._LinSpace=function(){return(l._LinSpace=l.asm.LinSpace).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.Log).apply(null,arguments)},l._Log1p=function(){return(l._Log1p=l.asm.Log1p).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.LogicalAnd).apply(null,arguments)},l._LogicalNot=function(){return(l._LogicalNot=l.asm.LogicalNot).apply(null,arguments)},l._LogicalOr=function(){return(l._LogicalOr=l.asm.LogicalOr).apply(null,arguments)},l._LogicalXor=function(){return(l._LogicalXor=l.asm.LogicalXor).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.Max).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.MaxPool).apply(null,arguments)},l._MaxPool3D=function(){return(l._MaxPool3D=l.asm.MaxPool3D).apply(null,arguments)},l._MaxPool3DGrad=function(){return(l._MaxPool3DGrad=l.asm.MaxPool3DGrad).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.Maximum).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.Mean).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.Min).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.Minimum).apply(null,arguments)},l._MirrorPad=function(){return(l._MirrorPad=l.asm.MirrorPad).apply(null,arguments)},l._Multinomial=function(){return(l._Multinomial=l.asm.Multinomial).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.Multiply).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.Neg).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.NonMaxSuppressionV3).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.NonMaxSuppressionV4).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.NonMaxSuppressionV5).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.NotEqual).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.OneHot).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.PadV2).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.Pow).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.Prelu).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Prod).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.RealDiv).apply(null,arguments)},l._Reciprocal=function(){return(l._Reciprocal=l.asm.Reciprocal).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Relu).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Relu6).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.ResizeBilinear).apply(null,arguments)},l._ResizeBilinearGrad=function(){return(l._ResizeBilinearGrad=l.asm.ResizeBilinearGrad).apply(null,arguments)},l._ResizeNearestNeighbor=function(){return(l._ResizeNearestNeighbor=l.asm.ResizeNearestNeighbor).apply(null,arguments)},l._ResizeNearestNeighborGrad=function(){return(l._ResizeNearestNeighborGrad=l.asm.ResizeNearestNeighborGrad).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Reverse).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.RotateWithOffset).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Round).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Rsqrt).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.ScatterNd).apply(null,arguments)},l._SearchSorted=function(){return(l._SearchSorted=l.asm.SearchSorted).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.SelectV2).apply(null,arguments)},l._Selu=function(){return(l._Selu=l.asm.Selu).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Sigmoid).apply(null,arguments)},l._Sign=function(){return(l._Sign=l.asm.Sign).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Sin).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Softmax).apply(null,arguments)},l._Softplus=function(){return(l._Softplus=l.asm.Softplus).apply(null,arguments)},l._SparseFillEmptyRows=function(){return(l._SparseFillEmptyRows=l.asm.SparseFillEmptyRows).apply(null,arguments)},l._SparseReshape=function(){return(l._SparseReshape=l.asm.SparseReshape).apply(null,arguments)},l._SparseSegmentReduction=function(){return(l._SparseSegmentReduction=l.asm.SparseSegmentReduction).apply(null,arguments)},l._SparseToDense=function(){return(l._SparseToDense=l.asm.SparseToDense).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Sqrt).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Square).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.SquaredDifference).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Step).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.StridedSlice).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Sub).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sum).apply(null,arguments)},l._Tan=function(){return(l._Tan=l.asm.Tan).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Tanh).apply(null,arguments)},l._TensorScatterUpdate=function(){return(l._TensorScatterUpdate=l.asm.TensorScatterUpdate).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Tile).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.TopK).apply(null,arguments)},l._Transform=function(){return(l._Transform=l.asm.Transform).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Transpose).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm._FusedMatMul).apply(null,arguments)},l._malloc=function(){return(l._malloc=l.asm.malloc).apply(null,arguments)},l._free=function(){return(l._free=l.asm.free).apply(null,arguments)},l.__emscripten_tls_init=function(){return(l.__emscripten_tls_init=l.asm._emscripten_tls_init).apply(null,arguments)},l._pthread_self=function(){return(Ge=l._pthread_self=l.asm.pthread_self).apply(null,arguments)}),He=(l.___errno_location=function(){return(l.___errno_location=l.asm.__errno_location).apply(null,arguments)},l.__emscripten_thread_init=function(){return(He=l.__emscripten_thread_init=l.asm._emscripten_thread_init).apply(null,arguments)}),je=(l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm._emscripten_thread_crashed).apply(null,arguments)},l._emscripten_main_thread_process_queued_calls=function(){return(l._emscripten_main_thread_process_queued_calls=l.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.emscripten_main_browser_thread_id).apply(null,arguments)},l._emscripten_run_in_main_runtime_thread_js=function(){return(je=l._emscripten_run_in_main_runtime_thread_js=l.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)}),qe=(l._emscripten_dispatch_to_thread_=function(){return(l._emscripten_dispatch_to_thread_=l.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},l.__emscripten_proxy_execute_task_queue=function(){return(qe=l.__emscripten_proxy_execute_task_queue=l.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)}),Ke=l.__emscripten_thread_free_data=function(){return(Ke=l.__emscripten_thread_free_data=l.asm._emscripten_thread_free_data).apply(null,arguments)},Xe=l.__emscripten_thread_exit=function(){return(Xe=l.__emscripten_thread_exit=l.asm._emscripten_thread_exit).apply(null,arguments)},Ye=l._emscripten_stack_set_limits=function(){return(Ye=l._emscripten_stack_set_limits=l.asm.emscripten_stack_set_limits).apply(null,arguments)},Je=l.stackSave=function(){return(Je=l.stackSave=l.asm.stackSave).apply(null,arguments)},nt=l.stackRestore=function(){return(nt=l.stackRestore=l.asm.stackRestore).apply(null,arguments)},rt=l.stackAlloc=function(){return(rt=l.stackAlloc=l.asm.stackAlloc).apply(null,arguments)};l.dynCall_iijjiiii=function(){return(l.dynCall_iijjiiii=l.asm.dynCall_iijjiiii).apply(null,arguments)},l.dynCall_jiji=function(){return(l.dynCall_jiji=l.asm.dynCall_jiji).apply(null,arguments)};function at(e){if(e=e||m,!(te>0)){if(x)return s(l),Z(),void startWorker(l);(function(){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)$(l.preRun.shift());ge(X)})(),te>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){Pe||(Pe=!0,l.calledRun=!0,!O&&(Z(),s(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function(){if(!x){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)ee(l.postRun.shift());ge(J)}}()))}}if(l.keepRuntimeAlive=Q,l.wasmMemory=F,l.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Oe(e):function(){return ze(e,t,n,arguments)}},l.ExitStatus=pe,l.PThread=ve,re=function e(){Pe||at(),Pe||(re=e)},l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();if(at(),c&&(Be={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!c.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!c.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)We=WasmBackendModule;else{if("undefined"==typeof t)throw new Error("Could not find wasm module in post.js");We=t}if(Be){var it=We._dispose;We._dispose=function(){it(),Be.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),Be.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModuleThreadedSimd=r)})),rt=Oe((function(e,t){t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};'})),at=Oe((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||Ne,function(t){var n,r,a,i="undefined"!=typeof(t=t||{})?t:{};i.ready=new Promise((function(e,t){n=e,r=t})),"undefined"!=typeof process&&process.listeners&&(a={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var o,s,u,c=Object.assign({},i),l=[],p="object"==typeof window,h="function"==typeof importScripts,d="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,f="";if(d){var m=Qe(),v=Ze();f=h?v.dirname(f)+"/":"//",o=function(e,t){return e=U(e)?new URL(e):v.normalize(e),m.readFileSync(e,t?void 0:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=function(e,t,n){e=U(e)?new URL(e):v.normalize(e),m.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),l=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof H))throw e})),process.on("unhandledRejection",(function(e){throw e})),function(e,t){if(x)throw process.exitCode=e,t;(function(e){e instanceof H||y("exiting due to exception: "+e)})(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}}else(p||h)&&(h?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),e&&(f=e),f=0!==f.indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},function(e){return document.title=e});var g=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);Object.assign(i,c),c=null,i.arguments&&(l=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit;var b;i.wasmBinary&&(b=i.wasmBinary);var x=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&z("no native wasm support detected");var k,w=!1;var I,S,N,T,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function E(e,t,n){for(var r=(t>>>=0)+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&C)return C.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function _(e,t){return(e>>>=0)?E(N,e,t):""}function A(e){I=e,i.HEAP8=S=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=N=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=T=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var R=[],F=[],D=[];var M=0,O=null,L=null;function z(e){i.onAbort&&i.onAbort(e),y(e="Aborted("+e+")"),w=!0,1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var P,B,W="data:application/octet-stream;base64,";function V(e){return e.startsWith(W)}function U(e){return e.startsWith("file://")}function G(e){try{if(e==P&&b)return new Uint8Array(b);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(t){z(t)}}function H(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function j(e){for(;e.length>0;)e.shift()(i)}function q(e){try{return k.grow(e-I.byteLength+65535>>>16),A(k.buffer),1}catch(t){}}V(P="tfjs-backend-wasm.wasm")||(B=P,P=i.locateFile?i.locateFile(B,f):f+B);var K=[null,[],[]];function X(e,t){var n=K[e];0===t||10===t?((1===e?g:y)(E(n,0)),n.length=0):n.push(t)}function Y(e){return i["_"+e]}function J(e,t,n,r,a){var i={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n>>>=0,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++>>>0]=s}else if(s<=2047){if(n+1>=i)break;t[n++>>>0]=192|s>>6,t[n++>>>0]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++>>>0]=224|s>>12,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}else{if(n+3>=i)break;t[n++>>>0]=240|s>>18,t[n++>>>0]=128|s>>12&63,t[n++>>>0]=128|s>>6&63,t[n++>>>0]=128|63&s}}t[n>>>0]=0})(e,N,t,n)})(e,t=re(n),n)}return t},array:function(e){var t=re(e.length);return function(e,t){S.set(e,t>>>0)}(e,t),t}};var o=Y(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=te()),s[c]=l(r[c])):s[c]=r[c]}var p,h=o.apply(null,s);return p=h,0!==u&&ne(u),h=function(e){return"string"===t?_(e):"boolean"===t?!!e:e}(p),h}var Q,Z,$,ee={abort:function(){z("")},emscripten_get_heap_max:function(){return 4294901760},emscripten_memcpy_big:function(e,t,n){N.copyWithin(e>>>0,t>>>0,t+n>>>0)},emscripten_resize_heap:function(e){var t=N.length,n=4294901760;if((e>>>=0)>n)return!1;for(var r,a,i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),q(Math.min(n,(r=Math.max(e,o))+((a=65536)-r%a)%a)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=T[t>>>2],s=T[t+4>>>2];t+=8;for(var u=0;u<s;u++)X(e,N[o+u>>>0]);a+=s}return T[r>>>2]=a,0}},te=(function(){var e={env:ee,wasi_snapshot_preview1:ee};function t(e,t){var n=e.exports;i.asm=n,A((k=i.asm.memory).buffer),i.asm.__indirect_function_table,function(e){F.unshift(e)}(i.asm.__wasm_call_ctors),function(e){if(M--,i.monitorRunDependencies&&i.monitorRunDependencies(M),0==M&&(null!==O&&(clearInterval(O),O=null),L)){var t=L;L=null,t()}}()}function n(e){t(e.instance)}function a(t){return function(){if(!b&&(p||h)){if("function"==typeof fetch&&!U(P))return fetch(P,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+P+"'";return e.arrayBuffer()})).catch((function(){return G(P)}));if(s)return new Promise((function(e,t){s(P,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return G(P)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),z(e)}))}if(M++,i.monitorRunDependencies&&i.monitorRunDependencies(M),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(o){y("Module.instantiateWasm callback failed with error: "+o),r(o)}(b||"function"!=typeof WebAssembly.instantiateStreaming||V(P)||U(P)||d||"function"!=typeof fetch?a(n):fetch(P,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.__wasm_call_ctors).apply(null,arguments)},i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._init_with_threads_count=function(){return(i._init_with_threads_count=i.asm.init_with_threads_count).apply(null,arguments)},i._get_threads_count=function(){return(i._get_threads_count=i.asm.get_threads_count).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Acos=function(){return(i._Acos=i.asm.Acos).apply(null,arguments)},i._Acosh=function(){return(i._Acosh=i.asm.Acosh).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._All=function(){return(i._All=i.asm.All).apply(null,arguments)},i._Any=function(){return(i._Any=i.asm.Any).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._ArgMin=function(){return(i._ArgMin=i.asm.ArgMin).apply(null,arguments)},i._Asin=function(){return(i._Asin=i.asm.Asin).apply(null,arguments)},i._Asinh=function(){return(i._Asinh=i.asm.Asinh).apply(null,arguments)},i._Atan=function(){return(i._Atan=i.asm.Atan).apply(null,arguments)},i._Atan2=function(){return(i._Atan2=i.asm.Atan2).apply(null,arguments)},i._Atanh=function(){return(i._Atanh=i.asm.Atanh).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._AvgPool3D=function(){return(i._AvgPool3D=i.asm.AvgPool3D).apply(null,arguments)},i._AvgPool3DGrad=function(){return(i._AvgPool3DGrad=i.asm.AvgPool3DGrad).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._Bincount=function(){return(i._Bincount=i.asm.Bincount).apply(null,arguments)},i._Ceil=function(){return(i._Ceil=i.asm.Ceil).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Conv3D=function(){return(i._Conv3D=i.asm.Conv3D).apply(null,arguments)},i._Conv3DBackpropFilterV2=function(){return(i._Conv3DBackpropFilterV2=i.asm.Conv3DBackpropFilterV2).apply(null,arguments)},i._Conv3DBackpropInputV2=function(){return(i._Conv3DBackpropInputV2=i.asm.Conv3DBackpropInputV2).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._Cosh=function(){return(i._Cosh=i.asm.Cosh).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumprod=function(){return(i._Cumprod=i.asm.Cumprod).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DenseBincount=function(){return(i._DenseBincount=i.asm.DenseBincount).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Diag=function(){return(i._Diag=i.asm.Diag).apply(null,arguments)},i._Dilation2D=function(){return(i._Dilation2D=i.asm.Dilation2D).apply(null,arguments)},i._Dilation2DBackpropFilter=function(){return(i._Dilation2DBackpropFilter=i.asm.Dilation2DBackpropFilter).apply(null,arguments)},i._Dilation2DBackpropInput=function(){return(i._Dilation2DBackpropInput=i.asm.Dilation2DBackpropInput).apply(null,arguments)},i._Elu=function(){return(i._Elu=i.asm.Elu).apply(null,arguments)},i._EluGrad=function(){return(i._EluGrad=i.asm.EluGrad).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._Expm1=function(){return(i._Expm1=i.asm.Expm1).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._IsFinite=function(){return(i._IsFinite=i.asm.IsFinite).apply(null,arguments)},i._IsInf=function(){return(i._IsInf=i.asm.IsInf).apply(null,arguments)},i._IsNan=function(){return(i._IsNan=i.asm.IsNan).apply(null,arguments)},i._LRN=function(){return(i._LRN=i.asm.LRN).apply(null,arguments)},i._LRNGrad=function(){return(i._LRNGrad=i.asm.LRNGrad).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._LinSpace=function(){return(i._LinSpace=i.asm.LinSpace).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._Log1p=function(){return(i._Log1p=i.asm.Log1p).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._LogicalNot=function(){return(i._LogicalNot=i.asm.LogicalNot).apply(null,arguments)},i._LogicalOr=function(){return(i._LogicalOr=i.asm.LogicalOr).apply(null,arguments)},i._LogicalXor=function(){return(i._LogicalXor=i.asm.LogicalXor).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._MaxPool3D=function(){return(i._MaxPool3D=i.asm.MaxPool3D).apply(null,arguments)},i._MaxPool3DGrad=function(){return(i._MaxPool3DGrad=i.asm.MaxPool3DGrad).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._MirrorPad=function(){return(i._MirrorPad=i.asm.MirrorPad).apply(null,arguments)},i._Multinomial=function(){return(i._Multinomial=i.asm.Multinomial).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Reciprocal=function(){return(i._Reciprocal=i.asm.Reciprocal).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._ResizeBilinearGrad=function(){return(i._ResizeBilinearGrad=i.asm.ResizeBilinearGrad).apply(null,arguments)},i._ResizeNearestNeighbor=function(){return(i._ResizeNearestNeighbor=i.asm.ResizeNearestNeighbor).apply(null,arguments)},i._ResizeNearestNeighborGrad=function(){return(i._ResizeNearestNeighborGrad=i.asm.ResizeNearestNeighborGrad).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Round=function(){return(i._Round=i.asm.Round).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SearchSorted=function(){return(i._SearchSorted=i.asm.SearchSorted).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Selu=function(){return(i._Selu=i.asm.Selu).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sign=function(){return(i._Sign=i.asm.Sign).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._Softplus=function(){return(i._Softplus=i.asm.Softplus).apply(null,arguments)},i._SparseFillEmptyRows=function(){return(i._SparseFillEmptyRows=i.asm.SparseFillEmptyRows).apply(null,arguments)},i._SparseReshape=function(){return(i._SparseReshape=i.asm.SparseReshape).apply(null,arguments)},i._SparseSegmentReduction=function(){return(i._SparseSegmentReduction=i.asm.SparseSegmentReduction).apply(null,arguments)},i._SparseToDense=function(){return(i._SparseToDense=i.asm.SparseToDense).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._Step=function(){return(i._Step=i.asm.Step).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tan=function(){return(i._Tan=i.asm.Tan).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._TensorScatterUpdate=function(){return(i._TensorScatterUpdate=i.asm.TensorScatterUpdate).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transform=function(){return(i._Transform=i.asm.Transform).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.___errno_location=function(){return(i.___errno_location=i.asm.__errno_location).apply(null,arguments)},i.stackSave=function(){return(te=i.stackSave=i.asm.stackSave).apply(null,arguments)}),ne=i.stackRestore=function(){return(ne=i.stackRestore=i.asm.stackRestore).apply(null,arguments)},re=i.stackAlloc=function(){return(re=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)};i.dynCall_iijjiiii=function(){return(i.dynCall_iijjiiii=i.asm.dynCall_iijjiiii).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.dynCall_jiji).apply(null,arguments)};function ae(e){function t(){Q||(Q=!0,i.calledRun=!0,!w&&(!0,j(F),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),D.unshift(e);var e;j(D)}()))}e=e||l,M>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),R.unshift(e);var e;j(R)}(),M>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t())}if(i.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Y(e):function(){return J(e,t,n,arguments)}},L=function e(){Q||ae(),Q||(L=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();if(ae(),a&&(Z={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!a.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!a.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof t)$=t;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");$=WasmBackendModuleThreadedSimd}if(Z){var ie=$._dispose;$._dispose=function(){ie(),Z.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),Z.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModule=r)})),it=function(){function e(t,n){xe(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return we(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),ot=function(){function e(){xe(this,e)}return we(e,[{key:"refCount",value:function(e){return st("refCount")}},{key:"incRef",value:function(e){return st("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return st("time")}},{key:"read",value:function(e){return st("read")}},{key:"readSync",value:function(e){return st("readSync")}},{key:"readToGPU",value:function(e,t){return st("readToGPU")}},{key:"numDataIds",value:function(){return st("numDataIds")}},{key:"disposeData",value:function(e,t){return st("disposeData")}},{key:"write",value:function(e,t,n){return st("write")}},{key:"move",value:function(e,t,n,r,a){return st("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return st("createTensorFromGPUData")}},{key:"memory",value:function(){return st("memory")}},{key:"floatPrecision",value:function(){return st("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return st("dispose")}}]),e}();function st(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function ut(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,ht(e,--t,n)}function ct(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,ht(e,--n,r),ht(t,n,r)}function lt(e,t,n){return Math.max(e,Math.min(t,n))}function pt(e){return e%2===0?e:e+1}function ht(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function dt(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ft(e,t){var n=Math.random();return t*n+(1-n)*e}function mt(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function vt(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function gt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";vt(wt(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function yt(e){vt(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function bt(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function xt(e){return 0===e.length}function kt(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(null!==e[n]&&null!==t[n]&&e[n]!==t[n])return!1;return!0}function wt(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function It(e){return e%1===0}function St(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Nt(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Tt(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return ut(t),t}function Ct(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Et(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function _t(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function At(e,t){var n=t.length;return vt((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),vt(e.every((function(e){return It(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Rt(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:At(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Ft(e,t){return Dt(e,t)}function Dt(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Mt(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function Ot(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Lt(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function zt(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Pt(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Bt(e){return"string"==typeof e||e instanceof String}function Wt(e){return"boolean"==typeof e}function Vt(e){return"number"==typeof e}function Ut(e){return Array.isArray(e)?Ut(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Vt(e)?"float32":Bt(e)?"string":Wt(e)?"bool":"float32"}function Gt(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ht(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function jt(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function qt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=qt(e+l*c,u,n,r);return a}function Kt(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return qt(0,e,t,n)}function Xt(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function Yt(e,t){for(var n=Jt(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Jt(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Qt(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Kt(e,new Float32Array(n));if("int32"===t)return Kt(e,new Int32Array(n));if("bool"===t)return Kt(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function Zt(e){e.forEach((function(t){vt(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function $t(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function en(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function tn(e){return e&&e.then&&"function"==typeof e.then}var nn="tfjsflags",rn=function(){function e(t){xe(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=an,this.populateURLFlags()}return we(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(on().getBool("IS_TEST")||on().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];on().getBool("IS_TEST")||on().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(tn(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getString",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);nn in t&&t[nn].split(",").forEach((function(t){var n=C(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){var n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,a)}))}}}]),e}();function an(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function on(){return un}var sn,un=null;function cn(){if(null==sn){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}sn=e}return sn}function ln(e,t){var n=function(){var e=cn();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var pn="Abs",hn="Acos",dn="Acosh",fn="Add",mn="AddN",vn="All",gn="Any",yn="ArgMax",bn="ArgMin",xn="Asin",kn="Asinh",wn="Atan",In="Atanh",Sn="Atan2",Nn="AvgPool",Tn="AvgPoolGrad",Cn="AvgPool3D",En="AvgPool3DGrad",_n="BatchMatMul",An="BatchToSpaceND",Rn="Bincount",Fn="BitwiseAnd",Dn="BroadcastTo",Mn="BroadcastArgs",On="Cast",Ln="Ceil",zn="ClipByValue",Pn="Complex",Bn="ComplexAbs",Wn="Concat",Vn="Conv2D",Un="Conv2DBackpropFilter",Gn="Conv2DBackpropInput",Hn="Conv3D",jn="Conv3DBackpropFilterV2",qn="Conv3DBackpropInputV2",Kn="Cos",Xn="Cosh",Yn="Cumprod",Jn="Cumsum",Qn="CropAndResize",Zn="DenseBincount",$n="DepthToSpace",er="DepthwiseConv2dNative",tr="DepthwiseConv2dNativeBackpropFilter",nr="DepthwiseConv2dNativeBackpropInput",rr="Diag",ar="Dilation2D",ir="Dilation2DBackpropInput",or="Dilation2DBackpropFilter",sr="RealDiv",ur="Einsum",cr="Elu",lr="EluGrad",pr="Erf",hr="Equal",dr="Exp",fr="ExpandDims",mr="Expm1",vr="FFT",gr="Fill",yr="FlipLeftRight",br="Floor",xr="FloorDiv",kr="FusedBatchNorm",wr="GatherV2",Ir="GatherNd",Sr="Greater",Nr="GreaterEqual",Tr="Identity",Cr="IFFT",Er="Imag",_r="IsFinite",Ar="IsInf",Rr="IsNan",Fr="LeakyRelu",Dr="Less",Mr="LessEqual",Or="LinSpace",Lr="Log",zr="Log1p",Pr="LogicalAnd",Br="LogicalNot",Wr="LogicalOr",Vr="LogicalXor",Ur="LogSoftmax",Gr="LowerBound",Hr="LRN",jr="LRNGrad",qr="MatrixBandPart",Kr="Max",Xr="Maximum",Yr="MaxPool",Jr="MaxPoolGrad",Qr="MaxPool3D",Zr="MaxPool3DGrad",$r="MaxPoolWithArgmax",ea="Mean",ta="Min",na="Minimum",ra="MirrorPad",aa="Mod",ia="Multinomial",oa="Multiply",sa="Neg",ua="NotEqual",ca="NonMaxSuppressionV3",la="NonMaxSuppressionV4",pa="NonMaxSuppressionV5",ha="OnesLike",da="OneHot",fa="Pack",ma="PadV2",va="Pool",ga="Pow",ya="Prelu",ba="Prod",xa="RaggedGather",ka="RaggedRange",wa="RaggedTensorToTensor",Ia="Range",Sa="Real",Na="Reciprocal",Ta="Relu",Ca="Reshape",Ea="ResizeNearestNeighbor",_a="ResizeNearestNeighborGrad",Aa="ResizeBilinear",Ra="ResizeBilinearGrad",Fa="Relu6",Da="Reverse",Ma="Round",Oa="Rsqrt",La="ScatterNd",za="TensorScatterUpdate",Pa="SearchSorted",Ba="Select",Wa="Selu",Va="Slice",Ua="Sin",Ga="Sinh",Ha="Sign",ja="Sigmoid",qa="Softplus",Ka="Sqrt",Xa="Sum",Ya="SpaceToBatchND",Ja="SplitV",Qa="Softmax",Za="SparseFillEmptyRows",$a="SparseReshape",ei="SparseSegmentMean",ti="SparseSegmentSum",ni="SparseToDense",ri="SquaredDifference",ai="Square",ii="StaticRegexReplace",oi="StridedSlice",si="StringNGrams",ui="StringSplit",ci="StringToHashBucketFast",li="Sub",pi="Tan",hi="Tanh",di="Tile",fi="TopK",mi="Transform",vi="Transpose",gi="Unique",yi="Unpack",bi="UnsortedSegmentSum",xi="UpperBound",ki="ZerosLike",wi="Step",Ii="FromPixels",Si="RotateWithOffset",Ni="_FusedMatMul",Ti="FusedConv2D",Ci="FusedDepthwiseConv2D";function Ei(){var e;on().getBool("IS_TEST")||on().getBool("PROD")||(e=console).warn.apply(e,arguments)}function _i(){var e;on().getBool("IS_TEST")||on().getBool("PROD")||(e=console).log.apply(e,arguments)}var Ai=ln("kernelRegistry",(function(){return new Map})),Ri=ln("gradRegistry",(function(){return new Map}));function Fi(e,t){var n=Wi(e,t);return Ai.get(n)}function Di(e){return Ri.get(e)}function Mi(e){for(var t=Ai.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=C(i,2),s=o[0],u=o[1];C(s.split("_"),1)[0]===e&&n.push(u)}return n}function Oi(e){var t=e.kernelName,n=e.backendName,r=Wi(t,n);Ai.has(r)&&Ei("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),Ai.set(r,e)}function Li(e){var t=e.kernelName;Ri.has(t)&&on().getBool("DEBUG")&&Ei("Overriding the gradient for '".concat(t,"'")),Ri.set(t,e)}function zi(e,t){var n=Wi(e,t);if(!Ai.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));Ai.delete(n)}function Pi(e){if(!Ri.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));Ri.delete(e)}function Bi(e,t){Mi(e).forEach((function(e){Oi(Object.assign({},e,{backendName:t}))}))}function Wi(e,t){return"".concat(t,"_").concat(e)}var Vi={};function Ui(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}Le(Vi,{arraysEqual:function(){return wt},arraysEqualWithNull:function(){return kt},assert:function(){return vt},assertNonNegativeIntegerDimensions:function(){return Zt},assertNonNull:function(){return yt},assertShapesMatch:function(){return gt},bytesFromStringArray:function(){return Pt},bytesPerElement:function(){return zt},checkConversionForErrors:function(){return Mt},clamp:function(){return lt},computeStrides:function(){return jt},convertBackendValuesAndArrayBuffer:function(){return Xt},createScalarValue:function(){return ro},createShuffledIndices:function(){return Tt},decodeString:function(){return uo},distSquared:function(){return mt},encodeString:function(){return so},fetch:function(){return oo},fingerPrint64:function(){return no},flatten:function(){return lo},getArrayFromDType:function(){return Dt},getTypedArrayFromDType:function(){return Ft},hasEncodingLoss:function(){return Lt},hexToLong:function(){return ji},indexToLoc:function(){return en},inferDtype:function(){return Ut},inferFromImplicitShape:function(){return _t},isBoolean:function(){return Wt},isFunction:function(){return Gt},isInt:function(){return It},isNumber:function(){return Vt},isPromise:function(){return tn},isScalarShape:function(){return xt},isString:function(){return Bt},isTypedArray:function(){return co},isValidDtype:function(){return Ot},locToIndex:function(){return $t},makeOnesTypedArray:function(){return Yt},makeZerosNestedTypedArray:function(){return Qt},makeZerosTypedArray:function(){return Jt},nearestDivisor:function(){return Ht},nearestLargerEven:function(){return pt},now:function(){return io},parseAxisParam:function(){return At},randUniform:function(){return ft},repeatedTry:function(){return Et},rightPad:function(){return Ct},shuffle:function(){return ut},shuffleCombo:function(){return ct},sizeFromShape:function(){return bt},sizeToSquarishShape:function(){return Nt},squeezeShape:function(){return Rt},sum:function(){return dt},swap:function(){return ht},tanh:function(){return St},toNestedArray:function(){return Kt},toTypedArray:function(){return ao}});var Gi=ze(Pe()),Hi=Gi.default||Gi;function ji(e){return Hi.fromString(e,!0,16)}var qi=ji("c3a5c85c97cb3127"),Ki=ji("b492b66fbe98f273"),Xi=ji("9ae16a3b2f90404f");function Yi(e){return e.xor(e.shru(47))}function Ji(e,t,n){var r=e.slice(t,t+n);return Hi.fromBytes(Array.from(r),!0,!0)}function Qi(e,t){return Ji(e,t,8)}function Zi(e,t){return Ji(e,t,4)}function $i(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function eo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ji("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function to(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=$i(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add($i(a,44)),[a.add(r),i.add(o)]}(Qi(e,t),Qi(e,t+8),Qi(e,t+16),Qi(e,t+24),n,r)}function no(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Hi.fromNumber(81,!0);if(n<=32)return n<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Xi.add(2*t),r=Qi(e,0).add(Xi),a=Qi(e,t-8);return eo($i(a,37).mul(n).add(r),$i(r,25).add(a).mul(n),n)}if(t>=4){var i=Xi.add(2*t);return eo(Zi(e,0).shl(3).add(t),Zi(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return Yi(Xi.mul(o).xor(qi.mul(s))).mul(Xi)}return Xi}(e,n):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Xi.add(2*t),r=Qi(e,0).mul(Ki),a=Qi(e,8),i=Qi(e,t-8).mul(n),o=Qi(e,t-16).mul(Xi);return eo($i(r.add(a),43).add($i(i,30)).add(o),r.add($i(a.add(Xi),18)).add(i),n)}(e,n);if(n<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Xi.add(2*t),r=Qi(e,0).mul(Xi),a=Qi(e,8),i=Qi(e,t-8).mul(n),o=Qi(e,t-16).mul(Xi),s=$i(r.add(a),43).add($i(i,30)).add(o),u=eo(s,r.add($i(a.add(Xi),18)).add(i),n),c=Qi(e,16).mul(n),l=Qi(e,24),p=s.add(Qi(e,t-32)).mul(n),h=u.add(Qi(e,t-24)).mul(n);return eo($i(c.add(l),43).add($i(p,30)).add(h),c.add($i(l.add(r),18)).add(p),n)}(e,n);var a=r,i=r.mul(Ki).add(113),o=Yi(i.mul(Xi).add(113)).mul(Xi),s=[Hi.UZERO,Hi.UZERO],u=[Hi.UZERO,Hi.UZERO];a=a.mul(Xi).add(Qi(e,0));var c=0,l=64*(n-1>>6),p=l+(n-1&63)-63;do{var h;a=$i(a.add(i).add(s[0]).add(Qi(e,c+8)),37).mul(Ki),i=$i(i.add(s[1]).add(Qi(e,c+48)),42).mul(Ki),a=a.xor(u[1]),i=i.add(s[0]).add(Qi(e,c+40)),o=$i(o.add(u[0]),33).mul(Ki),s=to(e,c,s[1].mul(Ki),a.add(u[0])),u=to(e,c+32,o.add(u[1]),i.add(Qi(e,c+16))),o=(h=[a,o])[0],a=h[1],c+=64}while(c!==l);var d=Ki.add(o.and(255).shl(1));return c=p,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=$i(a.add(i).add(s[0]).add(Qi(e,c+8)),37).mul(d),i=$i(i.add(s[1]).add(Qi(e,c+48)),42).mul(d),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(Qi(e,c+40))),o=$i(o.add(u[0]),33).mul(d),s=to(e,c,s[1].mul(d),a.add(u[0])),u=to(e,c+32,o.add(u[1]),i.add(Qi(e,c+16))),o=(t=[a,o])[0],a=t[1],eo(eo(s[0],u[0],d).add(Yi(i).mul(qi)).add(o),eo(s[1],u[1],d).add(a),d)}function ro(e,t){return"string"===t?so(e):ao([e],t)}function ao(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=lo(e)),on().getBool("DEBUG")&&Mt(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function io(){return on().platform.now()}function oo(e,t){return on().platform.fetch(e,t)}function so(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",on().platform.encode(e,t)}function uo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",on().platform.decode(e,t)}function co(e){return null!=on().platform.isTypedArray?on().platform.isTypedArray(e):Ui(e)}function lo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||tn(e)||null==e||co(e)&&n)t.push(e);else if(Array.isArray(e)||co(e))for(var r=0;r<e.length;++r)lo(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)lo(e[u],t,n)}return t}var po=function(){function e(t,n){xe(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new ho)}return we(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=io();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=Se(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:io()-o})}if(on().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var ho=function(){function e(){xe(this,e)}return we(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Ct("".concat(r,"ms"),9):r.error,s=Ct(e,25),u=t.rank,c=t.size,l=Ct(t.shape.toString(),14),p="";for(var h in a){var d=a[h];if(null!=d){var f=d.shape||t.shape,m=f.length;p+="".concat(h,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var fo=20,mo=3,vo=7;function go(e,t,n,r){var a=jt(t),i=function(e,t,n,r){var a=bt(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?ko(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],yo(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=xo(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function yo(e,t,n){return Ct(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(vo))," + ").concat(parseFloat(e[1].toFixed(vo)),"j"):Bt(e)?"'".concat(e,"'"):"bool"===n?bo(e):parseFloat(e.toFixed(vo)).toString(),t)}function bo(e){return 0===e?"false":"true"}function xo(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[yo(ko(e)[0],0,n)]:"bool"===n?[bo(e[0])]:[e[0].toString()];if(1===u){if(s>fo){var c=mo*o,l=Array.from(e.slice(0,c)),p=Array.from(e.slice((s-mo)*o,s*o));return"complex64"===n&&(l=ko(l),p=ko(p)),["["+l.map((function(e,t){return yo(e,a[t],n)})).join(", ")+", ..., "+p.map((function(e,t){return yo(e,a[s-mo+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?ko(e):Array.from(e)).map((function(e,t){return yo(e,a[t],n)})).join(", ")+"]"]}var h=t.slice(1),d=r.slice(1),f=r[0]*o,m=[];if(s>fo){for(var v=0;v<mo;v++){var g=v*f,y=g+f;m.push.apply(m,Ie(xo(e.slice(g,y),h,n,d,a,!1)))}m.push("...");for(var b=s-mo;b<s;b++){var x=b*f,k=x+f;m.push.apply(m,Ie(xo(e.slice(x,k),h,n,d,a,b===s-1)))}}else for(var w=0;w<s;w++){var I=w*f,S=I+f;m.push.apply(m,Ie(xo(e.slice(I,S),h,n,d,a,w===s-1)))}var N=2===u?",":"";m[0]="["+(s>0?m[0]+N:"");for(var T=1;T<m.length-1;T++)m[T]=" "+m[T]+N;for(var C=",\n",E=2;E<u;E++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":C),m}function ko(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var wo=function(){function e(t,n,r){var a=this;if(xe(this,e),this.dtype=n,this.shape=t.slice(),this.size=bt(t),null!=r){var i=r.length;vt(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Dt(n,this.size),this.strides=jt(t)}return we(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),vt(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return Io().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),Io=null,So=null;var No=function(){function e(t,n,r,a){xe(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=bt(t),this.strides=jt(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return we(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",So.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return So.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Kt(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Kt(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=Io().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return uo(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),Io().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=Io().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return uo(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,Io().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(Io().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return So.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),So.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return go(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),So.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),Io().makeVariable(this,e,t,n)}}]),e}();function To(){return ln("Tensor",(function(){return No}))}Object.defineProperty(No,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),To();var Co=function(e){ye(n,e);var t=be(n);function n(e,r,a,i){var o;return xe(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return we(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!wt(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));Io().disposeTensor(this),this.dataId=e.dataId,Io().incRef(this,null)}},{key:"dispose",value:function(){Io().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(No);Object.defineProperty(Co,Symbol.hasInstance,{value:function(e){return e instanceof No&&null!=e.assign&&e.assign instanceof Function}});var Eo,_o,Ao,Ro,Fo,Do={};Le(Do,{assertTypesMatch:function(){return Wo},getTensorsInContainer:function(){return Uo},isTensorInList:function(){return Vo},makeTypesMatch:function(){return Bo}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Eo||(Eo={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(_o||(_o={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Ao||(Ao={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Ro||(Ro={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Fo||(Fo={}));var Mo={float32:Ro,int32:_o,bool:Ao,complex64:Fo};function Oo(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Mo[e][t]}function Lo(e){return Oo(e,"int32")}function zo(e){return null!=e&&"object"==typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function Po(e){return"undefined"!=typeof GPUBuffer&&null!=e&&"object"==typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Bo(e,t){if(e.dtype===t.dtype)return[e,t];var n=Oo(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Wo(e,t){vt(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Vo(e,t){return t.some((function(t){return t.id===e.id}))}function Uo(e){var t=[];return Go(e,t,new Set),t}function Go(e,t,n){if(null!=e)if(e instanceof No)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),Go(i,t,n))}}}function Ho(e){return null!=e.kernelName}var jo=function(){function e(){xe(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return we(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),qo=function(){function e(t){xe(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new jo}return we(e,[{key:"ready",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(Ei("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new po(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Mi(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Mi(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof ot||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,Ei("Initialization of backend ".concat(e," failed")),Ei(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return Ei("Initialization of backend ".concat(e," failed")),Ei(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Xo.runKernel(Tr,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Xo.runKernel(On,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==Fi(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r=this,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u,c=Ho(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ho(e)){var l=e.kernelName,p=e.inputs,h=e.attrs;null==this.backendName&&this.backend;var d=Fi(l,this.backendName);vt(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(r.backendName,"'")})),n=function(){var e=r.backend.numDataIds();u=d.kernelFunc({inputs:p,attrs:h,backend:r.backend});var t=Array.isArray(u)?u:[u];r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:r.makeTensorFromTensorInfo(e)}));if(i){var o=r.getTensorsForGradient(l,p,n);a=r.saveTensorsForBackwardMode(o)}return n}}else{var f=e.forwardFunc,m=function(e){i&&(a=e.map((function(e){return r.keep(r.clone(e))})))};n=function(){var e=r.backend.numDataIds();u=r.tidy((function(){return f(r.backend,m)}));var t=Array.isArray(u)?u:[u];return r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Ho(e)?null:e.backwardsFunc;return this.scopedRun((function(){return r.state.kernelDepth++}),(function(){return r.state.kernelDepth--}),(function(){r.ENV.getBool("DEBUG")||r.state.profiling?(v=r.profiler.profileKernel(c,g,(function(){return n()})),r.ENV.getBool("DEBUG")&&r.profiler.logKernelProfile(v),t=v.outputs):t=n()})),i&&this.addTapeNode(c,g,t,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(u)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Di(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(vt(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Bt(e[0])&&(a=e.map((function(e){return so(e)})));var i=r.write(a,t,n),o=new No(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Pt(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new No(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Co(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*zt(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Co||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*zt(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Ie(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=Se(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Di(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Jt(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Uo(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(vt(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));vt(i instanceof No,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,h=0;h<t.length;h++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&f[w.id]){var I={};for(var S in w.inputs){var N=w.inputs[S];r[N.id]&&(I[S]=N)}var T=Object.assign({},w);T.inputs=I,T.outputs=w.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=Yt(bt(e),"float32");return Xo.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!wt(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(i.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),Yo);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=Se(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return vt(Gt(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];vt(r.every((function(e){return e instanceof No})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i,o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return vt((i=e.apply(void 0,r.concat([n]))).value instanceof No,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),vt(Gt(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];vt(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),vt(a.every((function(e){return e instanceof No})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=io(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=io()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new jo,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Ko(){var e=cn();if(null==e._tfengine){var t=new rn(e);e._tfengine=new qo(t)}return function(e){un=e}(e._tfengine.ENV),function(e){Io=e}((function(){return e._tfengine})),e._tfengine}qo.nextTensorId=0,qo.nextVariableId=0;var Xo=Ko();function Yo(e,t){var n={a:e,b:t};return Xo.runKernel(fn,n)}var Jo,Qo={};function Zo(e){Jo=e}function $o(e){if(void 0!==Jo)return Jo;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function es(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}Le(Qo,{isBrowser:function(){return es},isMobile:function(){return $o},mockIsMobile:function(){return Zo}});var ts=on();function ns(e,t){var n=e;if(co(e))return"string"===t?[]:[e.length];if(zo(e)){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if(Po(e))return[e.buffer.size/(null==t?4:zt(t))];if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||co(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&on().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&rs(e,a,[]),a}function rs(e,t,n){if(n=n||[],Array.isArray(e)||co(e)){vt(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),vt(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)rs(e[a],r,n.concat(a))}else vt(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function as(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function is(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof No)return as(r,e.dtype,t,n),e;var a=Ut(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),as(r,a,t,n),null==e||!co(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=ns(e,a);!co(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?ao(e,a):lo(e,[],!0);return Xo.makeTensor(s,o,a)}function os(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return is(e,"".concat(t,"[").concat(a,"]"),n,r)}))}ts.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ts.registerFlag("IS_BROWSER",(function(){return es()})),ts.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node})),ts.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),ts.registerFlag("IS_SAFARI",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)})),ts.registerFlag("PROD",(function(){return!1})),ts.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return ts.getBool("DEBUG")})),ts.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),ts.registerFlag("IS_TEST",(function(){return!1})),ts.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return ts.getBool("DEBUG")})),ts.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),ts.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),ts.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var ss="__op";function us(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=ss;var a=function(){Xo.startScope(n);try{var e=r.apply(void 0,arguments);return tn(e)&&console.error("Cannot return a Promise inside of tidy."),Xo.endScope(e),e}catch(e){throw Xo.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var cs=us({complex_:function(e,t){var n=is(e,"real","complex"),r=is(t,"imag","complex");gt(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Xo.runKernel(Pn,a)}});function ls(e,t,n,r){if(null==r)r=Ut(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Po(e)||zo(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Xo.backend.createTensorFromGPUData(e,t||n,r)}if(!co(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Zt(t);var a=bt(t),i=bt(n);vt(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==bt(t.slice(o));vt(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!co(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?ao(e,r):lo(e,[],!0),Xo.makeTensor(e,t,r)}function ps(e,t,n){return ls(e,t,ns(e,n),n)}var hs={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},ds=4;function fs(e,t){return ms.apply(this,arguments)}function ms(){return ms=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=w().mark((function e(){var o,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=3;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 3:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+ds*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=ds,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<i.length)){e.next=8;break}return e.delegateYield(o(),"t0",5);case 5:++s,e.next=3;break;case 8:return e.next=10,Promise.all(a);case 10:return u=e.sent,e.abrupt("return",{data:gs(u),specs:r});case 12:case"end":return e.stop()}}),e)}))),ms.apply(this,arguments)}function vs(e,t){var n,r,a={},i=0,o=Se(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=bt(l),h=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(d.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," which only supports weights of type float32 not ").concat(c,"."))}var f=hs[d.dtype],m=e.slice(i,i+p*f),v="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){h=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];h[g]=y*d.scale+d.min}}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type float32."));void 0===n&&(n=As()),h=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type int32."));h=new Int32Array(v.length);for(var b=0;b<v.length;b++){var x=v[b];h[b]=Math.round(x*d.scale+d.min)}}i+=p*f}else if("string"===c){var k=bt(s.shape);h=[];for(var w=0;w<k;w++){var I=new Uint32Array(e.slice(i,i+ds))[0];i+=ds;var S=new Uint8Array(e.slice(i,i+I));h.push(S),i+=I}}else{var N=hs[c],T=e.slice(i,i+p*N);if("float32"===c)h=new Float32Array(T);else if("int32"===c)h=new Int32Array(T);else if("bool"===c)h=new Uint8Array(T);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));h=new Float32Array(T);for(var C=new Float32Array(h.length/2),E=new Float32Array(h.length/2),_=0;_<C.length;_++)C[_]=h[2*_],E[_]=h[2*_+1];var A=ps(C,l,"float32"),R=ps(E,l,"float32");a[u]=cs(A,R),A.dispose(),R.dispose()}i+=p*N}"complex64"!==c&&(a[u]=ps(h,l,c))}}catch(F){o.e(F)}finally{o.f()}return a}function gs(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var ys="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function bs(e){return ys?Buffer.byteLength(e):new Blob([e]).size}function xs(e){if(ys)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function ks(e){if(ys){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function ws(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Is(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function Ss(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function Ns(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function Ts(e,t){return Cs.apply(this,arguments)}function Cs(){return Cs=S(w().mark((function e(t,n){var r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=C(r,2),i=a[0],o=a[1];case 9:return e.abrupt("return",Ns(t,i,o));case 10:case"end":return e.stop()}}),e)}))),Cs.apply(this,arguments)}function Es(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:bs(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:bs(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function _s(e){var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,Ie(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function As(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var Rs=function(){function e(){xe(this,e),this.saveRouters=[],this.loadRouters=[]}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Fs=function(e){return Rs.registerSaveRouter(e)},Ds=function(e){return Rs.registerLoadRouter(e)},Ms=function(e){return Rs.getSaveHandlers(e)},Os=function(e,t){return Rs.getLoadHandlers(e,t)},Ls="tensorflowjs",zs="models_store",Ps="model_info_store";function Bs(){if(!on().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Ws(e){var t=e.result;t.createObjectStore(zs,{keyPath:"modelPath"}),t.createObjectStore(Ps,{keyPath:"modelPath"})}var Vs=function(){function e(t){if(xe(this,e),this.indexedDB=Bs(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Ls,1);a.onupgradeneeded=function(){return Ws(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(zs,"readonly"),s=o.objectStore(zs).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c,l=Es(t),p=i.transaction(Ps,"readwrite"),h=p.objectStore(Ps);try{u=h.put({modelPath:n.modelPath,modelArtifactsInfo:l})}catch(d){return r(d)}u.onsuccess=function(){var a,o=(c=i.transaction(zs,"readwrite")).objectStore(zs);try{a=o.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l})}catch(s){return r(s)}a.onsuccess=function(){return e({modelArtifactsInfo:l})},a.onerror=function(e){var t=(h=p.objectStore(Ps)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},u.onerror=function(e){return i.close(),r(u.error)},p.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Vs.URL_SCHEME="indexeddb://";var Us=function(e){return on().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vs.URL_SCHEME)?function(e){return new Vs(e)}(e.slice(Vs.URL_SCHEME.length)):null};function Gs(e){return e.startsWith(Vs.URL_SCHEME)?e.slice(Vs.URL_SCHEME.length):e}Rs.registerSaveRouter(Us),Rs.registerLoadRouter(Us);var Hs=function(){function e(){xe(this,e),this.indexedDB=Bs()}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Ls,1);r.onupgradeneeded=function(){return Ws(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Ps,"readonly"),i=a.objectStore(Ps).getAll();i.onsuccess=function(){var t,n={},r=Se(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=Gs(t),new Promise((function(e,r){var a=n.indexedDB.open(Ls,1);a.onupgradeneeded=function(){return Ws(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Ps,"readwrite"),s=o.objectStore(Ps),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(zs,"readwrite")).objectStore(zs).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),js="/",qs="tensorflowjs_models",Ks="info",Xs="model_topology",Ys="weight_specs",Js="weight_data",Qs="model_metadata";function Zs(e){return{info:[qs,e,Ks].join(js),topology:[qs,e,Xs].join(js),weightSpecs:[qs,e,Ys].join(js),weightData:[qs,e,Js].join(js),modelMetadata:[qs,e,Qs].join(js)}}function $s(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function eu(e){var t=e.split(js);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(js)}function tu(e){return e.startsWith(nu.URL_SCHEME)?e.slice(nu.URL_SCHEME.length):e}var nu=function(){function e(t){if(xe(this,e),!on().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Zs(this.modelPath)}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Es(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,xs(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),$s(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=ks(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();nu.URL_SCHEME="localstorage://";var ru=function(e){return on().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(nu.URL_SCHEME)?function(e){return new nu(e)}(e.slice(nu.URL_SCHEME.length)):null};Rs.registerSaveRouter(ru),Rs.registerLoadRouter(ru);var au=function(){function e(){xe(this,e),vt(on().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),vt("undefined"==typeof window||"undefined"!=typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=qs+js,r=js+Ks,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=eu(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=tu(t),n=Zs(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",($s(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),iu="://",ou=function(){function e(){xe(this,e),this.managers={}}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){vt(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(iu)&&(t=t.slice(0,t.indexOf(iu))),vt(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();vt(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function su(e){if(-1===e.indexOf(iu))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(ou.getSchemes().join(",")));return{scheme:e.split(iu)[0],path:e.split(iu)[1]}}function uu(e,t){return cu.apply(this,arguments)}function cu(){return cu=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],vt(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),vt((a=Rs.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),vt(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],vt((o=Rs.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),vt(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=su(t).scheme,c=su(t).path,l=u===su(t).scheme,e.next=12,i.load();case 12:if(p=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,ou.getManager(u).removeModel(c);case 17:return e.next=19,s.save(p);case 19:if(h=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,ou.getManager(u).removeModel(c);case 24:return e.abrupt("return",h.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)}))),cu.apply(this,arguments)}function lu(){return pu.apply(this,arguments)}function pu(){return pu=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ou.getSchemes(),n={},r=Se(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,ou.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+iu+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),pu.apply(this,arguments)}function hu(e){return du.apply(this,arguments)}function du(){return du=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=su(t),e.abrupt("return",ou.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),du.apply(this,arguments)}function fu(e,t){return mu.apply(this,arguments)}function mu(){return mu=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",uu(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),mu.apply(this,arguments)}function vu(e,t){return gu.apply(this,arguments)}function gu(){return gu=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",uu(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),gu.apply(this,arguments)}var yu=function(){function e(){xe(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return we(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!=typeof window&&on().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return Ui(e)}}]),e}();if(on().get("IS_BROWSER")){on().setPlatform("browser",new yu);try{ou.registerManager(nu.URL_SCHEME,new au)}catch(rGe){}try{ou.registerManager(Vs.URL_SCHEME,new Hs)}catch(rGe){}}var bu,xu=function(){return Be()},ku=function(){function e(){xe(this,e),this.util=We(),this.textEncoder=new this.util.TextEncoder}return we(e,[{key:"fetch",value:function(e,t){return null!=on().global.fetch?on().global.fetch(e,t):(null==bu&&(bu=xu()),bu(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function wu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Zt(e),new wo(e,t,n)}on().get("IS_NODE")&&!on().get("IS_BROWSER")&&on().setPlatform("node",new ku);var Iu=us({cast_:function(e,t){var n=is(e,"x","cast");if(!Ot(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Xo.runKernel(On,r,a)}});var Su=us({clone_:function(e){var t={x:is(e,"x","clone","string_or_numeric")};return Xo.runKernel(Tr,t)}});function Nu(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function Tu(){on().set("PROD",!0)}function Cu(){on().set("DEBUG",!0)}function Eu(){on().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function _u(e){on().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Au(){Xo.disposeVariables()}function Ru(){return Xo}function Fu(){return Xo.memory()}function Du(e){return Xo.profile(e)}function Mu(e,t){return Xo.tidy(e,t)}function Ou(e){Uo(e).forEach((function(e){return e.dispose()}))}function Lu(e){return Xo.keep(e)}function zu(e){return Xo.time(e)}function Pu(e){return Xo.setBackend(e)}function Bu(){return Xo.ready()}function Wu(){return Xo.backendName}function Vu(e){Xo.removeBackend(e)}function Uu(e){return Xo.findBackend(e)}function Gu(e){return Xo.findBackendFactory(e)}function Hu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Xo.registerBackend(e,t,n)}function ju(){return Xo.backend}function qu(e,t){on().setPlatform(e,t)}Ko(),function(e){So=e}({buffer:wu,cast:Iu,clone:Su,print:Nu}),function(e){e}(_u);var Ku=us({add_:function(e,t){var n=is(e,"a","add"),r=is(t,"b","add"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(fn,i)}});var Xu=us({floorDiv_:function(e,t){var n=is(e,"a","floorDiv"),r=is(t,"b","floorDiv"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(xr,i)}});var Yu=us({div_:function(e,t){var n,r=is(e,"a","div"),a=is(t,"b","div");if(r=(n=C(Bo(r,a),2))[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return Xu(r,a);var i={a:r,b:a};return Xo.runKernel(sr,i,{})}});var Ju=us({mul_:function(e,t){var n=is(e,"a","mul"),r=is(t,"b","mul"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(oa,i)}});var Qu=us({abs_:function(e){var t=is(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Xo.runKernel(Bn,n)}var r={x:t};return Xo.runKernel(pn,r)}});var Zu=us({acos_:function(e){var t={x:is(e,"x","acos")};return Xo.runKernel(hn,t)}});var $u=us({acosh_:function(e){var t={x:is(e,"x","acosh")};return Xo.runKernel(dn,t)}});var ec=us({addN_:function(e){vt(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),vt(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return is(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!wt(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Xo.runKernel(mn,r)}});var tc=us({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:is(e,"x","all","bool")},a={axis:t,keepDims:n};return Xo.runKernel(vn,r,a)}});var nc=us({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:is(e,"x","any","bool")},a={axis:t,keepDims:n};return Xo.runKernel(gn,r,a)}});var rc=us({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:is(e,"x","argMax")},r={axis:t};return Xo.runKernel(yn,n,r)}});var ac=us({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:is(e,"x","argMin")},r={axis:t};return Xo.runKernel(bn,n,r)}});var ic=us({asin_:function(e){var t={x:is(e,"x","asin")};return Xo.runKernel(xn,t)}});var oc=us({asinh_:function(e){var t={x:is(e,"x","asinh")};return Xo.runKernel(kn,t)}});var sc=us({atan_:function(e){var t={x:is(e,"x","atan")};return Xo.runKernel(wn,t)}});var uc=us({atan2_:function(e,t){var n=is(e,"a","atan2"),r=is(t,"b","atan2"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(Sn,i)}});var cc=us({atanh_:function(e){var t={x:is(e,"x","atanh")};return Xo.runKernel(In,t)}});function lc(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return dc(e,[].concat(Ie(t),[o]),n,i,r,null,null,Ic(a))}function pc(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=C(vc(t),2),c=u[0],l=u[1];if("channelsLast"===s)o=[c,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[c,l,e[1],e[1]]}return dc(e,o,n,r,a,i,!1,s)}function hc(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=C(gc(t),3),l=c[0],p=c[1],h=c[2];if("NDHWC"===u)s="channelsLast",o=[l,p,h,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[l,p,h,e[1],e[1]]}return fc(e,o,n,r,a,!1,s,i)}function dc(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var h=C(e,4);u=h[0],c=h[1],l=h[2],p=h[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var d=C(e,4);u=d[0],p=d[1],c=d[2],l=d[3]}var f,m=C(t,4),v=m[0],g=m[1],y=m[3],b=C(vc(n),2),x=b[0],k=b[1],w=C(vc(r),2),I=w[0],S=w[1],N=yc(v,I),T=yc(g,S),E=function(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=mc(e,t,n));var i=e[0],o=e[1],s=bc((i-t+2*r)/n+1,a),u=bc((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=h[0],p=h[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(p-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=bc((t-i+y+b)/r+1,s),p=bc((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,c,l,x,k,N,T,i,s),_=E.padInfo,A=E.outHeight,R=E.outWidth,F=o?y*p:y;return"channelsFirst"===s?f=[u,F,A,R]:"channelsLast"===s&&(f=[u,A,R,F]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:A,outWidth:R,outChannels:F,padInfo:_,strideHeight:x,strideWidth:k,filterHeight:v,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:T,dilationHeight:I,dilationWidth:S,inShape:e,outShape:f,filterShape:t}}function fc(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,p=-1,h=-1;if("channelsLast"===o){var d=C(e,5);u=d[0],c=d[1],l=d[2],p=d[3],h=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var f=C(e,5);u=f[0],h=f[1],c=f[2],l=f[3],p=f[4]}var m,v=C(t,5),g=v[0],y=v[1],b=v[2],x=v[4],k=C(gc(n),3),w=k[0],I=k[1],S=k[2],N=C(gc(r),3),T=N[0],E=N[1],_=N[2],A=yc(g,T),R=yc(y,E),F=yc(b,_),D=function(e,t,n,r,a,i,o,s,u,c,l){var p,h,d,f;if("valid"===e&&(e=0),"number"==typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=mc(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=bc((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);h=m[0],d=m[1],f=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((h=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,I=Math.floor(y/2);p={top:k,bottom:w,left:I,right:y-I,front:b,back:x,type:"SAME"}}return{padInfo:p,outDepth:h,outHeight:d,outWidth:f}}(a,c,l,p,w,I,S,A,R,F,s),M=D.padInfo,O=D.outDepth,L=D.outHeight,z=D.outWidth,P=i?x*h:x;return"channelsFirst"===o?m=[u,P,O,L,z]:"channelsLast"===o&&(m=[u,O,L,z,P]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:p,inChannels:h,outDepth:O,outHeight:L,outWidth:z,outChannels:P,padInfo:M,strideDepth:w,strideHeight:I,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:F,dilationDepth:T,dilationHeight:E,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function mc(e,t,n){var r=yc(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function vc(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function gc(e){return"number"==typeof e?[e,e,e]:e}function yc(e,t){return t<=1?e:e+(e-1)*(t-1)}function bc(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function xc(e){var t=C(vc(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function kc(e,t){return xc(e)||xc(t)}function wc(e){return vc(e).every((function(e){return e>0}))}function Ic(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function Sc(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)vt(It(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){vt(It(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var Nc=us({reshape_:function(e,t){var n={x:is(e,"x","reshape","string_or_numeric")},r={shape:t};return Xo.runKernel(Ca,n,r)}});var Tc=us({avgPool_:function(e,t,n,r,a){var i=is(e,"x","avgPool","float32");vt(kc(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),vt(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),Sc("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Xo.runKernel(Nn,u,c);return l=Iu(l,i.dtype),s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Cc=us({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=is(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),vt(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),vt("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),vt("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),Sc("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Xo.runKernel(Cn,c,l);return p=Iu(p,s.dtype),u?Nc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Ec=us({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;vt(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=os(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Su(n[0]);var r=n,a={axis:t};return Xo.runKernel(Wn,r,a)}});var _c=us({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=is(e,"a","matMul"),i=is(t,"b","matMul"),o=C(Bo(a,i),2),s={a:a=o[0],b:i=o[1]},u={transposeA:n,transposeB:r};return Xo.runKernel(_n,s,u)}});var Ac=us({sigmoid_:function(e){var t={x:is(e,"x","sigmoid","float32")};return Xo.runKernel(ja,t)}});var Rc=us({slice_:function(e,t,n){var r=is(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Xo.runKernel(Va,a,i)}});var Fc=us({tanh_:function(e){var t={x:is(e,"x","tanh","float32")};return Xo.runKernel(hi,t)}});var Dc=us({basicLSTMCell_:function(e,t,n,r,a,i){var o=is(e,"forgetBias","basicLSTMCell"),s=is(t,"lstmKernel","basicLSTMCell"),u=is(n,"lstmBias","basicLSTMCell"),c=is(r,"data","basicLSTMCell"),l=is(a,"c","basicLSTMCell"),p=is(i,"h","basicLSTMCell"),h=Ec([c,p],1),d=_c(h,s),f=Ku(d,u),m=f.shape[0],v=f.shape[1]/4,g=[m,v],y=Rc(f,[0,0],g),b=Rc(f,[0,v],g),x=Rc(f,[0,2*v],g),k=Rc(f,[0,3*v],g),w=Ku(Ju(Ac(y),Fc(b)),Ju(l,Ac(Ku(o,x))));return[w,Ju(Fc(w),Ac(k))]}});var Mc=us({batchToSpaceND_:function(e,t,n){var r=is(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));vt(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),vt(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),vt(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Xo.runKernel(An,i,o)}});function Oc(e){return 0===e.rank||1===e.rank?Nc(e,[1,1,1,e.size]):2===e.rank?Nc(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var Lc=us({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=is(e,"x","batchNorm"),c=is(t,"mean","batchNorm"),l=is(n,"variance","batchNorm");null!=a&&(o=is(a,"scale","batchNorm")),null!=r&&(s=is(r,"offset","batchNorm")),vt(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),vt(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),vt(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p={x:Oc(u),scale:o,offset:s,mean:c,variance:l},h={varianceEpsilon:i},d=Xo.runKernel(kr,p,h);return Nc(d,u.shape)}});var zc=us({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=is(e,"x","batchNorm"),c=is(t,"mean","batchNorm"),l=is(n,"variance","batchNorm");return null!=a&&(o=is(a,"scale","batchNorm")),null!=r&&(s=is(r,"offset","batchNorm")),vt(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),vt(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),vt(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&vt(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&vt(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Pc=us({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=is(e,"x","batchNorm"),c=is(t,"mean","batchNorm"),l=is(n,"variance","batchNorm");return null!=a&&(o=is(a,"scale","batchNorm")),null!=r&&(s=is(r,"offset","batchNorm")),vt(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),vt(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),vt(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&vt(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&vt(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Bc=us({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=is(e,"x","batchNorm"),c=is(t,"mean","batchNorm"),l=is(n,"variance","batchNorm");return null!=a&&(o=is(a,"scale","batchNorm")),null!=r&&(s=is(r,"offset","batchNorm")),vt(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),vt(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),vt(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&vt(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&vt(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Wc=us({bincount_:function(e,t,n){var r=is(e,"x","bincount"),a=is(t,"weights","bincount");vt("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),vt(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),vt(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Xo.runKernel(Rn,i,o)}});var Vc=us({bitwiseAnd_:function(e,t){var n=is(e,"x","bitwiseAnd"),r=is(t,"y","bitwiseAnd");if(!wt(n.shape,r.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(n.shape,", y: ").concat(r.shape));if("int32"!==n.dtype||"int32"!==r.dtype)throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(n.dtype," and type of y: ").concat(r.dtype));var a={a:n,b:r};return Xo.runKernel(Fn,a)}});var Uc=us({broadcastArgs_:function(e,t){var n=is(e,"s0","broadcastArgs","int32"),r=is(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Xo.runKernel(Mn,a)}});var Gc=us({broadcastTo_:function(e,t){var n=is(e,"broadcastTo","x"),r=n.shape;if(Zt(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Nc(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return Su(n);var u={x:n},c={reps:o};return Xo.runKernel(di,u,c)}});var Hc=us({ceil_:function(e){var t={x:is(e,"x","ceil","float32")};return Xo.runKernel(Ln,t)}});function jc(e,t,n){Zt(e);var r={shape:e,value:t,dtype:n=n||Ut(t)};return Xo.runKernel(gr,{},r)}var qc=us({clipByValue_:function(e,t,n){var r=is(e,"x","clipByValue");if(vt(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return jc(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return Xo.runKernel(zn,a,i)}});var Kc=us({concat1d_:function(e){return Ec(e,0)}});var Xc=us({concat2d_:function(e,t){return Ec(e,t)}});var Yc=us({concat3d_:function(e,t){return Ec(e,t)}});var Jc=us({concat4d_:function(e,t){return Ec(e,t)}});var Qc=us({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=is(e,"x","conv2d","float32"),u=is(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),vt(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),vt(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),Sc("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];vt(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match input depth for filter ").concat(u.shape[2],".")})),vt(kc(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),vt(wc(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),vt(wc(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Xo.runKernel(Vn,h,d);return l?Nc(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Zc=us({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=is(e,"x","conv1d"),u=is(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1]])),vt(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),vt(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),Sc("conv1d",r,o),vt(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),vt(kc(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),vt(wc(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),vt(wc(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),vt("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=Nc(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Nc(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=Qc(h,p,[1,n],r,"NHWC",[1,i],o);return Nc(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});var $c=us({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;vt(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),vt(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),vt(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),vt(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];vt(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),vt(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must match output depth for filter ").concat(n.shape[3],".")})),Sc("conv2dDerInput",a,o);var h={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=Xo.runKernel(Gn,h,d);return c?Nc(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var el=us({conv2dTranspose_:function(e,t,n,r,a,i){var o=is(e,"x","conv2dTranspose"),s=is(t,"filter","conv2dTranspose");return $c(n,o,s,r,a,"NHWC",i)}});var tl=us({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=is(e,"x","conv3d"),s=is(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),vt(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),vt(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),vt(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),vt(kc(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),vt("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),vt(wc(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),vt(wc(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},h=Xo.runKernel(Hn,l,p);return c?Nc(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var nl=us({conv3DBackpropInput_:function(e,t,n,r,a){vt(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];vt(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),vt(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),vt(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),vt(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),vt(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},h=Xo.runKernel(qn,l,p);return s?Nc(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var rl=us({conv3dTranspose_:function(e,t,n,r,a){var i=is(e,"x","conv3dTranspose"),o=is(t,"filter","conv3dTranspose");return nl(n,i,o,r,a)}});var al=us({cos_:function(e){var t={x:is(e,"x","cos","float32")};return Xo.runKernel(Kn,t)}});var il=us({cosh_:function(e){var t={x:is(e,"x","cosh","float32")};return Xo.runKernel(Xn,t)}});var ol=us({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:is(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Xo.runKernel(Yn,a,i)}});var sl=us({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:is(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Xo.runKernel(Jn,a,i)}});var ul=us({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=is(e,"x","denseBincount"),i=is(t,"weights","denseBincount");vt("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),vt(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),vt(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),vt(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Xo.runKernel(Zn,o,s)}});var cl=us({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=is(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];vt(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),vt(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),vt(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),vt(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Xo.runKernel($n,s,u)}});var ll=us({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=is(e,"x","depthwiseConv2d","float32"),u=is(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),vt(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),vt(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];vt(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(p,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),Sc("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Xo.runKernel(er,h,d);return l?Nc(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var pl=us({diag_:function(e){var t={x:is(e,"x","diag")};return Xo.runKernel(rr,t)}});var hl=us({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=is(e,"x","dilation2d"),s=is(t,"filter","dilation2d");vt(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),vt(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),vt("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),vt(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},h=Xo.runKernel(ar,l,p);return c?Nc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),dl={};function fl(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function ml(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function vl(e,t){for(var n=Math.max(e.length,t.length),r=new Array(n),a=0;a<n;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}r[n-a-1]=i}}return r}Le(dl,{assertAndGetBroadcastShape:function(){return vl},getBroadcastDims:function(){return fl},getReductionAxes:function(){return ml}});var gl=us({equal_:function(e,t){var n,r=is(e,"a","equal","string_or_numeric"),a=is(t,"b","equal","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(hr,i)}});var yl=us({where_:function(e,t,n){var r=is(t,"a","where"),a=is(n,"b","where"),i=is(e,"condition","where","bool"),o=vl(vl(i.shape,r.shape),a.shape),s={condition:Gc(i,o),t:Gc(r,o),e:Gc(a,o)};return Xo.runKernel(Ba,s)}});var bl=us({zerosLike_:function(e){var t={x:is(e,"x","zerosLike")};return Xo.runKernel(ki,t)}});var xl=us({divNoNan_:function(e,t){var n=is(e,"a","div"),r=is(t,"b","div"),a=C(Bo(n,r),2);n=a[0],r=a[1];var i=Yu(n,r),o=bl(i),s=gl(r,o);return yl(s,o,i)}});var kl=us({dot_:function(e,t){var n=is(e,"t1","dot"),r=is(t,"t2","dot");vt((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(vt(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Nc(n,[1,-1]),s=Nc(r,[-1,1]),u=_c(o,s);return Nc(u,[])}if(1===n.rank&&2===r.rank){var c=Nc(n,[1,-1]),l=Nc(r,[r.shape[0],r.shape[1]]),p=_c(c,l);return Nc(p,[p.size])}if(2===n.rank&&1===r.rank){var h=Nc(r,[-1,1]),d=_c(n,h);return Nc(d,[d.size])}var f=Nc(r,[r.shape[0],r.shape[1]]);return _c(n,f)}});var wl=us({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return is(e,"tensors".concat(t),"einsum")})),i={equation:e};return Xo.runKernel(ur,a,i)}});var Il=us({elu_:function(e){var t={x:is(e,"x","elu","float32")};return Xo.runKernel(cr,t)}});var Sl=us({ensureShape_:function(e,t){var n=is(e,"x","ensureShape","string_or_numeric");if(!kt(n.shape,t))throw new Error("EnsureShape: Shape of tensor ".concat(n.shape," is not compatible with expected shape ").concat(t));return e}});var Nl=us({erf_:function(e){var t=is(e,"x","erf");vt("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Iu(t,"float32"));var n={x:t};return Xo.runKernel(pr,n)}});function Tl(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Cl(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function El(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function _l(e,t){return Cl(e,t.map((function(e){return 1})),t)}function Al(e,t,n){vt(Tl(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Rl(e,t){if(Tl(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Fl(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Dl(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Ml=us({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:is(e,"x","max")},a={reductionIndices:t,keepDims:n};return Xo.runKernel(Kr,r,a)}});var Ol=us({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:is(e,"x","min")},a={axis:t,keepDims:n};return Xo.runKernel(ta,r,a)}});var Ll=us({pow_:function(e,t){var n=is(e,"base","pow"),r=is(t,"exp","pow"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(ga,i)}});function zl(e,t){if((co(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&co(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ls(e,[],[],t)}var Pl=us({sqrt_:function(e){var t={x:is(e,"x","sqrt","float32")};return Xo.runKernel(Ka,t)}});var Bl=us({square_:function(e){var t=is(e,"x","square");return Xo.runKernel("Square",{x:t},{})}});var Wl=us({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=is(e,"x","sum");"bool"===r.dtype&&(r=Iu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Xo.runKernel(Xa,a,i)}});function Vl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Qu(e);if(1!==e.rank&&null===n)return Vl(Nc(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Wl(Qu(e),n);if(t===1/0)return Ml(Qu(e),n);if(t===-1/0)return Ol(Qu(e),n);if("euclidean"===t||2===t)return Pl(Wl(Ll(Qu(e),zl(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Ml(Wl(Qu(e),n[0]),n[1]-1);if(t===1/0)return Ml(Wl(Qu(e),n[1]),n[0]);if(t===-1/0)return Ol(Wl(Qu(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Pl(Wl(Bl(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Ul=us({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Vl(e=is(e,"x","norm"),t,n),i=a.shape;if(r){var o=At(n,e.shape);i=_l(a.shape,o)}return Nc(a,i)}});var Gl=us({euclideanNorm_:function(e){return Ul(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});var Hl=us({exp_:function(e){var t={x:is(e,"x","exp")};return Xo.runKernel(dr,t)}});var jl=us({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=is(e,"x","expandDims","string_or_numeric");vt(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Xo.runKernel(fr,r,a)}});var ql=us({expm1_:function(e){var t={x:is(e,"x","expm1")};return Xo.runKernel(mr,t)}});var Kl=us({tile_:function(e,t){var n=is(e,"x","tile","string_or_numeric");vt(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Xo.runKernel(di,r,a)}});var Xl=us({eye_:function(e,t,n){null==t&&(t=e);for(var r=wu([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=Nc(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return Kl(jl(o,0),[n[0],1,1]);if(2===n.length)return Kl(jl(jl(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return Kl(jl(jl(jl(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});var Yl=us({floor_:function(e){var t={x:is(e,"x","floor","float32")};return Xo.runKernel(br,t)}});var Jl=us({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:is(e,"x","gather"),indices:is(t,"indices","gather","int32")},i={axis:n,batchDims:r};return Xo.runKernel(wr,a,i)}});var Ql=us({greater_:function(e,t){var n,r=is(e,"a","greater","string_or_numeric"),a=is(t,"b","greater","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(Sr,i)}});var Zl=us({greaterEqual_:function(e,t){var n,r=is(e,"a","greaterEqual","string_or_numeric"),a=is(t,"b","greaterEqual","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(Nr,i)}});var $l=us({imag_:function(e){var t={input:is(e,"input","imag")};return Xo.runKernel(Er,t)}});var ep=us({isFinite_:function(e){var t={x:is(e,"x","isFinite")};return Xo.runKernel(_r,t)}});var tp=us({isInf_:function(e){var t={x:is(e,"x","isInf")};return Xo.runKernel(Ar,t)}});var np=us({isNaN_:function(e){var t={x:is(e,"x","isNaN")};return Xo.runKernel(Rr,t)}});var rp=us({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:is(e,"x","leakyRelu")},r={alpha:t};return Xo.runKernel(Fr,n,r)}});var ap=us({less_:function(e,t){var n,r=is(e,"a","less","string_or_numeric"),a=is(t,"b","less","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(Dr,i)}});var ip=us({lessEqual_:function(e,t){var n,r=is(e,"a","lessEqual","string_or_numeric"),a=is(t,"b","lessEqual","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(Mr,i)}});function op(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Xo.runKernel(Or,{},r)}var sp=us({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=is(e,"x","localResponseNormalization");vt(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),vt(It(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Xo.runKernel(Hr,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var up=us({log_:function(e){var t={x:is(e,"x","log","float32")};return Xo.runKernel(Lr,t)}});var cp=us({log1p_:function(e){var t={x:is(e,"x","log1p")};return Xo.runKernel(zr,t)}});function lp(e){return vt(Gt(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=is(t,"x","tf.grad","string_or_numeric"),a=null!=n?is(n,"dy","tf.grad"):null;return Xo.tidy((function(){var t=Xo.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&gt(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),vp(i),i[0]}))}}function pp(e){return vt(Gt(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){vt(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=os(t,"args","tf.grads","string_or_numeric"),a=null!=n?is(n,"dy","tf.grads"):null;return Xo.tidy((function(){var t=Xo.gradients((function(){return e.apply(void 0,Ie(r))}),r,a),n=t.value,i=t.grads;return null!=a&&gt(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),vp(i),i}))}}function hp(e){return vt(Gt(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){vt(t instanceof No,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),vt(null==n||n instanceof No,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Xo.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return vp(a),{grad:a[0],value:i}}}function dp(e){return vt(Gt(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){vt(Array.isArray(t)&&t.every((function(e){return e instanceof No})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),vt(null==n||n instanceof No,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Xo.gradients((function(){return e.apply(void 0,Ie(t))}),t,n);return null!=n&&gt(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),vp(r.grads),r}}function fp(e,t){vt(Gt(e),(function(){return"The f passed in variableGrads(f) must be a function"})),vt(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Co})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Xo.registeredVariables)t.push(Xo.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),vt(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Xo.gradients(e,t,null,!0),s=o.value,u=o.grads;vt(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),vt(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function mp(e){return Xo.customGrad(e)}function vp(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var gp=us({neg_:function(e){var t={x:is(e,"x","neg")};return Xo.runKernel(sa,t)}});var yp=us({softplus_:function(e){var t={x:is(e,"x","softplus")};return Xo.runKernel(qa,t)}});var bp=us({logSigmoid_:function(e){var t=is(e,"x","logSigmoid");return mp((function(e){return{value:gp(yp(gp(e))),gradFunc:function(t){return Ju(t,Ac(gp(e)))}}}))(t)}});var xp=us({sub_:function(e,t){var n=is(e,"a","sub"),r=is(t,"b","sub"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(li,i)}});var kp=us({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=is(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return mp((function(e,n){var r=Ml(e,t,!0),a=xp(e,r),i=xp(Iu(a,"float32"),up(Wl(Hl(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=C(n,1)[0],a=Hl(r);return xp(e,Ju(Wl(e,t,!0),a))}}}))(n)}});var wp=us({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=is(e,"x","logSumExp"),a=At(t,r.shape),i=Ml(r,a,!0),o=xp(r,i),s=Hl(o),u=Wl(s,a),c=up(u),l=Ku(Nc(i,c.shape),c);if(n){var p=_l(l.shape,a);return Nc(l,p)}return l}});var Ip=us({logicalAnd_:function(e,t){var n=is(e,"a","logicalAnd","bool"),r=is(t,"b","logicalAnd","bool");vl(n.shape,r.shape);var a={a:n,b:r};return Xo.runKernel(Pr,a)}});var Sp=us({logicalNot_:function(e){var t={x:is(e,"x","logicalNot","bool")};return Xo.runKernel(Br,t)}});var Np=us({logicalOr_:function(e,t){var n=is(e,"a","logicalOr","bool"),r=is(t,"b","logicalOr","bool");vl(n.shape,r.shape);var a={a:n,b:r};return Xo.runKernel(Wr,a)}});var Tp=us({logicalXor_:function(e,t){var n=is(e,"a","logicalXor","bool"),r=is(t,"b","logicalXor","bool");return vl(n.shape,r.shape),Ip(Np(e,t),Sp(Ip(e,t)))}}),Cp=2147483648;var Ep=us({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=is(e,"sortedSequence","searchSorted"),a=is(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=Nc(r,[-1,i]),u=Nc(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(bt(u.shape)>=Cp)throw new Error("values tensor size must less than ".concat(Cp));if(s.shape[1]>=Cp)throw new Error("trailing dim_size must less than ".concat(Cp," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Xo.runKernel(Pa,c,l)}});function _p(e,t){return Ep(e,t,"left")}var Ap=us({maxPool_:function(e,t,n,r,a){var i=is(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),vt(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),vt(kc(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),Sc("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Xo.runKernel(Yr,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Rp=us({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=is(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),vt(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),vt("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),Sc("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Xo.runKernel(Qr,c,l);return u?Nc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Fp=us({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:is(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Xo.runKernel($r,i,o);return{result:s[0],indexes:s[1]}}});var Dp=us({maximum_:function(e,t){var n,r=is(e,"a","maximum"),a=is(t,"b","maximum");r=(n=C(Bo(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Iu(r,"int32"),a=Iu(a,"int32")),vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(Xr,i)}});var Mp=us({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:is(e,"x","mean")},a={axis:t,keepDims:n};return Xo.runKernel(ea,r,a)}});function Op(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Zt(e),"complex64"===t){var n=Op(e,"float32"),r=Op(e,"float32");return cs(n,r)}var a=Jt(bt(e),t);return Xo.makeTensor(a,e,t)}function Lp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(Zt(e),"complex64"===t){var n=Lp(e,"float32"),r=Op(e,"float32");return cs(n,r)}var a=Yt(bt(e),t);return Xo.makeTensor(a,e,t)}function zp(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).indexing,r=void 0===n?"xy":n;if("xy"!==r&&"ij"!==r)throw new TypeError("".concat(r," is not a valid third argument to meshgrid"));if(void 0===e)return[];var a=is(e,"x","meshgrid",e instanceof No?e.dtype:"float32");if(void 0===t)return[a];var i=is(t,"y","meshgrid",t instanceof No?t.dtype:"float32"),o=bt(a.shape),s=bt(i.shape);return"xy"===r?(a=Nc(a,[1,-1]),i=Nc(i,[-1,1]),[_c(Lp([s,1],a.dtype),a),_c(i,Lp([1,o],i.dtype))]):(a=Nc(a,[-1,1]),i=Nc(i,[1,-1]),[_c(a,Lp([1,s],a.dtype)),_c(Lp([o,1],i.dtype),i)])}var Pp=us({minimum_:function(e,t){var n,r=is(e,"a","minimum"),a=is(t,"b","minimum");r=(n=C(Bo(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Iu(r,"int32"),a=Iu(a,"int32")),vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(na,i)}});var Bp=us({mirrorPad_:function(e,t,n){vt("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=is(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");vt(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){vt(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),vt(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Xo.runKernel(ra,u,s)}});var Wp=us({mod_:function(e,t){var n=is(e,"a","mod"),r=is(t,"b","mod"),a=C(Bo(n,r),2),i={a:n=a[0],b:r=a[1]};return Xo.runKernel(aa,i)}});var Vp=us({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=At(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=is(e,"x","moments")).shape),r=Mp(e,n,t),a=r.shape;t||(a=_l(r.shape,n));var i=Bl(xp(Iu(e,"float32"),Nc(r,a)));return{mean:r,variance:Mp(i,n,t)}}});var Up=us({multiRNNCell_:function(e,t,n,r){for(var a=is(t,"data","multiRNNCell"),i=os(n,"c","multiRNNCell"),o=os(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var p=[],h=[],d=0;d<u.length;d+=2)p.push(u[d]),h.push(u[d+1]);return[p,h]}});var Gp=us({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=is(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?Nc(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Xo.runKernel(ia,s,u);return 1===o?Nc(c,[c.size]):c}});var Hp=us({notEqual_:function(e,t){var n,r=is(e,"a","notEqual","string_or_numeric"),a=is(t,"b","notEqual","string_or_numeric");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(ua,i)}});var jp=us({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:is(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return Xo.runKernel(da,i,o)}});var qp=us({onesLike_:function(e){var t={x:is(e,"x","onesLike")};return Xo.runKernel(ha,t)}});var Kp=us({outerProduct_:function(e,t){var n=is(e,"v1","outerProduct"),r=is(t,"v2","outerProduct");vt(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=Nc(n,[-1,1]),i=Nc(r,[1,-1]);return _c(a,i)}});var Xp=us({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=is(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Xo.runKernel(ma,i,a)}});var Yp=us({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return vt(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Xp(e,[t],n)}});var Jp=us({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return vt(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Xp(e,t,n)}});var Qp=us({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return vt(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Xp(e,t,n)}});var Zp=us({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return vt(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Xp(e,t,n)}});var $p=us({spaceToBatchND_:function(e,t,n){var r=is(e,"x","spaceToBatchND");vt(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),vt(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),vt(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Xo.runKernel(Ya,a,i)}});var eh=us({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=is(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),vt(kc(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,p=pc(u.shape,t,i,a,r),h=[p.dilationHeight,p.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([p.filterHeight,p.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([p.inHeight,p.inWidth],h,l),m=C(f,2),v=m[0],g=m[1],y=d?r:"valid",b=d?u:$p(u,h,v),x=("avg"===n?function(){return Tc(b,t,i,y,o)}:function(){return Ap(b,t,i,y,o)})(),k=d?x:Mc(x,h,g);return c?Nc(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});var th=us({prelu_:function(e,t){var n={x:is(e,"x","prelu"),alpha:is(t,"alpha","prelu")};return Xo.runKernel(ya,n)}});var nh=us({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=is(e,"x","prod");"bool"===r.dtype&&(r=Iu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Xo.runKernel(ba,a,i)}});var rh=us({raggedGather_:function(e,t,n,r){var a=e.map((function(e,t){return is(e,"tensors".concat(t),"raggedGather","int32")})),i={paramsNestedSplits:a,paramsDenseValues:is(t,"paramsDenseValues","raggedGather"),indices:is(n,"indices","raggedGather","int32")},o={outputRaggedRank:r},s=Xo.runKernel(xa,i,o);return{outputNestedSplits:s.slice(0,s.length-1),outputDenseValues:s[s.length-1]}}});var ah=us({raggedRange_:function(e,t,n){var r=is(e,"starts","raggedRange"),a={starts:r,limits:is(t,"limits","raggedRange",r.dtype),deltas:is(n,"deltas","raggedRange",r.dtype)},i=Xo.runKernel(ka,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});var ih=us({raggedTensorToTensor_:function(e,t,n,r,a){var i=is(e,"shape","raggedTensorToTensor","int32"),o=is(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:is(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return is(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},u={rowPartitionTypes:a};return Xo.runKernel(wa,s,u)}});var oh=us({rand_:function(e,t,n){Zt(e);var r=bt(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Xo.makeTensor(a,e,n)}}),sh=ze(Ye()),uh={};Le(uh,{TEST_EPSILON_FLOAT16:function(){return lh},createVideoElement:function(){return kh},encodeStrings:function(){return xh},expectArrayBuffersEqual:function(){return bh},expectArraysClose:function(){return ph},expectArraysEqual:function(){return mh},expectNumbersClose:function(){return vh},expectPromiseToFail:function(){return fh},expectValuesInRange:function(){return yh},play:function(){return wh},testEpsilon:function(){return hh}});var ch=.001,lh=.1;function ph(e,t,n){return null==n&&(n=hh()),dh(e,t,(function(e,t){return gh(e,t,n)}))}function hh(){return 32===Xo.backend.floatPrecision()?ch:lh}function dh(e,t,n){var r=!0;if((co(e)||co(t))&&(r=!1),co(e)&&co(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=ns(e),s=ns(t);if(!wt(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=co(e)?e:lo(e),c=co(t)?t:lo(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],h=c[l];if(!n(p,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(h,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}"undefined"!=typeof expect&&expect().nothing()}function fh(e,t){e().then((function(){return t.fail()}),(function(){return t()})),"undefined"!=typeof expect&&expect().nothing()}function mh(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Bt(e)||Bt(e[0])||Bt(t)||Bt(t[0])?dh(e,n,(function(e,t){return e==t})):dh(e,t,(function(e,t){return gh(e,t,0)}))}function vh(e,t,n){if(null==n&&(n=hh()),!gh(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));"undefined"!=typeof expect&&expect().nothing()}function gh(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function yh(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function bh(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))}function xh(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?xh(n):e[t]=so(n)}return e}function kh(e){var t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((function(e){t.addEventListener("loadeddata",(function(n){return e(t)})),t.load()}))}function wh(e){return Ih.apply(this,arguments)}function Ih(){return Ih=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:if(e.t0="requestVideoFrameCallback"in t,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){t.requestVideoFrameCallback(e)}));case 6:case"end":return e.stop()}}),e)}))),Ih.apply(this,arguments)}var Sh=function(){function e(t,n,r,a,i){xe(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=sh.alea(o.toString())}return we(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Nh=function(){function e(t,n,r,a){xe(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=sh.alea(i.toString()),this.randn=new Sh(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return we(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Th=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(xe(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=sh.alea(i)}return we(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Ch=us({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(Zt(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Nh(t,n,r,a),o=wu(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Eh=us({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Zt(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new Sh(t,n,r,!1,a),o=wu(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var _h=us({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Eh(e,0,1,t,n)}});var Ah=us({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;Zt(e);for(var i=wu(e,r),o=new Th(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});var Rh=us({randomUniformInt_:function(e,t,n,r){return Ah(e,t,n,"int32",r)}});function Fh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Xo.runKernel(Ia,{},a)}var Dh=us({real_:function(e){var t={input:is(e,"input","real")};return Xo.runKernel(Sa,t)}});var Mh=us({reciprocal_:function(e){var t={x:is(e,"x","reciprocal")};return Xo.runKernel(Na,t)}});var Oh=us({relu_:function(e){var t={x:is(e,"x","relu")};return Xo.runKernel(Ta,t)}});var Lh=us({relu6_:function(e){var t={x:is(e,"x","relu6")};return Xo.runKernel(Fa,t)}});var zh=us({reverse_:function(e,t){var n={x:is(e,"x","reverse")},r={dims:t};return Xo.runKernel(Da,n,r)}});var Ph=us({reverse1d_:function(e){var t=is(e,"x","reverse");return vt(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),zh(t,0)}});var Bh=us({reverse2d_:function(e,t){var n=is(e,"x","reverse");return vt(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),zh(n,t)}});var Wh=us({reverse3d_:function(e,t){var n=is(e,"x","reverse");return vt(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),zh(n,t)}});var Vh=us({reverse4d_:function(e,t){var n=is(e,"x","reverse");return vt(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),zh(n,t)}});var Uh=us({round_:function(e){var t={x:is(e,"x","round")};return Xo.runKernel(Ma,t)}});var Gh=us({rsqrt_:function(e){var t={x:is(e,"x","rsqrt","float32")};return Xo.runKernel(Oa,t)}});var Hh=us({selu_:function(e){var t={x:is(e,"x","selu")};return Xo.runKernel(Wa,t)}});var jh=us({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=is(e,"x","separableConv2d"),u=is(t,"depthwiseFilter","separableConv2d"),c=is(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");vt(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),vt(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),vt(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),vt(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),vt(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var h=u.shape[2],d=u.shape[3];vt(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(h*d,", but got ").concat(c.shape[2],".")}));var f=ll(l,u,r,a,o,i),m=Qc(f,c,1,"valid",o);return p?Nc(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function qh(){return qh=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=is(t,"x","setdiff1d"),a=is(n,"y","setdiff1d"),vt(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),vt(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),vt(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new wo([u],r.dtype),p=new wo([u],"int32"),h=0,d=0;h<i.length;h++)s.has(i[h])||(l.values[d]=i[h],p.values[d]=h,d++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 14:case"end":return e.stop()}}),e)}))),qh.apply(this,arguments)}var Kh=function(e,t){return qh.apply(this,arguments)};var Xh=us({sign_:function(e){var t={x:is(e,"x","sign")};return Xo.runKernel(Ha,t)}});var Yh=us({sin_:function(e){var t={x:is(e,"x","sin","float32")};return Xo.runKernel(Ua,t)}});var Jh=us({sinh_:function(e){var t={x:is(e,"x","sinh")};return Xo.runKernel(Ga,t)}});var Qh=us({slice1d_:function(e,t,n){var r=is(e,"x","slice1d");return vt(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Rc(r,[t],[n])}});var Zh=us({slice2d_:function(e,t,n){var r=is(e,"x","slice2d");return vt(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Rc(r,t,n)}});var $h=us({slice3d_:function(e,t,n){var r=is(e,"x","slice3d");return vt(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Rc(r,t,n)}});var ed=us({slice4d_:function(e,t,n){var r=is(e,"x","slice4d");return vt(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Rc(r,t,n)}});var td=us({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=is(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Xo.runKernel(Qa,r,a)}});var nd=us({fft_:function(e){vt("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Xo.runKernel(vr,t)}});var rd=us({ifft_:function(e){vt("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Xo.runKernel(Cr,t)}});var ad=us({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Nc(e,[r,n]);t=rd(a)}else{var i=[r,2*(n-1)],o=Nc(Dh(e),[r,n]),s=Nc($l(e),[r,n]),u=zh(Rc(o,[0,1],[r,n-2]),1),c=Ju(zh(Rc(s,[0,1],[r,n-2]),1),zl(-1)),l=Ec([o,u],1),p=Ec([s,c],1),h=Nc(cs(l,p),[i[0],i[1]]);t=rd(h)}if(t=Dh(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=Nc(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}});var id=us({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:is(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Xo.runKernel(Ja,r,a)}});var od=us({rfft_:function(e,t){vt("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Rc(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Ec([e,Op(s)],e.shape.length-1),r=t}else n=e;var u=bl(n),c=Nc(cs(n,u),[a,r]),l=nd(c),p=Math.floor(r/2)+1,h=Dh(l),d=$l(l),f=id(h,[p,r-p],h.shape.length-1),m=id(d,[p,r-p],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,Nc(cs(f[0],m[0]),v)}});var sd=us({squaredDifference_:function(e,t){var n,r=is(e,"a","squaredDifference"),a=is(t,"b","squaredDifference");r=(n=C(Bo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Xo.runKernel(ri,i,{})}});var ud=us({squeeze_:function(e,t){var n=is(e,"x","squeeze","string_or_numeric");return Nc(n,Rt(n.shape,t).newShape)}});var cd=us({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=os(e,"tensors","stack","string_or_numeric");vt(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&vt(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Xo.runKernel(fa,r,a)}});var ld=us({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:is(e,"x","step")},r={alpha:t};return Xo.runKernel(wi,n,r)}});var pd=us({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:is(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Xo.runKernel(oi,c,l)}});var hd=us({tan_:function(e){var t={x:is(e,"x","tan","float32")};return Xo.runKernel(pi,t)}});function dd(e,t){yt(e);var n=ns(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ls(e,null,n,t)}function fd(e,t,n){if(yt(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=ns(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ls(e,t,r,n)}function md(e,t,n){if(yt(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=ns(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ls(e,t,r,n)}function vd(e,t,n){if(yt(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=ns(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ls(e,t,r,n)}function gd(e,t,n){if(yt(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=ns(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ls(e,t,r,n)}function yd(e,t,n){if(yt(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=ns(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ls(e,t=t||r,r,n)}var bd={};function xd(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function kd(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}xd(n,t,e)}function wd(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:bt(t.shape)/u,sliceSize:o,strides:[].concat(Ie(jt(n.slice(0,a))),[1]),outputSize:bt(n)}}Le(bd,{calculateShapes:function(){return wd},validateInput:function(){return kd},validateUpdateShape:function(){return xd}});var Id=us({tensorScatterUpdate_:function(e,t,n){var r=is(e,"tensor","tensorScatterupdate"),a=is(t,"indices","tensorScatterupdate","int32"),i=is(n,"updates","tensorScatterupdate");if(kd(i,a,r.shape),r.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(r.dtype," and ").concat(i.dtype,"."));var o={tensor:r,indices:a,updates:i};return Xo.runKernel(za,o,{})}});var Sd=us({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=is(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var i={x:r},o={k:t,sorted:n},s=C(Xo.runKernel(fi,i,o),2);return{values:s[0],indices:s[1]}}});var Nd=us({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(Zt(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Sh(t,n,r,!0,a),o=wu(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Td=us({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=is(e,"x","unique","string_or_numeric");vt(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=C(Xo.runKernel(gi,r,a),2);return{values:i[0],indices:i[1]}}});var Cd=us({unsortedSegmentSum_:function(e,t,n){var r=is(e,"x","unsortedSegmentSum"),a=is(t,"segmentIds","unsortedSegmentSum","int32");vt(It(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Xo.runKernel(bi,i,o)}});var Ed=us({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=is(e,"x","unstack","string_or_numeric");vt(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Xo.runKernel(yi,r,a)}});function _d(e,t){return Ep(e,t,"right")}function Ad(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Xo.makeVariable(e,t,n,r)}function Rd(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=wu(e,"int32"),i=wu([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function Fd(){return Fd=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=is(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=Rd(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)}))),Fd.apply(this,arguments)}var Dd=function(e){return Fd.apply(this,arguments)};function Md(){return Md=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=is(t,"tensor","boolMask"),i=is(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,vt(s>0,(function(){return"mask cannot be scalar"})),gt(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return p=u.slice(0,o).concat([c],u.slice(o+s)),h=Nc(a,p),d=Nc(i,[-1]),e.next=9,Dd(d);case 9:return f=e.sent,m=ud(f,[1]),v=Jl(h,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),h.dispose(),d.dispose(),f.dispose(),v));case 13:case"end":return e.stop()}}),e)}))),Md.apply(this,arguments)}var Od=function(e,t,n){return Md.apply(this,arguments)};var Ld=us({transpose_:function(e,t,n){var r=is(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),vt(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){vt(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?Mu((function(){var e=Dh(r),t=$l(r);return e=Xo.runKernel(vi,{x:e},i),t=Xo.runKernel(vi,{x:t},i),n&&(t=gp(t)),cs(e,t)})):Xo.runKernel(vi,a,i)}});var zd=us({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=is(e,"v","movingAverage"),o=is(t,"x","movingAverage"),s=is(n,"decay","movingAverage");Wo(i,o),vt(wt(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=zl(1),c=xp(u,s),l=Ju(xp(o,i),c);if(a){vt(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var p=is(r,"step","movingAverage");l=Yu(l,xp(u,Ll(s,p)))}return Ku(i,l)}});var Pd=us({scatterND_:function(e,t,n){Zt(n);var r=is(e,"indices","scatterND","int32"),a=is(t,"updates","scatterND");kd(a,r,n);var i={indices:r,updates:a},o={shape:n};return Xo.runKernel(La,i,o)}});var Bd=us({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Zt(n);var a=is(e,"sparseIndices","sparseToDense","int32"),i=is(t,"sparseValues","sparseToDense","string_or_numeric"),o=is(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Xo.runKernel(ni,s,u)}});var Wd=us({gatherND_:function(e,t){var n=is(t,"indices","gatherND","int32"),r={params:is(e,"x","gatherND","string_or_numeric"),indices:n};return Xo.runKernel(Ir,r)}});var Vd=us({dropout_:function(e,t,n,r){var a=is(e,"x","dropout");if(vt("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),vt(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof No?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(wt(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Yu(Yl(Ku(Ah(i,0,1,"float32",r),o)),o);return Ju(a,s)}});function Ud(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Gd(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return dd(a,"float32")}function Hd(){return Hd=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=is(t,"predictions","inTopK"),i=is(n,"targets","inTopK"),vt(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),vt(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),gt(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],vt(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,p=Ft("bool",c),h=0;case 15:if(!(h<c)){e.next=30;break}for(d=h*l,f=s.subarray(d,d+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});m.sort((function(e,t){return t.value-e.value})),p[h]=0,g=0;case 20:if(!(g<r)){e.next=27;break}if(m[g].index!==u[h]){e.next=24;break}return p[h]=1,e.abrupt("break",27);case 24:g++,e.next=20;break;case 27:h++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),ps(p,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)}))),Hd.apply(this,arguments)}var jd=function(e,t){return Hd.apply(this,arguments)},qd={};Le(qd,{conv2d:function(){return Zd},depthwiseConv2d:function(){return tf},matMul:function(){return nf}});var Kd=us({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]])),vt(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),vt(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),vt(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];vt(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),vt(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),Sc("conv2dDerFilter",a,o);var p={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Xo.runKernel(Un,p,h)}});function Xd(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Ju(e,ld(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Yd(e,t){var n=t,r=ml(e.shape,t.shape);return r.length>0&&(n=Wl(n,r)),Nc(n,e.shape)}function Jd(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Oh(e);if("elu"===t)return Il(e);if("relu6"===t)return Lh(e);if("prelu"===t)return th(e,n);if("leakyrelu"===t)return rp(e,r);if("sigmoid"===t)return Ac(e);throw new Error("Unknown fused activation ".concat(t,"."))}var Qd=function(e,t){return!(e>0)||"linear"===t};var Zd=us({fusedConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,p=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights,m=e.leakyreluAlpha;if(d=d||"linear",!1===Qd(Xo.state.gradientDepth,d)){vt("NHWC"===s,(function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var v=Qc(n,r,a,i,s,c,l);return null!=p&&(v=Ku(v,p)),Jd(v,d,f,m)}var g=is(n,"x","conv2d","float32"),y=is(r,"filter","conv2d","float32"),b=g,x=!1;3===g.rank&&(x=!0,b=Nc(g,[1,g.shape[0],g.shape[1],g.shape[2]])),vt(4===b.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(b.rank,".")})),vt(4===y.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(y.rank,".")})),Sc("fused conv2d",i,l);var k="NHWC"===s?b.shape[3]:b.shape[1];vt(y.shape[2]===k,(function(){return"Error in conv2d: depth of input (".concat(k,") must match input depth for filter ").concat(y.shape[2],".")})),vt(kc(a,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}));var w,I,S=dc(b.shape,y.shape,a,c,i,l);if(null!=p&&(t=C(Bo(w=is(p,"bias","fused conv2d"),g),1),w=t[0],"NHWC"===s?vl(S.outShape,w.shape):(vt(w.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(w.shape.length,".")})),vt(0===w.shape.length||w.shape[0]===S.outChannels||1===w.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(w.shape,") is not compatible with the number of output channels (").concat(S.outChannels,")")})))),null!=f){var N=f.shape;if(vt(N.length<=1||3===N.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(N.length,".")})),1===N.length)vt(1===N[0]||N[0]===S.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(N,") is not compatible with the number of output channels (").concat(S.outChannels,").")}));else if(3===N.length)try{vl(N,S.outShape)}catch(LUe){var T="Error in fused conv2d: PReLU activation weights (".concat(N,") is not compatible with the output shape of the conv2d (").concat(S.outShape,").");throw Error(T)}I=is(f,"prelu weights","fused conv2d")}var E=function(e,t){vt("NHWC"===s,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")}));var n=C(t,4),r=n[0],o=n[1],u=n[2],l=n[3],p=Xd(e,u,d);vt(xc(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(c,"'")}));var h=[$c(o.shape,p,r,a,i),Kd(o,p,r.shape,a,i)];if(null!=l){var f=Yd(l,p);h.push(f)}return h},_={x:b,filter:y,bias:w,preluActivationWeights:I},A={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:m};return null==p?mp((function(e,t,n){var r=Xo.runKernel(Ti,_,A);return n([t,e,r]),x&&(r=Nc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:E}}))(b,y):mp((function(e,t,n,r){var a=Xo.runKernel(Ti,_,A);return r([t,e,a,n]),x&&(a=Nc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:E}}))(b,y,w)}});var $d=us({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Xo.runKernel(tr,c,l)}});var ef=us({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=Xo.runKernel(nr,c,l);return u?Nc(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var tf=us({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,p=e.bias,h=e.activation,d=void 0===h?"linear":h,f=e.preluActivationWeights,m=e.leakyreluAlpha;if(!1===Qd(Xo.state.gradientDepth,d)){var v=ll(n,r,a,i,s,c,l);return null!=p&&(v=Ku(v,p)),Jd(v,d,f,m)}var g=is(n,"x","depthwiseConv2d","float32"),y=is(r,"filter","depthwiseConv2d","float32"),b=g,x=!1;3===g.rank&&(x=!0,b=Nc(g,[1,g.shape[0],g.shape[1],g.shape[2]])),vt(4===b.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(b.rank,".")})),vt(4===y.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(y.rank,".")})),vt(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(b.shape[3],") must match the inChannels dimension in filter ").concat(y.shape[2],".")})),null==c&&(c=[1,1]),vt(kc(a,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")})),Sc("fused depthwiseConv2d",i,l);var k,w,I=dc(b.shape,y.shape,a,c,i,l,!0);null!=p&&(t=C(Bo(k=is(p,"bias","fused conv2d"),g),1),k=t[0],vl(I.outShape,k.shape)),null!=f&&(w=is(f,"prelu weights","fused depthwiseConv2d"));var S=function(e,t){vt(xc(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(c,"'")}));var n=C(t,4),r=n[0],o=n[1],s=n[2],u=n[3],p=Xd(e,s,d),h=ef(o.shape,p,r,a,i,c,l),f=$d(o,p,r.shape,a,i,c,l);return null!=u?[h,f,Yd(k,p)]:[h,f]},N={x:b,filter:y,bias:k,preluActivationWeights:w},T={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:m};return null==p?mp((function(e,t,n){var r=Xo.runKernel(Ci,N,T);return n([t,e,r]),x&&(r=Nc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:S}}))(b,y):mp((function(e,t,n,r){var a=Xo.runKernel(Ci,N,T);return r([t,e,a,n]),x&&(a=Nc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:S}}))(b,y,k)}});var nf=us({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,p=e.leakyreluAlpha,h=void 0===p?.2:p;if(!1===Qd(Xo.state.gradientDepth,c)){var d=_c(t,n,a,o);return null!=s&&(d=Ku(d,s)),Jd(d,c,l,h)}var f=is(t,"a","fused matMul"),m=is(n,"b","fused matMul"),v=C(Bo(f,m),2);f=v[0],m=v[1];var g=a?f.shape[f.rank-2]:f.shape[f.rank-1],y=o?m.shape[m.rank-1]:m.shape[m.rank-2],b=a?f.shape[f.rank-1]:f.shape[f.rank-2],x=o?m.shape[m.rank-2]:m.shape[m.rank-1],k=f.shape.slice(0,-2),w=m.shape.slice(0,-2),I=bt(k),S=bt(w);vt(g===y,(function(){return"Error in fused matMul: inner shapes (".concat(g,") and (").concat(y,") of Tensors with shapes ").concat(f.shape," and ").concat(m.shape," and transposeA=").concat(a," and transposeB=").concat(o," must match.")}));var N,T,E=vl(f.shape.slice(0,-2),m.shape.slice(0,-2)).concat([b,x]),_=Nc(f,a?[I,g,b]:[I,b,g]),A=Nc(m,o?[S,x,y]:[S,y,x]);null!=s&&(N=C(Bo(N=is(s,"bias","fused matMul"),f),1)[0],vl(E,N.shape)),null!=l&&(T=is(l,"prelu weights","fused matMul"));var R=function(e,t){var n,r,i=C(t,4),u=i[0],l=i[1],p=i[2],h=i[3],d=Xd(Nc(e,p.shape),p,c);return a||o?!a&&o?(n=_c(d,l,!1,!1),r=_c(d,u,!0,!1)):a&&!o?(n=_c(l,d,!1,!0),r=_c(u,d,!1,!1)):(n=_c(l,d,!0,!0),r=_c(d,u,!0,!0)):(n=_c(d,l,!1,!0),r=_c(u,d,!0,!1)),null!=s?[n,r,Yd(h,d)]:[n,r]},F={a:_,b:A,bias:N,preluActivationWeights:T},D={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:h};return null==s?mp((function(e,t,n){var r=Xo.runKernel(Ni,F,D);return n([e,t,r]),{value:Nc(r,E),gradFunc:R}}))(_,A):mp((function(e,t,n,r){var a=Xo.runKernel(Ni,F,D);return r([e,t,a,n]),{value:Nc(a,E),gradFunc:R}}))(_,A,N)}});var rf=us({hammingWindow_:function(e){return Gd(e,.54,.46)}});var af=us({hannWindow_:function(e){return Gd(e,.5,.5)}});var of=us({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Rc(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Ec([Rc(e,i,t-s),jc([s],a)]);o.push(u),i+=n}return 0===o.length?fd([],[0,t]):Nc(Ec(o),[o.length,t])}});var sf=us({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:af;null==r&&(r=Ud(t));var i=of(e,t,n),o=Ju(i,a(t));return od(o,r)}});var uf=us({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=is(e,"image","cropAndResize"),s=is(t,"boxes","cropAndResize","float32"),u=is(n,"boxInd","cropAndResize","int32"),c=s.shape[0];vt(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),vt(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),vt(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),vt(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),vt(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),vt("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return Xo.runKernel(Qn,l,p)}});var cf=us({flipLeftRight_:function(e){var t=is(e,"image","flipLeftRight","float32");vt(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Xo.runKernel(yr,n,{})}});var lf=us({grayscaleToRGB_:function(e){var t=is(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];vt(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),vt(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Kl(t,a)}});var pf=us({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=is(e,"image","rotateWithOffset","float32");vt(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Xo.runKernel(Si,i,o)}});function hf(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),vt(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),vt(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),vt(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),vt(1===t.rank,(function(){return"scores must be a 1D tensor"})),vt(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),vt(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var df=us({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=is(e,"boxes","nonMaxSuppression","float32"),o=is(t,"scores","nonMaxSuppression","float32"),s=hf(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Xo.runKernel(ca,{boxes:i,scores:o},u)}});function ff(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||mf)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function mf(e,t){return e>t?1:e<t?-1:0}function vf(e,t,n,r,a){return bf(e,t,n,r,a,0)}function gf(e,t,n,r,a,i){return bf(e,t,n,r,a,0,!1,i,!0)}function yf(e,t,n,r,a,i){return bf(e,t,n,r,a,i,!0)}function bf(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(wf);for(var p=i>0?-.5/i:0,h=[],d=[];h.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var x=xf(e,v,h[b]);if(x>=r){y=!0;break}if(f.score=f.score*kf(r,p,x),f.score<=a)break}f.suppressBeginIndex=h.length,y||(f.score===m?(h.push(v),d.push(f.score)):f.score>a&&ff(c,f,wf))}var k=h.length,w=n-k;s&&w>0&&(h.push.apply(h,Ie(new Array(w).fill(0))),d.push.apply(d,Ie(new Array(w).fill(0))));var I={selectedIndices:h};return o&&(I.selectedScores=d),u&&(I.validOutputs=k),I}function xf(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(p-c)*(h-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function kf(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function wf(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function If(){return If=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=is(t,"boxes","nonMaxSuppressionAsync"),s=is(n,"scores","nonMaxSuppressionAsync"),u=hf(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],p=c[1],h=vf(l,p,r,a,i),d=h.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),dd(d,"int32")));case 12:case"end":return e.stop()}}),e)}))),If.apply(this,arguments)}var Sf=function(e,t,n){return If.apply(this,arguments)};var Nf=us({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=is(e,"boxes","nonMaxSuppression"),s=is(t,"scores","nonMaxSuppression"),u=hf(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=Xo.runKernel(pa,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function Tf(){return Tf=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=is(t,"boxes","nonMaxSuppressionAsync"),u=is(n,"scores","nonMaxSuppressionAsync"),c=hf(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,p=l[0],h=l[1],d=yf(p,h,r,a,i,o),f=d.selectedIndices,m=d.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:dd(f,"int32"),selectedScores:dd(m)}));case 14:case"end":return e.stop()}}),e)}))),Tf.apply(this,arguments)}var Cf=function(e,t,n){return Tf.apply(this,arguments)};var Ef=us({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=is(e,"boxes","nonMaxSuppression"),s=is(t,"scores","nonMaxSuppression"),u=hf(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},p=Xo.runKernel(la,c,l);return{selectedIndices:p[0],validOutputs:p[1]}}});function _f(){return _f=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],s=is(t,"boxes","nonMaxSuppressionAsync"),u=is(n,"scores","nonMaxSuppressionAsync"),c=hf(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,h=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,f=C(d,2),m=f[0],v=f[1],g=gf(m,v,l,p,h,o),y=g.selectedIndices,b=g.validOutputs,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:dd(y,"int32"),validOutputs:zl(b,"int32")}));case 19:case"end":return e.stop()}}),e)}))),_f.apply(this,arguments)}var Af=function(e,t,n){return _f.apply(this,arguments)};var Rf=us({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=is(e,"images","resizeBilinear");vt(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),vt(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),vt(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Nc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Xo.runKernel(Aa,s,u);return o?Nc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Ff=us({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=is(e,"images","resizeNearestNeighbor");vt(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),vt(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),vt("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),vt(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=Nc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Xo.runKernel(Ea,s,u);return o?Nc(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Df=us({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=is(e,"image","threshold"),c=u.shape[0]*u.shape[1],l=Ju(dd([s]),255);if(vt(3===u.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(u.rank,".")})),vt(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(u.shape[2],".")})),vt("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(u.dtype,".")})),vt("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var p=C(id(u,[1,1,1],-1),3);t=p[0],n=p[1],r=p[2];var h=Ju(t,.2989),d=Ju(n,.587),f=Ju(r,.114);a=Ku(Ku(h,d),f)}else a=e;"otsu"===i&&(l=function(e,t){for(var n,r,a,i,o,s,u=dd([-1]),c=dd([0]),l=dd([0]),p=0;p<e.size-1;p++){n=Rc(e,0,p+1),r=Rc(e,p+1),o=Yu(Wl(n),t),s=Yu(Wl(r),t);var h=Wl(Ju(n,Fh(0,n.size)));a=Yu(h,Wl(n));var d=jc(r.shape,n.size),f=Ku(Fh(0,r.size),d),m=Ju(r,f);i=Yu(Wl(m),Wl(r));var v=xp(a,i),g=xp(a,i),y=Ju(o,s);l=Ju(Ju(y,v),g);var b=Ql(l,c);c=yl(b,l,c),u=yl(b,dd([p]),u)}return u}(Wc(Iu(Uh(a),"int32"),ps([]),256),c));var m=o?ip(a,l):Ql(a,l);return Iu(Ju(m,255),"int32")}});var Mf=us({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=is(e,"image","transform","float32"),s=is(t,"transforms","transform","float32");vt(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),vt(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),vt(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Xo.runKernel(mi,u,c)}});var Of=us({bandPart_:function(e,t,n){var r=is(e,"a","bandPart");vt(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a,i,o=r.shape,s=C(r.shape.slice(-2),2),u=s[0],c=s[1];"number"==typeof t?(vt(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),vt(t<=u,(function(){return"bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(u,").")})),a=is(t<0?u:t,"numLower","bandPart")):(vt("int32"===t.dtype,(function(){return"bandPart(): numLower's dtype must be an int32."})),a=yl(ap(t,0),u,Pp(t,u))),"number"==typeof n?(vt(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")})),vt(n<=c,(function(){return"bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(c,").")})),i=is(n<0?c:n,"numUpper","bandPart")):(vt("int32"===n.dtype,(function(){return"bandPart(): numUpper's dtype must be an int32."})),i=yl(ap(n,0),c,Pp(n,c)));var l=Nc(Fh(0,u,1,"int32"),[-1,1]),p=Fh(0,c,1,"int32"),h=xp(l,p),d=Ip(ip(h,a),Zl(h,gp(i))),f=Op([u,c],r.dtype);return Nc(cd(Ed(Nc(r,[-1,u,c])).map((function(e){return yl(d,e,f)}))),o)}});var Lf=us({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,vt(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){vt(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=id(e,e.shape[0],0).map((function(e){return ud(e,[0])}));vt(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(Xo.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Ju(Wl(Ju(i[n],t)),i[n]);t=xp(t,r)}return Yu(t,Ul(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?cd(i,0):i}});function zf(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Xo.tidy((function(){vt(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Xl(n),i=Su(e),o=fd([[1]],[1,1]),s=Su(o),u=n>=r?r:n,c=function(e){var t,u,c=i,l=s,p=a;t=Xo.tidy((function(){var t=Rc(i,[e,e],[n-e,1]),u=Ul(t),c=Rc(i,[e,e],[1,1]),l=yl(Ql(c,0),fd([[-1]]),fd([[1]])),p=xp(c,Ju(l,u)),h=Yu(t,p);s=1===h.shape[0]?Su(o):Ec([o,Rc(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);var d=gp(Yu(_c(l,p),u)),f=Rc(i,[e,0],[n-e,r]),m=Ju(d,s),v=Ld(s);if(0===e)i=xp(f,_c(m,_c(v,f)));else{var g=xp(f,_c(m,_c(v,f)));i=Ec([Rc(i,[0,0],[e,r]),g],0)}var y=Ld(m),b=Rc(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=xp(b,_c(_c(b,s),y));else{var x=xp(b,_c(_c(b,s),y));a=Ec([Rc(a,[0,0],[n,e]),x],1)}return[s,i,a]})),u=C(t,3),s=u[0],i=u[1],a=u[2],Ou([c,l,p])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Rc(a,[0,0],[n,r]),i=Rc(i,[0,0],[r,r])),[a,i]}))}var Pf,Bf=us({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(vt(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return zf(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Ed(Nc(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=C(zf(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[Nc(cd(a,0),e.shape),Nc(cd(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Pf||(Pf={}));var Wf=us({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pf.SUM_BY_NONZERO_WEIGHTS,r=is(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=is(t,"weights","computeWeightedLoss"));var i=null==a?r:Ju(r,a);if(n===Pf.NONE)return i;if(n===Pf.SUM)return Wl(i);if(n===Pf.MEAN){if(null==a)return Mp(i);var o=r.size/a.size,s=Yu(Wl(i),Wl(a));return o>1?Yu(s,zl(o)):s}if(n===Pf.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Yu(Wl(i),zl(r.size));var u=Ju(a,Lp(r.shape)),c=Iu(Wl(Hp(u,zl(0))),"float32");return Yu(Wl(i),c)}throw Error("Unknown reduction: ".concat(n))}});var Vf=us({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pf.SUM_BY_NONZERO_WEIGHTS,a=is(e,"labels","absoluteDifference"),i=is(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=is(n,"weights","absoluteDifference")),gt(a.shape,i.shape,"Error in absoluteDifference: ");var s=Qu(xp(a,i));return Wf(s,o,r)}});var Uf=us({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pf.SUM_BY_NONZERO_WEIGHTS,i=is(e,"labels","cosineDistance"),o=is(t,"predictions","cosineDistance"),s=null;null!=r&&(s=is(r,"weights","cosineDistance")),gt(i.shape,o.shape,"Error in cosineDistance: ");var u=zl(1),c=xp(u,Wl(Ju(i,o),n,!0));return Wf(c,s,a)}});var Gf=us({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pf.SUM_BY_NONZERO_WEIGHTS,a=is(e,"labels","hingeLoss"),i=is(t,"predictions","hingeLoss"),o=null;null!=n&&(o=is(n,"weights","hingeLoss")),gt(a.shape,i.shape,"Error in hingeLoss: ");var s=zl(1);a=xp(Ju(zl(2),a),s);var u=Oh(xp(s,Ju(a,i)));return Wf(u,o,r)}});var Hf=us({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pf.SUM_BY_NONZERO_WEIGHTS,i=is(e,"labels","huberLoss"),o=is(t,"predictions","huberLoss"),s=null;null!=n&&(s=is(n,"weights","huberLoss")),gt(i.shape,o.shape,"Error in huberLoss: ");var u=zl(r),c=Qu(xp(o,i)),l=Pp(c,u),p=xp(c,l),h=Ku(Ju(zl(.5),Bl(l)),Ju(u,p));return Wf(h,s,a)}});var jf=us({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pf.SUM_BY_NONZERO_WEIGHTS,i=is(e,"labels","logLoss"),o=is(t,"predictions","logLoss"),s=null;null!=n&&(s=is(n,"weights","logLoss")),gt(i.shape,o.shape,"Error in logLoss: ");var u=zl(1),c=zl(r),l=gp(Ju(i,up(Ku(o,c)))),p=Ju(xp(u,i),up(Ku(xp(u,o),c))),h=xp(l,p);return Wf(h,s,a)}});var qf=us({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pf.SUM_BY_NONZERO_WEIGHTS,a=is(e,"labels","meanSquaredError"),i=is(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=is(n,"weights","meanSquaredError")),gt(a.shape,i.shape,"Error in meanSquaredError: ");var s=sd(a,i);return Wf(s,o,r)}});var Kf=us({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pf.SUM_BY_NONZERO_WEIGHTS,i=is(e,"multiClassLabels","sigmoidCrossEntropy"),o=is(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=is(n,"weights","sigmoidCrossEntropy")),gt(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=zl(r),c=zl(1),l=zl(.5);i=Ku(Ju(i,xp(c,u)),Ju(l,u))}var p=function(e,t){var n=is(e,"labels","sigmoidCrossEntropyWithLogits"),r=is(t,"logits","sigmoidCrossEntropyWithLogits");gt(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Oh(r),i=Ju(r,n),o=cp(Hl(gp(Qu(r))));return Ku(xp(a,i),o)}(i,o);return Wf(p,s,a)}});var Xf=us({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pf.SUM_BY_NONZERO_WEIGHTS,i=is(e,"onehotLabels","softmaxCrossEntropy"),o=is(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=is(n,"weights","softmaxCrossEntropy")),gt(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=zl(r),c=zl(1),l=zl(i.shape[1]);i=Ku(Ju(i,xp(c,u)),Yu(u,l))}var p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return mp((function(e,t,r){var a=wp(t,[n],!0),i=xp(Iu(t,"float32"),a);r([e,i]);var o=gp(Ju(i,e));return{value:Wl(o,[n]),gradFunc:function(e,t){var r=C(t,2),a=r[0],i=r[1],o=_l(e.shape,[n]);return[Ju(Nc(e,o),xp(Iu(a,"float32"),Hl(i))),Ju(Nc(e,o),xp(Hl(i),Iu(a,"float32")))]}}}))(e,t)}(i,o);return Wf(p,s,a)}});var Yf=us({sparseFillEmptyRows_:function(e,t,n,r){var a=is(e,"indices","sparseFillEmptyRows","int32"),i=is(t,"values","sparseFillEmptyRows"),o=is(n,"denseShape","sparseFillEmptyRows","int32"),s=is(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Xo.runKernel(Za,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Jf=us({sparseReshape_:function(e,t,n){var r=is(e,"inputIndices","sparseReshape","int32"),a=is(t,"inputShape","sparseReshape","int32"),i=is(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Xo.runKernel($a,o);return{outputIndices:s[0],outputShape:s[1]}}});var Qf=us({sparseSegmentMean_:function(e,t,n){var r=is(e,"data","sparseSegmentMean"),a=is(t,"indices","sparseSegmentMean","int32"),i=is(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Xo.runKernel(ei,o)}});var Zf=us({sparseSegmentSum_:function(e,t,n){var r=is(e,"data","sparseSegmentSum"),a=is(t,"indices","sparseSegmentSum","int32"),i=is(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Xo.runKernel(ti,o)}});var $f=us({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=is(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=is(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},p={data:u,dataSplits:c},h=Xo.runKernel(si,p,l);return{nGrams:h[0],nGramsSplits:h[1]}}});var em=us({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=is(e,"input","stringSplit","string"),a=is(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Xo.runKernel(ui,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var tm=us({stringToHashBucketFast_:function(e,t){var n=is(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Xo.runKernel(ci,a,r)}});var nm=us({staticRegexReplace_:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=is(e,"input","staticRegexReplace","string"),i={pattern:t,rewrite:n,replaceGlobal:r};return Xo.runKernel(ii,{x:a},i)}}),rm={fft:nd,ifft:rd,rfft:od,irfft:ad},am={hammingWindow:rf,hannWindow:af,frame:of,stft:sf},im={flipLeftRight:cf,grayscaleToRGB:lf,resizeNearestNeighbor:Ff,resizeBilinear:Rf,rotateWithOffset:pf,cropAndResize:uf,nonMaxSuppression:df,nonMaxSuppressionAsync:Sf,nonMaxSuppressionWithScore:Nf,nonMaxSuppressionWithScoreAsync:Cf,nonMaxSuppressionPadded:Ef,nonMaxSuppressionPaddedAsync:Af,threshold:Df,transform:Mf},om={bandPart:Of,gramSchmidt:Lf,qr:Bf},sm={absoluteDifference:Vf,computeWeightedLoss:Wf,cosineDistance:Uf,hingeLoss:Gf,huberLoss:Hf,logLoss:jf,meanSquaredError:qf,sigmoidCrossEntropy:Kf,softmaxCrossEntropy:Xf},um={sparseFillEmptyRows:Yf,sparseReshape:Jf,sparseSegmentMean:Qf,sparseSegmentSum:Zf},cm={stringNGrams:$f,stringSplit:em,stringToHashBucketFast:tm,staticRegexReplace:nm},lm={};Le(lm,{Serializable:function(){return pm},SerializationMap:function(){return hm},registerClass:function(){return dm}});var pm=function(){function e(){xe(this,e)}return we(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),hm=function(){function e(){xe(this,e),this.classNameMap={}}return we(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function dm(e){vt(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),vt("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),vt(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),hm.register(e)}var fm=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Ou(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return fp(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Ou(this.iterations_)}},{key:"saveIterations",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:zl(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(pm);Object.defineProperty(fm,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var mm=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return xe(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Xo.backend.epsilon()),a}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Xo.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Mu((function(){return bl(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Mu((function(){return bl(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Mu((function(){var e=Ku(Ju(o,t.rho),Ju(Bl(i),1-t.rho)),n=Ju(Yu(Pl(Ku(s,t.epsilon)),Pl(Ku(o,t.epsilon))),i),r=Ku(Ju(s,t.rho),Ju(Bl(n),1-t.rho));o.assign(e),s.assign(r);var u=Ku(Ju(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Ou(this.accumulatedGrads.map((function(e){return e.variable}))),Ou(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedGrads),Ie(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(fm),vm=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return xe(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Xo.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Mu((function(){return jc(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Mu((function(){var e=Ku(o,Bl(i));o.assign(e);var n=Ku(Ju(Yu(i,Pl(Ku(e,Xo.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Ou(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(fm),gm=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return xe(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Mu((function(){i.accBeta1=zl(r).variable(),i.accBeta2=zl(a).variable()})),null==o&&(i.epsilon=Xo.backend.epsilon()),i}return we(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Mu((function(){var r=xp(1,t.accBeta1),a=xp(1,t.accBeta2);n.forEach((function(n,i){var o=Xo.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Mu((function(){return bl(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Mu((function(){return bl(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Ku(Ju(u,t.beta1),Ju(s,1-t.beta1)),p=Ku(Ju(c,t.beta2),Ju(Bl(s),1-t.beta2)),h=Yu(l,r),d=Yu(p,a);u.assign(l),c.assign(p);var f=Ku(Ju(Yu(h,Ku(Pl(d),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(Ju(t.accBeta1,t.beta1)),t.accBeta2.assign(Ju(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ou(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Ou(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedFirstMoment),Ie(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Mu((function(){r.accBeta1.assign(Ll(r.beta1,r.iterations_+1)),r.accBeta2.assign(Ll(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(fm),ym=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return xe(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Mu((function(){i.iteration=zl(0).variable(),i.accBeta1=zl(r).variable()})),null==o&&(i.epsilon=Xo.backend.epsilon()),i}return we(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Mu((function(){var r=xp(1,t.accBeta1),a=Yu(-t.learningRate,Ku(Ju(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Xo.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:bl(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:bl(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Ku(Ju(u,t.beta1),Ju(s,1-t.beta1)),p=Ju(c,t.beta2),h=Qu(s),d=Dp(p,h);u.assign(l),c.assign(d);var f=Ku(Ju(Yu(a,r),Yu(l,Ku(d,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(Ku(t.iteration,1)),t.accBeta1.assign(Ju(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ou(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Ou(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(fm),bm=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Xo.registeredVariables[n];Mu((function(){var e=Ku(Ju(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Lu(zl(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(fm),xm=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xe(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=zl(a.momentum),a}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Xo.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Mu((function(){return bl(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Mu((function(){var e,n=Ku(Ju(t.m,i),o);e=t.useNesterov?Ku(Ju(t.c,Ku(o,Ju(n,t.m))),a):Ku(Ju(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Ou(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(bm),km=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Xo.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return ge(r)}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Xo.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Mu((function(){return bl(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Mu((function(){return bl(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Mu((function(){return bl(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Mu((function(){var e=Ku(Ju(s,t.decay),Ju(Bl(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Ku(Ju(n,t.decay),Ju(o,1-t.decay)),c=Yu(Ju(o,t.learningRate),Pl(xp(e,Ku(Bl(i),t.epsilon)))),l=Ku(Ju(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=xp(a,l);a.assign(p)}else{var h=Ku(Ju(s,t.decay),Ju(Bl(o),1-t.decay)),d=Ku(Ju(u,t.momentum),Yu(Ju(o,t.learningRate),Pl(Ku(h,t.epsilon))));s.assign(h),u.assign(d);var f=xp(a,d);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Ou(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Ou(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Ou(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedMeanSquares),Ie(this.accumulatedMoments)),this.centered&&t.push.apply(t,Ie(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(fm),wm=[mm,vm,gm,ym,xm,km,bm];var Im={};Le(Im,{browserFiles:function(){return Cm},browserHTTPRequest:function(){return Wm},concatenateArrayBuffers:function(){return ws},copyModel:function(){return fu},decodeWeights:function(){return vs},encodeWeights:function(){return fs},fromMemory:function(){return Hm},fromMemorySync:function(){return jm},getLoadHandlers:function(){return Os},getModelArtifactsForJSON:function(){return Ts},getModelArtifactsForJSONSync:function(){return Ns},getModelArtifactsInfoForJSON:function(){return Es},getSaveHandlers:function(){return Ms},getWeightSpecs:function(){return _s},http:function(){return Bm},isHTTPScheme:function(){return zm},listModels:function(){return lu},loadWeights:function(){return Fm},moveModel:function(){return vu},registerLoadRouter:function(){return Ds},registerSaveRouter:function(){return Fs},removeModel:function(){return hu},weightsLoaderFactory:function(){return Mm},withSaveHandler:function(){return qm},withSaveHandlerSync:function(){return Km}});function Sm(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Nm=function(){function e(t){if(xe(this,e),!on().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=Ss(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=10,Sm((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=16,Sm((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:Es(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Nm.URL_SCHEME="downloads://";var Tm=function(){function e(t){if(xe(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return we(e,[{key:"load",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Ts(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=Se(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Ie(o.weights)),a.push.apply(a,Ie(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,ws(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return Is(e.name)})),i={},o=Se(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=Is(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();function Cm(e){return new Tm(e)}Rs.registerSaveRouter((function(e){return on().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Nm.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Nm(e)}(e.slice(Nm.URL_SCHEME.length)):null}));var Em=function(){function e(t){if(xe(this,e),this.shards=[],this.previousShardIndex=0,t instanceof Array||(t=[t]),t=t.map((function(e){return co(e)?e.buffer:e})),0!==t.length){this.bufferUniformSize=t[0].byteLength;for(var n=0,r=0;r<t.length;r++){var a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=n+a.byteLength;this.shards.push({buffer:a,start:n,end:i}),n=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return we(e,[{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));for(var r=new ArrayBuffer(t-e),a=new Uint8Array(r),i=0,o=n;o<this.shards.length;o++){var s=this.shards[o],u=e+i-s.start,c=i,l=Math.min(t,s.end)-s.start,p=new Uint8Array(s.buffer.slice(u,l));if(a.set(p,c),i+=p.length,t<s.end)break}return r}},{key:"findShardForByte",value:function(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;var n=function(e,t){for(var n=0,r=e.length;n<=r;){var a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}]),e}();function _m(e,t,n,r){var a;vt(null!=(a=e)&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"})),function(e,t){vt(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),vt(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),vt(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function Am(e,t){return Rm.apply(this,arguments)}function Rm(){return Rm=S(w().mark((function e(t,n){var r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?on().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,_m(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,_m(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)}))),Rm.apply(this,arguments)}function Fm(e){return Dm.apply(this,arguments)}function Dm(){return Dm=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",Mm((function(e){return Am(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),Dm.apply(this,arguments)}function Mm(e){return function(){var t=S(w().mark((function t(n){var r,a,i,o,s,u,c,l,p,h,d,f,m=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=hs[r]*bt(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=10,e(p);case 10:return h=t.sent,d={},f=0,t.abrupt("return",(l.forEach((function(e){var t=n[e].paths.length,r=new Em(h.slice(f,f+t));o[e].forEach((function(e){var t=vs(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),f+=t})),d));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}var Om=function(){function e(t,n){if(xe(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(vt("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=on().platform.fetch,vt(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&vt(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=Ss(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(i=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:Es(t),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",Ts(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Lm(n),a=C(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=_s(t),c=[],l=[],p=Se(t);try{for(p.s();!(h=p.n()).done;){d=h.value,f=Se(d.paths);try{for(f.s();!(m=f.n()).done;)v=m.value,null!=this.weightUrlConverter?l.push(this.weightUrlConverter(v)):c.push(s+v+o)}catch(y){f.e(y)}finally{f.f()}}}catch(y){p.e(y)}finally{p.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=c.push,e.t2=c,e.t3=Ie,e.next=10,Promise.all(l);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.next=15,Am(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 15:return g=e.sent,e.abrupt("return",[u,ws(g)]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Lm(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function zm(e){return null!=e.match(Om.URL_SCHEME_REGEX)}Om.URL_SCHEME_REGEX=/^https?:\/\//;var Pm=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;var n=!0;return n=Array.isArray(e)?e.every((function(e){return zm(e)})):zm(e),n?Bm(e,t):null};function Bm(e,t){return new Om(e,t)}function Wm(e,t){return Bm(e,t)}Rs.registerSaveRouter(Pm),Rs.registerLoadRouter(Pm);var Vm=function(){function e(t){xe(this,e),this.modelArtifacts=t}return we(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Um=function(){function e(t){xe(this,e),this.saveHandler=t}return we(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Gm=we((function e(t){xe(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Hm(e,t,n,r){var a=arguments;return new Gm(jm.apply(void 0,Ie(a)))}function jm(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Vm(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vm({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vm({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function qm(e){return new Um(e)}function Km(e){return new Um(e)}var Xm={};Le(Xm,{confusionMatrix:function(){return Jm}});var Ym,Jm=us({confusionMatrix_:function(e,t,n){var r=is(e,"labels","confusionMatrix"),a=is(t,"predictions","confusionMatrix");vt(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),vt(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),vt(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),vt(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),vt(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=jp(Iu(r,"int32"),n),o=jp(Iu(a,"int32"),n),s=Ld(i),u=_c(s,o);return Iu(u,"int32")}}),Qm={};function Zm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));s=!0}if(null!=Fi(Ii,Xo.backendName)){var u={pixels:e},c={numChannels:t};return Xo.runKernel(Ii,u,c)}var l,p,h=C(a?[e.videoWidth,e.videoHeight]:[e.width,e.height],2),d=h[0],f=h[1];if(o)l=e.getContext("2d").getImageData(0,0,d,f).data;else if(r||n)l=e.data;else if(i||a||s){if(null==Ym)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ym=new OffscreenCanvas(1,1).getContext("2d")}else Ym=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Ym.canvas.width=d,Ym.canvas.height=f,Ym.drawImage(e,0,0,d,f),l=Ym.getImageData(0,0,d,f).data}if(4===t)p=new Int32Array(l);else{var m=d*f;p=new Int32Array(m*t);for(var v=0;v<m;v++)for(var g=0;g<t;++g)p[v*t+g]=l[4*v+g]}return md(p,[f,d,t],"int32")}function $m(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function ev(e){return tv.apply(this,arguments)}function tv(){return tv=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!on().getBool("WRAP_TO_IMAGEBITMAP")||!$m(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",Zm(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),tv.apply(this,arguments)}function nv(e,t){return rv.apply(this,arguments)}function rv(){return rv=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=is(t,"img","toPixels"),t instanceof No||(r=Iu(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=C(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(c));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:l=e.sent,p="float32"===r.dtype?255:1,h=new Uint8ClampedArray(u*s*4),d=0;case 15:if(!(d<s*u)){e.next=36;break}f=[0,0,0,255],m=0;case 18:if(!(m<c)){e.next=31;break}if(v=l[d*c+m],"float32"!==r.dtype){e.next=25;break}if(!(v<0||v>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(v,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(v<0||v>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(v,"."));case 27:1===c?(f[0]=v*p,f[1]=v*p,f[2]=v*p):f[m]=v*p;case 28:m++,e.next=18;break;case 31:h[(g=4*d)+0]=Math.round(f[0]),h[g+1]=Math.round(f[1]),h[g+2]=Math.round(f[2]),h[g+3]=Math.round(f[3]);case 33:++d,e.next=15;break;case 36:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),b=new ImageData(h,u,s),y.putImageData(b,0,0)),e.abrupt("return",(r!==t&&r.dispose(),h));case 38:case"end":return e.stop()}}),e)}))),rv.apply(this,arguments)}Le(Qm,{fromPixels:function(){return av},fromPixelsAsync:function(){return ev},toPixels:function(){return nv}});var av=us({fromPixels_:Zm}),iv={};function ov(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===bt(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var h=[].concat(Ie(jt(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,h]}Le(iv,{prepareAndValidate:function(){return ov}});var sv={};Le(sv,{assertParamsValid:function(){return lv},computeFlatOffset:function(){return Iv},computeOutShape:function(){return hv},getNormalizedAxes:function(){return vv},isSliceContinous:function(){return wv},maskToAxes:function(){return pv},parseSliceParams:function(){return Sv},sliceInfo:function(){return Nv},startForAxis:function(){return xv},startIndicesWithElidedDims:function(){return gv},stopForAxis:function(){return kv},stopIndicesWithElidedDims:function(){return yv},stridesForAxis:function(){return bv},stridesWithElidedDims:function(){return dv}});var uv=-2,cv=-1;function lv(e,t,n){var r=e.shape.length;vt(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),vt(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){vt(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function pv(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function hv(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function dv(e,t,n,r){for(var a=Ie(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function fv(e,t,n){return n<=e?n:n-(t-1)}function mv(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function vv(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),p=new Array(c),h=new Array(c);if(t.length&&n>0){var d=t[0],f=n+1;l=gv(o,d,f,r,e),p=yv(s,d,f,a,e),h=dv(i,d,f,e)}else for(var m=0;m<c;m++)l[m]=xv(o,r,i,e,m,u),p[m]=kv(s,a,i,e,m,u),h[m]=bv(i,m,u);return{begin:l,end:p,strides:h}}function gv(e,t,n,r,a){for(var i=Ie(a),o=mv(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=fv(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function yv(e,t,n,r,a){for(var i=Ie(a),o=mv(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=fv(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var p=a[l];i[l]<0&&(i[l]+=p),i[l]=lt(0,i[l],a[l])}return i}function bv(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function xv(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=lt(0,o,u-1)}function kv(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?lt(0,o,u):lt(-1,o,u-1)}function wv(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Iv(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Sv(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(Ie(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){vt(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(Ie(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(vt(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Nv(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<p.dims;h++)l&&1<<h&s&&p.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(uv),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(cv),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,d);for(var f=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(d.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[d.beginMask&1<<b,d.endMask&1<<b],I=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===d.strides[b];var S=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){var N=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=N,d.end[b]=d.begin[b]+1,N<0||N>=k)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=Tv(d.begin[b],0,d.strides[b],k,w,I),d.end[b]=Tv(d.end[b],1,d.strides[b],k,w,I);var T=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===k;f=f&&T,m=m&&(0===b&&1===d.strides[b]||T)}else f=f&&1===d.strides[b]&&S,m=m&&(0===b&&1===d.strides[b]||S);var C=void 0,E=!1;if(d.beginValid&&d.endValid?(C=d.end[b]-d.begin[b],E=!0):x?(C=1,E=!0):S&&k>=0&&(C=d.strides[b]<0?-k:k,E=!0),E){var _=void 0;_=0===C||C<0!=d.strides[b]<0?0:Math.trunc(C/d.strides[b])+(C%d.strides[b]!==0?1:0),g.push(_)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<d.finalShapeGatherIndices.length;++A){var R=d.finalShapeGatherIndices[A];R>=0?y.push(g[R]):R===uv&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return d.finalShapeGatherIndices[t]!==uv})),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function Tv(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var Cv="4.5.0",Ev=function(){function e(){xe(this,e)}return we(e,null,[{key:"sgd",value:function(e){return new bm(e)}},{key:"momentum",value:function(e,t){return new xm(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new km(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new gm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new mm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new ym(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new vm(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),_v=Ev,Av="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function Rv(){return new Promise((function(e){return Av((function(){return e()}))}))}var Fv,Dv={};function Mv(e,t){var n=e[0].length;e.forEach((function(e,t){vt(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),vt(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)vt(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Ov(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Lv(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function zv(e){var t,n={FIRST_DIM_SIZE:Fv.FIRST_DIM_SIZE,VALUE_ROWIDS:Fv.VALUE_ROWIDS,ROW_LENGTHS:Fv.ROW_LENGTHS,ROW_SPLITS:Fv.ROW_SPLITS,ROW_LIMITS:Fv.ROW_LIMITS,ROW_STARTS:Fv.ROW_STARTS},r=[],a=Se(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function Pv(e){return 0===e.length?0:e[0]===Fv.FIRST_DIM_SIZE?e.length-1:e.length}function Bv(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}Le(Dv,{ERF_A1:function(){return Qv},ERF_A2:function(){return Zv},ERF_A3:function(){return $v},ERF_A4:function(){return eg},ERF_A5:function(){return tg},ERF_P:function(){return Jv},PARALLELIZE_THRESHOLD:function(){return Wv},RowPartitionType:function(){return Fv},SELU_SCALE:function(){return Yv},SELU_SCALEALPHA:function(){return Xv},applyActivation:function(){return Jd},assertAndGetBroadcastShape:function(){return vl},assertAxesAreInnerMostDims:function(){return Al},assertParamsConsistent:function(){return Mv},assignToTypedArray:function(){return sg},axesAreInnerMostDims:function(){return Tl},calculateShapes:function(){return wd},checkEinsumDimSizes:function(){return vg},checkPadOnDimRoundingMode:function(){return Sc},combineLocations:function(){return Cl},combineRaggedTensorToTensorShapes:function(){return Lv},complexWithEvenIndex:function(){return ag},complexWithOddIndex:function(){return ig},computeConv2DInfo:function(){return dc},computeConv3DInfo:function(){return fc},computeDefaultPad:function(){return mc},computeDilation2DInfo:function(){return lc},computeOptimalWindowSize:function(){return Vv},computeOutAndReduceShapes:function(){return El},computeOutShape:function(){return Ov},computePool2DInfo:function(){return pc},computePool3DInfo:function(){return hc},convertConv2DDataFormat:function(){return Ic},decodeEinsumEquation:function(){return fg},eitherStridesOrDilationsAreOne:function(){return kc},expandShapeToKeepDim:function(){return _l},exponent:function(){return cg},exponents:function(){return ug},fromStringArrayToUint8:function(){return Pg},fromUint8ToStringArray:function(){return zg},getAxesPermutation:function(){return Rl},getBroadcastDims:function(){return fl},getComplexWithIndex:function(){return og},getEinsumComputePath:function(){return gg},getEinsumPermutation:function(){return mg},getFusedBiasGradient:function(){return Yd},getFusedDyActivation:function(){return Xd},getImageCenter:function(){return Uv},getInnerMostAxes:function(){return Dl},getPermuted:function(){return Hv},getRaggedRank:function(){return Pv},getReductionAxes:function(){return ml},getReshaped:function(){return Gv},getReshapedPermuted:function(){return jv},getRowPartitionTypesHelper:function(){return zv},getSliceBeginCoords:function(){return qv},getSliceSize:function(){return Kv},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return kg},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return wg},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return Ig},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return Tg},getSparseReshapeInputOutputMismatchErrorMessage:function(){return Eg},getSparseReshapeInputOutputMultipleErrorMessage:function(){return Cg},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return Sg},getSparseReshapeNegativeOutputDimErrorMessage:function(){return Ng},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return Fg},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return _g},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return Ag},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return Rg},getUndoAxesPermutation:function(){return Fl},isIdentityPermutation:function(){return yg},log:function(){return _i},mergeRealAndImagArrays:function(){return ng},prepareAndValidate:function(){return ov},prepareSplitSize:function(){return xg},segment_util:function(){return Dg},shouldFuse:function(){return Qd},slice_util:function(){return sv},splitRealAndImagArrays:function(){return rg},stridesOrDilationsArePositive:function(){return wc},tupleValuesAreOne:function(){return xc},upcastType:function(){return Oo},validateDefaultValueShape:function(){return Bv},validateInput:function(){return kd},validateUpdateShape:function(){return xd},warn:function(){return Ei}}),function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Fv||(Fv={}));var Wv=30;function Vv(e){return e<=Wv?e:Ht(e,Math.floor(Math.sqrt(e)))}function Uv(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Gv(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function Hv(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function jv(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function qv(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Kv(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Xv=1.7580993408473768,Yv=1.0507009873554805,Jv=.3275911,Qv=.254829592,Zv=-.284496736,$v=1.421413741,eg=-1.453152027,tg=1.061405429;function ng(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function rg(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function ag(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function ig(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function og(e,t){return{real:e[2*t],imag:e[2*t+1]}}function sg(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function ug(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function cg(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var lg="->",pg=/->/g,hg=",",dg="...";function fg(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(pg,"").length)/lg.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(lg,'").'));var r=C(e.split(lg),2),a=r[0],i=r[1];vt(-1===a.indexOf(dg),(function(){return'The ellipsis notation ("'.concat(dg,'") is not supported yet.')}));var o=a.split(hg),s=o.length;if(t!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(t));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(){var e=i[l];if(!o.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===u.indexOf(e)&&u.push(e)},l=0;l<i.length;++l)c();for(var p=0;p<a.length;++p){var h=a[p];-1===u.indexOf(h)&&h!==hg&&u.push(h)}for(var d=new Array(o.length),f=0;f<s;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error("Found duplicate axes in input component ".concat(o[f],". Support for duplicate axes in input is not implemented yet."));d[f]=[];for(var m=0;m<o[f].length;++m)d[f].push(u.indexOf(o[f][m]))}for(var v=u.length,g=[],y=i.length;y<v;++y)g.push(y);return{allDims:u,summedDims:g,idDims:d}}function mg(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return n=n.filter((function(e){return-1!==e})),{permutationIndices:n,expandDims:a}}function vg(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:vt(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function gg(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Se(bg(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch(p){c.e(p)}finally{c.f()}}return{path:r,steps:a}}function yg(e){return e.every((function(e,t){return e===t}))}function bg(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function xg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)vt(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);vt(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}vt(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function kg(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function wg(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function Ig(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function Sg(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Ng(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Tg(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Cg(e,t){var n=bt(e),r=bt(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Eg(e,t){var n=bt(e),r=bt(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function _g(){return"segment ids must be >= 0"}function Ag(){return"segment ids are not increasing"}function Rg(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function Fg(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}var Dg={};function Mg(e,t){var n,r=!1;for(e<=Wv?(n=e,r=!0):n=Ht(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ht(e,n+1);return n}function Og(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Lg(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,h=0;h<r;++h)u.push(e.shape[h]),c*=e.shape[h];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function zg(e){try{return e.map((function(e){return uo(e)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function Pg(e){return e.map((function(e){return so(e)}))}Le(Dg,{collectGatherOpShapeInfo:function(){return Lg},computeOutShape:function(){return Og},segOpComputeOptimalWindowSize:function(){return Mg}});var Bg={};Le(Bg,{nonMaxSuppressionV3Impl:function(){return vf},nonMaxSuppressionV4Impl:function(){return gf},nonMaxSuppressionV5Impl:function(){return yf},whereImpl:function(){return Rd}}),function(){for(var e=0,t=wm;e<t.length;e++){dm(t[e])}}();var Wg={kernelName:pn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,ld(Iu(n,"float32"),-1))}}}},Vg={kernelName:hn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Bl(Iu(n,"float32")),r=Pl(xp(zl(1),t));return gp(Yu(e,r))}}}},Ug={kernelName:dn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Pl(xp(Bl(Iu(n,"float32")),1));return Yu(e,t)}}}},Gg={kernelName:fn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=e,n=ml(r.shape,i);return n.length>0&&(t=Wl(t,n)),Nc(t,r.shape)},b:function(){var t=e,n=ml(a.shape,i);return n.length>0&&(t=Wl(t,n)),Nc(t,a.shape)}}}},Hg={kernelName:mn,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},jg={kernelName:yn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return bl(n)}}}},qg={kernelName:bn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return bl(n)}}}},Kg={kernelName:xn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Pl(xp(zl(1),Bl(Iu(n,"float32")))))}}}},Xg={kernelName:kn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Pl(Ku(zl(1),Bl(Iu(n,"float32"))));return Yu(e,t)}}}},Yg={kernelName:Sn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Ku(Bl(r),Bl(a)),n=Ju(e,Yu(a,t)),o=ml(r.shape,i);return o.length>0&&(n=Wl(n,o)),Nc(n,r.shape)},b:function(){var t=Ku(Bl(r),Bl(a)),n=gp(Ju(e,Yu(r,t))),o=ml(a.shape,i);return o.length>0&&(n=Wl(n,o)),Nc(n,a.shape)}}}},Jg={kernelName:wn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Ku(Bl(Iu(n,"float32")),1))}}}},Qg={kernelName:In,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,xp(zl(1),Bl(Iu(n,"float32"))))}}}};var Zg=us({avgPool3dGrad_:function(e,t,n,r,a,i){var o=is(e,"dy","avgPool3dGrad"),s=is(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),vt(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),vt(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),Sc("avgPool3dGrad",a,i);var p={dy:u,input:c},h={filterSize:n,strides:r,pad:a,dimRoundingMode:i},d=Xo.runKernel(En,p,h);return l?Nc(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),$g={kernelName:Cn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return Zg(e,r,a,i,o,s)}}}};var ey=us({avgPoolGrad_:function(e,t,n,r,a){var i=is(e,"dy","avgPoolGrad"),o=is(t,"input","avgPoolGrad");vt(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),vt(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),vt(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},h=Xo.runKernel(Tn,l,p);return c?Nc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),ty={kernelName:Nn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return ey(e,r,a,i,o)}}}},ny={kernelName:_n,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return _c(e,i,!1,!1)},b:function(){return _c(e,a,!0,!1)}}:o&&!s?{a:function(){return _c(i,e,!1,!0)},b:function(){return _c(a,e,!1,!1)}}:{a:function(){return _c(i,e,!0,!0)},b:function(){return _c(e,a,!0,!0)}}:{a:function(){return _c(e,i,!1,!0)},b:function(){return _c(a,e,!0,!1)}}}},ry={kernelName:An,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return $p(e,r,a)}}}},ay={kernelName:Dn,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Wl(e,u,!0)}}}},iy={kernelName:On,gradFunc:function(e){return{x:function(){return e.clone()}}}},oy={kernelName:Ln,gradFunc:function(e){return{x:function(){return bl(e)}}}},sy={kernelName:zn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return yl(Ip(Zl(r,a),ip(r,i)),e,bl(e))}}}},uy={kernelName:Bn,inputsToSave:["x"],gradFunc:Wg.gradFunc},cy={kernelName:Wn,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=At(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return id(e,i,a).map((function(e){return function(){return e}}))}},ly={kernelName:Vn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return vt(xc(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return $c(a.shape,e,i,s,u,c)},filter:function(){return Kd(a,e,i.shape,s,u,c)}}}},py={kernelName:Gn,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Qc(e,i,o,s,u,1,c)},filter:function(){return Kd(e,a,i.shape,o,s,u,c)}}}};var hy=us({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),vt(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),vt(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),vt(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),vt(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),vt(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Xo.runKernel(jn,s,u)}}),dy={kernelName:Hn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;vt(xc(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=C(t,2),s=o[0],u=o[1];return{x:function(){return nl(s.shape,e,u,a,i)},filter:function(){return hy(s,e,u.shape,a,i)}}}},fy={kernelName:Kn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(gp(Yh(Iu(n,"float32"))),e)}}}},my={kernelName:Xn,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(Jh(Iu(n,"float32")),e)}}}},vy={kernelName:Jn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Rl([a],r.rank),n=sl(e,a,i,!o);return null!=t&&(n=Ld(n,t)),n}}}},gy={kernelName:er,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;vt(xc(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=C(t,2),c=u[0],l=u[1];return vt(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),vt(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),vt(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),vt(kc(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),Sc("depthwiseConv2d",i,o),{x:function(){return ef(c.shape,e,l,a,i,s,o)},filter:function(){return $d(c,e,l.shape,a,i,s,o)}}}},yy={kernelName:ar,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Xo.runKernel(ir,o,n)},filter:function(){return Xo.runKernel(or,s,n)}}}},by={kernelName:cr,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:C(t,1)[0]};return{x:function(){return Xo.runKernel(lr,n)}}}},xy={kernelName:pr,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=Ju(Hl(gp(Bl(n))),2/Math.sqrt(Math.PI));return{x:function(){return Ju(e,r)}}}},ky={kernelName:dr,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,n)}}}},wy={kernelName:fr,inputsToSave:["input"],gradFunc:function(e,t){var n=C(t,1)[0];return{input:function(){return Nc(e,n.shape)}}}},Iy={kernelName:mr,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,Hl(n))}}}},Sy={kernelName:br,gradFunc:function(e){return{x:function(){return bl(e)}}}},Ny={kernelName:xr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Yu(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Wl(t,n),r.shape):t},b:function(){var t=Ju(e,Iu(r,"float32")),n=ml(a.shape,i);n.length>0&&(t=Nc(Wl(t,n),a.shape));var o=Bl(a);return gp(Yu(t,Iu(o,"float32")))}}}},Ty={kernelName:kr,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=C(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?zl(1):u,l=ml(o.shape,i.shape),p=[];if(1===o.rank){for(var h=0;h<i.shape.length-1;++h)p.push(i.shape[h]);p.push(1)}var d=xp(i,o),f=Ju(e,c),m=Gh(Ku(s,zl(r))),v=Ju(Ju(Ju(m,m),m),zl(-.5));return{x:function(){return 1===o.rank?Nc(Ju(Ju(e,Kl(Nc(m,[1,1,1,o.shape[0]]),p)),c),i.shape):Nc(Ju(Ju(e,m),c),i.shape)},mean:function(){var e=Ju(Ju(m,zl(-1)),f);return 1===o.rank&&(e=Wl(e,l)),Nc(e,o.shape)},variance:function(){var e=Ju(Ju(v,d),f);return 1===o.rank&&(e=Wl(e,l)),Nc(e,o.shape)},scale:function(){var t=Ju(d,m),n=Ju(e,t);return 1===o.rank&&(n=Wl(n,l)),Nc(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Wl(t,l)),Nc(t,o.shape)}}}},Cy={kernelName:wr,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.axis,s=At(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=Ey(0,u),h=Ey(u+1,u+1+l),d=_y([r,[n],c]),f=Nc(e,d),m=Nc(i,[n]),v=_y([[u],p,h]),g=Ld(f,v),y=Cd(g,m,a.shape[s]),b=Fl(v);return y=Ld(y,b)},indices:function(){return i}}}};function Ey(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function _y(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ay={kernelName:Nr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return bl(r)},b:function(){return bl(a)}}}},Ry={kernelName:Tr,gradFunc:function(e){return{x:function(){return Iu(e,"float32")}}}},Fy={kernelName:_r,gradFunc:function(e){return{x:function(){return bl(e)}}}},Dy={kernelName:Ar,gradFunc:function(e){return{x:function(){return bl(e)}}}},My={kernelName:Rr,gradFunc:function(e){return{x:function(){return bl(e)}}}},Oy={kernelName:Fr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.alpha,i=Ql(r,0);return{x:function(){return yl(i,e,Ju(e,a))}}}},Ly={kernelName:zr,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Ku(n,1))}}}},zy={kernelName:Lr,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Iu(n,"float32"))}}}},Py={kernelName:Ur,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis;return{logits:function(){var t=Hl(r);return xp(e,Ju(Wl(e,a,!0),t))}}}};var By=us({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return Xo.runKernel(jr,r,a)}}),Wy={kernelName:Hr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return By(a,i,e,o,s,u,c)}}}};function Vy(e,t,n,r){return t.rank<n.rank&&(t=Nc(t,_l(t.shape,r))),e.rank<n.rank&&(e=Nc(e,_l(e.shape,r))),{x:function(){return Ju(e,Iu(gl(n,t),e.dtype))}}}var Uy={kernelName:Kr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Vy(e,t[1],a,At(r,a.shape));return{x:function(){return i.x()}}}},Gy={kernelName:Xr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return Ju(e,Iu(Zl(r,a),"float32"))},b:function(){return Ju(e,Iu(ap(r,a),"float32"))}}}};var Hy=us({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=is(e,"dy","maxPool3dGrad"),u=is(t,"input","maxPool3dGrad"),c=is(n,"output","maxPool3dGrad"),l=s,p=u,h=c,d=!1;4===u.rank&&(d=!0,l=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=Nc(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Nc(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),vt(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),vt(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(p.rank,".")})),vt(5===h.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(h.rank,".")})),Sc("maxPool3dGrad",i,o);var f={dy:l,input:p,output:h},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Xo.runKernel(Zr,f,m);return d?Nc(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),jy={kernelName:Qr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Hy(e,a,i,o,s,u,c)}}}};var qy=us({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=is(e,"dy","maxPoolGrad"),u=is(t,"input","maxPoolGrad"),c=is(n,"output","maxPoolGrad");vt(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),vt(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),vt(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),Sc("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Xo.runKernel(Jr,l,p)}}),Ky={kernelName:Yr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return qy(e,a,i,o,s,u)}}}},Xy={kernelName:ea,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=At(n.axis,r.shape),i=bt(El(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=Nc(e,t);return Yu(Ju(n,Lp(r.shape,"float32")),i)}}}},Yy={kernelName:ta,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=C(t,2),i=a[0],o=Vy(e,a[1],i,At(r,i.shape));return{x:function(){return o.x()}}}},Jy={kernelName:na,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return Ju(e,Iu(ip(r,a),"float32"))},b:function(){return Ju(e,Iu(Ql(r,a),"float32"))}}}},Qy={kernelName:ra,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Rc(e,a,r.shape)}}}},Zy={kernelName:aa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=ml(r.shape,i);return t.length>0?Nc(Wl(e,t),r.shape):e},b:function(){var t=Ju(e,gp(Yl(Yu(r,a)))),n=ml(a.shape,i);return n.length>0?Nc(Wl(t,n),a.shape):t}}}},$y={kernelName:oa,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Ju(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Wl(t,n),r.shape):t},b:function(){var t=Ju(e,Iu(r,"float32")),n=ml(a.shape,i);return n.length>0?Nc(Wl(t,n),a.shape):t}}}},eb={kernelName:sa,gradFunc:function(e){return{x:function(){return gp(e)}}}},tb={kernelName:da,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Op(n.shape,"float32")}}}},nb={kernelName:ha,gradFunc:function(e){return{x:function(){return bl(e)}}}},rb={kernelName:fa,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Ed(e,r).map((function(e){return function(){return e}}))}},ab={kernelName:ma,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Rc(e,a,r.shape)}}}},ib={kernelName:ga,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=vl(o.shape,s.shape);return{a:function(){var t=Iu(s,"float32"),n=Ju(e,Ju(t,Ll(o,xp(t,zl(1))))),r=ml(o.shape,u);return r.length>0&&(n=Wl(n,r)),Nc(n,o.shape)},b:function(){var t=Ql(o,0),n=yl(t,up(o),bl(o)),r=Ju(e,Ju(i,n)),a=ml(s.shape,u);return a.length>0&&(r=Wl(r,a)),Nc(r,s.shape)}}}},ob={kernelName:ya,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=Ql(r,0);return{x:function(){return yl(i,e,Ju(e,a))},alpha:function(){var t=yl(i,bl(e),Ju(e,r)),n=ml(a.shape,e.shape);return n.length>0&&(t=Wl(t,n)),Nc(t,a.shape)}}}};function sb(e,t,n){var r=e.shape.length,a=r-n.length,i=Dv.getAxesPermutation(n,r),o=e;null!=i&&(o=Ld(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=Nc(t,r),i=ol(e,n,!0,!1),o=ol(e,n,!0,!0),s=Ju(i,o);return Ju(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=Dv.getUndoAxesPermutation(i);c=Ld(c,l)}return c}var ub={kernelName:ba,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis,i=[];return i=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return sb(r,e,i)}}}},cb={kernelName:sr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Yu(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Wl(t,n),r.shape):t},b:function(){var t=Ju(e,Iu(r,"float32")),n=ml(a.shape,i);n.length>0&&(t=Nc(Wl(t,n),a.shape));var o=Bl(a);return gp(Yu(t,Iu(o,"float32")))}}}},lb={kernelName:Na,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,gp(Bl(n)))}}}},pb={kernelName:Fa,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=Ju(ip(n,6),ld(n));return{x:function(){return Ju(e,Iu(r,"float32"))}}}},hb={kernelName:Ta,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,Iu(ld(n),"float32"))}}}},db={kernelName:Ca,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Nc(e,n.shape)}}}},fb={kernelName:Aa,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return Xo.runKernel(Ra,r,n)}}}},mb={kernelName:Ea,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return Xo.runKernel(_a,r,n)}}}},vb={kernelName:Da,gradFunc:function(e,t,n){var r=At(n.dims,e.shape);return{x:function(){return zh(e,r)}}}},gb={kernelName:Ma,gradFunc:function(e){return{x:function(){return bl(e)}}}},yb={kernelName:Oa,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return gp(Yu(e,Ju(Ll(n,1.5),2)))}}}},bb={kernelName:Ba,inputsToSave:["condition"],gradFunc:function(e,t){var n=C(t,1)[0];return{condition:function(){return Iu(bl(n),"float32")},t:function(){return Ju(e,Iu(n,e.dtype))},e:function(){return Ju(e,Iu(Sp(n),e.dtype))}}}},xb={kernelName:Wa,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Ql(n,zl(0)),r=zl(Xv),a=zl(Yv),i=Ju(e,a),o=Ju(Ju(e,r),Hl(Iu(n,"float32")));return yl(t,i,o)}}}},kb={kernelName:ja,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,Ju(n,xp(zl(1),n)))}}}},wb={kernelName:Ha,gradFunc:function(e){return{x:function(){return bl(e)}}}},Ib={kernelName:Ua,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(al(Iu(n,"float32")),e)}}}},Sb={kernelName:Ga,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(il(Iu(n,"float32")),e)}}}},Nb={kernelName:Va,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=C(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=C(Sv(r,a,i),2),u=s[0],c=s[1],l=[],p=0;p<e.rank;p++)l.push([u[p],o[p]-u[p]-c[p]]);return{x:function(){return Xp(e,l)}}}},Tb={kernelName:Qa,outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.dim,i=Ju(e,r);return{logits:function(){return xp(i,Ju(Wl(i,[a],true),r))}}}},Cb={kernelName:qa,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,Ac(n))}}}},Eb={kernelName:Ya,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Mc(e,r,a)}}}},_b={kernelName:Ja,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Ec(e,r)}}}},Ab={kernelName:Ka,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Ju(Pl(Iu(n,"float32")),2))}}}},Rb={kernelName:ai,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(e,Ju(Iu(n,"float32"),2))}}}},Fb={kernelName:ri,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=zl(2);return{a:function(){return Ju(e,Ju(i,xp(r,a)))},b:function(){return Ju(e,Ju(i,xp(a,r)))}}}},Db={kernelName:wi,gradFunc:function(e){return{x:function(){return bl(e)}}}},Mb={kernelName:li,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=e,n=ml(r.shape,i);return n.length>0&&(t=Wl(t,n)),Nc(t,r.shape)},b:function(){var t=e,n=ml(a.shape,i);return n.length>0&&(t=Wl(t,n)),Nc(gp(t),a.shape)}}}},Ob={kernelName:Xa,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=r.shape.slice();At(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=Nc(e,a),o=Ju(i,Lp(r.shape,"float32"));return{x:function(){return o}}}},Lb={kernelName:pi,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Yu(e,Bl(al(n)))}}}},zb={kernelName:hi,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Ju(xp(zl(1),Bl(n)),e)}}}},Pb={kernelName:di,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.reps;return{x:function(){var t=bl(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Ku(t,Rc(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Ku(t,Rc(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Ku(t,Rc(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var h=0;h<a[2];++h)for(var d=0;d<a[3];++d)t=Ku(t,Rc(e,[l*r.shape[0],p*r.shape[1],h*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},Bb={kernelName:vi,gradFunc:function(e,t,n){var r=Fl(n.perm);return{x:function(){return Ld(e,r)}}}},Wb={kernelName:yi,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return cd(e,r)}}}},Vb={kernelName:bi,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return function(e,t){for(var n=Dp(t,bl(t)),r=Jl(e,n),a=Zl(t,zl(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=jl(a,o+1);a=Ip(a,Lp(r.shape,"bool"));var s=bl(r);return yl(a,r,s)}(e,n)}}}};for(var Ub={kernelName:ki,gradFunc:function(e){return{x:function(){return bl(e)}}}},Gb=0,Hb=[Wg,Vg,Ug,Gg,Hg,jg,qg,Kg,Xg,Yg,Jg,Qg,$g,ty,ny,ry,ay,iy,oy,sy,uy,cy,py,ly,dy,fy,my,vy,gy,yy,cb,by,xy,ky,wy,Iy,Ny,Sy,Ty,Cy,Ay,Ry,Fy,Dy,My,Oy,Ly,zy,Py,Wy,Uy,Uy,Gy,jy,Ky,Xy,Yy,Jy,Qy,Zy,$y,eb,tb,nb,rb,ab,ab,ib,ob,ub,lb,pb,hb,db,fb,mb,vb,gb,yb,bb,xb,kb,wb,Ib,Sb,Nb,Tb,Cb,Eb,Eb,_b,_b,Ab,Fb,Rb,Db,Mb,Ob,Lb,zb,Pb,Bb,Wb,Vb,Ub];Gb<Hb.length;Gb++){Li(Hb[Gb])}To().prototype.abs=function(){return this.throwIfDisposed(),Qu(this)},To().prototype.acos=function(){return this.throwIfDisposed(),Zu(this)},To().prototype.acosh=function(){return this.throwIfDisposed(),$u(this)},To().prototype.add=function(e){return this.throwIfDisposed(),Ku(this,e)},To().prototype.all=function(e,t){return this.throwIfDisposed(),tc(this,e,t)},To().prototype.any=function(e,t){return this.throwIfDisposed(),nc(this,e,t)},To().prototype.argMax=function(e){return this.throwIfDisposed(),rc(this,e)},To().prototype.argMin=function(e){return this.throwIfDisposed(),ac(this,e)},To().prototype.asScalar=function(){return this.throwIfDisposed(),vt(1===this.size,(function(){return"The array must have only 1 element."})),Nc(this,[])},To().prototype.asType=function(e){return this.throwIfDisposed(),Iu(this,e)},To().prototype.as1D=function(){return this.throwIfDisposed(),Nc(this,[this.size])},To().prototype.as2D=function(e,t){return this.throwIfDisposed(),Nc(this,[e,t])},To().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Nc(this,[e,t,n])},To().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Nc(this,[e,t,n,r])},To().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Nc(this,[e,t,n,r,a])},To().prototype.asin=function(){return this.throwIfDisposed(),ic(this)},To().prototype.asinh=function(){return this.throwIfDisposed(),oc(this)},To().prototype.atan=function(){return this.throwIfDisposed(),sc(this)},To().prototype.atan2=function(e){return this.throwIfDisposed(),uc(this,e)},To().prototype.atanh=function(){return this.throwIfDisposed(),cc(this)},To().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Tc(this,e,t,n,r)},To().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Mc(this,e,t)},To().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Lc(this,e,t,n,r,a)},To().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Gc(this,e)},To().prototype.cast=function(e){return this.throwIfDisposed(),Iu(this,e)},To().prototype.ceil=function(){return this.throwIfDisposed(),Hc(this)},To().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),qc(this,e,t)},To().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof No&&(e=[e]),Ec([this].concat(Ie(e)),t)},To().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Zc(this,e,t,n,r,a,i)},To().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),el(this,e,t,n,r,a)},To().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Qc(this,e,t,n,r,a,i)},To().prototype.cos=function(){return this.throwIfDisposed(),al(this)},To().prototype.cosh=function(){return this.throwIfDisposed(),il(this)},To().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),ol(this,e,t,n)},To().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),sl(this,e,t,n)},To().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),cl(this,e,t)},To().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ll(this,e,t,n,r,a,i)},To().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),hl(this,e,t,n,r,a)},To().prototype.divNoNan=function(e){return this.throwIfDisposed(),xl(this,e)},To().prototype.div=function(e){return this.throwIfDisposed(),Yu(this,e)},To().prototype.dot=function(e){return this.throwIfDisposed(),kl(this,e)},To().prototype.elu=function(){return this.throwIfDisposed(),Il(this)},To().prototype.equal=function(e){return this.throwIfDisposed(),gl(this,e)},To().prototype.erf=function(){return this.throwIfDisposed(),Nl(this)},To().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Gl(this,e,t)},To().prototype.exp=function(){return this.throwIfDisposed(),Hl(this)},To().prototype.expandDims=function(e){return this.throwIfDisposed(),jl(this,e)},To().prototype.expm1=function(){return this.throwIfDisposed(),ql(this)},To().prototype.fft=function(){return this.throwIfDisposed(),nd(this)},To().prototype.flatten=function(){return this.throwIfDisposed(),Nc(this,[this.size])},To().prototype.floor=function(){return this.throwIfDisposed(),Yl(this)},To().prototype.floorDiv=function(e){return this.throwIfDisposed(),Xu(this,e)},To().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Jl(this,e,t,n)},To().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Zl(this,e)},To().prototype.greater=function(e){return this.throwIfDisposed(),Ql(this,e)},To().prototype.ifft=function(){return this.throwIfDisposed(),rd(this)},To().prototype.irfft=function(){return this.throwIfDisposed(),ad(this)},To().prototype.isFinite=function(){return this.throwIfDisposed(),ep(this)},To().prototype.isInf=function(){return this.throwIfDisposed(),tp(this)},To().prototype.isNaN=function(){return this.throwIfDisposed(),np(this)},To().prototype.leakyRelu=function(e){return this.throwIfDisposed(),rp(this,e)},To().prototype.lessEqual=function(e){return this.throwIfDisposed(),ip(this,e)},To().prototype.less=function(e){return this.throwIfDisposed(),ap(this,e)},To().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),sp(this,e,t,n,r)},To().prototype.logSigmoid=function(){return this.throwIfDisposed(),bp(this)},To().prototype.logSoftmax=function(e){return this.throwIfDisposed(),kp(this,e)},To().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),wp(this,e,t)},To().prototype.log=function(){return this.throwIfDisposed(),up(this)},To().prototype.log1p=function(){return this.throwIfDisposed(),cp(this)},To().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ip(this,e)},To().prototype.logicalNot=function(){return this.throwIfDisposed(),Sp(this)},To().prototype.logicalOr=function(e){return this.throwIfDisposed(),Np(this,e)},To().prototype.logicalXor=function(e){return this.throwIfDisposed(),Tp(this,e)},To().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),_c(this,e,t,n)},To().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Ap(this,e,t,n,r)},To().prototype.max=function(e,t){return this.throwIfDisposed(),Ml(this,e,t)},To().prototype.maximum=function(e){return this.throwIfDisposed(),Dp(this,e)},To().prototype.mean=function(e,t){return this.throwIfDisposed(),Mp(this,e,t)},To().prototype.min=function(e,t){return this.throwIfDisposed(),Ol(this,e,t)},To().prototype.minimum=function(e){return this.throwIfDisposed(),Pp(this,e)},To().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Bp(this,e,t)},To().prototype.mod=function(e){return this.throwIfDisposed(),Wp(this,e)},To().prototype.mul=function(e){return this.throwIfDisposed(),Ju(this,e)},To().prototype.neg=function(){return this.throwIfDisposed(),gp(this)},To().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Ul(this,e,t,n)},To().prototype.notEqual=function(e){return this.throwIfDisposed(),Hp(this,e)},To().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),jp(this,e,t,n)},To().prototype.onesLike=function(){return this.throwIfDisposed(),qp(this)},To().prototype.pad=function(e,t){return this.throwIfDisposed(),Xp(this,e,t)},To().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),eh(this,e,t,n,r,a,i)},To().prototype.pow=function(e){return this.throwIfDisposed(),Ll(this,e)},To().prototype.prelu=function(e){return this.throwIfDisposed(),th(this,e)},To().prototype.prod=function(e,t){return this.throwIfDisposed(),nh(this,e,t)},To().prototype.reciprocal=function(){return this.throwIfDisposed(),Mh(this)},To().prototype.relu=function(){return this.throwIfDisposed(),Oh(this)},To().prototype.relu6=function(){return this.throwIfDisposed(),Lh(this)},To().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Nc(this,e.shape)},To().prototype.reshape=function(e){return this.throwIfDisposed(),Nc(this,e)},To().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Rf(this,e,t,n)},To().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Ff(this,e,t,n)},To().prototype.reverse=function(e){return this.throwIfDisposed(),zh(this,e)},To().prototype.rfft=function(){return this.throwIfDisposed(),od(this)},To().prototype.round=function(){return this.throwIfDisposed(),Uh(this)},To().prototype.rsqrt=function(){return this.throwIfDisposed(),Gh(this)},To().prototype.selu=function(){return this.throwIfDisposed(),Hh(this)},To().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),jh(this,e,t,n,r,a,i)},To().prototype.sigmoid=function(){return this.throwIfDisposed(),Ac(this)},To().prototype.sign=function(){return this.throwIfDisposed(),Xh(this)},To().prototype.sin=function(){return this.throwIfDisposed(),Yh(this)},To().prototype.sinh=function(){return this.throwIfDisposed(),Jh(this)},To().prototype.slice=function(e,t){return this.throwIfDisposed(),Rc(this,e,t)},To().prototype.softmax=function(e){return this.throwIfDisposed(),td(this,e)},To().prototype.softplus=function(){return this.throwIfDisposed(),yp(this)},To().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),$p(this,e,t)},To().prototype.split=function(e,t){return this.throwIfDisposed(),id(this,e,t)},To().prototype.sqrt=function(){return this.throwIfDisposed(),Pl(this)},To().prototype.square=function(){return this.throwIfDisposed(),Bl(this)},To().prototype.squaredDifference=function(e){return this.throwIfDisposed(),sd(this,e)},To().prototype.squeeze=function(e){return this.throwIfDisposed(),ud(this,e)},To().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof No?[this,e]:[this].concat(Ie(e));return cd(n,t)},To().prototype.step=function(e){return this.throwIfDisposed(),ld(this,e)},To().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),pd(this,e,t,n,r,a,i,o,s)},To().prototype.sub=function(e){return this.throwIfDisposed(),xp(this,e)},To().prototype.sum=function(e,t){return this.throwIfDisposed(),Wl(this,e,t)},To().prototype.tan=function(){return this.throwIfDisposed(),hd(this)},To().prototype.tanh=function(){return this.throwIfDisposed(),Fc(this)},To().prototype.tile=function(e){return this.throwIfDisposed(),Kl(this,e)},To().prototype.toBool=function(){return this.throwIfDisposed(),Iu(this,"bool")},To().prototype.toFloat=function(){return this.throwIfDisposed(),Iu(this,"float32")},To().prototype.toInt=function(){return this.throwIfDisposed(),Iu(this,"int32")},To().prototype.topk=function(e,t){return this.throwIfDisposed(),Sd(this,e,t)},To().prototype.transpose=function(e){return this.throwIfDisposed(),Ld(this,e)},To().prototype.unique=function(e){return this.throwIfDisposed(),Td(this,e)},To().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Cd(this,e,t)},To().prototype.unstack=function(e){return this.throwIfDisposed(),Ed(this,e)},To().prototype.where=function(e,t){return this.throwIfDisposed(),yl(e,this,t)},To().prototype.zerosLike=function(){return this.throwIfDisposed(),bl(this)};var jb=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),qb=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Kb=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Xb=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Yb=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Jb=function(){function e(t){xe(this,e),this.maxEntries=t||100,this.cache=new Map}return we(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function Qb(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function Zb(e,t){if(!e)throw new Yb(t)}function $b(e,t){var n,r=0,a=Se(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function ex(e){return 1===e.length?e[0]:e}function tx(e){return Array.isArray(e)?e:[e]}function nx(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function rx(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var ax={};function ix(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function ox(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return ox(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?ox(a):e[r]=a.value)}}function sx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in ax)i=ax[o];else if(null==(i=t[o]))throw new Kb("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l=e;if(null==l.className||null==l.config)throw new Kb("".concat(r,": Improper config format: ").concat(JSON.stringify(l),".\n'className' and 'config' must set."));var p,h,d=l.className;if(d in n?(p=(s=C(n[d],2))[0],h=s[1]):d in ax?(p=(u=C(ax.className,2))[0],h=u[1]):d in t&&(p=(c=C(t[d],2))[0],h=c[1]),null==p)throw new Kb("Unknown ".concat(r,": ").concat(d,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=h){for(var f={},m=0,v=Object.keys(ax);m<v.length;m++){var g=v[m];f[g]=ax[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var x=b[y];f[x]=n[x]}l.config.customObjects=f;for(var k=Object.assign({},ax),w=0,I=Object.keys(n);w<I.length;w++){var S=I[w];ax[S]=n[S]}ox(l.config);var N=h(p,l.config,n,a);return ax=Object.assign({},k),N}for(var T=Object.assign({},ax),E=0,_=Object.keys(n);E<_.length;E++){var A=_[E];ax[A]=n[A]}var R=new p(l.config);return ax=Object.assign({},T),R}function ux(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function cx(e){if(null==e)return e;var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function lx(e){if(null==e)throw new Kb("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function px(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Kb("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function hx(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Zb(n>=0),Zb(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function dx(e,t){Array.isArray(e)?(Vi.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return dx(e,"element ".concat(n+1," of ").concat(t))}))):Vi.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(fx(e),".")}))}function fx(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return fx(e)})).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function mx(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var vx=0;function gx(){return vx++}var yx={};function bx(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in yx||(yx[e]=0),yx[e]+=1,e+yx[e].toString()}var xx=["channelsFirst","channelsLast"],kx=["nearest","bilinear"],wx=["valid","same","causal"],Ix=["max","avg"],Sx=["sum","mul","concat","ave"],Nx=new Map;function Tx(e){px(xx,"DataFormat",e)}function Cx(e){px(wx,"PaddingMode",e)}function Ex(e){px(Ix,"PoolMode",e)}var _x=[],Ax="/";function Rx(e,t){_x.push(e);try{var n=t();return _x.pop(),n}catch(n){throw _x.pop(),n}}function Fx(e){if(!Lx(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===_x.length?"":_x.join(Ax)+Ax)+e}function Dx(e){if(!Lx(e))throw new Error("Not a valid tensor name: '"+e+"'");Nx.has(e)||Nx.set(e,0);var t=Nx.get(e);if(Nx.set(e,Nx.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Nx.set(n,1),n}return e}var Mx,Ox=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Lx(e){return!!e.match(Ox)}function zx(e){return e===parseInt(e.toString(),10)}function Px(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Bx(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function Wx(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Vx(e,t){if(t<e)throw new Kb("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function Ux(){return null==Mx&&(Mx=ju().epsilon()),Mx}function Gx(e,t){return Iu(e,t)}function Hx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),Nc(e,n)}function jx(e,t,n){return Mu((function(){switch(e.rank){case 1:return Qh(e,t,n);case 2:return Zh(e,[t,0],[n,e.shape[1]]);case 3:return $h(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return ed(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Rc(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Rc(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Kb("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function qx(e,t,n){return Mu((function(){switch(e.rank){case 1:return Qh(e,t,n);case 2:return Zh(e,[0,t],[e.shape[0],n]);case 3:return $h(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return ed(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Kb("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Kx(e,t,n,r){return Mu((function(){switch(e.rank){case 1:return Qh(e,t,n);case 2:switch(r){case 1:return jx(e,t,n);case 2:return qx(e,t,n);default:throw new Kb("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return jx(e,t,n);case 2:return $h(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return qx(e,t,n);default:throw new Kb("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return jx(e,t,n);case 2:return ed(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return ed(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return qx(e,t,n);default:throw new Kb("The axis is not within the rank of the tensor ".concat(r))}default:throw new Kb("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Xx(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Ec(e,n)}function Yx(e,t){switch(e.rank){case 1:return Kc([e,t]);case 2:return Xc([e,t],0);case 3:return Yc([e,t],0);case 4:return Jc([e,t],0);default:throw new Kb("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function Jx(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Kb("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return Kl(e,t)}function Qx(e){return Eh(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function Zx(e,t,n,r){if(e.rank<2||t.rank<2)throw new Xb("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Xb("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return qd.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?tk(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=Nc(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Ie(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=Nc(Ld(t,l),[u,-1]);var p=[].concat(Ie(a),Ie(c));return Nc(qd.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?tk(e.rank,r,"channelsLast"):null,activation:n}),p)}function $x(e,t,n){return Mu((function(){return t=Array.isArray(t)?dd(t,"int32"):Iu(t,"int32"),Jl(e,t,n)}))}function ek(e){return Ju(e,e)}function tk(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Kb("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1,1,1]):Nc(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,1,1,r[0]]):Nc(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1,1]):Nc(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,1,r[0]]):Nc(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1]):Nc(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,r[0]]):Nc(t,[1].concat(r))}else if(e<3)return t;throw new Kb("Unsupported input rank by biasAdd: ".concat(t.rank))}function nk(e,t,n){return Mu((function(){return null==n&&(n="channelsLast"),Tx(n),Ku(e,tk(e.rank,t,n))}))}function rk(e,t,n,r){return Mu((function(){return Vd(e,t,n,r)}))}function ak(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var ik=["fanIn","fanOut","fanAvg"],ok=["normal","uniform","truncatedNormal"];var sk=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(lm.Serializable),uk=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return Op(e,t)}}]),n}(sk);uk.className="Zeros",lm.registerClass(uk);var ck=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return Lp(e,t)}}]),n}(sk);ck.className="Ones",lm.registerClass(ck);var lk=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this),"object"!=typeof e)throw new Kb("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new Kb("config must have value set but got ".concat(e));return r.value=e.value,ge(r)}return we(n,[{key:"apply",value:function(e,t){var n=this;return Mu((function(){return Ju(zl(n.value),Lp(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(sk);lk.className="Constant",lm.registerClass(lk);var pk=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){return Ah(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(sk);pk.className="RandomUniform",lm.registerClass(pk);var hk=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Xb("randomNormal does not support dType ".concat(t,"."));return Qx(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(sk);hk.className="RandomNormal",lm.registerClass(hk);var dk=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Xb("truncatedNormal does not support dType ".concat(t,"."));return Nd(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(sk);dk.className="TruncatedNormal",lm.registerClass(dk);var fk=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return we(n,[{key:"apply",value:function(e,t){var n=this;return Mu((function(){if(2!==e.length||e[0]!==e[1])throw new Kb("Identity matrix initializer can only be used for 2D square matrices.");return Ju(n.gain,Xl(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(sk);fk.className="Identity",lm.registerClass(fk);var mk=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this),e.scale<0)throw new Kb("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){px(ik,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){px(ok,"Distribution",e)}(r.distribution),r.seed=e.seed,ge(r)}return we(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Tx(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=Px(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=Px(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=Px(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Xb("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Nd(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return Ah(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(sk);mk.className="VarianceScaling",lm.registerClass(mk);var vk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);vk.className="GlorotUniform",lm.registerClass(vk);var gk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);gk.className="GlorotNormal",lm.registerClass(gk);var yk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);yk.className="HeNormal",lm.registerClass(yk);var bk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);bk.className="HeUniform",lm.registerClass(bk);var xk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);xk.className="LeCunNormal",lm.registerClass(xk);var kk=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return mk.className}}]),n}(mk);kk.className="LeCunUniform",lm.registerClass(kk);var wk=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.ELEMENTS_WARN_SLOW=2e3,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){var n=this;return Mu((function(){if(e.length<2)throw new Xb("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));var r=Vi.sizeFromShape(e.slice(0,-1)),a=e[e.length-1],i=r*a;i>n.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more than ".concat(n.ELEMENTS_WARN_SLOW," (").concat(i,") elements: Slowness may result."));var o=Qx([Math.max(a,r),Math.min(a,r)],0,1,t,n.seed),s=om.qr(o,!1),u=s[0],c=s[1].flatten().stridedSlice([0],[Math.min(a,r)*Math.min(a,r)],[Math.min(a,r)+1]);return u=Ju(u,c.sign()),r<a&&(u=u.transpose()),Ju(zl(n.gain),u.reshape(e))}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(sk);wk.className="Orthogonal",lm.registerClass(wk);var Ik={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Sk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sx(e,lm.SerializationMap.getMap().classNameMap,t,"initializer")}function Nk(e){return ix(e)}function Tk(e){if("string"==typeof e){var t=e in Ik?Ik[e]:e;if("GlorotNormal"===t)return new gk;if("GlorotUniform"===t)return new vk;if("HeNormal"===t)return new yk;if("HeUniform"===t)return new bk;if("LeCunNormal"===t)return new xk;if("LeCunUniform"===t)return new kk;var n={};return n.className=t,n.config={},Sk(n)}return e instanceof sk?e:Sk(e)}function Ck(e){return Array.isArray(e)&&Array.isArray(e[0])}function Ek(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function _k(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new Kb("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Ak(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new Kb("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Rk(e){var t,n=0,r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var Fk="Variable",Dk=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fk,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;xe(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=gx(),r=null==r?Fk:r,this.originalName=Fx(r),this.name=Dx(this.originalName),this.trainable_=a,this.constraint=i,this.val=Ad(t,this.trainable_,this.name,this.dtype)}return we(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Mk(e){return e.map((function(e){return e.read()}))}function Ok(e){e.forEach((function(e){e[0].write(e[1])}))}var Lk=we((function e(t){xe(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),zk=we((function e(t,n,r,a,i,o,s){xe(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=gx(),null!=o&&(this.originalName=Fx(o),this.name=Dx(this.originalName)),this.rank=n.length})),Pk=0,Bk=function(){function e(t,n){xe(this,e),this.callArgs=n,this.id=Pk++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=Se(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return we(e,[{key:"getConfig",value:function(){var e,t=[],n=Se(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),Wk=0,Vk=function(e){ye(n,e);var t=be(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=Wk++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=nx(i)+"_"+bx(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return we(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new qb("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Kb("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return ex(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return ex(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new jb("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new jb("Layer ".concat(this.name," is not connected, no input to return."));return ex(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new jb("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new jb("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return ex(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=tx(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=tx(this.inputSpec);if(e.length!==t.length)throw new Kb("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var h=a.shape[p],d=r.shape[p];if(null!=h&&null!=d&&h!==d)throw new Kb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=tx(e),i=!0,o=Se(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof zk)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=Se(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof zk){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new Kb("Arguments to apply() must be all SymbolicTensors or all Tensors");return Rx(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=Se(tx(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(ex(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,p=n.call(e,t),h=[],d=Se(tx(p));try{for(d.s();!(c=d.n()).done;){var f=c.value;-1!==a.indexOf(f)&&(f=f.clone()),h.push(f)}}catch(l){d.e(l)}finally{d.f()}if(p=ex(h),null!=n.activityRegularizer)throw new Xb("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var m,v=function(e){e=tx(e);var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return ex(n)}(e),g=n.computeOutputShape(v),y="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),m=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new zk(y,r,n,tx(e),t,n.name,a)})):new zk(y,g,n,tx(e),t,n.name),n.addInboundNode(e,m,null,null,v,g,t),n._refCount++,null!=n.activityRegularizer)throw new Xb("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new jb("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=Se(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new jb("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new qb("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return Rk(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return Mk(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Mu((function(){var n=t.weights;if(n.length!==e.length)throw new Kb('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=Mk(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Vi.arraysEqual(o.shape,u.shape))throw new Kb("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}Ok(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new Kb("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Tk("zeros"));var u=r.apply(t,n),c=new Dk(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=tx(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Ie(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=tx(e);t=tx(t),n=tx(n),r=tx(r),a=Ek(a),i=Ek(i);var u,c=[],l=[],p=[],h=Se(s);try{for(h.s();!(u=h.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),p.push(d.tensorIndex)}}catch(m){h.e(m)}finally{h.f()}new Bk({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(lm.Serializable);function Uk(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=Se(Uk(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(c){s.e(c)}finally{s.f()}}return a}var Gk=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:bx("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Kb("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new Kb("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Kb("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new zk(r.dtype,r.batchInputShape,he(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Bk({outboundLayer:he(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),ge(r)}return we(n,[{key:"apply",value:function(e,t){throw new Kb("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Vk);function Hk(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Kb("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Gk({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}Gk.className="InputLayer",lm.registerClass(Gk);var jk=function(){function e(t){if(xe(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=Se(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return we(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new Kb("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Iu(t,e.dtype)}catch(n){throw new Kb("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof zk){if(null==this.id2Value[e.id])throw new Kb("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new Kb("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof zk){if(null==this.id2Value[e.id])throw new Kb("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new Kb("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Ou(this.id2Mask)}}]),e}(),qk=new Jb,Kk=new Jb;function Xk(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=Se(u);try{for(p.s();!(a=p.n()).done;){var h=a.value;-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}}catch(z){p.e(z)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,f=u.join(",")+"|"+t.names().sort().join(","),m=qk.get(f);if(null==m){var v=function(e,t){Vi.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=Jk(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=Se(e);try{for(s.s();!(i=s.n()).done;){var u,c=Jk(i.value,t),l=c.sorted,p=c.recipientMap,h=Se(l);try{for(h.s();!(u=h.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch(z){h.e(z)}finally{h.f()}var f=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)f(m)}}catch(z){s.e(z)}finally{s.f()}}return{sorted:n,recipientCounts:Yk(r)}}(s,t);m=v.sorted,d=v.recipientCounts,qk.put(f,m),Kk.put(f,d)}d={},i||Object.assign(d,Kk.get(f));for(var g=new jk(t),y=0;y<m.length;++y){if(null!=r){var b=Fu().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=m[y],k=x.sourceLayer;if(!(k instanceof Gk)){var w,I=[],S=[],N=[],T=!1,C=Se(x.inputs);try{for(C.s();!(w=C.n()).done;){var E=w.value,_=g.getValue(E),A=g.getMask(E);I.push(_),S.push(A),null!=A&&(T=!0),i||(d[E.name]--,0===d[E.name]&&!t.hasKey(E)&&-1===u.indexOf(E.name)&&!_.isDisposed&&!0!==E.sourceLayer.stateful&&N.push(_))}}catch(z){C.e(z)}finally{C.f()}T&&((n=n||{}).mask=S[0]);var R=tx(k.apply(I,n)),F=null;k.supportsMasking&&(F=k.computeMask(I,S));for(var D=Qk(x),M=Array.isArray(D)?D:[D],O=0;O<M.length;++O){g.hasKey(M[O])||g.add(M[O],R[O],Array.isArray(F)?F[0]:F);var L=u.indexOf(M[O].name);-1!==L&&(c[L]=R[O])}i||Ou(N)}}return g.disposeMasks(),o?c:c[0]}function Yk(e){var t={};for(var n in e)t[n]=e[n].size;return t}function Jk(e,t){var n,r=new Set,a=[],i={},o=Se(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var h,d=Se(l.inputs);try{for(d.s();!(h=d.n()).done;){var f=h.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),!r.has(f.name)&&u.push(f)}}catch(m){d.e(m)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function Qk(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=Se(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}on().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=qk&&qk.setMaxEntries(e),null!=Kk&&Kk.setMaxEntries(e)}));var Zk={};function $k(e,t){return Mu((function(){return Pl(Wl(Ju(e,e),t,!0))}))}Le(Zk,{maxNorm:function(){return cw},minMaxNorm:function(){return hw},nonNeg:function(){return pw},unitNorm:function(){return lw}});var ew=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"getConfig",value:function(){return{}}}]),n}(lm.Serializable),tw=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return Mu((function(){var n=$k(e,t.axis),r=qc(n,0,t.maxValue);return Ju(e,Yu(r,Ku(Ux(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(ew);tw.className="MaxNorm",lm.registerClass(tw);var nw=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return Mu((function(){return Yu(e,Ku(Ux(),$k(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(ew);nw.className="UnitNorm",lm.registerClass(nw);var rw=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Oh(e)}}]),n}(ew);rw.className="NonNeg",lm.registerClass(rw);var aw=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return Mu((function(){var n=$k(e,t.axis),r=Ku(Ju(t.rate,qc(n,t.minValue,t.maxValue)),Ju(1-t.rate,n));return Ju(e,Yu(r,Ku(Ux(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(ew);aw.className="MinMaxNorm",lm.registerClass(aw);var iw={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ow(e){return ix(e)}function sw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sx(e,lm.SerializationMap.getMap().classNameMap,t,"constraint")}function uw(e){return null==e?null:"string"==typeof e?sw({className:e in iw?iw[e]:e,config:{}}):e instanceof ew?e:sw(e)}function cw(e){return new tw(e)}function lw(e){return new nw(e)}function pw(){return new rw}function hw(e){return new aw(e)}var dw={};function fw(){return new uk}function mw(){return new ck}function vw(e){return new lk(e)}function gw(e){return new pk(e)}function yw(e){return new hk(e)}function bw(e){return new dk(e)}function xw(e){return new fk(e)}function kw(e){return new mk(e)}function ww(e){return new vk(e)}function Iw(e){return new gk(e)}function Sw(e){return new yk(e)}function Nw(e){return new bk(e)}function Tw(e){return new xk(e)}function Cw(e){return new kk(e)}function Ew(e){return new wk(e)}Le(dw,{constant:function(){return vw},glorotNormal:function(){return Iw},glorotUniform:function(){return ww},heNormal:function(){return Sw},heUniform:function(){return Nw},identity:function(){return xw},leCunNormal:function(){return Tw},leCunUniform:function(){return Cw},ones:function(){return mw},orthogonal:function(){return Ew},randomNormal:function(){return yw},randomUniform:function(){return gw},truncatedNormal:function(){return bw},varianceScaling:function(){return kw},zeros:function(){return fw}});var _w,Aw={};function Rw(e){return Fw.apply(this,arguments)}function Fw(){return Fw=S(w().mark((function e(t){var n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Ou(a);case 10:case"end":return e.stop()}}),e)}))),Fw.apply(this,arguments)}function Dw(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}Le(Aw,{Layer:function(){return Vk},RNN:function(){return rN},RNNCell:function(){return aN},activation:function(){return LT},add:function(){return jT},alphaDropout:function(){return OC},average:function(){return qT},averagePooling1d:function(){return tC},averagePooling2d:function(){return aC},averagePooling3d:function(){return sC},avgPool1d:function(){return nC},avgPool2d:function(){return iC},avgPool3d:function(){return uC},avgPooling1d:function(){return rC},avgPooling2d:function(){return oC},avgPooling3d:function(){return cC},batchNormalization:function(){return ZT},bidirectional:function(){return CC},categoryEncoding:function(){return WC},centerCrop:function(){return PC},concatenate:function(){return KT},conv1d:function(){return CT},conv2d:function(){return ET},conv2dTranspose:function(){return _T},conv3d:function(){return AT},conv3dTranspose:function(){return RT},convLstm2d:function(){return IC},convLstm2dCell:function(){return SC},cropping2D:function(){return DT},dense:function(){return zT},depthwiseConv2d:function(){return OT},dot:function(){return QT},dropout:function(){return PT},elu:function(){return kT},embedding:function(){return HT},flatten:function(){return WT},gaussianDropout:function(){return MC},gaussianNoise:function(){return DC},globalAveragePooling1d:function(){return lC},globalAveragePooling2d:function(){return pC},globalMaxPool1d:function(){return _C},globalMaxPool2d:function(){return AC},globalMaxPooling1d:function(){return hC},globalMaxPooling2d:function(){return dC},gru:function(){return gC},gruCell:function(){return yC},input:function(){return aS},inputLayer:function(){return xT},layerNormalization:function(){return $T},leakyReLU:function(){return IT},lstm:function(){return bC},lstmCell:function(){return xC},masking:function(){return LC},maxPool1d:function(){return RC},maxPool2d:function(){return FC},maxPooling1d:function(){return fC},maxPooling2d:function(){return mC},maxPooling3d:function(){return vC},maximum:function(){return XT},minimum:function(){return YT},multiply:function(){return JT},permute:function(){return GT},prelu:function(){return ST},randomWidth:function(){return VC},reLU:function(){return wT},repeatVector:function(){return VT},rescaling:function(){return zC},reshape:function(){return UT},resizing:function(){return BC},rnn:function(){return NC},separableConv2d:function(){return FT},simpleRNN:function(){return kC},simpleRNNCell:function(){return wC},softmax:function(){return NT},spatialDropout1d:function(){return BT},stackedRNNCells:function(){return TC},thresholdedReLU:function(){return TT},timeDistributed:function(){return EC},upSampling2d:function(){return MT},zeroPadding2d:function(){return eC}}),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(_w||(_w={}));var Mw=function(){function e(){xe(this,e),this.validationData=null}return we(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Ow=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;xe(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return we(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=Se(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=Se(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Se(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Se(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Lw=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this)}return we(n,[{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=w().mark((function e(t){var a,i,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"==typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=Mu((function(){return Ku(o.totals[t],Ju(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=w().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=17;break}r=Se(this.params.metrics),e.prev=2,i=w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,null!=o.totals[t]&&("number"==typeof o.totals[t]?n[t]=o.totals[t]/o.seen:Mu((function(){var e=Ju(Yu(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),Lu(n[t])})));case 2:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=9;break}return e.delegateYield(i(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Mw),zw=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Mw),Pw=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Rv,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Vi.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Vi.now();return function(){var i=null!=n?n():Vi.now();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind(he(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,ge(a)}return we(n,[{key:"maybeWait",value:function(){var e=S(w().mark((function e(t,n,r){var a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,Rw(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,Rw(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,Rw(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,Rw(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,Rw(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Vi.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,Rw(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,Rw(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Mw);function Bw(e,t){return null==e&&(e={}),e instanceof Mw?[e]:Array.isArray(e)&&e[0]instanceof Mw?e:tx(e).map((function(e){return new Pw(e,t)}))}var Ww=function(){function e(){xe(this,e)}return we(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Vi.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new Kb("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Ie(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Vw(e,t,n,r,a,i,o,s,u){var c=new zw,l=[new Lw].concat(Ie(Ww.createCallbacks(t)));null!=e&&l.push.apply(l,Ie(e)),l.push(c);var p=new Ow(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function Uw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return sx(e,lm.SerializationMap.getMap().classNameMap,t,"layer",n)}function Gw(e,t){return Mu((function(){"float32"!==e.dtype&&(e=Iu(e,"float32"));var n=Wl(ek(e),t,!0),r=jc(n.shape,Ux()),a=Pl(Dp(n,r));return Yu(e,a)}))}function Hw(e,t){return Mu((function(){return Mp(ek(xp(t,e)),-1)}))}function jw(e,t){return Mu((function(){return Mp(Qu(xp(t,e)),-1)}))}function qw(e,t){return Mu((function(){var n=xp(e,t),r=qc(Qu(e),Ux(),Number.MAX_VALUE),a=Qu(Yu(n,r));return Ju(100,Mp(a,-1))}))}function Kw(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Mu((function(){if(n)t=td(t);else{var r=Wl(t,t.shape.length-1,!0);t=Yu(t,r)}return t=qc(t,Ux(),1-Ux()),gp(Wl(Ju(Iu(e,"float32"),up(t)),t.shape.length-1))}))}function Xw(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Mu((function(){var r=Iu(Yl(function(e){var t=[Px(e.shape)];return Nc(e,t)}(e)),"int32"),a=(t=qc(t,Ux(),1-Ux())).shape;return Kw(Nc(jp(r,a[a.length-1]),a),t,n)}))}function Yw(e,t){return Mu((function(){var n;return n=qc(t,Ux(),1-Ux()),n=up(Yu(n,xp(1,n))),Mp(function(e,t){if(!Vi.arraysEqual(e.shape,t.shape))throw new Kb("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Mu((function(){var n=Oh(t),r=gp(Qu(t));return Ku(xp(n,Ju(t,e)),cp(Hl(r)))}))}(e,n),-1)}))}function Jw(e,t){return Mu((function(){var n=Gw(e,-1),r=Gw(t,-1),a=Ju(n,r);return gp(Wl(a,-1))}))}Ww.constructors={};var Qw={meanSquaredError:Hw,meanAbsoluteError:jw,meanAbsolutePercentageError:qw,meanSquaredLogarithmicError:function(e,t){return Mu((function(){var n=qc(t,Ux(),Number.MAX_VALUE),r=up(Ku(1,n)),a=qc(e,Ux(),Number.MAX_VALUE),i=up(Ku(1,a));return Mp(ek(xp(r,i)),-1)}))},squaredHinge:function(e,t){return Mu((function(){var n=Dp(0,xp(1,Ju(e,t)));return Mp(ek(n),-1)}))},hinge:function(e,t){return Mu((function(){var n=Dp(0,xp(1,Ju(e,t)));return Mp(n,-1)}))},categoricalHinge:function(e,t){return Mu((function(){var n=Wl(Ju(e,t),-1),r=Ml(Ju(xp(1,e),t),-1);return Dp(0,Ku(1,xp(r,n)))}))},logcosh:function(e,t){return Mu((function(){var n=Math.log(2),r=xp(t,e),a=xp(Ku(r,yp(Ju(-2,r))),n);return Mp(a,-1)}))},categoricalCrossentropy:Kw,sparseCategoricalCrossentropy:Xw,binaryCrossentropy:Yw,kullbackLeiblerDivergence:function(e,t){return Mu((function(){var n=qc(e,Ux(),1),r=qc(t,Ux(),1);return Wl(Ju(e,up(Yu(n,r))),-1)}))},poisson:function(e,t){return Mu((function(){var n=up(Ku(Ux(),t));return Mp(xp(t,Ju(e,n)),-1)}))},cosineProximity:Jw};function Zw(e){if("string"==typeof e){if(e in Qw)return Qw[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new Kb(t)}return e}function $w(e,t){return Mu((function(){var n=Ju(.5,qp(t)),r=Gx(Ql(t,n),e.dtype);return Mp(gl(e,r),-1)}))}function eI(e,t){return Mu((function(){return Gx(gl(rc(e,-1),rc(t,-1)),"float32")}))}function tI(e,t){return Mu((function(){return Iu(Wl(Ip(gl(e,1),gl(t,1))),"float32")}))}function nI(e,t){return Mu((function(){var n=tI(e,t),r=function(e,t){return Mu((function(){return Iu(Wl(Ip(gl(e,0),gl(t,1))),"float32")}))}(e,t),a=Ku(n,r);return Iu(yl(Ql(a,0),Yu(n,a),0),"float32")}))}function rI(e,t){return Mu((function(){var n=tI(e,t),r=function(e,t){return Mu((function(){return Iu(Wl(Ip(gl(e,1),gl(t,0))),"float32")}))}(e,t),a=Ku(n,r);return Iu(yl(Ql(a,0),Yu(n,a),0),"float32")}))}function aI(e,t){return Yw(e,t)}function iI(e,t){return e.rank===t.rank&&(e=ud(e,[e.rank-1])),(t=rc(t,-1)).dtype!==e.dtype&&(t=Iu(t,e.dtype)),Iu(gl(e,t),"float32")}var oI=Kw,sI=Xw,uI={binaryAccuracy:$w,categoricalAccuracy:eI,precision:nI,categoricalCrossentropy:oI,sparseCategoricalCrossentropy:sI,mse:Hw,MSE:Hw,mae:jw,MAE:jw,mape:qw,MAPE:qw,cosine:Jw};function cI(e){if(Zb(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(Qw);n<r.length;n++){var a=r[n];if(Qw[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(uI);i<o.length;i++){var s=o[i];if(uI[s]===e){t=s;break}}return void 0!==t?t:e.name}function lI(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!pI(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576."))}}function pI(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!pI(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=Se(e);try{for(i.s();!(a=i.n()).done;){if(!pI(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function hI(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Ie(s))}if(t){var u,c=Se(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,h=!1,d=Se(p.inboundNodes);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(h){t=!1;break}h=!0}}}catch(m){d.e(m)}finally{d.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Ie(e.nodesByDepth[s]))}a("_".repeat(t)),dI(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?fI(c[l],n,a):mI(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=function(e){var t;return t=null!=e.collectedTrainableWeights?Rk(e.collectedTrainableWeights):Rk(e.trainableWeights),t}(e),h=Rk(e.nonTrainableWeights);a("Total params: ".concat(p+h)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(h)),a("_".repeat(t))}function dI(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function fI(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();dI(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function mI(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(g){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(g){a="multiple"}var o,s=[],u=Se(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,h=c.nodeIndices[l],d=c.tensorIndices[l];s.push("".concat(p,"[").concat(h,"][").concat(d,"]"))}}}catch(y){u.e(y)}finally{u.f()}var f=e.name,m=e.getClassName(),v=0===s.length?"":s[0];dI(["".concat(f," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)dI(["","","","",s[g]],t,r)}function vI(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function gI(e,t){if(null===e)return null;if("string"==typeof e)return rx(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];vI(t,a,i)?n.push(i):n.push(gI(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var p=rx(c);o[p]=gI(l,p)}}return o}function yI(e,t){if(null==e)return null;if("string"==typeof e)return nx(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];vI(t,a,i)?n.push(i):n.push(yI(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=nx(c);o[p]="name"!==c&&"className"!==c||"string"!=typeof l?yI(l,c):l}return o}var bI="4.5.0",xI=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=bx(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],cx(r.inputs).length!==r.inputs.length)throw new Kb("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));cx(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=Se(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(Ie){o.e(Ie)}finally{o.f()}var p,h=Se(r.inputs);try{for(h.s();!(p=h.n()).done;){var d=p.value,f=d.sourceLayer,m=d.nodeIndex,v=d.tensorIndex;Zb(0===m,"input layer has >1 nodes"),Zb(0===v,"input layer has >1 tensors"),r.inputLayers.push(f),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch(Ie){h.e(Ie)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof Gk))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(g," (0-based) originates from layer type ").concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=Se(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch(Ie){x.e(Ie)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,I={},S={},N={},T={},C={},E=[],_=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new qb("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in C||(C[o.id]=Object.keys(C).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},A=[],R=[],F=Se(r.outputs);try{for(F.s();!(w=F.n()).done;){_(w.value,A,R)}}catch(Ie){F.e(Ie)}finally{F.f()}var D,M=Se(E.slice().reverse());try{for(M.s();!(D=M.n()).done;){var O=D.value;S[O.id]=O,O.id in I||(I[O.id]=0);var L=I[O.id],z=null==N[O.outboundLayer.id]?0:N[O.outboundLayer.id];L=Math.max(L,z),N[O.outboundLayer.id]=L,T[O.outboundLayer.id]=O.outboundLayer,I[O.id]=L;for(var P=0;P<O.inboundLayers.length;P++){var B=O.inboundLayers[P],W=O.nodeIndices[P],V=B.inboundNodes[W],U=null==I[V.id]?0:I[V.id];I[V.id]=Math.max(L+1,U),S[V.id]=V}}}catch(Ie){M.e(Ie)}finally{M.f()}var G={};for(var H in I){var j=I[H];j in G||(G[j]=[]),G[j].push(S[H])}var q={};for(var K in N){var X=N[K];X in q||(q[X]=[]),q[X].push(T[K])}var Y=Object.keys(q).map((function(e){return parseInt(e,10)})).sort(ux);r.layers=[];var J,Q=Se(Y);try{for(Q.s();!(J=Q.n()).done;){var Z=q[J.value];Z.sort((function(e,t){var n=C[e.id],r=C[t.id];return n<r?-1:n>r?1:0}));var $,ee=Se(Z);try{for(ee.s();!($=ee.n()).done;){var te=$.value;te instanceof n&&r.internalContainerRefs.push(te),r.layers.push(te)}}catch(Ie){ee.e(Ie)}finally{ee.f()}}}catch(Ie){Q.e(Ie)}finally{Q.f()}r.layersByDepth=q,Y=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(ux);var ne,re=r.inputs.slice(),ae=[],ie=Se(Y);try{for(ie.s();!(ne=ie.n()).done;){var oe,se=Se(G[ne.value]);try{for(se.s();!(oe=se.n()).done;){var ue=oe.value,ce=ue.outboundLayer;if(null!=ce){var le,pe=Se(ue.inputTensors);try{for(pe.s();!(le=pe.n()).done;){var de=le.value;if(-1===re.indexOf(de))throw new qb("Graph disconnected: cannot obtain value for tensor ".concat(de,' at layer "').concat(ce.name,'". The following previous layers were accessed without issue: ').concat(ae))}}catch(Ie){pe.e(Ie)}finally{pe.f()}var fe,me=Se(ue.outputTensors);try{for(me.s();!(fe=me.n()).done;){var ve=fe.value;re.push(ve)}}catch(Ie){me.e(Ie)}finally{me.f()}ae.push(ce.name)}}}catch(Ie){se.e(Ie)}finally{se.f()}}}catch(Ie){ie.e(Ie)}finally{ie.f()}r.nodesByDepth=G;var ye,be=r.layers.map((function(e){return e.name})),ke=Se(be);try{var we=function(){var e=ye.value,t=be.filter((function(t){return t===e})).length;if(1!==t)throw new qb('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(be))};for(ke.s();!(ye=ke.n()).done;)we()}catch(Ie){ke.e(Ie)}finally{ke.f()}return r.outboundNodes=[],r.inboundNodes=[],new Bk({outboundLayer:he(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,ge(r)}return we(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=Se(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=Se(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new Kb("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Se(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Ie(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=Se(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=Se(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new Kb("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch(m){s.e(m)}finally{s.f()}}}catch(m){i.e(m)}finally{i.f()}var c=[];for(var l in e){var p=l;if(null==r[l]){var h=l.split("/");p=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(null!=r[p])c.push([r[p],e[l]]);else if(n)throw new Kb("Provided weight data has no target variable: ".concat(l));delete r[p]}if(n){var d=[];for(var f in r)d.push(f);if(d.length>0)throw new Kb("".concat(d.length," of ").concat(a," weights are not set: ").concat(d))}Ok(c)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(bI),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=yI(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Mu((function(){e=tx(e);for(var r=new jk,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return Xk(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Mu((function(){var r;return e=tx(e),r=null==t?Qb(null,e.length):tx(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Ek(e);if(t.length!==this.inputLayers.length)throw new Kb("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(ux);if(o.length>1){var s,u=Se(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=Se(this.nodesByDepth[l]);try{for(p.s();!(c=p.n()).done;){var h=c.value,d=h.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(d.id)){for(var f=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.nodeIndices[m],y=h.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];f.push(b)}for(var x=Ek(d.computeOutputShape(ex(f))),k=d.inboundNodes.indexOf(h),w=0;w<x.length;w++){n["".concat(d.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch(F){p.e(F)}finally{p.f()}}}catch(F){u.e(F)}finally{u.f()}}for(var I=[],S=[],N=0;N<this.outputLayers.length;N++){var T=this.outputLayers[N],C=this.outputLayersNodeIndices[N],E=this.outputLayersTensorIndices[N],_="".concat(T.name,"_").concat(C,"_").concat(E);S.push(_)}for(var A=0;A<S.length;A++){var R=S[A];Zb(R in n),I.push(n[R])}return ex(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=Qb(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(ux),c=Se(u);try{for(c.s();!(s=c.n()).done;){var l,p=s.value,h=Se(this.nodesByDepth[p]);try{for(h.s();!(l=h.n()).done;){var d,f=l.value,m=f.outboundLayer,v=f.inputTensors,g=f.outputTensors,y=new Array,b=Se(v);try{for(b.s();!(d=b.n()).done;){var x=d.value;x.id in n&&y.push(n[x.id])}}catch(G){b.e(G)}finally{b.f()}if(y.length===v.length){var k={},w=void 0,I=void 0,S=void 0,N=void 0;if(null!=f.callArgs&&(k=f.callArgs),1===y.length){var T=C(y[0],2),E=T[0],_=T[1];null==k.mask&&(k.mask=_),S=tx(m.call(E,k)),N=tx(m.computeMask(E,_)),w=[E],I=[_]}else w=y.map((function(e){return e[0]})),I=y.map((function(e){return e[1]})),null==k.mask&&(k.mask=I),S=tx(m.call(w,k)),N=tx(m.computeMask(w,I));if(m.activityRegularizer)throw new Xb("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var R=g[A],F=S[A],D=N[A];n[R.id]=[F,D]}}}}catch(G){h.e(G)}finally{h.f()}}}catch(G){c.e(G)}finally{c.f()}var M,O=[],L=[],z=[],P=Se(this.outputs);try{for(P.s();!(M=P.n()).done;){var B=M.value;Zb(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=C(n[B.id],2),V=W[0],U=W[1];z.push(V.shape),O.push(V),L.push(U)}}catch(G){P.e(G)}finally{P.f()}return[O,L,z]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=Se(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new Kb("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new Kb("Provide either a layer name or layer index");var n,r=Se(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new Kb("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Mu((function(){var t,r=[],a=Se(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Ie(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=Se(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],h=n.nodeKey(o,l),d={};if(this.containerNodes.has(h)){if(p.callArgs)try{JSON.stringify(p.callArgs),d=p.callArgs}catch(f){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(p.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),d={}}if(p.inboundLayers.length>0){for(var f=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),f.push([v.name,b,y,d])}c.push(f)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(O){i.e(O)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var I=this.inputLayers[w],S=this.inputLayersNodeIndices[w],N=n.nodeKey(I,S);if(this.containerNodes.has(N)){var T=r[N];null==T&&(T=0);var C=this.inputLayersTensorIndices[w];k.push([I.name,T,C])}}t.inputLayers=k;for(var E=[],_=0;_<this.outputLayers.length;_++){var A=this.outputLayers[_],R=this.outputLayersNodeIndices[_],F=n.nodeKey(A,R);if(this.containerNodes.has(F)){var D=r[F];null==D&&(D=0);var M=this.outputLayersTensorIndices[_];E.push([A.name,D,M])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new Kb("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=Se(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Mu((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=Se(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var h=r[c];if(h.inboundNodes.length<=l)return void i(e,t);var d=h.inboundNodes[l];o.push(d.outputTensors[p])}}catch(f){s.e(f)}finally{s.f()}o.length>0&&e.apply(ex(o),n)}function s(e){var a=e.name,o=Uw(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new Kb("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=Se(l);try{for(p.s();!(u=p.n()).done;){s(u.value)}}catch(O){p.e(O)}finally{p.f()}for(;!lx(a);){var h,d=Se(l);try{for(d.s();!(h=d.n()).done;){var f=h.value,m=r[f.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,y=Se(v);try{for(y.s();!(g=y.n()).done;){o(m,g.value)}}catch(O){y.e(O)}finally{y.f()}}}}catch(O){d.e(O)}finally{d.f()}}var b,x=[],k=[],w=Se(t.inputLayers);try{for(w.s();!(b=w.n()).done;){var I=b.value,S=I[0],N=I[1],T=I[2];Zb(S in r);var C=r[S].inboundNodes[N].outputTensors;x.push(C[T])}}catch(O){w.e(O)}finally{w.f()}var E,_=Se(t.outputLayers);try{for(_.s();!(E=_.n()).done;){var A=E.value,R=A[0],F=A[1],D=A[2];Zb(R in r);var M=r[R].inboundNodes[F].outputTensors;k.push(M[D])}}catch(O){_.e(O)}finally{_.f()}return new e({inputs:x,outputs:k,name:c})}}]),n}(Vk);function kI(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function wI(e,t,n,r){return II.apply(this,arguments)}function II(){return II=S(w().mark((function e(t,n,r,a){var i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=Mu((function(){if(1===t.shape.length)return Su(t);if(2===t.shape.length){if(t.shape[1]>1)return rc(t,1);if(1===t.shape[1])return Nc(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Ou(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),dd(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),II.apply(this,arguments)}function SI(e,t){return Ju(e,t)}var NI=32;function TI(e,t){var n,r,a=t;n=a.xs,r=a.ys,Vi.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=CI("input",e.inputNames,n),o=CI("output",e.outputNames,r),s=i[0].shape[0];Vi.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),Vi.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Vi.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Vi.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function CI(e,t,n){if(n instanceof No)return[n];if(Array.isArray(n))return Vi.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=Se(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new Kb("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function EI(e){if(3===e.length)throw new Xb("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function _I(e,t,n){return AI.apply(this,arguments)}function AI(){return AI=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E,_,A,R,F,D,M,O,L,z;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Vi.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Vi.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Vi.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),Vi.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Vi.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(FI(r.validationData)?Vi.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=EI(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),h=Bw(r.callbacks,r.yieldEvery),d=null==r.verbose?1:r.verbose,f=Vw(h,d,r.epochs,null,null,RI(n,r),null,i,p),m=f.callbackList,v=f.history,m.setModel(t),t.history=v,e.next=14,m.onTrainBegin();case 14:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:y=e.sent;case 19:if(!(g<r.epochs)){e.next=88;break}return b={},e.next=23,m.onEpochBegin(g);case 23:if(x=0,k=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:y=e.sent;case 29:if(a&&!(x<r.batchesPerEpoch)){e.next=81;break}return e.next=32,y.next();case 32:if(I=e.sent,!a||!I.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(x," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==I.value){e.next=63;break}return S=TI(t,I.value),N=S.xs,T=S.ys,(C={}).batch=k,C.size=N[0].shape[0],e.next=42,m.onBatchBegin(k,C);case 42:if(E=[],null==r.classWeight){e.next=55;break}_=kI(r.classWeight,t.outputNames),A=0;case 46:if(!(A<_.length)){e.next=55;break}return e.t1=E,e.next=50,wI(T[A],null,_[A]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++A,e.next=46;break;case 55:for(R=N.concat(T).concat(E),F=c(R),Ou(R),D=0;D<l.length;++D)M=l[D],O=F[D],C[M]=O,Lu(O);return e.next=60,m.onBatchEnd(k,C);case 60:Dw(C),k++,x++;case 63:if(!(a?x>=r.batchesPerEpoch:I.done)){e.next=77;break}if(!i){e.next=76;break}if(L=void 0,!FI(r.validationData)){e.next=74;break}return e.t3=tx,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,L=(0,e.t3)(e.t4),e.next=75;break;case 74:L=tx(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?NI:r.validationBatchSize,verbose:0}));case 75:for(z=0;z<t.metricsNames.length;++z)b["val_".concat(t.metricsNames[z])]=L[z];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,m.onEpochEnd(g,b);case 83:if(g++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,m.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])}))),AI.apply(this,arguments)}function RI(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function FI(e){return"function"==typeof e.iterator}function DI(e){return"function"==typeof e.next}function MI(e,t,n){return OI.apply(this,arguments)}function OI(){return OI=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new Xb("Verbose mode is not implemented yet.");case 4:if(Vi.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!DI(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Mu((function(){if(n.value){var e=TI(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Mu((function(){return i(s)}));if(Ou(s),0===c)for(var p=0;p<l.length;++p)o.push(zl(0));for(var h=s[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=Mu((function(){return Ku(o[e],Ju(h,t))})),c>0&&Ou(n)},f=0;f<l.length;++f)d(f);Ou(l),u+=h,++c}return o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(p=0;p<o.length;++p)h=o[p],o[p]=Yu(o[p],u),Ou(h);return e.abrupt("return",ex(o));case 25:case"end":return e.stop()}}),e)}))),OI.apply(this,arguments)}function LI(e){Vi.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function zI(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return jx(e,t,n-t)})):jx(e,t,n-t)}function PI(e,t){return Mu((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return PI(e,t)})):$x(e,"int32"===t.dtype?t:Iu(t,"int32"))}))}function BI(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function WI(e){var t=[];e instanceof No&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(Hx(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function VI(e,t){if(null!=e){var n=[];if(t instanceof No)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof No)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function UI(e){return Array.isArray(e)}function GI(e){return!function(e){return e instanceof No}(e)&&!UI(e)}function HI(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(UI(e)&&e.length>0)o=!0;else if(GI(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new Kb("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(GI(e)){r=[];var u,c=Se(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new Kb('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(UI(e)){if(e.length!==t.length)throw new Kb("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(t.length>1)throw new Kb("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=WI(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var h=r[p];if(h.shape.length!==n[p].length)throw new Kb("Error when checking ".concat(i,": expected ").concat(t[p]," to have ").concat(n[p].length," dimension(s). but got array with shape ").concat(h.shape));for(var d=0;d<n[p].length;++d)if(0!==d||a){var f=h.shape[d],m=n[p][d];if(null!=m&&m>=0&&f!==m)throw new Kb("".concat(i," expected a batch of elements where each example has shape [").concat(n[p].slice(1,n[p].length),"] (i.e.,tensor shape [*,").concat(n[p].slice(1,n[p].length),"]) but the ").concat(i," received an input with ").concat(h.shape[0]," examples, each with shape [").concat(h.shape.slice(1,h.shape.length),"] (tensor shape [").concat(h.shape,"])"))}}return r}function jI(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Kb("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new Kb("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new Kb("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new Kb("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var qI=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).isTraining=!1,r}return we(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Kb("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");hI(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return _v.adagrad(.01)},Adadelta:function(){return _v.adadelta(1,.95,Ux())},Adam:function(){return _v.adam(.001,.9,.999,Ux())},Adamax:function(){return _v.adamax(.002,.9,.999,Ux(),0)},RMSProp:function(){return _v.rmsprop(.001,.9,0,Ux())},SGD:function(){return _v.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Kb("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof fm))throw new Kb("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Kb("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return Zw(e)}))}else{var r=Zw(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new Kb('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=Se(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(Zw(e.loss[s]))}}catch(d){o.e(d)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Rx("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=Se(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(d){i.e(d)}finally{i.f()}return a}(e.metrics,this.outputNames);Rx("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){var r,a,i,o,s=Se(n);try{var u=function(){var n,s=o.value;if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Yw?-1!==["accuracy","acc"].indexOf(s)?a=$w:-1!==["crossentropy","ce"].indexOf(s)&&(a=aI):t.lossFunctions[e]===Xw?-1!==["accuracy","acc"].indexOf(s)?a=iI:-1!==["crossentropy","ce"].indexOf(s)&&(a=sI):-1!==["accuracy","acc"].indexOf(s)?a=eI:-1!==["crossentropy","ce"].indexOf(s)&&(a=oI),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else i=function(e){if("string"==typeof e&&e in uI)return uI[e];if("string"!=typeof e&&null!=e)return e;throw new Kb("Unknown metric ".concat(e))}(s),r=""+cI(s);Rx(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(d){s.e(d)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;LI(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return ex(this.testLoop(o,i,r,n.verbose,n.steps))}finally{VI(a[0],e),VI(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),MI(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new Kb("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new Kb("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new Kb("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new jk;if(e instanceof No&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Kb("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=Se(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new Kb("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(h){u.e(h)}finally{u.f()}}var p=Xk(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=Qb(null,e.length),r=e.length,a=Se(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new Kb("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Mu((function(){var a=t.checkNumSamples(e);if(r)throw new Xb("Verbose predictLoop() is not implemented yet.");for(var i=BI(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){Mu((function(){var r=i[n][0],a=i[n][1],o=zI(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new jk(s);return Xk(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return ex(o.map((function(e){return Ec(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=WI(e);jI(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return LI(r),this.predictLoop(n,r)}finally{VI(n,e)}}},{key:"predictOnBatch",value:function(e){jI(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new qb("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===Xw?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=cx(e.map((function(e){return e.shape[0]})));r.sort();var a=cx(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new Kb("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new Kb("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Vi.arraysEqual(r,a))throw new Kb("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}(e=HI(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=HI(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[Hw,Yw,Kw],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===Kw&&1===i.shape[i.shape.length-1])throw new Kb("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],h=c[l];if(null!=h&&p!==h)throw new Kb("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new Kb("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(f.length>4&&void 0!==f[4])||f[4],o=f.length>5?f[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=C(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}h=kI(a,this.outputNames),p=[],d=0;case 10:if(!(d<h.length)){e.next=19;break}return e.t0=p,e.next=14,wI(l[d],null,h[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Mu((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new Xb("Verbose mode is not implemented yet.");if(null!=i)throw new Xb("steps mode in testLoop() is not implemented yet");for(var u=BI(o,n),c=dd(Vx(0,o)),l=0;l<u.length;++l){var p=u[l][0],h=u[l][1],d=jx(c,p,h-p),f=PI(t,d),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(zl(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=Ku(s[g],Ju(h-p,y))}}for(var b=0;b<s.length;++b)s[b]=Yu(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if($b(e,r)>1){var i=$b(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new jk(t),l=Xk(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var h=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(h=SI(h,i[p]));var d=Mp(h);n.push(d),u=0===p?h:Ku(u,h)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][0],g=e.metricsTensors[f][1];m=Mp(v(a[g],l[g]))}Lu(m),o.push(m)}return u=Mp(u),e.calculateLosses().forEach((function(e){u=Ku(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Mu((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new jk(o),c=Xk(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],h=Mp(p(i[l],c[l]));n=0===l?h:Ku(n,h),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var f=e.metricsTensors[d][0],m=e.metricsTensors[d][1],v=Mp(f(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C.length>2&&void 0!==C[2]?C[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,LI(d=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,d);case 10:if(f=e.sent,a=f[0],i=f[1],h=f[2],m=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=26;break}if(m=!0,2!==r.validationData.length){e.next=18;break}u=r.validationData[0],c=r.validationData[1],e.next=19;break;case 18:throw 3===r.validationData.length?new Xb("validationData including sample weights is not supported yet."):new Kb("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(r.validationData," is invalid."));case 19:return!0,e.next=22,this.standardizeUserData(u,c,null,null,true,d);case 22:g=e.sent,l=g[0],p=g[1],v=l.concat(p),e.next=27;break;case 26:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(m=!0,y=Math.floor(a[0].shape[0]*(1-r.validationSplit)),b=a[0].shape[0],l=zI(a,y,b),o=a,a=zI(a,0,y),p=zI(i,y,b),s=i,i=zI(i,0,y),v=l.concat(p)):null!=r.validationSteps&&(m=!0);case 27:return x=a.concat(i).concat(h),this.checkTrainableWeightsConsistency(),k=this.makeTrainFunction(),I=this.getDedupedMetricsNames(),m?(this.makeTestFunction(),S=this.testFunction,N=I.slice().concat(I.map((function(e){return"val_"+e})))):(S=null,v=[],N=I.slice()),T=Bw(r.callbacks,r.yieldEvery),e.next=34,this.fitLoop(k,x,I,d,r.epochs,r.verbose,T,S,v,r.shuffle,N,r.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,this.isTraining=!1,VI(a,t),VI(i,n),VI(o,t),VI(s,n),VI(l,u),VI(p,c),null!=h&&Ou(h),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,,35,38]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=S(w().mark((function e(t,n,r,a,i,o,s,u,c,l,p,h,d,f){var m,v,g,y,b,x,k,I,S=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==h&&(h=0),m=!1,null!=u&&null!=c&&(m=!0),null==f||(m=!0,null!=d)){e.next=4;break}throw new Kb("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(v=this.checkNumSamples(n,a,d,"steps_per_epoch"))&&(g=Vx(0,v)),null==o&&(o=1),y=Vw(s,o,i,h,v,d,a,m,p),b=y.callbackList,x=y.history,b.setModel(this),this.history=x,e.next=11,b.onTrainBegin();case 11:this.stopTraining_=!1,k=w().mark((function e(){var i,o,s,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.onEpochBegin(I);case 2:if(i={},null==d){e.next=5;break}throw new Xb("stepsPerEpoch mode is not implemented yet.");case 5:if("batch"!==l){e.next=7;break}throw new Xb("batch shuffling is not implemneted yet");case 7:l&&Vi.shuffle(g),o=dd(g),s=BI(v,a),p=w().mark((function e(l){var p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,b.onBatchBegin(l,p);case 3:return Mu((function(){var e=s[l][0],h=s[l][1],d=jx(o,e,h-e);p.batch=l,p.size=h-e;for(var f=PI(n,d),v=t(f),g=0;g<r.length;++g){var y=r[g],b=v[g];p[y]=b,Lu(b)}if(l===s.length-1&&m)for(var x=S.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],I=x[k];Lu(I),i["val_"+w]=I}})),e.next=6,b.onBatchEnd(l,p);case 6:if(Dw(p),!S.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 11:if(!(h<s.length)){e.next=19;break}return e.delegateYield(p(h),"t0",13);case 13:if("break"!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:++h,e.next=11;break;case 19:return o.dispose(),e.next=22,b.onEpochEnd(I,i);case 22:if(!S.stopTraining_){e.next=24;break}return e.abrupt("return","break");case 24:case"end":return e.stop()}}),e)})),I=h;case 14:if(!(I<i)){e.next=22;break}return e.delegateYield(k(),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++I,e.next=14;break;case 22:return e.next=24,b.onTrainEnd();case 24:return e.next=26,this.history.syncData();case 26:return e.abrupt("return",this.history);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,p,h,d,f){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_I(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=Se(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:p=e.sent,s.push(p[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(Ou(o),VI(r[0],t),VI(r[1],n),ex(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=pe(le(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Fu().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Fu().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=nx(this.loss);else if(Array.isArray(this.loss)){var t,n=Se(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return nx(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=nx(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[nx(cI(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return nx(cI(e))}));var e={};for(var t in this.metrics)e[t]=nx(cI(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Uw(gI(e.optimizer_config));if("string"==typeof e.loss)t=rx(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return rx(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=rx(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return rx(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=rx(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=Im.getSaveHandlers(t)).length){e.next=4;break}throw new Kb("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Kb("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Kb("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,Im.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,false),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(bI),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=Im,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,Ie(l)),a.data=Im.concatenateArrayBuffers([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(lI(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){lI(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(xI);qI.className="Model",lm.registerClass(qI);var KI=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(qI);function XI(e,t){return YI.apply(this,arguments)}function YI(){return YI=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=gI(r),i=Uw(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,Im.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=Se(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(p){u.e(p)}finally{u.f()}i.loadWeights(s),Ou(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),YI.apply(this,arguments)}function JI(e,t){return QI.apply(this,arguments)}function QI(){return QI=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=Im.getLoadHandlers(t,n)).length){e.next=6;break}r.push(Im.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new Kb("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",ZI(t,void 0,n));case 10:case"end":return e.stop()}}),e)}))),QI.apply(this,arguments)}function ZI(e,t,n){return $I.apply(this,arguments)}function $I(){return $I=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new Kb("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=Uw(gI(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new Kb("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=eS(a.weightData,a.weightSpecs),p=l.modelWeights,h=l.optimizerWeights,u.loadWeights(p,o),e.t0=null!=u.optimizer&&h.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(h);case 17:Ou(p),Ou(h.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)}))),$I.apply(this,arguments)}function eS(e,t){var n=Im.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}KI.className="Functional",lm.registerClass(KI);var tS=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:bx("sequential_"),null!=e.layers){var a,i=Se(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return ge(r)}return we(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new Kb("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof qI;if(r){if(1!==(t=e).outputs.length)throw new Kb("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new Kb("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Kb("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=Hk({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new Kb("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new Kb("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Uk(this.outputs[0])}this.inboundNodes=[],new Bk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Qb(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Ak(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new qI({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),pe(le(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),pe(le(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new qb("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new qb("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new qb("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new qb("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new Kb("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new Kb("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Kb("Legacy serialization format not supported yet.");r=t}else Vi.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new Xb("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=Se(r);try{for(u.s();!(s=u.n()).done;){var c=Uw(s.value,void 0,a);a&&c.setFastWeightInitDuringBuild(!0),o.add(c)}}catch(l){u.e(l)}finally{u.f()}return o}}]),n}(qI);function nS(e){return new qI(e)}function rS(e){return new tS(e)}function aS(e){return Hk(e)}function iS(e,t){Ww.registerCallbackConstructor(e,t)}tS.className="Sequential",lm.registerClass(tS);var oS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"getConfig",value:function(){return{}}}]),n}(lm.Serializable),sS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new Xb("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return Il(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(oS);sS.className="elu",lm.registerClass(sS);var uS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Hh(e)}}]),n}(oS);uS.className="selu",lm.registerClass(uS);var cS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Oh(e)}}]),n}(oS);cS.className="relu",lm.registerClass(cS);var lS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Mu((function(){return Pp(6,Oh(e))}))}}]),n}(oS);lS.className="relu6",lm.registerClass(lS);var pS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return e}}]),n}(oS);pS.className="linear",lm.registerClass(pS);var hS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Ac(e)}}]),n}(oS);hS.className="sigmoid",lm.registerClass(hS);var dS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){return Mu((function(){var t=Ku(.5,Ju(.2,e));return qc(t,0,1)}))}(e)}}]),n}(oS);dS.className="hardSigmoid",lm.registerClass(dS);var fS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return yp(e)}}]),n}(oS);fS.className="softplus",lm.registerClass(fS);var mS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){return Mu((function(){return Yu(e,Ku(Qu(e),1))}))}(e)}}]),n}(oS);mS.className="softsign",lm.registerClass(mS);var vS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Fc(e)}}]),n}(oS);vS.className="tanh",lm.registerClass(vS);var gS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return td(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(oS);gS.className="softmax",lm.registerClass(gS);var yS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return kp(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(oS);yS.className="logSoftmax",lm.registerClass(yS);var bS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Mu((function(){return Ju(Ac(Ju(e,t)),e)}))}}]),n}(oS);bS.className="swish",lm.registerClass(bS);var xS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Mu((function(){return Ju(e,Fc(yp(e)))}))}}]),n}(oS);function kS(e){return e.getClassName()}function wS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sx(e,lm.SerializationMap.getMap().classNameMap,t,"activation")}function IS(e){if(null==e){var t={className:"linear",config:{}};return wS(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},wS(n)}return e instanceof oS?e:wS(e)}function SS(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}xS.className="mish",lm.registerClass(xS);var NS=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(lm.Serializable),TS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this),SS(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return we(n,[{key:"apply",value:function(e){var t=this;return Mu((function(){var n=Op([1]);return t.hasL1&&(n=Ku(n,Wl(Ju(t.l1,Qu(e))))),t.hasL2&&(n=Ku(n,Wl(Ju(t.l2,ek(e))))),Nc(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(NS);TS.className="L1L2",lm.registerClass(TS);var CS={l1l2:"L1L2"};function ES(e){return ix(e)}function _S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return sx(e,lm.SerializationMap.getMap().classNameMap,t,"regularizer")}function AS(e){return null==e?null:"string"==typeof e?_S({className:e in CS?CS[e]:e,config:{}}):e instanceof NS?e:_S(e)}var RS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return we(n,[{key:"call",value:function(e,t){e=_k(e);var n=Oh(e);return null!=this.maxValue&&(n=qc(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);RS.className="ReLU",lm.registerClass(RS);var FS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return we(n,[{key:"call",value:function(e,t){var n=_k(e);return rp(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);FS.className="LeakyReLU",lm.registerClass(FS);var DS=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Tk(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=AS(e.alphaRegularizer),r.alphaConstraint=uw(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Kb("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return ge(r)}return we(n,[{key:"build",value:function(e){var t=(e=Ak(e)).slice(1);if(null!=this.sharedAxes){var n,r=Se(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Lk({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=_k(e),th(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Nk(this.alphaInitializer),alphaRegularizer:ES(this.alphaRegularizer),alphaConstraint:ow(this.alphaConstraint),sharedAxes:this.sharedAxes},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);DS.className="PReLU",lm.registerClass(DS);var MS=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new Xb("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,ge(r)}return we(n,[{key:"call",value:function(e,t){var n=_k(e);return Il(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);MS.className="ELU",lm.registerClass(MS);var OS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return we(n,[{key:"call",value:function(e,t){var n=_k(e);return Ju(n,Iu(Ql(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);OS.className="ThresholdedReLU",lm.registerClass(OS);var LS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new gS).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return we(n,[{key:"call",value:function(e,t){var n=_k(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);function zS(e,t,n){if("number"==typeof e)return Qb(e,t);if(e.length!==t)throw new Kb("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!zx(a))throw new Kb("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function PS(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function BS(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+Wx([n-t,0]);else{if("same"!==r)throw new Kb("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function WS(e,t){return Mu((function(){return Tx(t),"channelsFirst"===t?Ld(e,[0,2,3,1]):e}))}function VS(e,t){return Mu((function(){return Tx(t),"channelsFirst"===t?Ld(e,[0,2,3,4,1]):e}))}function US(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Mu((function(){if(null==i&&(i="channelsLast"),Tx(i),3!==e.rank&&4!==e.rank)throw new Kb("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Kb("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=WS(e,i);if("causal"===a)throw new Xb("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=qd.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=Ld(u,[0,3,1,2])),u}))}LS.className="Softmax",lm.registerClass(LS);var GS=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,dx(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new Xb("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=zS(r.kernelSize,e,"kernelSize"),a.strides=zS(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Cx(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Tx(a.dataFormat),a.activation=IS(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Tk(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=uw(r.biasConstraint),a.biasRegularizer=AS(r.biasRegularizer),a.activityRegularizer=AS(r.activityRegularizer),a.dilationRate=zS(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new Kb("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new Kb("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new Kb("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return ge(a)}return we(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:kS(this.activation),useBias:this.useBias,biasInitializer:Nk(this.biasInitializer),biasRegularizer:ES(this.biasRegularizer),activityRegularizer:ES(this.activityRegularizer),biasConstraint:ow(this.biasConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(Zb("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!hx(e.kernelSize,"number",1,3))throw new Kb("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Vk),HS=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,dx(a.filters,"filters"),a.kernelInitializer=Tk(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=uw(r.kernelConstraint),a.kernelRegularizer=AS(r.kernelRegularizer),a}return we(n,[{key:"build",value:function(e){e=Ak(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Kb("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:oe({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){e=_k(e);var t,r=null==n.bias?null:n.bias.read(),a=mx(n.activation.getClassName());if(null!=a&&2===n.rank)t=US(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Mu((function(){if(null==i&&(i="channelsLast"),Tx(i),3!==e.shape.length)throw new Kb("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new Kb("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new Kb("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=Ld(e,[0,2,1])),"causal"===a)throw new Xb("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Zc(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=nk(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=US(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new Xb("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Mu((function(){if(null==i&&(i="channelsLast"),Tx(i),4!==e.rank&&5!==e.rank)throw new Kb("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new Kb("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=VS(e,i);if("causal"===a)throw new Xb("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=tl(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=nk(s,n)),"channelsFirst"===i&&(s=Ld(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Ak(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=PS(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Nk(this.kernelInitializer),kernelRegularizer:ES(this.kernelRegularizer),kernelConstraint:ow(this.kernelConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Kb("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(GS),jS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!hx(e.kernelSize,"number",1,2))throw new Kb("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(HS);jS.className="Conv2D",lm.registerClass(jS);var qS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Kb("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(HS);qS.className="Conv3D",lm.registerClass(qS);var KS=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).inputSpec=[new Lk({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new Kb("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return ge(r)}return we(n,[{key:"build",value:function(e){if(4!==(e=Ak(e)).length)throw new Kb("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Kb("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lk({ndim:4,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e);if(4!==t.shape.length)throw new Kb("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],h=n.strides[1],d=[o,BS(s,p,c,n.padding),BS(u,h,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Ld(t,[0,2,3,1]));var f=el(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(f=Ld(f,[0,3,1,2])),null!=n.bias&&(f=nk(f,n.bias.read(),n.dataFormat)),null!=n.activation&&(f=n.activation.apply(f)),f}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Ak(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=BS(a[n],s,i,this.padding),a[r]=BS(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(jS);KS.className="Conv2DTranspose",lm.registerClass(KS);var XS=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).inputSpec=[new Lk({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new Kb("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return ge(r)}return we(n,[{key:"build",value:function(e){if(5!==(e=Ak(e)).length)throw new Kb("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Kb("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lk({ndim:5,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e);if(5!==t.shape.length)throw new Kb("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],h=n.kernelSize[1],d=n.kernelSize[2],f=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,BS(u,f,p,n.padding),BS(c,m,h,n.padding),BS(l,v,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Ld(t,[0,2,3,4,1]));var y=rl(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=Ld(y,[0,4,1,2,3])),null!==n.bias&&(y=nk(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Ak(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=BS(i[n],c,o,this.padding),i[r]=BS(i[r],l,s,this.padding),i[a]=BS(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(qS);XS.className="Conv3DTranspose",lm.registerClass(XS);var YS=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new Kb("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new Kb("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new Kb("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Tk(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=AS(r.depthwiseRegularizer),a.depthwiseConstraint=uw(r.depthwiseConstraint),a.pointwiseInitializer=Tk(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=AS(r.pointwiseRegularizer),a.pointwiseConstraint=uw(r.pointwiseConstraint),ge(a)}return we(n,[{key:"build",value:function(e){if((e=Ak(e)).length<this.rank+2)throw new Kb("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Kb("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Lk({ndim:this.rank+2,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t;if(e=_k(e),1===n.rank)throw new Xb("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Ld(e,[0,2,3,1])),t=jh(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=nk(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Ld(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Nk(this.depthwiseInitializer),e.pointwiseInitializer=Nk(this.pointwiseInitializer),e.depthwiseRegularizer=ES(this.depthwiseRegularizer),e.pointwiseRegularizer=ES(this.pointwiseRegularizer),e.depthwiseConstraint=ow(this.depthwiseConstraint),e.pointwiseConstraint=ow(this.pointwiseConstraint),e}}]),n}(HS);YS.className="SeparableConv";var JS=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,2,e)}return we(n)}(YS);JS.className="SeparableConv2D",lm.registerClass(JS);var QS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!hx(e.kernelSize,"number",1,1))throw new Kb("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(HS);QS.className="Conv1D",lm.registerClass(QS);var ZS=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return we(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(e=_k(e),"channelsLast"===n.dataFormat){var t=Kx(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return Kx(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=Kx(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return Kx(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);ZS.className="Cropping2D",lm.registerClass(ZS);var $S=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Tx(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){px(kx,"InterpolationFormat",e)}(r.interpolation),r}return we(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Ld(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?im.resizeNearestNeighbor(t,[a,i]):im.resizeBilinear(t,[a,i]);return Ld(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?im.resizeNearestNeighbor(t,[s,u]):im.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);$S.className="UpSampling2D",lm.registerClass($S);var eN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Tk(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=uw(e.depthwiseConstraint),r.depthwiseRegularizer=AS(e.depthwiseRegularizer),r}return we(n,[{key:"build",value:function(e){if((e=Ak(e)).length<4)throw new Kb("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Kb("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Mu((function(){null==a&&(a="channelsLast"),Tx(a);var o=WS(e,a);if(4!==e.rank)throw new Kb("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new Kb("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=ll(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=Ld(o,[0,3,1,2])),o}))}(e=_k(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=nk(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Ak(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=PS(t,this.kernelSize[0],this.padding,this.strides[0]),i=PS(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Nk(this.depthwiseInitializer),e.depthwiseRegularizer=ES(this.depthwiseRegularizer),e.depthwiseConstraint=ow(this.depthwiseRegularizer),e}}]),n}(GS);function tN(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Kb("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function nN(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Mu((function(){var u=t.shape.length;if(u<3)throw new Kb("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Vx(2,u));if(t=Ld(t,c),null!=i)throw new Xb("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=Iu(Iu(a,"bool"),"float32")).rank===u-1&&(a=jl(a,-1)),a=Ld(a,c)),r&&(t=zh(t,0),null!=a&&(a=zh(a,0)));var l,p,h=[],d=n,f=t.shape[0],m=Ed(t);null!=a&&(p=Ed(a));for(var v,g=function(t){var n=m[t],r=Mu((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=Mu((function(){var e=p[t],n=xp(qp(e),e),a=Ku(Ju(r[0],e),Ju(d[0],n)),i=d.map((function(t,a){return Ku(Ju(r[1][a],e),Ju(t,n))}));return{output:a,newStates:i}}));l=i.output,d=i.newStates}s&&h.push(l)},y=0;y<f;++y)g(y);return s&&(v=cd(h,1)),[l,v,d]}))}eN.className="DepthwiseConv2D",lm.registerClass(eN);var rN=function(e){ye(n,e);var t=be(n);function n(e){var r,a;if(xe(this,n),r=t.call(this,e),null==e.cell)throw new Kb("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new pN({cells:e.cell}):e.cell).stateSize)throw new Kb("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Lk({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return we(n,[{key:"getStates",value:function(){return null==this.states_?Vx(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Ck(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=Se(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Mu((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new Xb("Constants support is not implemented in RNN yet.");Ck(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Lk({shape:[t,null].concat(Ie(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Vi.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new Kb("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Lk({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Mu((function(){if(!t.stateful)throw new jb("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new Kb("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Op([r,e])})):t.states_=[Op([r,t.cell.stateSize])];else if(null==e)Ou(t.states_),null!=t.keptStates&&(Ou(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Op([r,e])})):t.states_[0]=Op([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Kb("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Ou(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Vi.arraysEqual(i.shape,s))throw new Kb("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Lu(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=tN(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=Se(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Lk({shape:l.shape}))}}catch(m){c.e(m)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof zk){var p=[e].concat(o),h=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=h;var f=pe(le(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=d,f}return pe(le(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=_k(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new Kb("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=nN((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var h=n.returnSequences?l:c;return n.returnState?[h].concat(p):h}))}},{key:"getInitialState",value:function(e){var t=this;return Mu((function(){var n=Op(e.shape);return n=Hx(n=Wl(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Jx(n,[1,e]):n})):t.cell.stateSize>1?[Jx(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Uw(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(Vk);rN.className="RNN",lm.registerClass(rN);var aN=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(Vk),iN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,dx(r.units,"units"),r.activation=IS(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Tk(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Tk(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Tk(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=AS(e.kernelRegularizer),r.recurrentRegularizer=AS(e.recurrentRegularizer),r.biasRegularizer=AS(e.biasRegularizer),r.kernelConstraint=uw(e.kernelConstraint),r.recurrentConstraint=uw(e.recurrentConstraint),r.biasConstraint=uw(e.biasConstraint),r.dropout=Bx([1,Wx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Bx([1,Wx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return we(n,[{key:"build",value:function(e){e=Ak(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(2!==e.length)throw new Kb("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=hN({ones:function(){return qp(e)},rate:n.dropout,training:a,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=hN({ones:function(){return qp(r)},rate:n.recurrentDropout,training:a,dropoutFunc:n.dropoutFunc}));var i,o=n.dropoutMask,s=n.recurrentDropoutMask;i=Zx(null!=o?Ju(e,o):e,n.kernel.read()),null!=n.bias&&(i=nk(i,n.bias.read())),null!=s&&(r=Ju(r,s));var u=Ku(i,Zx(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:kS(this.activation),useBias:this.useBias,kernelInitializer:Nk(this.kernelInitializer),recurrentInitializer:Nk(this.recurrentInitializer),biasInitializer:Nk(this.biasInitializer),kernelRegularizer:ES(this.kernelRegularizer),recurrentRegularizer:ES(this.recurrentRegularizer),biasRegularizer:ES(this.biasRegularizer),activityRegularizer:ES(this.activityRegularizer),kernelConstraint:ow(this.kernelConstraint),recurrentConstraint:ow(this.recurrentConstraint),biasConstraint:ow(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(aN);iN.className="SimpleRNNCell",lm.registerClass(iN);var oN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),e.cell=new iN(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return Mu((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(rN);oN.className="SimpleRNN",lm.registerClass(oN);var sN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Kb("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,dx(r.units,"units"),r.activation=IS(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=IS(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Tk(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Tk(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Tk(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=AS(e.kernelRegularizer),r.recurrentRegularizer=AS(e.recurrentRegularizer),r.biasRegularizer=AS(e.biasRegularizer),r.kernelConstraint=uw(e.kernelConstraint),r.recurrentConstraint=uw(e.recurrentConstraint),r.biasConstraint=uw(e.biasConstraint),r.dropout=Bx([1,Wx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Bx([1,Wx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,ge(r)}return we(n,[{key:"build",value:function(e){var t=(e=Ak(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(2!==e.length)throw new Kb("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=hN({ones:function(){return qp(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=hN({ones:function(){return qp(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ju(e,u[0]));var l=Zx(e,n.kernel.read());n.useBias&&(l=nk(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ju(a,c[0]));var p=n.recurrentKernel.read(),h=C(id(p,[2*n.units,n.units],p.rank-1),2),d=h[0],f=h[1],m=Zx(a,d),v=C(id(l,3,l.rank-1),3),g=v[0],y=v[1],b=v[2],x=C(id(m,2,m.rank-1),2),k=x[0],w=x[1];i=n.recurrentActivation.apply(Ku(g,k)),o=n.recurrentActivation.apply(Ku(y,w));var I=Zx(Ju(o,a),f);s=n.activation.apply(Ku(b,I));var S=Ku(Ju(i,a),Ju(Ku(1,gp(i)),s));return[S,S]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:kS(this.activation),recurrentActivation:kS(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Nk(this.kernelInitializer),recurrentInitializer:Nk(this.recurrentInitializer),biasInitializer:Nk(this.biasInitializer),kernelRegularizer:ES(this.kernelRegularizer),recurrentRegularizer:ES(this.recurrentRegularizer),biasRegularizer:ES(this.biasRegularizer),activityRegularizer:ES(this.activityRegularizer),kernelConstraint:ow(this.kernelConstraint),recurrentConstraint:ow(this.recurrentConstraint),biasConstraint:ow(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(aN);sN.className="GRUCell",lm.registerClass(sN);var uN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new sN(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return Mu((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(rN);uN.className="GRU",lm.registerClass(uN);var cN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,dx(r.units,"units"),r.activation=IS(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=IS(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Tk(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Tk(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Tk(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=AS(e.kernelRegularizer),r.recurrentRegularizer=AS(e.recurrentRegularizer),r.biasRegularizer=AS(e.biasRegularizer),r.kernelConstraint=uw(e.kernelConstraint),r.recurrentConstraint=uw(e.recurrentConstraint),r.biasConstraint=uw(e.biasConstraint),r.dropout=Bx([1,Wx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Bx([1,Wx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return we(n,[{key:"build",value:function(e){var t,n,r=(e=Ak(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new ck).apply([i]),o=a.apply([2*i]);return Yx(Yx(n,r),o)}}]),n}(sk),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new Kb("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=hN({ones:function(){return qp(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=hN({ones:function(){return qp(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ju(e,l[0]));var h=Zx(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ju(a,p[0])),h=Ku(h,Zx(a,n.recurrentKernel.read())),n.useBias&&(h=nk(h,n.bias.read()));var d=C(id(h,4,h.rank-1),4),f=d[0],m=d[1],v=d[2],g=d[3];o=n.recurrentActivation.apply(f),s=n.recurrentActivation.apply(m),u=Ku(Ju(s,i),Ju(o,n.activation.apply(v))),c=n.recurrentActivation.apply(g);var y=Ju(c,n.activation.apply(u));return[y,y,u]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:kS(this.activation),recurrentActivation:kS(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Nk(this.kernelInitializer),recurrentInitializer:Nk(this.recurrentInitializer),biasInitializer:Nk(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ES(this.kernelRegularizer),recurrentRegularizer:ES(this.recurrentRegularizer),biasRegularizer:ES(this.biasRegularizer),activityRegularizer:ES(this.activityRegularizer),kernelConstraint:ow(this.kernelConstraint),recurrentConstraint:ow(this.recurrentConstraint),biasConstraint:ow(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(aN);cN.className="LSTMCell",lm.registerClass(cN);var lN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new cN(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return Mu((function(){null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(rN);lN.className="LSTM",lm.registerClass(lN);var pN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).cells=e.cells,r}return we(n,[{key:"stateSize",get:function(){var e,t=[],n=Se(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Ie(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r,a=e.slice(1),i=[],o=Se(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var h,d=Se(c.slice().reverse());try{for(d.s();!(h=d.n()).done;){var f,m=h.value;(f=a).push.apply(f,Ie(m))}}catch(v){d.e(v)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Ck(e)&&(e=e[0]),this.cells.forEach((function(n,r){Rx("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=Se(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Ie(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.weights))}}catch(a){n.e(a)}finally{n.f()}return Mk(t)}},{key:"setWeights",value:function(e){var t,n=[],r=Se(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}Ok(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=Se(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Uw(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(aN);function hN(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):rk(t(),n)},c=function(){return ak(u,t,a)};return!o||o<=1?Lu(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Lu(e.clone())}))}pN.className="StackedRNNCells",lm.registerClass(pN);var dN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),e.unroll)throw new Xb("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Xb("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Lk({ndim:5})],r}return we(n,[{key:"call",value:function(e,t){var r=this;return Mu((function(){if(null!=r.cell.dropoutMask&&(Ou(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Ou(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new Kb("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Ie(t.slice(2)))),this.returnState&&(t=[t].concat(Ie(Array(2).fill([e[0]].concat(Ie(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Mu((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Op([a[0]].concat(Ie(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Mu((function(){if(!t.stateful)throw new jb("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Ie(a.slice(2)));if(null==r[0])throw new Kb("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Op(i)})):t.states_=[Op(i)];else if(null==e)Ou(t.states_),null!=t.keptStates&&(Ou(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Op(i)})):t.states_[0]=Op(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Kb("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Ou(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Vi.arraysEqual(s.shape,u))throw new Kb("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Lu(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=PS(c,a[0],i,o[0],s[0]),h=PS(l,a[1],i,o[1],s[1]);return[].concat(Ie(e.slice(0,2)),Ie(u?[r,p,h]:[p,h,r]))}}]),n}(rN);dN.className="ConvRNN2D";var fN=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,dx(r.filters,"filters"),r.kernelSize=zS(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return dx(e,"kernelSize")})),r.strides=zS(o||1,2,"strides"),r.strides.forEach((function(e){return dx(e,"strides")})),r.padding=s||"valid",Cx(r.padding),r.dataFormat=u||"channelsLast",Tx(r.dataFormat),r.dilationRate=zS(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return dx(e,"dilationRate")})),r}return we(n,[{key:"build",value:function(e){var t;e=Ak(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Kb("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return Xx([s.apply([u]),Lp([u]),s.apply([2*u])])}}]),n}(sk),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(3!==e.length)throw new Kb("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=hN({ones:function(){return qp(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Ju(t[n],e):e},c=u(a,s,0),l=u(a,s,1),p=u(a,s,2),h=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=hN({ones:function(){return qp(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var d=n.recurrentDropoutMask,f=u(i,d,0),m=u(i,d,1),v=u(i,d,2),g=u(i,d,3),y=C(id(n.kernel.read(),4,3),4),b=y[0],x=y[1],k=y[2],w=y[3],I=C(n.useBias?id(n.bias.read(),4):[null,null,null,null],4),S=I[0],N=I[1],T=I[2],E=I[3];c=n.inputConv(c,b,S,n.padding),l=n.inputConv(l,x,N,n.padding),p=n.inputConv(p,k,T,n.padding),h=n.inputConv(h,w,E,n.padding);var _=C(id(n.recurrentKernel.read(),4,3),4),A=_[0],R=_[1],F=_[2],D=_[3];f=n.recurrentConv(f,A),m=n.recurrentConv(m,R),v=n.recurrentConv(v,F),g=n.recurrentConv(g,D);var M=n.recurrentActivation.apply(Ku(c,f)),O=n.recurrentActivation.apply(Ku(l,m)),L=Ku(Ju(O,o),Ju(M,n.activation.apply(Ku(p,v)))),z=Ju(n.recurrentActivation.apply(Ku(h,g)),n.activation.apply(L));return[z,z,L]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t=(e.units,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=Qc(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?nk(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Qc(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(cN);fN.className="ConvLSTM2DCell",lm.registerClass(fN);var mN=function(e){ye(n,e);var t=be(n);function n(e){xe(this,n);var r=new fN(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return we(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(dN);mN.className="ConvLSTM2D",lm.registerClass(mN);var vN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return we(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return ak((function(){return rk(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return pe(le(n.prototype),"dispose",this).call(this)}}]),n}(Vk);vN.className="Dropout",lm.registerClass(vN);var gN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return we(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(vN);gN.className="SpatialDropout1D",lm.registerClass(gN);var yN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,dx(r.units,"units"),r.activation=IS(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Tk(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Tk(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=uw(e.kernelConstraint),r.biasConstraint=uw(e.biasConstraint),r.kernelRegularizer=AS(e.kernelRegularizer),r.biasRegularizer=AS(e.biasRegularizer),r.activityRegularizer=AS(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],ge(r)}return we(n,[{key:"build",value:function(e){var t=(e=Ak(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:oe({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Ak(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r,a=_k(e),i=mx(n.activation.getClassName());return null!=i?r=Zx(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=Zx(a,n.kernel.read()),null!=n.bias&&(r=nk(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:kS(this.activation),useBias:this.useBias,kernelInitializer:Nk(this.kernelInitializer),biasInitializer:Nk(this.biasInitializer),kernelRegularizer:ES(this.kernelRegularizer),biasRegularizer:ES(this.biasRegularizer),activityRegularizer:ES(this.activityRegularizer),kernelConstraint:ow(this.kernelConstraint),biasConstraint:ow(this.biasConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);yN.className="Dense",lm.registerClass(yN);var bN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return we(n,[{key:"computeOutputShape",value:function(e){var t,n=Se((e=Ak(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new Kb('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],Px(e,1)]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=Ld(r,a)}return function(e){if(e.rank<=1)throw new Kb("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],Px(e.shape,1)];return Nc(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);bN.className="Flatten",lm.registerClass(bN);var xN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=IS(e.activation),r}return we(n,[{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:kS(this.activation)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);xN.className="Activation",lm.registerClass(xN);var kN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return we(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return function(e,t){return Mu((function(){if(2!==e.shape.length)throw new Kb("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return Jx(Hx(e,1),[1,t,1])}))}(e=_k(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);kN.className="RepeatVector",lm.registerClass(kN);var wN=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return we(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new Kb("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=Px(e);if(null!==i){if(0===a||u%a!==0)throw new Kb(n);r[i]=u/a}else if(u!==a)throw new Kb(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return Nc(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);wN.className="Reshape",lm.registerClass(wN);var IN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=Vx(1,e.dims.length+1);if(!Vi.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Lk({ndim:r.dims.length+1})],ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){var t=(e=Ak(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Ld(_k(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);IN.className="Permute",lm.registerClass(IN);var SN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=_k(e);return nc(Hp(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e),a=nc(Hp(r,n.maskValue),-1,!0);return Ju(r,Iu(a,r.dtype))}))}}]),n}(Vk);SN.className="Masking",lm.registerClass(SN);var NN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(tx(e.inputLength))}return r.inputDim=e.inputDim,dx(r.inputDim,"inputDim"),r.outputDim=e.outputDim,dx(r.outputDim,"outputDim"),r.embeddingsInitializer=Tk(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=AS(e.embeddingsRegularizer),r.activityRegularizer=AS(e.activityRegularizer),r.embeddingsConstraint=uw(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,ge(r)}return we(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Mu((function(){return n.maskZero?(e=_k(e),Hp(e,bl(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Ak(e),null==this.inputLength)return[].concat(Ie(e),[this.outputDim]);var t=tx(this.inputLength);if(t.length!==e.length-1)throw new Kb('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new Kb('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Ie(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);"int32"!==r.dtype&&(r=Gx(r,"int32"));var a=$x(n.embeddings.read(),Nc(r,[r.size]));return Nc(a,Ak(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Nk(this.embeddingsInitializer),embeddingsRegularizer:ES(this.embeddingsRegularizer),activityRegularizer:ES(this.activityRegularizer),embeddingsConstraint:ow(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);NN.className="Embedding",lm.registerClass(NN);var TN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return we(n,[{key:"mergeFunction",value:function(e){throw new Xb}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new Kb("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ak(e)]),e.length<2)throw new Kb("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=cx(n)).length>1)throw new Kb("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===cx(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=Wx(r),o=Se(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=Hx(s,1);t.push(s)}}catch(T){o.e(T)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,h=Se(e);try{for(h.s();!(l=h.n()).done;){var d=l.value,f=d.rank;if(null==f){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),y=Nc(d,[v].concat(Px(m.slice(1))));y=Ld(y,[1,0]),y=Nc(y,g),t.push(y),p=!0}else if(f>1){var b=Vx(1,f).concat([0]);t.push(Ld(d,b)),p=!0}else t.push(d)}}catch(T){h.e(T)}finally{h.f()}var x=n.mergeFunction(t),k=x.rank;if(p)if(null==k){var w=x.shape,I=w[w.length-1],S=[I].concat(w.slice(0,w.length-1));x=Nc(Ld(Nc(x,[-1,I]),[1,0]),S)}else if(k>1){var N=[k-1].concat(Vx(0,k-1));x=Ld(x,N)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=Se(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=cx(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Mu((function(){if(null==t)return null;if(!Array.isArray(t))throw new Kb("`mask` should be an Array");if(!Array.isArray(e))throw new Kb("`inputs` should be an Array");if(t.length!==e.length)throw new Kb("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;t=t.map((function(e){return null==e?e:jl(e,0)}));for(var n=t[0],r=1;r<t.length-1;++r)n=Ip(n,t[r]);return n}))}}]),n}(Vk),CN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return Mu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ku(t,e[n]);return t}))}}]),n}(TN);CN.className="Add",lm.registerClass(CN);var EN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return Mu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ju(t,e[n]);return t}))}}]),n}(TN);EN.className="Multiply",lm.registerClass(EN);var _N=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return Mu((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ku(t,e[n]);return Ju(1/e.length,t)}))}}]),n}(TN);_N.className="Average",lm.registerClass(_N);var AN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return Mu((function(){for(var t=e[0],n=1;n<e.length;++n)t=Dp(t,e[n]);return t}))}}]),n}(TN);AN.className="Maximum",lm.registerClass(AN);var RN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return Mu((function(){for(var t=e[0],n=1;n<e.length;++n)t=Pp(t,e[n]);return t}))}}]),n}(TN);RN.className="Minimum",lm.registerClass(RN);var FN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return we(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Kb("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=Se(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(p){r.e(p)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=Se(a);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(Vi.arraysEqual(l,o)){u=!0;break}}}catch(p){c.e(p)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new Kb("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Mu((function(){return Xx(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Kb("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=Se(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new Kb("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Kb("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Kb("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return Mu((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(Iu(qp(e[i]),"bool")):t[i].rank<e[i].rank?a.push(jl(t[i],-1)):a.push(t[i]);var o=Ec(a,n.axis);return tc(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(TN);function DN(e,t){for(;e<0;)e+=t;return e}FN.className="Concatenate",lm.registerClass(FN);var MN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return we(n,[{key:"build",value:function(e){Vi.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Xb("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new Kb("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new Kb("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return DN(t,e[n].shape.length)})):[DN(this.axes,n.shape.length),DN(this.axes,r.shape.length)],this.normalize&&(n=Gw(n,t[0]),r=Gw(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Xb("batchDot is not implemented for tensors of 4D or higher rank yet");if(Vi.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),Vi.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new Xb("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Mu((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=Nc(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=Nc(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Wl(Ju(e,t),i[0]):Wl(Ju(Ld(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,h=i[1]===t.shape.length-1;o=_c(e,t,p,h)}if(n>0){for(var d,f=[],m=d=r>a?r+a-3:r-1;m<d+n;++m)f.push(m);o=ud(o,f)}return 1===o.shape.length&&(o=jl(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[DN(this.axes,e.length),DN(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Vi.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Xb("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(TN);MN.className="Dot",lm.registerClass(MN);var ON=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);return ak((function(){return Ku(Qx(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Vk);ON.className="GaussianNoise",lm.registerClass(ON);var LN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t);var r=_k(e);return n.rate>0&&n.rate<1?ak((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Ju(r,Qx(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(Vk);LN.className="GaussianDropout",lm.registerClass(LN);var zN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return we(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||_k(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Mu((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return ak((function(){var t=_k(e),a=-1.7580993408473766,i=Zl(Ah(r),n.rate);i=Gx(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=Ku(Ju(t,i),Ju(Ku(i,-1),a));return Ku(Ju(u,o),s)}),(function(){return _k(e)}),t.training||!1)}return e}))}}]),n}(Vk);function PN(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=zc(e,t,n,r,a,o);else if(3===e.rank)i=Pc(e,t,n,r,a,o);else{if(4!==e.rank)throw new Xb("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Bc(e,t,n,r,a,o)}return i}function BN(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Vi.arraysEqual(r.slice().sort(),Vx(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Mu((function(){var i=Vp(e,r),o=i.mean,s=i.variance;return[PN(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Mu((function(){var i,o=Vp(e,r),s=o.mean,u=o.variance,c=[],l=Se(Vx(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch(v){l.e(v)}finally{l.f()}var h=Nc(s,c),d=Nc(u,c),f=null==t?null:Nc(t,c),m=null==n?null:Nc(n,c);return[PN(e,h,d,m,f,a),s,u]}))}(e,t,n,r,a)}zN.className="AlphaDropout",lm.registerClass(zN);var WN=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Tk(e.betaInitializer||"zeros"),r.gammaInitializer=Tk(e.gammaInitializer||"ones"),r.movingMeanInitializer=Tk(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Tk(e.movingVarianceInitializer||"ones"),r.betaConstraint=uw(e.betaConstraint),r.gammaConstraint=uw(e.gammaConstraint),r.betaRegularizer=AS(e.betaRegularizer),r.gammaRegularizer=AS(e.gammaRegularizer),r}return we(n,[{key:"build",value:function(e){e=Ak(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Kb("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new Lk({ndim:e.length,axes:oe({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r=null!=t.training&&t.training,a=_k(e),i=a.shape,o=i.length,s=Vx(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=Qb(1,o);c[u]=i[u];var l=s.slice();l.sort();var p=!Vi.arraysEqual(l,Vx(0,o).slice(0,o-1));if(!r)return function(){if(p){var e=Nc(n.movingMean.read(),c),t=Nc(n.movingVariance.read(),c),r=n.center?Nc(n.beta.read(),c):null,i=n.scale?Nc(n.gamma.read(),c):null;return PN(a,e,t,r,i,n.epsilon)}return PN(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=C(BN(a,n.gamma.read(),n.beta.read(),s,n.epsilon),3),d=h[0],f=h[1],m=h[2],v=function(e,t,n){Mu((function(){var r=1-n,a=e.read(),i=Ju(xp(a,t),r);e.write(xp(a,i))}))};return v(n.movingMean,f,n.momentum),v(n.movingVariance,m,n.momentum),d}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Nk(this.betaInitializer),gammaInitializer:Nk(this.gammaInitializer),movingMeanInitializer:Nk(this.movingMeanInitializer),movingVarianceInitializer:Nk(this.movingVarianceInitializer),betaRegularizer:ES(this.betaRegularizer),gammaRegularizer:ES(this.gammaRegularizer),betaConstraint:ow(this.betaConstraint),gammaConstraint:ow(this.gammaConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);WN.className="BatchNormalization",lm.registerClass(WN);var VN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=Se(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Tk(e.betaInitializer||"zeros"),r.gammaInitializer=Tk(e.gammaInitializer||"ones"),r.betaRegularizer=AS(e.betaRegularizer),r.gammaRegularizer=AS(e.gammaRegularizer),r.supportsMasking=!0,ge(r)}return we(n,[{key:"build",value:function(e){var t=(e=Ak(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=Se(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==cx(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=_k(e),a=r.shape,i=a.length;return Mu((function(){var e,t=Vp(r,n.axis,!0),o=t.mean,s=t.variance,u=Qb(1,i),c=Se(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(g){c.e(g)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?Nc(e,u):e},h=n.scale?p(n.gamma.read()):null,d=n.center?p(n.beta.read()):null,f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=Kl(o,f),s=Kl(s,f),null!=h&&(h=Kl(h,m)),null!=d&&(d=Kl(d,m)),PN(r,o,s,d,h,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Nk(this.betaInitializer),gammaInitializer:Nk(this.gammaInitializer),betaRegularizer:ES(this.betaRegularizer),gammaRegularizer:ES(this.gammaRegularizer)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);VN.className="LayerNormalization",lm.registerClass(VN);var UN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Kb("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Kb("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new Kb("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Lk({ndim:4})],ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Ak(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return function(e,t,n){return Mu((function(){if(4!==e.rank)throw new Kb("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new Kb("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new Kb("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Xp(e,r)}))}(_k(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);function GN(e,t,n,r,a,i){return Mu((function(){Tx(a),Ex(i),Cx(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=WS(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Ap(e,t,n,s):Tc(e,t,n,s),"channelsFirst"===a&&(o=Ld(o,[0,3,1,2])),o}))}function HN(e,t,n,r,a,i){return Mu((function(){Tx(a),Ex(i),Cx(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=VS(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Rp(e,t,n,s):Cc(e,t,n,s),"channelsFirst"===a&&(o=Ld(o,[0,4,1,2,3])),o}))}UN.className="ZeroPadding2D",lm.registerClass(UN);var jN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Kb("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(dx(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Kb("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return dx(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Cx(r.padding),r.inputSpec=[new Lk({ndim:3})],ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){var t=PS((e=Ak(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){n.invokeCallHook(e,t),e=Hx(_k(e),2);var r=n.poolingFunction(_k(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return ud(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk),qN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),GN(e,t,n,r,a,"max")}}]),n}(jN);qN.className="MaxPooling1D",lm.registerClass(qN);var KN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),GN(e,t,n,r,a,"avg")}}]),n}(jN);KN.className="AveragePooling1D",lm.registerClass(KN);var XN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Kb("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return dx(r.poolSize,"poolSize"),dx(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Tx(r.dataFormat),Cx(r.padding),r.inputSpec=[new Lk({ndim:4})],ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){e=Ak(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=PS(t,this.poolSize[0],this.padding,this.strides[0]),n=PS(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return n.invokeCallHook(e,t),n.poolingFunction(_k(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk),YN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),GN(e,t,n,r,a,"max")}}]),n}(XN);YN.className="MaxPooling2D",lm.registerClass(YN);var JN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),GN(e,t,n,r,a,"avg")}}]),n}(XN);JN.className="AveragePooling2D",lm.registerClass(JN);var QN=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Kb("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return dx(r.poolSize,"poolSize"),dx(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Tx(r.dataFormat),Cx(r.padding),r.inputSpec=[new Lk({ndim:5})],ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){e=Ak(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=PS(t,this.poolSize[0],this.padding,this.strides[0]),n=PS(n,this.poolSize[1],this.padding,this.strides[1]),r=PS(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return n.invokeCallHook(e,t),n.poolingFunction(_k(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk),ZN=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),HN(e,t,n,r,a,"max")}}]),n}(QN);ZN.className="MaxPooling3D",lm.registerClass(ZN);var $N=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Tx(a),Cx(r),HN(e,t,n,r,a,"avg")}}]),n}(QN);$N.className="AveragePooling3D",lm.registerClass($N);var eT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).inputSpec=[new Lk({ndim:3})],r}return we(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new Xb}}]),n}(Vk),tT=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e||{})}return we(n,[{key:"call",value:function(e,t){return Mu((function(){var t=_k(e);return Mp(t,1)}))}}]),n}(eT);tT.className="GlobalAveragePooling1D",lm.registerClass(tT);var nT=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e||{})}return we(n,[{key:"call",value:function(e,t){return Mu((function(){var t=_k(e);return Ml(t,1)}))}}]),n}(eT);nT.className="GlobalMaxPooling1D",lm.registerClass(nT);var rT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Tx(r.dataFormat),r.inputSpec=[new Lk({ndim:4})],r}return we(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new Xb}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk),aT=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e);return"channelsLast"===n.dataFormat?Mp(t,[1,2]):Mp(t,[2,3])}))}}]),n}(rT);aT.className="GlobalAveragePooling2D",lm.registerClass(aT);var iT=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e);return"channelsLast"===n.dataFormat?Ml(t,[1,2]):Ml(t,[2,3])}))}}]),n}(rT);iT.className="GlobalMaxPooling2D",lm.registerClass(iT);var oT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).layer=e.layer,r}return we(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Uw(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(Vk),sT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return we(n,[{key:"build",value:function(e){if((e=Ak(e)).length<3)throw new Kb("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),pe(le(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Ak(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return nN((function(e,r){return[_k(n.layer.call(e,t)),[]]}),e=_k(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(oT);sT.className="TimeDistributed",lm.registerClass(sT);var uT=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Uw(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=Uw(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,function(e){px(Sx,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new Xb("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return we(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState&&(r=a.slice(1)),t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):ex(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=tN(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return pe(le(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new Kb("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Ie(r));var c=r.map((function(e){return new Lk({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Ie(c))}if(null!=a)throw new Xb("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof zk,p=0,h=o;p<h.length;p++){if(h[p]instanceof zk!==l)throw new Kb("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var v=pe(le(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return pe(le(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=zh(a,1)),"concat"===n.mergeMode?o=Xx([r,a]):"sum"===n.mergeMode?o=Ku(r,a):"ave"===n.mergeMode?o=Ju(.5,Ku(r,a)):"mul"===n.mergeMode?o=Ju(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Rx(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Rx(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Uw(t.layer);if(delete t.layer,null!=t.numConstants)throw new Xb("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(oT);uT.className="Bidirectional",lm.registerClass(uT);var cT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return we(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Mu((function(){return"float32"!==(e=_k(e)).dtype&&(e=Gx(e,"float32")),Ku(Ju(e,n.scale),n.offset)}))}}]),n}(Vk);cT.className="Rescaling",lm.registerClass(cT);var lT=im.resizeBilinear,pT=im.cropAndResize,hT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return we(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return Mu((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],p=[];3===e.rank?(c=!0,u=cd([e])):u=e;for(var h=0;h<u.shape[0];h++)p.push(l);var d=ps(p,[p.length,4]),f=Fh(0,p.length,1,"int32"),m=pT(u,d,f,[r,a],"nearest");return Gx(c?_k(Ed(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return Mu((function(){return Gx(lT(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&(0===(u=Math.floor((o-n.width)/2))&&(u=1)),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Ak(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(Vk);hT.className="CenterCrop",lm.registerClass(hT);var dT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return we(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=Ak(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var r;if("int32"!==(e=_k(e)).dtype&&(e=Gx(e,"int32")),"undefined"!=typeof t.countWeights){if("count"!==n.outputMode)throw new Kb("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=_k(t.countWeights)}var a=Ml(e),i=Ol(e),o=Ql(n.numTokens,a).bufferSync().get(0),s=Zl(i,0).bufferSync().get(0);if(!o||!s)throw new Kb("Input values must be between 0 < values <= numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=_k(e);if("int32"!==a.dtype&&(a=Gx(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=jl(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=jl(a,-1)),a.rank>2)throw new Kb("When outputMode is not int, maximum output rank is 2 Received outputMode ".concat(t," and input shape ").concat(i," which would result in output rank ").concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=ul(u,"undefined"!=typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return Ju(o,r);throw new Kb("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(Vk);dT.className="CategoryEncoding",lm.registerClass(dT);var fT=new Set(["bilinear","nearest"]),mT=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!fT.has(e.interpolation))throw new Kb("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=!!e.cropToAspectRatio,ge(r)}return we(n,[{key:"computeOutputShape",value:function(e){var t=(e=Ak(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return im.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return im.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat(Ie(fT)," are supported"))}))}}]),n}(Vk);mT.className="Resizing",lm.registerClass(mT);var vT=function(){function e(t){xe(this,e),this.seed=t}return we(e,[{key:"next",value:function(){if(void 0!==this.seed)return this.seed++}}]),e}();vT.className="RandomSeed";var gT=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).randomGenerator=new vT(e.seed),r}return we(n,[{key:"getConfig",value:function(){var e={seed:this.randomGenerator.seed},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Vk);gT.className="BaseRandomLayer";var yT=new Set(["bilinear","nearest"]),bT=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),r=t.call(this,e);var a=e.factor,i=e.interpolation,o=void 0===i?"bilinear":i;if(r.factor=a,Array.isArray(r.factor)&&2===r.factor.length)r.widthLower=r.factor[0],r.widthUpper=r.factor[1];else{if(Array.isArray(r.factor)||!(r.factor>0))throw new Kb("Invalid factor: ".concat(r.factor,". Must be positive number or tuple of 2 numbers"));r.widthLower=-r.factor,r.widthUpper=r.factor}if(r.widthLower<-1||r.widthUpper<-1)throw new Kb("factor must have values larger than -1. Got: ".concat(r.factor));if(r.widthUpper<r.widthLower)throw new Kb("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(r.widthUpper,".\n        Got lower bound: ").concat(r.widthLower,"\n      "));if(o){if(!yT.has(o))throw new Kb("Invalid interpolation parameter: ".concat(o," is not implemented"));r.interpolation=o}return r}return we(n,[{key:"getConfig",value:function(){var e={factor:this.factor,interpolation:this.interpolation},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Ak(e))[2];return[this.imgHeight,-1,t]}},{key:"call",value:function(e,t){var n=this;return Mu((function(){var t=_k(e);n.imgHeight=t.shape[t.shape.length-3];var r=t.shape[t.shape.length-2];n.widthFactor=Ah([1],1+n.widthLower,1+n.widthUpper,"float32",n.randomGenerator.next());var a=n.widthFactor.dataSync()[0]*r;a=Math.round(a);var i=[n.imgHeight,a];switch(n.interpolation){case"bilinear":return im.resizeBilinear(e,i);case"nearest":return im.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(n.interpolation,"\n          but only ").concat(Ie(yT)," are supported"))}}))}}]),n}(gT);function xT(e){return new Gk(e)}function kT(e){return new MS(e)}function wT(e){return new RS(e)}function IT(e){return new FS(e)}function ST(e){return new DS(e)}function NT(e){return new LS(e)}function TT(e){return new OS(e)}function CT(e){return new QS(e)}function ET(e){return new jS(e)}function _T(e){return new KS(e)}function AT(e){return new qS(e)}function RT(e){return new XS(e)}function FT(e){return new JS(e)}function DT(e){return new ZS(e)}function MT(e){return new $S(e)}function OT(e){return new eN(e)}function LT(e){return new xN(e)}function zT(e){return new yN(e)}function PT(e){return new vN(e)}function BT(e){return new gN(e)}function WT(e){return new bN(e)}function VT(e){return new kN(e)}function UT(e){return new wN(e)}function GT(e){return new IN(e)}function HT(e){return new NN(e)}function jT(e){return new CN(e)}function qT(e){return new _N(e)}function KT(e){return new FN(e)}function XT(e){return new AN(e)}function YT(e){return new RN(e)}function JT(e){return new EN(e)}function QT(e){return new MN(e)}function ZT(e){return new WN(e)}function $T(e){return new VN(e)}function eC(e){return new UN(e)}function tC(e){return new KN(e)}function nC(e){return tC(e)}function rC(e){return tC(e)}function aC(e){return new JN(e)}function iC(e){return aC(e)}function oC(e){return aC(e)}function sC(e){return new $N(e)}function uC(e){return sC(e)}function cC(e){return sC(e)}function lC(e){return new tT(e)}function pC(e){return new aT(e)}function hC(e){return new nT(e)}function dC(e){return new iT(e)}function fC(e){return new qN(e)}function mC(e){return new YN(e)}function vC(e){return new ZN(e)}function gC(e){return new uN(e)}function yC(e){return new sN(e)}function bC(e){return new lN(e)}function xC(e){return new cN(e)}function kC(e){return new oN(e)}function wC(e){return new iN(e)}function IC(e){return new mN(e)}function SC(e){return new fN(e)}function NC(e){return new rN(e)}function TC(e){return new pN(e)}function CC(e){return new uT(e)}function EC(e){return new sT(e)}bT.className="RandomWidth",lm.registerClass(bT);var _C=hC,AC=dC,RC=fC,FC=mC;function DC(e){return new ON(e)}function MC(e){return new LN(e)}function OC(e){return new zN(e)}function LC(e){return new SN(e)}function zC(e){return new cT(e)}function PC(e){return new hT(e)}function BC(e){return new mT(e)}function WC(e){return new dT(e)}function VC(e){return new bT(e)}var UC={};function GC(e,t){return $w(e,t)}function HC(e,t){return aI(e,t)}function jC(e,t){return iI(e,t)}function qC(e,t){return eI(e,t)}function KC(e,t){return oI(e,t)}function XC(e,t){return nI(e,t)}function YC(e,t){return rI(e,t)}function JC(e,t){return Jw(e,t)}function QC(e,t){return jw(e,t)}function ZC(e,t){return qw(e,t)}function $C(e,t){return qw(e,t)}function eE(e,t){return qw(e,t)}function tE(e,t){return Hw(e,t)}function nE(e,t){return Hw(e,t)}function rE(e,t){return Hw(e,t)}Le(UC,{MAPE:function(){return $C},MSE:function(){return nE},binaryAccuracy:function(){return GC},binaryCrossentropy:function(){return HC},categoricalAccuracy:function(){return qC},categoricalCrossentropy:function(){return KC},cosineProximity:function(){return JC},mape:function(){return eE},meanAbsoluteError:function(){return QC},meanAbsolutePercentageError:function(){return ZC},meanSquaredError:function(){return tE},mse:function(){return rE},precision:function(){return XC},recall:function(){return YC},sparseCategoricalAccuracy:function(){return jC}});var aE={};Le(aE,{modelFromJSON:function(){return XI}});var iE={};function oE(e){return new TS(e)}function sE(e){return function(e){return SS(e),new TS({l1:null!=e?e.l1:null,l2:0})}(e)}function uE(e){return function(e){return SS(e),new TS({l2:null!=e?e.l2:null,l1:0})}(e)}Le(iE,{l1:function(){return sE},l1l2:function(){return oE},l2:function(){return uE}});var cE=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.apply(this,arguments)).model=null,e}return we(n,[{key:"setModel",value:function(e){if(!(e instanceof qI))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(Mw);function lE(e,t){return e<t}function pE(e,t){return e>t}var hE=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new Xb("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=lE:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=pE:r.monitorFunc=lE,r.monitorFunc===lE&&(r.minDelta*=-1),ge(r)}return we(n,[{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===lE?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rw(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(cE);var dE,fE,mE={earlyStopping:function(e){return new hE(e)}};on().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(dE||(dE={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(fE||(fE={}));var vE={};function gE(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};vE[e]=n}function yE(e){return vE[e]}function bE(e){delete vE[e]}function xE(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd,u=o<0?t.inputNames.length+o:o;if("tensor"===i.type)return kE(t.inputNames[u],n,r,a);if("tensors"===i.type){var c=t.inputs.slice(o,s);return t.inputNames.slice(o,s).filter((function(e,t){var n;return"NoOp"!==(null===(n=c[t])||void 0===n?void 0:n.op)})).map((function(e){return kE(e,n,r,a)}))}var l=kE(t.inputNames[u],n,r,a),p=l.dataSync();return"number"===i.type?p[0]:Vi.toNestedArray(l.shape,p)}var h=t.attrParams[e];return h&&h.value}function kE(e,t,n,r){var a=C(NE(e,n),2),i=a[0],o=a[1];if(null!=r){var s=r.getHashTableHandleByName(i);if(null!=s)return s}var u=n.currentContextIds.find((function(e){return!!t[SE(i,e)]}));return void 0!==u?t[SE(i,u)][o]:void 0}function wE(e,t,n){return t[SE(e,n.currentContextId)]}function IE(e,t){var n=C(NE(e,t),3),r=n[0],a=n[1],i=n[2];return[SE(r,t&&t.currentContextId),a,i]}function SE(e,t){return t?"".concat(e,"-").concat(t):e}function NE(e,t){if(""===e)return["",0,void 0];var n=null!=t&&null!=t.parseNodeNameCache;if(n){var r=t.parseNodeNameCache.get(e);if(null!=r)return r}var a,i=e.split(":");if(1===i.length)a=[e,0,void 0];else{var o=i[0],s=3===i.length?i[1]:void 0;a=[o,Number(i[i.length-1]),s]}return n&&t.parseNodeNameCache.set(e,a),a}function TE(e,t,n){var r=xE("pad",e,t,n);if("explicit"===r){r=xE("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function CE(e){return e.kept?e:Su(e)}var EE={};Le(EE,{json:function(){return _E}});var _E=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],AE={};Le(AE,{json:function(){return RE}});var RE=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],FE={};Le(FE,{json:function(){return DE}});var DE=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],ME={};Le(ME,{json:function(){return OE}});var OE=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],LE={};Le(LE,{json:function(){return zE}});var zE=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],PE={};Le(PE,{json:function(){return BE}});var BE=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],WE={};Le(WE,{json:function(){return VE}});var VE=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],UE={};Le(UE,{json:function(){return GE}});var GE=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],HE={};Le(HE,{json:function(){return jE}});var jE=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],qE={};Le(qE,{json:function(){return KE}});var KE=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],XE={};Le(XE,{json:function(){return YE}});var YE=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],JE={};Le(JE,{json:function(){return QE}});var QE=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],ZE={};Le(ZE,{json:function(){return $E}});var $E=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],e_={};Le(e_,{json:function(){return t_}});var t_=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],n_={};Le(n_,{json:function(){return r_}});var r_=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],a_={};Le(a_,{json:function(){return i_}});var i_=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],o_={};Le(o_,{json:function(){return s_}});var s_=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],u_={};Le(u_,{json:function(){return c_}});var c_=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],l_={};Le(l_,{json:function(){return p_}});var p_=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],h_=function(){function e(){var t;xe(this,e);var n=[EE,AE,FE,ME,LE,PE,WE,UE,HE,qE,XE,JE,ZE,e_,n_,a_,o_,u_,l_],r=(t=[]).concat.apply(t,Ie(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return we(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var h=Object.keys(s);h.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=C(IE(e),3),a=r[0],i=r[2],o=s[a];if(null!=o.outputs){var u=o.outputs.indexOf(i);if(-1!==u){var c="".concat(a,":").concat(u);t.inputNames[n]=c}}t.inputs.push(o),o.children.push(t)}))})),0===Object.keys(p).length?h.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=C(IE(e),1)[0],n=s[t];null!=n&&(n.signatureKey=p[e],c.push(n))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=C(IE(e),1)[0],n=s[t];n&&(n.signatureKey=l[e],u.push(n))})):u=a;var d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var f={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:d};return o.length>0&&(f.initNodes=o),f}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=yE(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=f_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=f_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=S_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=S_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=v_(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=v_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=I_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=I_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=m_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=m_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=T_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=T_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=w_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=w_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=N_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=N_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=b_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=b_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=x_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=x_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=y_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=y_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=C(IE(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:g_(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=C(IE(e),3),i=r[0],o=r[2],s=a[i];if(null!=s.outputs){var u=s.outputs.indexOf(o);if(-1!==u){var c="".concat(i,":").concat(u);t.inputNames[n]=c}}t.inputs.push(s),s.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=C(IE(s[e.name]),2),n=t[0],r=t[1],i=a[n];null!=i&&(i.defaultOutput=r,o.push(i))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function d_(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=on().global;if("undefined"!=typeof t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function f_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?d_(a.s,r):n}function m_(e,t,n){var r=e[t];return r?r.b:n}function v_(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function g_(e){switch("string"==typeof e&&(e=dE[e]),e){case dE.DT_FLOAT:case dE.DT_HALF:return"float32";case dE.DT_INT32:case dE.DT_INT64:case dE.DT_INT8:case dE.DT_UINT8:return"int32";case dE.DT_BOOL:return"bool";case dE.DT_DOUBLE:return"float32";case dE.DT_STRING:return"string";default:return null}}function y_(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function b_(e,t,n){var r=e[t];return r&&r.type?g_(r.type):n}function x_(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return g_(e)})):n}function k_(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function w_(e,t,n){var r=e[t];return r&&r.shape?k_(r.shape):n}function I_(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function S_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return d_(e,r)})):n}function N_(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return k_(e)})):n}function T_(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var C_=function(){function e(t,n,r){var a=this;xe(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return we(e,[{key:"getInput",value:function(e){return kE(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return kE(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return v_(this.node.rawAttrs,e,t);if(null!=n.s)return f_(this.node.rawAttrs,e,t);if(null!=n.b)return m_(this.node.rawAttrs,e,t);if(null!=n.shape)return w_(this.node.rawAttrs,e,t);if(null!=n.type)return b_(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return I_(this.node.rawAttrs,e,t);if(null!=n.list.s)return S_(this.node.rawAttrs,e,t);if(null!=n.list.shape)return N_(this.node.rawAttrs,e,t);if(null!=n.list.b)return T_(this.node.rawAttrs,e,t);if(null!=n.list.type)return x_(this.node.rawAttrs,e,t)}return t}}]),e}(),E_={};Le(E_,{OP_SCOPE_SUFFIX:function(){return ss},abs:function(){return Qu},acos:function(){return Zu},acosh:function(){return $u},add:function(){return Ku},addN:function(){return ec},all:function(){return tc},any:function(){return nc},argMax:function(){return rc},argMin:function(){return ac},asin:function(){return ic},asinh:function(){return oc},atan:function(){return sc},atan2:function(){return uc},atanh:function(){return cc},avgPool:function(){return Tc},avgPool3d:function(){return Cc},basicLSTMCell:function(){return Dc},batchNorm:function(){return Lc},batchNorm2d:function(){return zc},batchNorm3d:function(){return Pc},batchNorm4d:function(){return Bc},batchToSpaceND:function(){return Mc},bincount:function(){return Wc},bitwiseAnd:function(){return Vc},booleanMaskAsync:function(){return Od},broadcastArgs:function(){return Uc},broadcastTo:function(){return Gc},buffer:function(){return wu},cast:function(){return Iu},ceil:function(){return Hc},clipByValue:function(){return qc},clone:function(){return Su},complex:function(){return cs},concat:function(){return Ec},concat1d:function(){return Kc},concat2d:function(){return Xc},concat3d:function(){return Yc},concat4d:function(){return Jc},conv1d:function(){return Zc},conv2d:function(){return Qc},conv2dTranspose:function(){return el},conv3d:function(){return tl},conv3dTranspose:function(){return rl},cos:function(){return al},cosh:function(){return il},cosineWindow:function(){return Gd},cumprod:function(){return ol},cumsum:function(){return sl},denseBincount:function(){return ul},depthToSpace:function(){return cl},depthwiseConv2d:function(){return ll},diag:function(){return pl},dilation2d:function(){return hl},div:function(){return Yu},divNoNan:function(){return xl},dot:function(){return kl},dropout:function(){return Vd},einsum:function(){return wl},elu:function(){return Il},enclosingPowerOfTwo:function(){return Ud},ensureShape:function(){return Sl},equal:function(){return gl},erf:function(){return Nl},euclideanNorm:function(){return Gl},exp:function(){return Hl},expandDims:function(){return jl},expm1:function(){return ql},eye:function(){return Xl},fft:function(){return nd},fill:function(){return jc},floor:function(){return Yl},floorDiv:function(){return Xu},fused:function(){return qd},gather:function(){return Jl},gatherND:function(){return Wd},greater:function(){return Ql},greaterEqual:function(){return Zl},ifft:function(){return rd},imag:function(){return $l},image:function(){return im},inTopKAsync:function(){return jd},irfft:function(){return ad},isFinite:function(){return ep},isInf:function(){return tp},isNaN:function(){return np},leakyRelu:function(){return rp},less:function(){return ap},lessEqual:function(){return ip},linalg:function(){return om},linspace:function(){return op},localResponseNormalization:function(){return sp},log:function(){return up},log1p:function(){return cp},logSigmoid:function(){return bp},logSoftmax:function(){return kp},logSumExp:function(){return wp},logicalAnd:function(){return Ip},logicalNot:function(){return Sp},logicalOr:function(){return Np},logicalXor:function(){return Tp},losses:function(){return sm},lowerBound:function(){return _p},matMul:function(){return _c},max:function(){return Ml},maxPool:function(){return Ap},maxPool3d:function(){return Rp},maxPoolWithArgmax:function(){return Fp},maximum:function(){return Dp},mean:function(){return Mp},meshgrid:function(){return zp},min:function(){return Ol},minimum:function(){return Pp},mirrorPad:function(){return Bp},mod:function(){return Wp},moments:function(){return Vp},movingAverage:function(){return zd},mul:function(){return Ju},multiRNNCell:function(){return Up},multinomial:function(){return Gp},neg:function(){return gp},norm:function(){return Ul},notEqual:function(){return Hp},oneHot:function(){return jp},ones:function(){return Lp},onesLike:function(){return qp},op:function(){return us},outerProduct:function(){return Kp},pad:function(){return Xp},pad1d:function(){return Yp},pad2d:function(){return Jp},pad3d:function(){return Qp},pad4d:function(){return Zp},pool:function(){return eh},pow:function(){return Ll},prelu:function(){return th},print:function(){return Nu},prod:function(){return nh},raggedGather:function(){return rh},raggedRange:function(){return ah},raggedTensorToTensor:function(){return ih},rand:function(){return oh},randomGamma:function(){return Ch},randomNormal:function(){return Eh},randomStandardNormal:function(){return _h},randomUniform:function(){return Ah},randomUniformInt:function(){return Rh},range:function(){return Fh},real:function(){return Dh},reciprocal:function(){return Mh},relu:function(){return Oh},relu6:function(){return Lh},reshape:function(){return Nc},reverse:function(){return zh},reverse1d:function(){return Ph},reverse2d:function(){return Bh},reverse3d:function(){return Wh},reverse4d:function(){return Vh},rfft:function(){return od},round:function(){return Uh},rsqrt:function(){return Gh},scalar:function(){return zl},scatterND:function(){return Pd},searchSorted:function(){return Ep},selu:function(){return Hh},separableConv2d:function(){return jh},setdiff1dAsync:function(){return Kh},sigmoid:function(){return Ac},sign:function(){return Xh},signal:function(){return am},sin:function(){return Yh},sinh:function(){return Jh},slice:function(){return Rc},slice1d:function(){return Qh},slice2d:function(){return Zh},slice3d:function(){return $h},slice4d:function(){return ed},softmax:function(){return td},softplus:function(){return yp},spaceToBatchND:function(){return $p},sparse:function(){return um},sparseToDense:function(){return Bd},spectral:function(){return rm},split:function(){return id},sqrt:function(){return Pl},square:function(){return Bl},squaredDifference:function(){return sd},squeeze:function(){return ud},stack:function(){return cd},step:function(){return ld},stridedSlice:function(){return pd},string:function(){return cm},sub:function(){return xp},sum:function(){return Wl},tan:function(){return hd},tanh:function(){return Fc},tensor:function(){return ps},tensor1d:function(){return dd},tensor2d:function(){return fd},tensor3d:function(){return md},tensor4d:function(){return vd},tensor5d:function(){return gd},tensor6d:function(){return yd},tensorScatterUpdate:function(){return Id},tile:function(){return Kl},topk:function(){return Sd},transpose:function(){return Ld},truncatedNormal:function(){return Nd},unique:function(){return Td},unsortedSegmentSum:function(){return Cd},unstack:function(){return Ed},upperBound:function(){return _d},variable:function(){return Ad},where:function(){return yl},whereAsync:function(){return Dd},zeros:function(){return Op},zerosLike:function(){return bl}});function __(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Vi.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Vi.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function A_(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function R_(e,t,n){var r=F_(e,n),a=!A_(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=F_(e.shape,r)})),!A_(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function F_(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var D_=function(){function e(t,n,r,a,i,o,s){xe(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=zl(0),Lu(this.idTensor)}return we(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),__(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Lu(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return ps([],[0].concat(this.elementShape));var r=this.readMany(e);return __(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),cd(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return ps([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return __(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Ec(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Ie(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Ed(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];Mu((function(){t=Nc(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=Nc(Rc(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),M_=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;xe(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));__(n,e.shape,"TensorList shape mismatch: "),Lu(e)})),this.idTensor=zl(0),this.maxNumElements=a,Lu(this.idTensor)}return we(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(Ie(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));__(e,this.elementShape,"TensorList shape mismatch: ");var a=R_(this.elementShape,this.tensors,e);return Mu((function(){var e=n.tensors.map((function(e){return Nc(e,a)}));return cd(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=R_(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,__(r.shape,e,"TensorList shape mismatch: "),Nc(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(__(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Lu(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));__(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=R_(this.elementShape,this.tensors,t);return Nc(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));__(this.elementShape,t.shape,"TensorList shape mismatch: "),Lu(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));__(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=R_(this.elementShape,this.tensors,n);return 0===e.length?ps([],[0].concat(a)):Mu((function(){var t=e.map((function(e){return Nc(r.tensors[e],a)}));return cd(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));__(this.elementShape,t,"TensorList shape mismatch: ");var r=R_(this.elementShape,this.tensors,t);return 0===this.size()?ps([],[0].concat(r)):Mu((function(){var e=n.tensors.map((function(e){return Nc(e,r)}));return Ec(e,0)}))}}]),e}();function O_(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));__(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=Ed(e);return new M_(a,t,r)}function L_(e,t,n,r){return new M_([],e,t,r)}function z_(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,Ie(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new M_([],n,e.dtype,r),o=Ed(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function P_(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=F_(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Mu((function(){var n=[];e=Nc(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=Nc(Rc(e,u,c),i)}return e.dispose(),n})),u=new M_([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var B_=function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E,_,A,R,F,D,M,O,L,z,P,B,W,V,U,G,H,j,q,K,X,Y,J,Q,Z,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,he,de,fe,me,ve,ge,ye,be,xe,ke,we,Ie,Se,Ne,Te,Ce,Ee,_e,Ae,Re,Fe,De,Me,Oe,Le,ze,Pe,Be,We,Ve,Ue,Ge,He,je,qe,Ke,Xe,Ye,Je,Qe,Ze,$e;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?30:"Switch"===e.t0?32:"Merge"===e.t0?42:"Enter"===e.t0?47:"Exit"===e.t0?49:"NextIteration"===e.t0?51:"TensorArrayV3"===e.t0?53:"TensorArrayWriteV3"===e.t0?55:"TensorArrayReadV3"===e.t0?57:"TensorArrayGatherV3"===e.t0?59:"TensorArrayScatterV3"===e.t0?61:"TensorArrayConcatV3"===e.t0?63:"TensorArraySplitV3"===e.t0?65:"TensorArraySizeV3"===e.t0?67:"TensorArrayCloseV3"===e.t0?69:"TensorListSetItem"===e.t0?71:"TensorListGetItem"===e.t0?73:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?75:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?77:"TensorListGather"===e.t0?81:"TensorListStack"===e.t0?83:"TensorListFromTensor"===e.t0?85:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?87:"TensorListPushBack"===e.t0?89:"TensorListPopBack"===e.t0?91:"TensorListSplit"===e.t0?93:"TensorListLength"===e.t0?95:"TensorListResize"===e.t0?97:99;break;case 3:return a=xE("thenBranch",t,n,r),i=xE("elseBranch",t,n,r),o=xE("cond",t,n,r),s=xE("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return u=xE("body",t,n,r),c=xE("cond",t,n,r),l=xE("args",t,n,r),e.next=17,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 17:return p=e.sent,h=l.map((function(e){return e.id})),e.next=21,p[0].data();case 21:d=e.sent,p.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&e.dispose()})),f=l,m=w().mark((function e(){var t,n,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f,e.next=3,r.functionMap[u].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 3:return f=e.sent,n=f.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:d=e.sent,a.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 25:if(!d[0]){e.next=29;break}return e.delegateYield(m(),"t2",27);case 27:e.next=25;break;case 29:return e.abrupt("return",f);case 30:return v=xE("pred",t,n,r),e.abrupt("return",[CE(v)]);case 32:return g=xE("pred",t,n,r),(y=xE("data",t,n,r)).kept||(y=CE(y)),e.next=36,g.data();case 36:if(!e.sent[0]){e.next=40;break}e.t3=[void 0,y],e.next=41;break;case 40:e.t3=[y,void 0];case 41:return e.abrupt("return",e.t3);case 42:if(b=t.inputNames.find((function(e){return void 0!==kE(e,n,r)})),!b){e.next=46;break}return x=kE(b,n,r),e.abrupt("return",[CE(x)]);case 46:return e.abrupt("return");case 47:return k=xE("frameName",t,n,r),I=xE("tensor",t,n,r),e.abrupt("return",(r.enterFrame(k),[CE(I)]));case 49:return S=xE("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[CE(S)]));case 51:return N=xE("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[CE(N)]));case 53:return T=xE("size",t,n,r),C=xE("dtype",t,n,r),E=xE("elementShape",t,n,r),_=xE("dynamicSize",t,n,r),A=xE("clearAfterRead",t,n,r),R=xE("identicalElementShapes",t,n,r),F=xE("name",t,n,r),D=new D_(F,C,T,E,R,_,A),e.abrupt("return",(r.addTensorArray(D),[D.idTensor,zl(1)]));case 55:return M=xE("tensorArrayId",t,n,r),O=xE("index",t,n,r),L=xE("tensor",t,n,r),z=r.getTensorArray(M.id),e.abrupt("return",(z.write(O,L),[z.idTensor]));case 57:return P=xE("tensorArrayId",t,n,r),B=xE("index",t,n,r),e.abrupt("return",[r.getTensorArray(P.id).read(B)]);case 59:return W=xE("tensorArrayId",t,n,r),V=xE("indices",t,n,r),U=xE("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(W.id).gather(V,U)]);case 61:return G=xE("tensorArrayId",t,n,r),H=xE("indices",t,n,r),j=xE("tensor",t,n,r),q=r.getTensorArray(G.id),e.abrupt("return",(q.scatter(H,j),[q.idTensor]));case 63:return K=xE("tensorArrayId",t,n,r),X=r.getTensorArray(K.id),Y=xE("dtype",t,n,r),e.abrupt("return",[X.concat(Y)]);case 65:return J=xE("tensorArrayId",t,n,r),Q=xE("tensor",t,n,r),Z=xE("lengths",t,n,r),$=r.getTensorArray(J.id),e.abrupt("return",($.split(Z,Q),[$.idTensor]));case 67:return ee=xE("tensorArrayId",t,n,r),te=r.getTensorArray(ee.id),e.abrupt("return",[zl(te.size(),"int32")]);case 69:return ne=xE("tensorArrayId",t,n,r),re=r.getTensorArray(ne.id),e.abrupt("return",(re.clearAndClose(),[re.idTensor]));case 71:return ae=xE("tensorListId",t,n,r),ie=xE("index",t,n,r),oe=xE("tensor",t,n,r),se=r.getTensorList(ae.id),e.abrupt("return",(se.setItem(ie,oe),[se.idTensor]));case 73:return ue=xE("tensorListId",t,n,r),ce=xE("index",t,n,r),le=xE("elementShape",t,n,r),pe=xE("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).getItem(ce,le,pe)]);case 75:return he=xE("indices",t,n,r),de=xE("tensor",t,n,r),fe=xE("elementShape",t,n,r),me=xE("numElements",t,n,r),ve=z_(de,he,fe,me),e.abrupt("return",(r.addTensorList(ve),[ve.idTensor]));case 77:return ge=xE("elementShape",t,n,r),ye=xE("elementDType",t,n,r),be="TensorListReserve"===t.op?"numElements":"maxNumElements",xe=xE(be,t,n,r),ke="TensorListReserve"===t.op?-1:xe,we=L_(ge,ye,0,ke),e.abrupt("return",(r.addTensorList(we),[we.idTensor]));case 81:return Ie=xE("tensorListId",t,n,r),Se=xE("indices",t,n,r),Ne=xE("elementShape",t,n,r),Te=xE("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ie.id).gather(Se,Te,Ne)]);case 83:return Ce=xE("tensorListId",t,n,r),Ee=xE("elementShape",t,n,r),_e=xE("elementDType",t,n,r),Ae=xE("numElements",t,n,r),e.abrupt("return",[r.getTensorList(Ce.id).stack(Ee,_e,Ae)]);case 85:return Re=xE("tensor",t,n,r),Fe=xE("elementShape",t,n,r),De=xE("elementDType",t,n,r),Me=O_(Re,Fe,De),e.abrupt("return",(r.addTensorList(Me),[Me.idTensor]));case 87:return Oe=xE("tensorListId",t,n,r),Le=r.getTensorList(Oe.id),ze=xE("dtype",t,n,r),Pe=xE("elementShape",t,n,r),e.abrupt("return",[Le.concat(ze,Pe)]);case 89:return Be=xE("tensorListId",t,n,r),We=xE("tensor",t,n,r),Ve=r.getTensorList(Be.id),e.abrupt("return",(Ve.pushBack(We),[Ve.idTensor]));case 91:return Ue=xE("tensorListId",t,n,r),Ge=xE("elementShape",t,n,r),He=xE("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ue.id).popBack(Ge,He)]);case 93:return je=xE("tensor",t,n,r),qe=xE("elementShape",t,n,r),Ke=xE("lengths",t,n,r),Xe=P_(je,Ke,qe),e.abrupt("return",(r.addTensorList(Xe),[Xe.idTensor]));case 95:return Ye=xE("tensorListId",t,n,r),Je=r.getTensorList(Ye.id),e.abrupt("return",[zl(Je.size(),"int32")]);case 97:return Qe=xE("tensorListId",t,n,r),Ze=xE("size",t,n,r),$e=r.getTensorList(Qe.id).resize(Ze),e.abrupt("return",(r.addTensorList($e),[$e.idTensor]));case 99:throw TypeError("Node type ".concat(t.op," is not implemented"));case 100:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function W_(e,t,n){var r=C(xE("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s=!o,u="prelu"===i,c="fusedbatchnorm"===a,l=xE("numArgs",e,t,n);if(o){if(u&&2!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&1!==l)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var p=xE("strides",e,t,n),h=TE(e,t,n),d=xE("dataFormat",e,t,n).toUpperCase(),f=xE("dilations",e,t,n),m=C(xE("args",e,t,n),2),v=m[0],g=m[1];return s&&(g=v,v=void 0),{stride:p,pad:h,dataFormat:d,dilations:f,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:xE("leakyreluAlpha",e,t,n)}}function V_(e,t,n){return{boxes:xE("boxes",e,t,n),scores:xE("scores",e,t,n),maxOutputSize:xE("maxOutputSize",e,t,n),iouThreshold:xE("iouThreshold",e,t,n),scoreThreshold:xE("scoreThreshold",e,t,n),softNmsSigma:xE("softNmsSigma",e,t,n)}}var U_=function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E,_,A,R=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=R.length>4&&void 0!==R[4]?R[4]:E_,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=V_(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,p=o.scoreThreshold,h=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,p,h);case 13:return d=e.sent,e.abrupt("return",[d.selectedIndices,d.selectedScores]);case 15:return f=V_(t,n,r),m=f.boxes,v=f.scores,g=f.maxOutputSize,y=f.iouThreshold,b=f.scoreThreshold,x=xE("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(m,v,g,y,b,x);case 24:return k=e.sent,e.abrupt("return",[k.selectedIndices,k.validOutputs]);case 26:return I=V_(t,n,r),S=I.boxes,N=I.scores,T=I.maxOutputSize,C=I.iouThreshold,E=I.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(S,N,T,C,E);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return _=i.cast(xE("condition",t,n,r),"bool"),e.next=34,i.whereAsync(_);case 34:return e.t2=e.sent,A=[e.t2],e.abrupt("return",(_.dispose(),A));case 37:return e.abrupt("return",i.setdiff1dAsync(xE("x",t,n,r),xE("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),G_=function(){function e(t,n){xe(this,e),this.keyDType=t,this.valueDType=n,this.handle=zl(0),this.tensorMap=new Map,Lu(this.handle)}return we(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return zl(this.size(),"int32")}},{key:"import",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),Mu((function(){var e=Ed(n),t=r.length,i=e.length;Vi.assert(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Lu(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Mu((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return cd(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),H_=function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f,m;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"InitializeTable"===e.t0||"InitializeTableV2"===e.t0||"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?13:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?18:20;break;case 3:if(null==(i=a.getHashTableHandleByName(t.name))){e.next=6;break}return e.abrupt("return",[i]);case 6:return o=xE("keyDType",t,n,r),s=xE("valueDType",t,n,r),u=new G_(o,s),e.abrupt("return",(a.addHashTable(t.name,u),[u.handle]));case 8:return c=xE("tableHandle",t,n,r,a),l=xE("keys",t,n,r),p=xE("values",t,n,r),e.next=11,a.getHashTableById(c.id).import(l,p);case 11:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 13:return h=xE("tableHandle",t,n,r,a),d=xE("keys",t,n,r),f=xE("defaultValue",t,n,r),e.next=16,a.getHashTableById(h.id).find(d,f);case 16:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 18:return m=xE("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(m.id).tensorSize()]);case 20:throw TypeError("Node type ".concat(t.op," is not implemented"));case 21:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();function j_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mu,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(xE("a",e,t,n),xE("b",e,t,n))];case"AddN":return[r.addN(xE("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(xE("a",e,t,n),xE("b",e,t,n))];case"Mul":return[r.mul(xE("a",e,t,n),xE("b",e,t,n))];case"RealDiv":case"Div":return[r.div(xE("a",e,t,n),xE("b",e,t,n))];case"DivNoNan":return[r.divNoNan(xE("a",e,t,n),xE("b",e,t,n))];case"FloorDiv":return[r.floorDiv(xE("a",e,t,n),xE("b",e,t,n))];case"Sub":return[r.sub(xE("a",e,t,n),xE("b",e,t,n))];case"Minimum":return[r.minimum(xE("a",e,t,n),xE("b",e,t,n))];case"Maximum":return[r.maximum(xE("a",e,t,n),xE("b",e,t,n))];case"Pow":return[r.pow(xE("a",e,t,n),xE("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(xE("a",e,t,n),xE("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(xE("x",e,t,n))];case"Acos":return[r.acos(xE("x",e,t,n))];case"Acosh":return[r.acosh(xE("x",e,t,n))];case"Asin":return[r.asin(xE("x",e,t,n))];case"Asinh":return[r.asinh(xE("x",e,t,n))];case"Atan":return[r.atan(xE("x",e,t,n))];case"Atan2":return[r.atan2(xE("x",e,t,n),xE("y",e,t,n))];case"Atanh":return[r.atanh(xE("x",e,t,n))];case"Ceil":return[r.ceil(xE("x",e,t,n))];case"Complex":return[r.complex(xE("real",e,t,n),xE("imag",e,t,n))];case"Cos":return[r.cos(xE("x",e,t,n))];case"Cosh":return[r.cosh(xE("x",e,t,n))];case"Elu":return[r.elu(xE("x",e,t,n))];case"Erf":return[r.erf(xE("x",e,t,n))];case"Exp":return[r.exp(xE("x",e,t,n))];case"Expm1":return[r.expm1(xE("x",e,t,n))];case"Floor":return[r.floor(xE("x",e,t,n))];case"Log":return[r.log(xE("x",e,t,n))];case"Log1p":return[r.log1p(xE("x",e,t,n))];case"Imag":return[r.imag(xE("x",e,t,n))];case"Neg":return[r.neg(xE("x",e,t,n))];case"Reciprocal":return[r.reciprocal(xE("x",e,t,n))];case"Real":return[r.real(xE("x",e,t,n))];case"Relu":return[r.relu(xE("x",e,t,n))];case"Round":return[r.round(xE("x",e,t,n))];case"Selu":return[r.selu(xE("x",e,t,n))];case"Sigmoid":return[r.sigmoid(xE("x",e,t,n))];case"Sin":return[r.sin(xE("x",e,t,n))];case"Sign":return[r.sign(xE("x",e,t,n))];case"Sinh":return[r.sinh(xE("x",e,t,n))];case"Softplus":return[r.softplus(xE("x",e,t,n))];case"Sqrt":return[r.sqrt(xE("x",e,t,n))];case"Square":return[r.square(xE("x",e,t,n))];case"Tanh":return[r.tanh(xE("x",e,t,n))];case"Tan":return[r.tan(xE("x",e,t,n))];case"ClipByValue":return[r.clipByValue(xE("x",e,t,n),xE("clipValueMin",e,t,n),xE("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(xE("x",e,t,n))];case"Rsqrt":return[r.rsqrt(kE(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(xE("x",e,t,n),xE("alpha",e,t,n))];case"Prelu":return[r.prelu(xE("x",e,t,n),xE("alpha",e,t,n))];case"IsNan":return[r.isNaN(kE(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(kE(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(kE(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return B_(e,t,n);case"convolution":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Conv1D":var a=xE("stride",e,t,n),i=xE("pad",e,t,n),o=xE("dataFormat",e,t,n).toUpperCase(),s=xE("dilation",e,t,n);return[r.conv1d(xE("x",e,t,n),xE("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=xE("strides",e,t,n),c=TE(e,t,n),l=xE("dataFormat",e,t,n).toUpperCase(),p=xE("dilations",e,t,n);return[r.conv2d(xE("x",e,t,n),xE("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var h=W_(e,t,n),d=h.stride,f=h.pad,m=h.dataFormat,v=h.dilations,g=h.biasArg,y=h.preluArg,b=h.activationFunc,x=h.leakyreluAlpha;return[r.fused.conv2d({x:xE("x",e,t,n),filter:xE("filter",e,t,n),strides:[d[1],d[2]],pad:f,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=W_(e,t,n),w=k.stride,I=k.pad,S=k.dataFormat,N=k.dilations,T=k.biasArg,C=k.preluArg,E=k.activationFunc,_=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:xE("x",e,t,n),filter:xE("filter",e,t,n),strides:[w[1],w[2]],pad:I,dataFormat:S,dilations:[N[1],N[2]],bias:T,activation:E,preluActivationWeights:C,leakyreluAlpha:_})];case"Conv2DBackpropInput":case"Conv2dTranspose":var A=xE("outputShape",e,t,n),R=xE("strides",e,t,n),F=TE(e,t,n);return[r.conv2dTranspose(xE("x",e,t,n),xE("filter",e,t,n),A,[R[1],R[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=xE("strides",e,t,n),M=TE(e,t,n),O=xE("dilations",e,t,n),L=xE("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(xE("input",e,t,n),xE("filter",e,t,n),[D[1],D[2]],M,L,[O[1],O[2]])];case"Conv3D":var z=xE("strides",e,t,n),P=xE("pad",e,t,n),B=xE("dataFormat",e,t,n).toUpperCase(),W=xE("dilations",e,t,n);return[r.conv3d(xE("x",e,t,n),xE("filter",e,t,n),[z[1],z[2],z[3]],P,B,[W[1],W[2],W[3]])];case"AvgPool":var V=xE("strides",e,t,n),U=xE("pad",e,t,n),G=xE("kernelSize",e,t,n);return[r.avgPool(xE("x",e,t,n),[G[1],G[2]],[V[1],V[2]],U)];case"MaxPool":var H=xE("strides",e,t,n),j=xE("pad",e,t,n),q=xE("kernelSize",e,t,n);return[r.maxPool(xE("x",e,t,n),[q[1],q[2]],[H[1],H[2]],j)];case"MaxPoolWithArgmax":var K=xE("strides",e,t,n),X=xE("pad",e,t,n),Y=xE("kernelSize",e,t,n),J=xE("includeBatchInIndex",e,t,n),Q=r.maxPoolWithArgmax(xE("x",e,t,n),[Y[1],Y[2]],[K[1],K[2]],X,J);return[Q.result,Q.indexes];case"AvgPool3D":var Z=xE("strides",e,t,n),$=xE("pad",e,t,n),ee=xE("kernelSize",e,t,n);return[r.avgPool3d(xE("x",e,t,n),[ee[1],ee[2],ee[3]],[Z[1],Z[2],Z[3]],$)];case"MaxPool3D":var te=xE("strides",e,t,n),ne=xE("pad",e,t,n),re=xE("kernelSize",e,t,n);return[r.maxPool3d(xE("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"Dilation2D":var ae=xE("strides",e,t,n),ie=xE("pad",e,t,n),oe=xE("dilations",e,t,n),se=ae[1],ue=ae[2],ce=oe[1],le=oe[2];return[r.dilation2d(xE("x",e,t,n),xE("filter",e,t,n),[se,ue],ie,[ce,le],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Fill":var a=xE("shape",e,t,n),i=xE("dtype",e,t,n),o=xE("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=xE("start",e,t,n),u=xE("stop",e,t,n),c=xE("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=xE("logits",e,t,n),p=xE("numSamples",e,t,n),h=xE("seed",e,t,n);return[r.multinomial(l,p,h)];case"OneHot":var d=xE("indices",e,t,n),f=xE("depth",e,t,n),m=xE("onValue",e,t,n),v=xE("offValue",e,t,n),g=xE("dtype",e,t,n);return[r.oneHot(d,f,m,v,g)];case"Ones":return[r.ones(xE("shape",e,t,n),xE("dtype",e,t,n))];case"OnesLike":return[r.onesLike(xE("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(xE("shape",e,t,n),xE("dtype",e,t,n),xE("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(xE("shape",e,t,n),xE("minval",e,t,n),xE("maxval",e,t,n),xE("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(xE("shape",e,t,n),xE("minval",e,t,n),xE("maxval",e,t,n),xE("seed",e,t,n))];case"Range":var y=xE("start",e,t,n),b=xE("stop",e,t,n),x=xE("step",e,t,n);return[r.range(y,b,x,xE("dtype",e,t,n))];case"TruncatedNormal":var k=xE("shape",e,t,n),w=xE("mean",e,t,n),I=xE("stdDev",e,t,n),S=xE("seed",e,t,n);return[r.truncatedNormal(k,w,I,xE("dtype",e,t,n),S)];case"Zeros":return[r.zeros(xE("shape",e,t,n),xE("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(xE("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return U_(e,t,n);case"evaluation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"LowerBound":var a=xE("sortedSequence",e,t,n),i=xE("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=xE("x",e,t,n),s=xE("k",e,t,n),u=xE("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=xE("sortedSequence",e,t,n),p=xE("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var h=xE("x",e,t,n),d=r.unique(h);return[d.values,d.indices];case"UniqueV2":var f=xE("x",e,t,n),m=xE("axis",e,t,n),v=r.unique(f,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"ResizeBilinear":var a=xE("images",e,t,n),i=xE("size",e,t,n),o=xE("alignCorners",e,t,n),s=xE("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=xE("images",e,t,n),c=xE("size",e,t,n),l=xE("alignCorners",e,t,n),p=xE("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var h=xE("image",e,t,n),d=xE("boxes",e,t,n),f=xE("boxInd",e,t,n),m=xE("cropSize",e,t,n),v=xE("method",e,t,n),g=xE("extrapolationValue",e,t,n);return[r.image.cropAndResize(h,d,f,m,v,g)];case"ImageProjectiveTransformV3":var y=xE("images",e,t,n),b=xE("transforms",e,t,n),x=xE("outputShape",e,t,n),k=xE("fillValue",e,t,n),w=xE("interpolation",e,t,n),I=xE("fillMode",e,t,n);return[r.image.transform(y,b,w.toLowerCase(),I.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=xE("default",e,t,n);return[kE(e.name,t,n)||a];case"Placeholder":return[kE(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[CE(xE("x",e,t,n))];case"IdentityN":return xE("x",e,t,n).map((function(e){return CE(e)}));case"Shape":return[r.tensor1d(xE("x",e,t,n).shape,"int32")];case"ShapeN":return xE("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(xE("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(xE("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var i=xE("x",e,t,n),o=xE("data",e,t,n),s=xE("message",e,t,n),u=xE("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Equal":return[r.equal(xE("a",e,t,n),xE("b",e,t,n))];case"NotEqual":return[r.notEqual(xE("a",e,t,n),xE("b",e,t,n))];case"Greater":return[r.greater(xE("a",e,t,n),xE("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(xE("a",e,t,n),xE("b",e,t,n))];case"Less":return[r.less(xE("a",e,t,n),xE("b",e,t,n))];case"LessEqual":return[r.lessEqual(xE("a",e,t,n),xE("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(xE("a",e,t,n),xE("b",e,t,n))];case"LogicalNot":return[r.logicalNot(xE("a",e,t,n))];case"LogicalOr":return[r.logicalOr(xE("a",e,t,n),xE("b",e,t,n))];case"Select":case"SelectV2":return[r.where(xE("condition",e,t,n),xE("a",e,t,n),xE("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(xE("a",e,t,n),xE("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(xE("a",e,t,n),xE("b",e,t,n),xE("transposeA",e,t,n),xE("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[xE("equation",e,t,n)].concat(Ie(xE("tensors",e,t,n))))];case"Transpose":return[r.transpose(xE("x",e,t,n),xE("perm",e,t,n))];case"_FusedMatMul":var a=C(xE("fusedOps",e,t,n),2),i=a[0],o=a[1],s="biasadd"===i,u="prelu"===o,c=xE("numArgs",e,t,n),l=xE("leakyreluAlpha",e,t,n);if(s){if(u&&2!==c)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&1!==c)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var p=C(xE("args",e,t,n),2),h=p[0],d=p[1];return[r.fused.matMul({a:xE("a",e,t,n),b:xE("b",e,t,n),transposeA:xE("transposeA",e,t,n),transposeB:xE("transposeB",e,t,n),bias:h,activation:o,preluActivationWeights:d,leakyreluAlpha:l})];case"MatrixBandPart":return[r.linalg.bandPart(xE("a",e,t,n),xE("numLower",e,t,n),xE("numUpper",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(xE("x",e,t,n),xE("axis",e,t,n),xE("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(xE("x",e,t,n),xE("mean",e,t,n),xE("variance",e,t,n),xE("offset",e,t,n),xE("scale",e,t,n),xE("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(xE("x",e,t,n),xE("radius",e,t,n),xE("bias",e,t,n),xE("alpha",e,t,n),xE("beta",e,t,n))];case"Softmax":return[r.softmax(xE("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(xE("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"ragged":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"RaggedGather":var a=r.raggedGather(xE("paramsNestedSplits",e,t,n),xE("paramsDenseValues",e,t,n),xE("indices",e,t,n),xE("outputRaggedRank",e,t,n)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o);case"RaggedRange":var s=r.raggedRange(xE("starts",e,t,n),xE("limits",e,t,n),xE("splits",e,t,n));return[s.rtNestedSplits,s.rtDenseValues];case"RaggedTensorToTensor":return[r.raggedTensorToTensor(xE("shape",e,t,n),xE("values",e,t,n),xE("defaultValue",e,t,n),xE("rowPartitionTensors",e,t,n),xE("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Max":var a=xE("axis",e,t,n),i=xE("keepDims",e,t,n);return[r.max(xE("x",e,t,n),a,i)];case"Mean":var o=xE("axis",e,t,n),s=xE("keepDims",e,t,n);return[r.mean(xE("x",e,t,n),o,s)];case"Min":var u=xE("axis",e,t,n),c=xE("keepDims",e,t,n);return[r.min(xE("x",e,t,n),u,c)];case"Sum":var l=xE("axis",e,t,n),p=xE("keepDims",e,t,n);return[r.sum(xE("x",e,t,n),l,p)];case"All":var h=xE("axis",e,t,n),d=xE("keepDims",e,t,n);return[r.all(xE("x",e,t,n),h,d)];case"Any":var f=xE("axis",e,t,n),m=xE("keepDims",e,t,n);return[r.any(xE("x",e,t,n),f,m)];case"ArgMax":var v=xE("axis",e,t,n);return[r.argMax(xE("x",e,t,n),v)];case"ArgMin":var g=xE("axis",e,t,n);return[r.argMin(xE("x",e,t,n),g)];case"Prod":var y=xE("axis",e,t,n),b=xE("keepDims",e,t,n);return[r.prod(xE("x",e,t,n),y,b)];case"Cumprod":var x=xE("axis",e,t,n),k=xE("exclusive",e,t,n),w=xE("reverse",e,t,n);return[r.cumprod(xE("x",e,t,n),x,k,w)];case"Cumsum":var I=xE("axis",e,t,n),S=xE("exclusive",e,t,n),N=xE("reverse",e,t,n);return[r.cumsum(xE("x",e,t,n),I,S,N)];case"Bincount":var T=xE("x",e,t,n),C=xE("weights",e,t,n),E=xE("size",e,t,n);return[r.bincount(T,C,E)];case"DenseBincount":var _=xE("x",e,t,n),A=xE("weights",e,t,n),R=xE("size",e,t,n),F=xE("binaryOutput",e,t,n);return[r.denseBincount(_,A,R,F)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"ConcatV2":case"Concat":var a=xE("n",e,t,n),i=xE("axis",e,t,n),o=xE("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=xE("x",e,t,n),u=xE("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=xE("axis",e,t,n),l=xE("batchDims",e,t,n),p=xE("x",e,t,n),h=xE("indices",e,t,n);return[r.gather(p,r.cast(h,"int32"),c,l)];case"Reverse":for(var d=xE("dims",e,t,n),f=[],m=0;m<d.length;m++)d[m]&&f.push(m);var v=xE("x",e,t,n);return[r.reverse(v,f)];case"ReverseV2":var g=xE("axis",e,t,n),y=xE("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=xE("begin",e,t,n),x=xE("size",e,t,n);return[r.slice(xE("x",e,t,n),b,x)];case"StridedSlice":var k=xE("begin",e,t,n),w=xE("end",e,t,n),I=xE("strides",e,t,n),S=xE("beginMask",e,t,n),N=xE("endMask",e,t,n),T=xE("ellipsisMask",e,t,n),C=xE("newAxisMask",e,t,n),E=xE("shrinkAxisMask",e,t,n),_=xE("x",e,t,n);return[r.stridedSlice(_,k,w,I,S,N,T,C,E)];case"Pack":return Mu((function(){var a=xE("axis",e,t,n),i=xE("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=Vi.arraysEqual(e.shape,o);if(!t&&!Vi.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var A=xE("axis",e,t,n),R=xE("tensor",e,t,n);return r.unstack(R,A);case"Tile":var F=xE("reps",e,t,n);return[r.tile(xE("x",e,t,n),F)];case"Split":case"SplitV":var D=xE("axis",e,t,n),M=xE("numOrSizeSplits",e,t,n),O=xE("x",e,t,n);return r.split(O,M,D);case"ScatterNd":var L=xE("indices",e,t,n),z=xE("values",e,t,n),P=xE("shape",e,t,n);return[r.scatterND(L,z,P)];case"GatherNd":var B=xE("x",e,t,n),W=xE("indices",e,t,n);return[r.gatherND(B,W)];case"SparseToDense":var V=xE("sparseIndices",e,t,n),U=xE("outputShape",e,t,n),G=xE("sparseValues",e,t,n),H=xE("defaultValue",e,t,n);return[r.sparseToDense(V,G,U,G.dtype===H.dtype?H:r.cast(H,G.dtype))];case"TensorScatterUpdate":var j=xE("indices",e,t,n),q=xE("values",e,t,n),K=xE("tensor",e,t,n);return[r.tensorScatterUpdate(K,j,q)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"sparse":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(xE("indices",e,t,n),xE("values",e,t,n),xE("denseShape",e,t,n),xE("defaultValue",e,t,n));return[a.outputIndices,a.outputValues,a.emptyRowIndicator,a.reverseIndexMap];case"SparseReshape":var i=r.sparse.sparseReshape(xE("inputIndices",e,t,n),xE("inputShape",e,t,n),xE("newShape",e,t,n));return[i.outputIndices,i.outputShape];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(xE("data",e,t,n),xE("indices",e,t,n),xE("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(xE("data",e,t,n),xE("indices",e,t,n),xE("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"FFT":return[r.fft(xE("x",e,t,n))];case"IFFT":return[r.ifft(xE("x",e,t,n))];case"RFFT":return[r.rfft(xE("x",e,t,n))];case"IRFFT":return[r.irfft(xE("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"string":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(xE("input",e,t,n),xE("pattern",e,t,n),xE("rewrite",e,t,n),xE("replaceGlobal",e,t,n))];case"StringNGrams":var a=r.string.stringNGrams(xE("data",e,t,n),xE("dataSplits",e,t,n),xE("separator",e,t,n),xE("nGramWidths",e,t,n),xE("leftPad",e,t,n),xE("rightPad",e,t,n),xE("padWidth",e,t,n),xE("preserveShortSequences",e,t,n));return[a.nGrams,a.nGramsSplits];case"StringSplit":var i=r.string.stringSplit(xE("input",e,t,n),xE("delimiter",e,t,n),xE("skipEmpty",e,t,n));return[i.indices,i.values,i.shape];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(xE("input",e,t,n),xE("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E_;switch(e.op){case"Cast":return[r.cast(xE("x",e,t,n),xE("dtype",e,t,n))];case"ExpandDims":var a=xE("axis",e,t,n);return[r.expandDims(xE("x",e,t,n),a)];case"Squeeze":var i=xE("axis",e,t,n);return[r.squeeze(xE("x",e,t,n),i)];case"Reshape":return[r.reshape(xE("x",e,t,n),xE("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(xE("x",e,t,n),xE("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(xE("x",e,t,n),xE("padding",e,t,n),xE("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(xE("x",e,t,n),xE("padding",e,t,n),xE("constantValue",e,t,n))];case"SpaceToBatchND":var o=xE("blockShape",e,t,n),s=xE("paddings",e,t,n);return[r.spaceToBatchND(xE("x",e,t,n),o,s)];case"BatchToSpaceND":var u=xE("blockShape",e,t,n),c=xE("crops",e,t,n);return[r.batchToSpaceND(xE("x",e,t,n),u,c)];case"DepthToSpace":var l=xE("blockSize",e,t,n),p=xE("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(xE("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(xE("x",e,t,n),xE("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(xE("s0",e,t,n),xE("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return H_(e,t,n,r);case"custom":var i=yE(e.op);if(i&&i.customExecutor)return i.customExecutor(new C_(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Vi.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var q_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4?arguments[4]:void 0;xe(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return we(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function K_(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(e).map((function(e){return NE(e)[0]})));r=r||[];for(var l=new Set(r.map((function(e){return NE(e.name)[0]}))),p=Ie(t);p.length>0;){var h=p.pop();if(($_(h)||eA(h)||tA(h))&&null==o&&(s=(o=h).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(h.name),null==n[h.name]&&!c.has(h.name)&&!l.has(h.name)){if(0===h.inputs.length){i.push(h.name);continue}h.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function X_(e,t){var n=t.usedNodes,r=t.inputs,a=Object.keys(r).map((function(e){return NE(e)[0]})).map((function(t){return e.nodes[t]})),i=e.initNodes||[],o=function(e){return n.has("string"==typeof e?e:e.name)};function s(e){return Ie(new Map(e.map((function(e){return[e.name,e]}))).values())}var u,c=s([].concat(Ie(a),Ie(e.weights),Ie(i))).filter(o),l=s([].concat(Ie(c),Ie(Object.values(e.nodes)))).filter(o),p=new Map(l.map((function(e){return[e.name,e]}))),h={},d=Se(l);try{for(d.s();!(u=d.n()).done;){var f=u.value;h[f.name]=h[f.name]||0;var m,v=Se(f.children);try{for(v.s();!(m=v.n()).done;){var g=m.value;o(g)||(h[g.name]=Number.POSITIVE_INFINITY),h[g.name]=(h[g.name]||0)+1}}catch(T){v.e(T)}finally{v.f()}}}catch(T){d.e(T)}finally{d.f()}for(var y=Object.entries(h).filter((function(e){return 0===C(e,2)[1]})).map((function(e){return C(e,1)[0]})),b=Ie(y);y.length>0;){var x,k=y.pop(),w=Se(p.get(k).children.filter(o));try{for(w.s();!(x=w.n()).done;){var I=x.value;0===--h[I.name]&&(b.push(I.name),y.push(I.name))}}catch(T){w.e(T)}finally{w.f()}}var S=b.map((function(e){return p.get(e)})),N=function(e,t){for(var n=new Map(e.map((function(e){return[e.name,e]}))),r=t.map((function(e){return e.name})),a=new Set(r);r.length>0;){var i,o=r.pop(),s=Se(n.get(o).children);try{for(s.s();!(i=s.n()).done;){var u=i.value;!n.has(u.name)||a.has(u.name)||(a.add(u.name),r.push(u.name))}}catch(T){s.e(T)}finally{s.f()}}return e.filter((function(e){return a.has(e.name)}))}(S,c);return function(e,t){var n,r=new Map(e.map((function(e,t){return[e.name,t]}))),a=new Set(t.map((function(e){return e.name}))),i=function(e){return a.has("string"==typeof e?e:e.name)},o=new Set(e.map((function(e){return e.name}))),s=function(e){return o.has("string"==typeof e?e:e.name)},u=Se(e);try{for(u.s();!(n=u.n()).done;){var c,l=n.value,p=Se(l.children.filter(s));try{for(p.s();!(c=p.n()).done;){var h=c.value;if(!r.has(h.name))throw new Y_("Child ".concat(h.name," of node ").concat(l.name," is unreachable."));if(r.get(l.name)>r.get(h.name))throw new Y_("Node ".concat(l.name," is scheduled to run after its child ").concat(h.name,"."))}}catch(T){p.e(T)}finally{p.f()}if(!i(l)){var d,f=Se(l.inputs);try{for(f.s();!(d=f.n()).done;){var m=d.value;if(!r.has(m.name))throw new Y_("Input ".concat(m.name," of node ").concat(l.name," is unreachable."));if(r.get(m.name)>r.get(l.name))throw new Y_("Node ".concat(l.name," is scheduled to run before its input ").concat(m.name,"."))}}catch(T){f.e(T)}finally{f.f()}}}}catch(T){u.e(T)}finally{u.f()}}(N,c),N}var Y_=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,"NodesExecutionOrderError: ".concat(e))}return we(n)}(ve(Error));var J_=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Q_=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),Z_=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function $_(e){return J_.has(e.op)}function eA(e){return Q_.has(e.op)}function tA(e){return Z_.has(e.op)}var nA=function(){function e(t,n){var r=this;xe(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return we(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Ie(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPARATOR)+"--"+r.join(this.SEPARATOR)}},{key:"compile",value:function(e,t){var n=K_(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}var u=X_(this.graph,n),c=function(e){for(var t=new Map(e.map((function(e,t){return[e.name,t]}))),n=Number.MAX_SAFE_INTEGER,r=e.map((function(e,t){return $_(e)?n:t})),a=function(e){var n=r[t.get(e.name)];return null==n?-1:n},i=e.map((function(e,t){return e.children.map(a).reduce((function(e,t){return Math.max(e,t)}),r[t])})),o=new Map,s=0;s<e.length;++s){var u=i[s];if(u!==n){var c=e[s],l=e[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}(u);return{orderedNodes:u,nodeLiveUntilMap:c}}},{key:"cloneAndKeepTensor",value:function(e){if(null==e)return null;var t=e.clone();return Lu(t),t}},{key:"cloneTensorList",value:function(e){var t=this;return e?e.map((function(e){return t.cloneAndKeepTensor(e)})):null}},{key:"cloneTensorMap",value:function(e){var t=this;return Object.fromEntries(Object.entries(e).map((function(e){var n=C(e,2),r=n[0],a=n[1];return[r,t.cloneTensorList(a)]})))}},{key:"execute",value:function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[NE(e)[0]]})),i=t.map((function(e){return NE(e)[0]})),o=new Set(i),s=i.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(a,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=on().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}var l={},p={};return Mu((function(){var r=new q_(n.weightMap,l,p,n.functionExecutorMap,n.parseNodeNameCache),a=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach((function(t){var i=C(NE(t,r),2),o=i[0],s=[];s[i[1]]=e[t],a[o]=s,n.keepIntermediateTensors&&(n.clonedTensorsMap[o]=n.cloneTensorList(s))}));var i,s=n.getFrozenTensorIds(a),u=c,h=u.orderedNodes,d=u.nodeLiveUntilMap,f=Se(h);try{for(f.s();!(i=f.n()).done;){var m=i.value;if(!a[m.name]){var v=j_(m,a,r,n._resourceManager);if(Vi.isPromise(v))throw new Error("The execution of the op '".concat(m.op,"' returned a promise. Please use model.executeAsync() instead."));a[m.name]=v,n.keepIntermediateTensors&&(n.clonedTensorsMap[m.name]=n.cloneTensorList(v)),n.checkTensorForDisposalWithNodeLiveUntilInfo(m,a,r,s,o,d.get(m.name))}}}catch(g){f.e(g)}finally{f.f()}return null==n.parent&&r.dispose(s),t.map((function(e){return kE(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){if(!$_(t)&&!i.has(e)){var s,u=Se(n[e]);try{for(u.s();!(s=u.n()).done;){var c=s.value;null!=c&&(o[c.id]=(o[c.id]||0)+t.children.length)}}catch(y){u.e(y)}finally{u.f()}var l,p=Se(t.inputs);try{for(p.s();!(l=p.n()).done;){var h=l.value;if(!$_(h)){var d=wE(h.name,n,r);if(null!=d){var f,m=Se(d);try{for(m.s();!(f=m.n()).done;){var v=f.value;if(v&&!v.kept&&!a.has(v.id)){var g=o[v.id];1===g?(v.dispose(),delete o[v.id]):null!=g&&o[v.id]--}}}catch(y){m.e(y)}finally{m.f()}}}}}catch(y){p.e(y)}finally{p.f()}}}},{key:"checkTensorForDisposalWithNodeLiveUntilInfo",value:function(e,t,n,r,a,i){function o(e){return $_(e)||a.has(e.name)}if(!$_(e)&&null!=i){var s,u=Se(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(!o(c)){var l,p=Se(wE(c.name,t,n));try{for(p.s();!(l=p.n()).done;){var h=l.value;!h||h.kept||r.has(h.id)||h.dispose()}}catch(d){p.e(d)}finally{p.f()}}}}catch(d){u.e(d)}finally{u.f()}}}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((function(e){var t,n=Se(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&!r.isDisposed&&r.dispose()}}catch(a){n.e(a)}finally{n.f()}})),this.clonedTensorsMap=null)}},{key:"getIntermediateTensors",value:function(){return this.clonedTensorsMap}},{key:"_executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>2&&void 0!==h[2]&&h[2],a=h.length>3&&void 0!==h[3]?h[3]:{},i=h.length>4&&void 0!==h[4]?h[4]:{},this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=on().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}return o=new q_(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return s=e.sent,u=n.map((function(e){return kE(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),p=new Set([].concat(Ie(c),Ie(l),Ie(this.weightIds))),e.abrupt("return",(Object.values(s).forEach((function(e){e.forEach((function(e){e&&!e.isDisposed&&!p.has(e.id)&&e.dispose()}))})),null==this.parent&&o.dispose(p),u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=S(w().mark((function e(t,n,r){var a,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return S.graph.nodes[NE(e)[0]]})),s=r.map((function(e){return NE(e)[0]})),u=new Set(s),c=s.map((function(e){return S.graph.nodes[e]})),0===c.length&&(c=this._outputs),l=K_(t,c,this.weightMap,this._initNodes),p=l.usedNodes,h=l.missingInputs,d=l.dynamicNode,f=l.syncInputs,m=[].concat(Ie(o),Ie(this.graph.weights),Ie(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),v=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=C(NE(e),2),r=n[0],a=[];a[n[1]]=t[e],v[r]=a})),g={},y=this.getFrozenTensorIds(v),b={};case 5:if(!(m.length>0)){e.next=11;break}return x=this.processStack(o,m,n,v,b,y,u,g,p),e.next=9,Promise.all(x);case 9:e.next=5;break;case 11:if(null==d&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),k=c.filter((function(e){return!$_(e)&&!kE(e.name,v,n)})).map((function(e){return e.name})),!(k.length>0)){e.next=16;break}throw I="",null!=d&&(I="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(f,"]")),new Error("Cannot compute the outputs [".concat(k,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(h,"]. ").concat(I));case 16:return e.abrupt("return",v);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e,p=t.pop();n.currentContext=p.contexts;var h="";if("Enter"===p.node.op&&xE("isConstant",p.node,r,n)&&(e=C(IE(p.node.name,n),1),h=e[0]),null==r[p.node.name]){var d,f=j_(p.node,r,n,c._resourceManager);h||(d=C(IE(p.node.name,n),1),h=d[0]);var m=n.currentContext;Vi.isPromise(f)?l.push(f.then((function(e){return r[h]=e,c.keepIntermediateTensors&&(c.clonedTensorsMap[h]=c.cloneTensorList(e)),n.currentContext=m,c.checkTensorForDisposal(h,p.node,r,n,i,o,s),c.processChildNodes(p.node,t,n,r,a,u),e}))):(r[h]=f,c.keepIntermediateTensors&&(c.clonedTensorsMap[h]=c.cloneTensorList(f)),c.checkTensorForDisposal(h,p.node,r,n,i,o,s),c.processChildNodes(p.node,t,n,r,a,u))}else c.processChildNodes(p.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=C(IE(e.name,n),1)[0];a[o]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!kE(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!kE(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=C(NE(n),1)[0],i=t.graph.nodes[a];if(i.attrParams.shape&&i.attrParams.shape.value){var o=i.attrParams.shape.value,s=o.length===r.shape.length&&r.shape.every((function(e,t){return-1===o[t]||o[t]===e}));Vi.assert(s,(function(){return"The shape of dict['".concat(i.name,"'] provided in model.execute(dict) must be [").concat(o,"], but was [").concat(r.shape,"]")}))}i.attrParams.dtype&&i.attrParams.dtype.value&&Vi.assert(r.dtype===i.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(i.name,"'] provided in model.execute(dict) must be ").concat(i.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t,n,r={};for(var a in e){var i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=C(NE(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){var n,r,a=null===(r=null===(n=t._signature)||void 0===n?void 0:n.outputs)||void 0===r?void 0:r[e];return null!=a?a.name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=C(NE(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),rA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xe(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return we(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),aA="?tfjs-format=file",iA="model.json",oA=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Im;xe(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new rA}return we(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Vi.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new nA(h_.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=h_.Instance.transformGraph(e.modelInitializer);this.initializer=new nA(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}},{key:"save",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addStructuredOutputNames",value:function(e){var t=this;if(this.structuredOutputKeys){var n={};return(e instanceof No?[e]:e).forEach((function(e,r){return n[t.structuredOutputKeys[r]]=e})),n}return e}},{key:"predict",value:function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}},{key:"predictAsync",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAsync(t,this.outputNodes);case 2:return r=e.sent,e.abrupt("return",this.addStructuredOutputNames(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"normalizeInputs",value:function(e){var t,n=this;if(!(e instanceof No)&&!Array.isArray(e)){var r=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=r)for(var a in r){var i=r[a];null!=i.resourceId&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];var o=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+o!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-o," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var s=0;return this.inputNodes.reduce((function(t,r){var a,i,o,u=null===(o=null===(i=null===(a=n.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[r])||void 0===o?void 0:o.resourceId;return t[r]=null!=u?n.resourceIdToCapturedInput[u]:e[s++],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"executeInitializerGraph",value:function(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}},{key:"executeInitializerGraphAsync",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResourceIdToCapturedInput",value:function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),r=0;r<n.length;r++){var a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}},{key:"execute",value:function(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null==this.resourceIdToCapturedInput,!e.t0){e.next=7;break}return e.t1=this,e.next=5,this.executeInitializerGraphAsync();case 5:e.t2=e.sent,e.t1.setResourceIdToCapturedInput.call(e.t1,e.t2);case 7:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=11,this.executor.executeAsync(t,n);case 11:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Ou(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}]),e}();function sA(e){return uA.apply(this,arguments)}function uA(){return uA=S(w().mark((function e(t){var n,r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:Im,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=lA(t)),a=new oA(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),uA.apply(this,arguments)}function cA(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var t;if(e instanceof Array){var n=C(e,2),r=n[0],a=n[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=Im.getWeightSpecs(r.weightsManifest),o=Im.getModelArtifactsForJSONSync(r,i,a);t=Im.fromMemorySync(o)}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=Im.fromMemorySync(e)}var s=new oA(t);return s.load(),s}function lA(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(iA).concat(aA)}var pA="4.5.0",hA={};Le(hA,{CSVDataset:function(){return sR},Dataset:function(){return XA},FileDataSource:function(){return wR},TextLineDataset:function(){return eR},URLDataSource:function(){return IR},array:function(){return JA},csv:function(){return SR},func:function(){return NR},generator:function(){return TR},microphone:function(){return _R},version_data:function(){return RR},webcam:function(){return CR},zip:function(){return QA}});var dA=ze(Ye()),fA=ze(Ye());function mA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(kA(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=mA(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function vA(e){return gA(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:yA)}function gA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(kA(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=gA(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function yA(e){return null===e?null:kA(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function bA(e,t){return xA.apply(this,arguments)}function xA(){return xA=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,mA(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!Vi.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",mA(t,n,r));case 15:case"end":return e.stop()}}),e)}))),xA.apply(this,arguments)}function kA(e){var t=!1;on().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof Je().StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof No)&&!(e instanceof Promise)&&!t)}function wA(e){return function(e,t){return mA(e,t)}(e,IA)}function IA(e){return e instanceof No?{value:e.clone(),recurse:!1}:kA(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var SA=function(){function e(t){if(xe(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return we(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=Se(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),NA=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,n.INITIAL_CAPACITY)}return we(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){pe(le(n.prototype),"isFull",this).call(this)&&this.expand(),pe(le(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){pe(le(n.prototype),"isFull",this).call(this)&&this.expand(),pe(le(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(SA);function TA(e){return new FA(e)}function CA(e){return new DA(e)}function EA(e,t){return new HA(e,t)}function _A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AA.FAIL;return new jA(e,t)}NA.INITIAL_CAPACITY=32;var AA,RA=function(){function e(){xe(this,e)}return we(e,[{key:"toArray",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent;case 10:e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new WA(this,e)}},{key:"filter",value:function(e){return new PA(this,e)}},{key:"map",value:function(e){return new BA(this,e)}},{key:"mapAsync",value:function(e){return new VA(this,e)}},{key:"serialMapAsync",value:function(e){return new VA(this,e).serial()}},{key:"flatmap",value:function(e){return new GA(this,e)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new zA(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yA;return this.rowMajorBatch(e,t).map((function(e){return vA(e,n)}))}},{key:"concatenate",value:function(e,t){return new HA(TA([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new LA(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new OA(this,e)}},{key:"prefetch",value:function(e){return new qA(this,e)}},{key:"shuffle",value:function(e,t){return new KA(this,e,t)}},{key:"serial",value:function(){return new MA(this)}}]),e}(),FA=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).items=e,r.trav=0,r}return we(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:wA(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),DA=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).nextFn=e,r}return we(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),MA=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),OA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Ou(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),LA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),zA=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return xe(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),PA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:Ou(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),BA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=Do.getTensorsInContainer(t.value),r=this.transform(t.value),a=Do.getTensorsInContainer(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Do.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),WA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),VA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=Do.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=Do.getTensorsInContainer(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Do.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),UA=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.call(this)).outputQueue=new NA,e.lastRead=Promise.resolve({value:null,done:!1}),e}return we(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),GA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=Do.getTensorsInContainer(t.value),r=this.transform(t.value),a=Do.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Do.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(UA),HA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return we(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(RA);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(AA||(AA={}));var jA=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AA.FAIL;return xe(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return we(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof RA?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,bA(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===AA.FAIL?13:e.t0===AA.SHORTEST?14:(e.t0,AA.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),qA=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new SA(r),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(RA),KA=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i;return xe(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=fA.alea(a||Vi.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return we(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(qA),XA=function(){function e(){xe(this,e),this.size=null}return we(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Vi.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,ZA));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return Mu((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return YA(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return Mu((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return YA(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return YA(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,YA(S(w().mark((function t(){var r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=CA(S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",EA(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=dA.alea(t||Vi.now().toString());return YA(S(w().mark((function t(){var i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function YA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){ye(a,n);var r=be(a);function a(){var e;return xe(this,a),(e=r.apply(this,arguments)).size=t,e}return we(a,[{key:"iterator",value:function(){var t=S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(XA))}function JA(e){return YA(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",TA(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function QA(e){if(!kA(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return YA(S(w().mark((function t(){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,bA(e,(function(e){if(e instanceof XA)return{value:e.iterator(),recurse:!1};if(kA(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",_A(n,AA.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function ZA(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof No||Vi.isTypedArray(e)}(e[0])?{value:$A(e),recurse:!1}:{value:null,recurse:!0}}function $A(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof No?cd(e):ps(e)}XA.MAX_BUFFER_SIZE=1e4;var eR=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).input=e,r}return we(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(XA),tR='"',nR=Symbol("out"),rR=Symbol("field"),aR=Symbol("quote"),iR=Symbol("quoteafterquote"),oR=Symbol("quoteinquote"),sR=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new eR(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(Vi.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return we(n,[{key:"columnNames",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&Vi.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),Vi.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=S(w().mark((function e(){var t,n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=nR,o=0;o<a;o++)switch(i){case nR:switch(e.charAt(o)){case tR:r=o+1,i=aR;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=nR;break;default:i=rR,r=o}break;case rR:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=nR,r=o+1;break;case aR:if(e.charAt(o)===tR)i=iR;break;case iR:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=nR,r=o+1;break;case tR:i=aR;break;default:i=oR}break;case oR:if(e.charAt(o)===tR)i=aR}if(i===iR?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(XA),uR=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return we(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=S(w().mark((function e(){var t,n,r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(Vi.sizeFromShape(t));return n.set(e,n.length-e.length),ps(n,t)}}],[{key:"create",value:function(){var e=S(w().mark((function e(){var t,r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},on().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),cR=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=dd([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=fd([u,s,l,c],[1,4])}else a.cropBox=fd([0,0,1,1],[1,4]);return ge(a)}return we(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&Vi.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(rGe){console.log(rGe),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=Qm.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return Mu((function(){var n,r=jl(Iu(e,"float32"),0),a=(n=im.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return Nc(n,a.slice(1))}))}},{key:"capture",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(rGe){console.log(rGe),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=S(w().mark((function e(t){var r,a,i=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},on().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(RA),lR=we((function e(){xe(this,e)})),pR=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"split",value:function(e){return new hR(this,e)}}]),n}(RA),hR=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.impl=new dR(e,r),a}return we(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(pR),dR=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=Se(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(UA),fR=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"decodeUTF8",value:function(){return new mR(this)}}]),n}(RA),mR=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).upstream=e,r.impl=new vR(e),r}return we(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(pR),vR=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this)).upstream=e,on().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=Je().StringDecoder;r.decoder=new a("utf8")}return ge(r)}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=on().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(UA),gR=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xe(this,n),(r=t.call(this)).file=e,r.options=a,Vi.assert(e instanceof Uint8Array||!!on().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return we(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(fR);function yR(e){return bR.apply(this,arguments)}function bR(){return bR=S(w().mark((function e(t){var n,r,a,i,o,s,u=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=xR(t)),e.next=5,(r||Vi.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new gR(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),bR.apply(this,arguments)}var xR=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function kR(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var wR=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xe(this,n),(r=t.call(this)).input=e,r.options=a,r}return we(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kR(this.input)&&on().get("IS_NODE")&&(t=Qe(),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new gR(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(lR),IR=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return xe(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return we(n,[{key:"iterator",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",kR(this.url)?new wR(this.url,this.fileOptions).iterator():yR(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(lR);function SR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new sR(new IR(e),t)}function NR(e){var t=CA(e);return YA(S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function TR(e){return YA(S(w().mark((function t(){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",CA((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function CR(e,t){return ER.apply(this,arguments)}function ER(){return ER=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",cR.create(t,n));case 1:case"end":return e.stop()}}),e)}))),ER.apply(this,arguments)}function _R(e){return AR.apply(this,arguments)}function AR(){return AR=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",uR.create(t));case 1:case"end":return e.stop()}}),e)}))),AR.apply(this,arguments)}var RR="4.5.0";function FR(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Vi.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var DR=Bg.whereImpl,MR=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new it(he(e),Ru()),e}return we(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,on().get("IS_NODE")&&Dv.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Vi.isString(n[0])){var a=n.map((function(e){return Vi.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return Dv.mergeRealAndImagArrays(a,i)}return Vi.convertBackendValuesAndArrayBuffer(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Vi.decodeString(e)}));return wu(e.shape,e.dtype,n)}catch(G1){throw new Error("Failed to decode encoded string bytes into utf-8")}return wu(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Ru().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Vi.now(),e.abrupt("return",(t(),{kernelMs:Vi.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){FR([e],"where");var t=this.readSync(e.dataId);return DR(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return pe(le(n.prototype),"epsilon",this).call(this)}}]),n}(ot);MR.nextDataId=0;var OR={};function LR(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}Le(OR,{addImpl:function(){return QR},bincountImpl:function(){return tF},bincountReduceImpl:function(){return nF},bitwiseAndImpl:function(){return rF},castImpl:function(){return qR},ceilImpl:function(){return cF},concatImpl:function(){return hF},equalImpl:function(){return dF},expImpl:function(){return vF},expm1Impl:function(){return bF},floorDivImpl:function(){return NF},floorImpl:function(){return wF},gatherNdImpl:function(){return EF},gatherV2Impl:function(){return _F},greaterEqualImpl:function(){return DF},greaterImpl:function(){return AF},lessEqualImpl:function(){return BF},lessImpl:function(){return LF},linSpaceImpl:function(){return UF},logImpl:function(){return GF},maxImpl:function(){return qF},maximumImpl:function(){return KF},minimumImpl:function(){return JF},multiplyImpl:function(){return $F},negImpl:function(){return rD},notEqualImpl:function(){return iD},prodImpl:function(){return pD},raggedGatherImpl:function(){return vD},raggedRangeImpl:function(){return yD},raggedTensorToTensorImpl:function(){return ID},rangeImpl:function(){return SD},rsqrtImpl:function(){return ND},scatterImpl:function(){return ED},sigmoidImpl:function(){return _D},simpleAbsImpl:function(){return LR},sliceImpl:function(){return FD},sparseFillEmptyRowsImpl:function(){return OD},sparseReshapeImpl:function(){return LD},sparseSegmentReductionImpl:function(){return zD},sqrtImpl:function(){return PD},squaredDifferenceImpl:function(){return VD},staticRegexReplaceImpl:function(){return HD},stridedSliceImpl:function(){return KD},stringNGramsImpl:function(){return YD},stringSplitImpl:function(){return QD},stringToHashBucketFastImpl:function(){return ZD},subImpl:function(){return $D},tileImpl:function(){return rM},topKImpl:function(){return oM},transposeImpl:function(){return uD},uniqueImpl:function(){return sM}});var zR={kernelName:pn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;FR(t,"abs");var r=new Float32Array(Vi.sizeFromShape(t.shape));return r=LR(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function PR(e){return function(t,n,r,a,i){var o=Dv.assertAndGetBroadcastShape(t,n),s=o.length,u=Vi.computeStrides(o),c=Vi.sizeFromShape(o),l=Vi.getTypedArrayFromDType(i,c),p=t.length,h=n.length,d=Vi.computeStrides(t),f=Vi.computeStrides(n),m=Dv.getBroadcastDims(t,o),v=Dv.getBroadcastDims(n,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=e(r[g%r.length],a[g%a.length]);else for(var y=function(){var t=Vi.indexToLoc(b,s,u),n=t.slice(-p);m.forEach((function(e){return n[e]=0}));var i=Vi.locToIndex(n,p,d),o=t.slice(-h);v.forEach((function(e){return o[e]=0}));var c=Vi.locToIndex(o,h,f);l[b]=e(r[i],a[c])},b=0;b<l.length;++b)y();return[l,o]}}function BR(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var WR={kernelName:Pn,backendName:"cpu",kernelFunc:BR};function VR(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return BR({inputs:{real:VR(e,t,"float32"),imag:VR(e,t,"float32")},backend:e});var r=Vi.makeZerosTypedArray(Vi.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function UR(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var GR={kernelName:Tr,backendName:"cpu",kernelFunc:UR};function HR(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var jR={kernelName:Sa,backendName:"cpu",kernelFunc:HR};function qR(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=Vi.toTypedArray([0],n),i=C(PR((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),2),o=i[0];return[i[1],"bool",o]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function KR(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return UR({inputs:{x:a},backend:n});var o=VR(n,a.shape,a.dtype),s=KR({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=BR({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=HR({inputs:{input:a},backend:n}),l=KR({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!Vi.hasEncodingLoss(a.dtype,i)){var p=UR({inputs:{x:a},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:i}}var h=C(qR(n.data.get(a.dataId).values,a.shape,a.dtype,i),3),d=h[0],f=h[1],m=h[2];return n.makeTensorInfo(d,f,m)}var XR={kernelName:On,backendName:"cpu",kernelFunc:KR};function YR(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;FR([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,p="string"===o.dtype?Dv.fromUint8ToStringArray(c):c,h="string"===o.dtype?Dv.fromUint8ToStringArray(l):l,d=r||o.dtype,f=C(t(o.shape,s.shape,p,h,d),2),m=f[0],v=f[1];return u.makeTensorInfo(v,d,m)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=KR({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),p=l.complexTensorInfos.real,h=l.complexTensorInfos.imag,d=u.data.get(p.dataId).values,f=u.data.get(h.dataId).values,m=KR({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(m.dataId),g=v.complexTensorInfos.real,y=v.complexTensorInfos.imag,b=u.data.get(g.dataId).values,x=u.data.get(y.dataId).values,k=C(n(o.shape,s.shape,d,f,b,x),3),w=k[0],I=k[1],S=k[2],N=u.makeTensorInfo(S,"float32",w),T=u.makeTensorInfo(S,"float32",I),E=BR({inputs:{real:N,imag:T},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(N),u.disposeIntermediateTensorInfo(T),E}var _=u.data.get(o.dataId).values,A=u.data.get(s.dataId).values,R=r||o.dtype,F=C(t(o.shape,s.shape,_,A,R),2),D=F[0],M=F[1];return u.makeTensorInfo(M,R,D)}}function JR(e){return function(t,n,r,a,i,o){var s=Dv.assertAndGetBroadcastShape(t,n),u=Vi.sizeFromShape(s),c=s.length,l=Vi.computeStrides(s),p=Vi.getTypedArrayFromDType("float32",u),h=Vi.getTypedArrayFromDType("float32",u),d=Dv.getBroadcastDims(t,s),f=Dv.getBroadcastDims(n,s),m=Dv.mergeRealAndImagArrays(r,a),v=Dv.mergeRealAndImagArrays(i,o),g=t.length,y=Vi.computeStrides(t),b=n.length,x=Vi.computeStrides(n);if(d.length+f.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,I=k%v.length,S=e(m[2*w],m[2*w+1],v[2*I],v[2*I+1]);p[k]=S.real,h[k]=S.imag}else for(var N=function(){var t=Vi.indexToLoc(T,c,l),n=t.slice(-g);d.forEach((function(e){return n[e]=0}));var r=Vi.locToIndex(n,g,y),a=t.slice(-b);f.forEach((function(e){return a[e]=0}));var i=Vi.locToIndex(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);p[T]=o.real,h[T]=o.imag},T=0;T<p.length;T++)N();return[p,h,s]}}var QR=PR((function(e,t){return e+t})),ZR=JR((function(e,t,n,r){return{real:e+n,imag:t+r}})),$R=YR(fn,QR,ZR),eF={kernelName:fn,backendName:"cpu",kernelFunc:$R};function tF(e,t,n,r,a){for(var i=Vi.sizeFromShape(r),o=Vi.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function nF(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=wu([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var rF=PR((function(e,t){return e&t})),aF=YR(Fn,rF),iF={kernelName:Fn,backendName:"cpu",kernelFunc:aF};function oF(e){return function(t,n,r){for(var a=Vi.getArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function sF(e,t,n){return uF(e,oF(t),n)}function uF(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;FR(s,e);var u,c=o,l=c.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Dv.fromUint8ToStringArray(l)}else u=l;var p=n||s.dtype,h=t(u,p,i);return c.makeTensorInfo(s.shape,p,h)}}var cF=oF((function(e){return Math.ceil(e)})),lF=uF(Ln,cF),pF={kernelName:Ln,backendName:"cpu",kernelFunc:lF};function hF(e,t,n,r){var a=Vi.getArrayFromDType(n,Vi.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Vi.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Dv.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}var dF=PR((function(e,t){return e===t?1:0})),fF=YR(hr,dF,null,"bool"),mF={kernelName:hr,backendName:"cpu",kernelFunc:fF},vF=oF((function(e){return Math.exp(e)})),gF=uF(dr,vF,"float32"),yF={kernelName:dr,backendName:"cpu",kernelFunc:gF},bF=oF((function(e){return Math.expm1(e)})),xF=uF(mr,bF),kF={kernelName:mr,backendName:"cpu",kernelFunc:xF},wF=oF((function(e){return Math.floor(e)})),IF=uF(br,wF),SF={kernelName:br,backendName:"cpu",kernelFunc:IF},NF=PR((function(e,t){return Math.floor(e/t)})),TF=YR(xr,NF,null,"int32"),CF={kernelName:xr,backendName:"cpu",kernelFunc:TF};function EF(e,t,n,r,a,i,o,s,u){for(var c=wu([r,i],n),l=0;l<r;l++){for(var p=[],h=0,d=0;d<a;d++){var f=e[l*a+d];h+=f*o[d],p.push(f)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,Ie(t.indexToLoc(h*i+m)))}return c}function _F(e,t,n){for(var r=wu(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var AF=PR((function(e,t){return e>t?1:0})),RF=YR(Sr,AF,null,"bool"),FF={kernelName:Sr,backendName:"cpu",kernelFunc:RF},DF=PR((function(e,t){return e>=t?1:0})),MF=YR(Nr,DF,null,"bool"),OF={kernelName:Nr,backendName:"cpu",kernelFunc:MF},LF=PR((function(e,t){return e<t?1:0})),zF=YR(Dr,LF,null,"bool"),PF={kernelName:Dr,backendName:"cpu",kernelFunc:zF},BF=PR((function(e,t){return e<=t?1:0})),WF=YR(Mr,BF,null,"bool"),VF={kernelName:Mr,backendName:"cpu",kernelFunc:WF};function UF(e,t,n){var r=(t-e)/(n-1),a=Vi.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var GF=oF((function(e){return Math.log(e)})),HF=uF(Lr,GF),jF={kernelName:Lr,backendName:"cpu",kernelFunc:HF};function qF(e,t,n,r){for(var a=Vi.getTypedArrayFromDType(r,Vi.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var KF=PR((function(e,t){return Math.max(e,t)})),XF=YR(Xr,KF),YF={kernelName:Xr,backendName:"cpu",kernelFunc:XF},JF=PR((function(e,t){return Math.min(e,t)})),QF=YR(na,JF),ZF={kernelName:na,backendName:"cpu",kernelFunc:QF},$F=PR((function(e,t){return e*t})),eD=JR((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),tD=YR(oa,$F,eD),nD={kernelName:oa,backendName:"cpu",kernelFunc:tD};function rD(e,t,n){var r=Vi.createScalarValue(-1,n);return $F([],t,r,e,n)}var aD={kernelName:sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;FR(r,"neg");var a=C(rD(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],o=a[1];return n.makeTensorInfo(o,r.dtype,i)}},iD=PR((function(e,t){return e!==t?1:0})),oD=YR(ua,iD,null,"bool"),sD={kernelName:ua,backendName:"cpu",kernelFunc:oD};function uD(e,t,n,r,a){for(var i=t.length,o=Vi.sizeFromShape(t),s=Vi.computeStrides(t),u=Vi.computeStrides(a),c=Vi.getTypedArrayFromDType(n,Vi.sizeFromShape(a)),l=0;l<o;++l){for(var p=Vi.indexToLoc(l,i,s),h=new Array(p.length),d=0;d<h.length;d++)h[d]=p[r[d]];c[Vi.locToIndex(h,i,u)]=e[l]}return c}function cD(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;FR(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=uD(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var lD={kernelName:vi,backendName:"cpu",kernelFunc:cD};function pD(e,t,n,r){for(var a=C(Dv.computeOutAndReduceShapes(e,r),2),i=a[0],o=a[1],s=Oo(t,"int32"),u=Vi.makeZerosTypedArray(Vi.sizeFromShape(i),s),c=Vi.sizeFromShape(o),l=0;l<u.length;++l){for(var p=l*c,h=1,d=0;d<c;++d)h*=n[p+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}var hD={kernelName:ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;FR(a,"prod");var s=a.shape.length,u=Vi.parseAxisParam(i,a.shape),c=Dv.getAxesPermutation(u,s),l=u,p=a,h=[];null!=c&&(p=cD({inputs:{x:a},backend:n,attrs:{perm:c}}),h.push(p),l=Dv.getInnerMostAxes(l.length,s));var d=n.data.get(p.dataId).values,f=pD(p.shape,p.dtype,d,l),m=f.outVals,v=f.outShape,g=f.outDtype,y=v;return o&&(y=Dv.expandShapeToKeepDim(v,u)),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function dD(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],p=1;p<u+1;++p)s[c].push(p*l)}for(var h=0;h<e.length;++h){for(var d=e[h],f=e[h]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[d],x=d;x<f;++x)s[g].push(v[x+1]+b);d=v[d],f=v[f]}f!==d&&(a.push([d,f]),i+=f-d)}return{outSplits:s,valueSlices:a,numValues:i}}function fD(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function mD(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Vi.getArrayFromDType(n,Vi.sizeFromShape(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=fD(t,2)[1],u=fD(i,2)[1],c=0,l=Se(n);try{for(l.s();!(o=l.n()).done;)for(var p=o.value,h=p[0];h<p[1];++h){for(var d=0;d<r;++d)a[c*u+d]=e[h*s+d];++c}}catch(f){l.e(f)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function vD(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Vi.indexToLoc(r,t.length,Vi.computeStrides(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=dD(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,p=u.numValues,h=function(e){for(var t=[],n=function(){var n=e[r].length,a=Vi.getArrayFromDType("int32",n);t.push(a),e[r].forEach((function(e,t){return a[t]=e}))},r=0;r<e.length;++r)n();return t}(c),d=mD(n,r,a,l,p);return[h,d[0],d[1]]}var gD=2147483647;function yD(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var p=1;p<l.length;++p)if(l[p]!==l[p-1])throw new Error("starts, limits, and deltas must have the same shape");var h=0===l.length?1:l[0],d=Vi.getArrayFromDType("int32",h+1);d[0]=0;for(var f=0;f<h;++f){var m=s?e[0]:e[f],v=u?r[0]:r[f],g=c?i[0]:i[f];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>gD)throw new Error("Requires ((limit - start) / delta) <= ".concat(gD));d[f+1]=d[f]+y}for(var b=d[h],x=Vi.getArrayFromDType(n,b),k=0,w=0;w<h;++w)for(var I=d[w+1]-d[w],S=s?e[0]:e[w],N=c?i[0]:i[w],T=0;T<I;++T)x[k++]=S,S+=N;return[d,x]}var bD=Dv.RowPartitionType,xD=function(){function e(t,n,r,a,i,o,s,u,c,l){xe(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Dv.getRowPartitionTypesHelper(l),this.raggedRank=Dv.getRaggedRank(this.rowPartitionTypes)}return we(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===bD.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===bD.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case bD.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case bD.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(bD[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return wD(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape,n=this.defaultValueShape;Dv.validateDefaultValueShape(n,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=Dv.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return Vi.assert(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var p=0;p<s-u;++p)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case bD.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case bD.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(bD[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case bD.FIRST_DIM_SIZE:return e[0];case bD.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case bD.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(bD[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=wD(t,!1),i=Vi.getArrayFromDType(this.valuesDType,Vi.sizeFromShape(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice();o=o.slice(e+1);var s=Vi.sizeFromShape(o),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Mu((function(){var e=Nc(c,l);c=Gc(e,o).dataSync()}))}for(var p=0,h=0,d=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==d){if(h<d){var v=a.subarray(p*s);kD(i.subarray(h*s),v,(d-h)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>d)if(1===this.defaultValue.length)i.subarray(d*s,m*s).fill(this.defaultValue[0]),d=m;else for(;m>d;){kD(i.slice(d*s),c,s),++d}m<0?(p=f+1,h=d):(p=f,d=(h=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function kD(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function wD(e,t){var n,r=[],a=Se(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}function ID(e,t,n,r,a,i,o,s,u,c){return new xD(e,t,n,r,a,i,o,s,u,c).compute()}function SD(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Vi.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=Vi.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var ND=oF((function(e){return 1/Math.sqrt(e)})),TD=uF(Oa,ND),CD={kernelName:Oa,backendName:"cpu",kernelFunc:TD};function ED(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,h=t.values;if(0===r)return wu(n,t.dtype);var d=u instanceof wo?u:wu(l,t.dtype);"string"==typeof u||"number"==typeof u?d.values.fill(u):"boolean"==typeof u&&d.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=p[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=h[f*a+b]:d.values[v*a+b]=0===t.rank?h[0]:h[f*a+b]}return d}var _D=oF((function(e){return 1/(1+Math.exp(-e))})),AD=sF(ja,(function(e){return 1/(1+Math.exp(-e))})),RD={kernelName:ja,backendName:"cpu",kernelFunc:AD};function FD(e,t,n,r,a){var i=sv.isSliceContinous(r,t,n),o=Vi.sizeFromShape(n),s=Vi.computeStrides(r);if(i){var u=sv.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=wu(r,a,"string"===a?Dv.fromUint8ToStringArray(e):e),l=wu(n,a),p=0;p<l.size;++p){var h=l.indexToLoc(p),d=h.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Ie(d))].concat(Ie(h)))}return"string"===a?Dv.fromStringArrayToUint8(l.values):l.values}function DD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;FR(a,"slice");var s=C(sv.parseSliceParams(a,i,o),2),u=s[0],c=s[1];sv.assertParamsValid(a,u,c);var l=FD(n.data.get(a.dataId).values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}var MD={kernelName:Va,backendName:"cpu",kernelFunc:DD};function OD(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(Dv.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[Vi.getArrayFromDType(n,0),[0,p],Vi.getArrayFromDType(a,0),c,l]}for(var h=!0,d=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*p];if(v<0)throw new Error(Dv.getSparseFillEmptyRowsNegativeIndexErrorMessage(m,v));if(v>=u)throw new Error(Dv.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(m,v,u));++f[v],h=h&&v>=d,d=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&h){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,p],k,c,l]}for(var I=f[u-1],S=Vi.getArrayFromDType(n,I*p),N=Vi.getArrayFromDType(a,I),T=new Array(u).fill(0),C=0;C<s;++C){var E=e[C*p],_=T[E],A=(0===E?0:f[E-1])+_;T[E]++;for(var R=0;R<p;++R)S[A*p+R]=e[C*p+R];N[A]=r[C],l[C]=A}for(var F=0;F<u;++F)if(0===T[F]){var D=0===F?0:f[F-1];S[D*p+0]=F;for(var M=1;M<p;++M)S[D*p+M]=0;N[D]=o}return[S,[I,p],N,c,l]}function LD(e,t,n,r,a){for(var i=Vi.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var h=a[p];if(-1===h){if(-1!==l)throw new Error(Dv.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,p));l=p,u.push(1)}else{if(h<0)throw new Error(Dv.getSparseReshapeNegativeOutputDimErrorMessage(p,h));c*=h,u.push(h)}}if(-1!==l){if(c<=0)throw new Error(Dv.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(Dv.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}if(Vi.sizeFromShape(u)!==i)throw new Error(Dv.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Vi.getArrayFromDType(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<f;++w)k+=e[x*f+w]*m[w];for(var I=0;I<s;++I)b[x*s+I]=Math.trunc(k/g[I]),k%=g[I]}return[b,[o,s],u]}function zD(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error(Dv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var p=t.slice();p[0]=l;var h=p.reduce((function(e,t){return e*t}),1),d=Vi.getArrayFromDType(n,h);if(0===s)return l>0&&d.fill(o),[d,p];if(l<=0)throw new Error(Dv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var f=0,m=1,v=0,g=a[f];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error(Dv.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(g<0||g>=l)throw new Error(Dv.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(g,l));g>v&&d.fill(o,v*c,g*c);for(var b=f;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(Dv.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,r[b],u[0]));for(var k=0;k<c;k++)d[g*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)d[g*c+w]/=m-f;if(f=m,v=g+1,g=y,++m>s)break}return v<l&&d.fill(o,v*c,l*c),[d,p]}var PD=oF((function(e){return Math.sqrt(e)})),BD=sF(Ka,(function(e){return Math.sqrt(e)})),WD={kernelName:Ka,backendName:"cpu",kernelFunc:BD},VD=PR((function(e,t){var n=e-t;return n*n})),UD=YR(ri,VD),GD={kernelName:ri,backendName:"cpu",kernelFunc:UD},HD=oF((function(e,t){var n=t.pattern,r=t.replaceGlobal,a=t.rewrite;return e.replace(new RegExp(n,r?"g":""),a)})),jD=uF(ii,HD),qD={kernelName:ii,backendName:"cpu",kernelFunc:jD};function KD(e,t,n,r){for(var a=wu(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Ie(o)))}return a}var XD=function(){function e(t,n,r,a,i,o){xe(this,e),this.separator=Vi.encodeString(t),this.nGramWidths=n,this.leftPad=Vi.encodeString(r),this.rightPad=Vi.encodeString(a),this.padWidth=i,this.preserveShort=o}return we(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),p=i-(c+l),h=t+(c>0?0:u-s),d=0;d+=c*o.leftPad.length;for(var f=0;f<p;++f)d+=e[h+f].length;d+=l*o.rightPad.length,d+=(c+l+p-1)*o.separator.length,n[r+u]=new Uint8Array(d);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[h+b]),g(o.separator);if(p>0){g(e[h+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Vi.getArrayFromDType("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var h=function(){var e=t[d]-t[d-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[d]=c[d-1]+r},d=1;d<=u;++d)h();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function YD(e,t,n,r,a,i,o,s){return new XD(n,r,a,i,o,s).compute(e,t)}function JD(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function QD(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;JD(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=Vi.getArrayFromDType("int32",2*i),h=new Array(i),d=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*f]=m,p[2*f+1]=v,h[f]=a[f],++f;return[p,h,d]}function ZD(e,t){for(var n=Vi.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=Vi.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var $D=PR((function(e,t){return e-t})),eM=JR((function(e,t,n,r){return{real:e-n,imag:t-r}})),tM=YR(li,$D,eM),nM={kernelName:li,backendName:"cpu",kernelFunc:tM};function rM(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=wu(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var aM=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function iM(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);iM(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,p=r;for(Vi.swap(e,n,t),aM(e[r],c)>0&&Vi.swap(e,n,r);l<p;){for(Vi.swap(e,l,p),l++,p--;aM(e[l],c)<0;)l+=1;for(;aM(e[p],c)>0;)p-=1}0===aM(e[n],c)?Vi.swap(e,n,p):(p+=1,Vi.swap(e,p,r)),p<=t&&(n=p+1),t<=p&&(r=p-1)}}function oM(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Vi.getTypedArrayFromDType(n,o*r),c=Vi.getTypedArrayFromDType("int32",o*r),l=function(){var t=p*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(iM(i,r),i=i.slice(0,r)),a&&i.sort(aM);for(var o=p*r,l=u.subarray(o,o+r),h=c.subarray(o,o+r),d=0;d<r;d++)l[d]=i[d].value,h[d]=i[d].index},p=0;p<o;p++)l();var h=t.slice();return h[h.length-1]=r,[wu(h,n,u),wu(h,"int32",c)]}function sM(e,t,n,r){for(var a=Vi.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u=new Map,c=new Int32Array(n[a]),l=new wo(i,r,e),p=[],h=1===i[0]&&1===i[2],d=0;d<n[a];d++){var f=void 0;if(h)f=e[d].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,d,g));f=m.join(",")}var y=u.get(f);if(null!=y)c[d]=y;else{var b=u.size;u.set(f,b),c[d]=b,p.push(d)}}var x=i.slice();x[1]=u.size;var k=new wo(x,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=x[1],{outputValues:k.values,outputShape:w,indices:c}}var uM="4.5.0";Hu("cpu",(function(){return new MR}),1);var cM=sF(cr,(function(e){return e>=0?e:Math.exp(e)-1})),lM={kernelName:cr,backendName:"cpu",kernelFunc:cM};function pM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;FR([a],"leakyRelu");for(var o=Vi.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=Vi.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var hM={kernelName:Fr,backendName:"cpu",kernelFunc:pM},dM=PR((function(e,t){return e<0?t*e:e}));function fM(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;FR([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=C(dM(r.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return n.makeTensorInfo(c,"float32",u)}var mM={kernelName:ya,backendName:"cpu",kernelFunc:fM},vM=sF(Ta,(function(e){return Math.max(0,e)})),gM={kernelName:Ta,backendName:"cpu",kernelFunc:vM},yM=sF(Fa,(function(e){return Math.min(Math.max(0,e),6)})),bM={kernelName:Fa,backendName:"cpu",kernelFunc:yM};function xM(e,t,n,r,a){if("linear"===n)return UR({inputs:{x:t},backend:e});if("relu"===n)return vM({inputs:{x:t},backend:e});if("elu"===n)return cM({inputs:{x:t},backend:e});if("relu6"===n)return yM({inputs:{x:t},backend:e});if("prelu"===n)return fM({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return pM({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return AD({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function kM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Vi.sizeFromShape(a.shape),s=Vi.inferFromImplicitShape(i,o),u=Vi.sizeFromShape(s);Vi.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var wM={kernelName:Ca,backendName:"cpu",kernelFunc:kM};function IM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;FR([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Vi.sizeFromShape(f),g=Vi.sizeFromShape(m),y=dl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,d]);Vi.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));for(var b=s?[g,d,p]:[g,p,d],x=kM({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,h]:[v,h,l]}}),k=kM({inputs:{x:i},backend:n,attrs:{shape:b}}),w=o?x.shape[1]:x.shape[2],I=o?x.shape[2]:x.shape[1],S=s?k.shape[1]:k.shape[2],N=Math.max(v,g),T=n.data.get(x.dataId).values,E=n.data.get(k.dataId).values,_=Vi.computeStrides(x.shape),A=Vi.computeStrides(k.shape),R=C(o?[_[0],1,_[1]]:[_[0],_[1],1],3),F=R[0],D=R[1],M=R[2],O=C(s?[1,A[1],A[0]]:[A[1],1,A[0]],3),L=O[0],z=O[1],P=O[2],B=I*S,W=wu([N,I,S],x.dtype),V=W.values,U=n.blockSize,G=0;G<N;G++)for(var H=G%v,j=G%g,q=0;q<I;q+=U)for(var K=Math.min(q+U,I),X=0;X<S;X+=U)for(var Y=Math.min(X+U,S),J=0;J<w;J+=U)for(var Q=Math.min(J+U,w),Z=q;Z<K;Z++)for(var $=X;$<Y;$++){for(var ee=0,te=J;te<Q;te++){ee+=T[H*F+Z*D+te*M]*E[te*L+$*z+j*P]}V[G*B+(Z*S+$)]+=ee}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,W.dtype,W.values)}var SM={kernelName:_n,backendName:"cpu",kernelFunc:IM};var NM={kernelName:Ni,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,h=o.transposeB,d=o.activation,f=o.leakyreluAlpha,m=[];t=IM({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:h},backend:i}),c&&(n=$R({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),d&&(r=xM(i,t,d,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}},TM=sF(hn,(function(e){return Math.acos(e)})),CM={kernelName:hn,backendName:"cpu",kernelFunc:TM},EM=sF(dn,(function(e){return Math.acosh(e)})),_M={kernelName:dn,backendName:"cpu",kernelFunc:EM};var AM={kernelName:mn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;FR(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=wu(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var RM={kernelName:vn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;FR(a,"all");var s=Vi.parseAxisParam(i,a.shape),u=s,c=Dv.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=cD({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Dv.getInnerMostAxes(u.length,a.shape.length)),Dv.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var p=C(Dv.computeOutAndReduceShapes(l.shape,u),2),h=p[0],d=p[1],f=Vi.sizeFromShape(d),m=Vi.makeZerosTypedArray(Vi.sizeFromShape(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];b=b&&k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var I=kM({inputs:{x:w},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(h,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}};var FM={kernelName:gn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;FR(a,"any");var s=Vi.parseAxisParam(i,a.shape),u=s,c=Dv.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=cD({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Dv.getInnerMostAxes(u.length,a.shape.length)),Dv.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var p=C(Dv.computeOutAndReduceShapes(l.shape,u),2),h=p[0],d=p[1],f=Vi.sizeFromShape(d),m=Vi.makeZerosTypedArray(Vi.sizeFromShape(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];b=b||k}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var I=kM({inputs:{x:w},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(h,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}};var DM={kernelName:yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;FR(a,"argMax");var o=Vi.parseAxisParam(i,a.shape),s=Dv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=cD({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Dv.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],Dv.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=C(Dv.computeOutAndReduceShapes(u.shape,o),2),p=l[0],h=l[1],d=Vi.sizeFromShape(p),f=Vi.makeZerosTypedArray(d,"int32"),m=Vi.sizeFromShape(h),v=n.data.get(u.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w>b&&(b=w,x=k)}f[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",f)}};var MM={kernelName:bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;FR(a,"argMin");var o=Vi.parseAxisParam(i,a.shape),s=Dv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=cD({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Dv.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],Dv.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=C(Dv.computeOutAndReduceShapes(u.shape,o),2),p=l[0],h=l[1],d=Vi.sizeFromShape(p),f=Vi.makeZerosTypedArray(d,"int32"),m=Vi.sizeFromShape(h),v=n.data.get(u.dataId).values,g=0;g<f.length;++g){for(var y=g*m,b=v[y],x=0,k=0;k<m;++k){var w=v[y+k];w<b&&(b=w,x=k)}f[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",f)}},OM=sF(xn,(function(e){return Math.asin(e)})),LM={kernelName:xn,backendName:"cpu",kernelFunc:OM},zM=sF(kn,(function(e){return Math.asinh(e)})),PM={kernelName:kn,backendName:"cpu",kernelFunc:zM},BM=sF(wn,(function(e){return Math.atan(e)})),WM={kernelName:wn,backendName:"cpu",kernelFunc:BM},VM=PR((function(e,t){return Math.atan2(e,t)})),UM=YR(Sn,VM),GM={kernelName:Sn,backendName:"cpu",kernelFunc:UM},HM=sF(In,(function(e){return Math.atanh(e)})),jM={kernelName:In,backendName:"cpu",kernelFunc:HM};function qM(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,h=a.padInfo.top,d=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=wu(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],I=0;I<a.inChannels;++I)for(var S=0;S<a.outHeight;++S)for(var N=S*o-h,T=Math.max(0,N),C=Math.min(a.inHeight,l+N),E=k+S*y,_=0;_<a.outWidth;++_){for(var A=_*s-d,R=Math.max(0,A),F=Math.min(a.inWidth,p+A),D=f,M=0,O=0,L=T;L<C;L+=u){for(var z=w+L*r[1],P=R;P<F;P+=c){var B=e[z+P*r[2]+I];"max"===i&&B>D?D=B:"avg"===i&&(M+=B,O++)}if(isNaN(D))break}v[E+_*b+I]="avg"===i?M/O:D}return m}function KM(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=wu(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,m=wu(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var I=w*u-f,S=I;S<0;)S+=l;for(var N=Math.min(r.inWidth,h+I),T=Number.NEGATIVE_INFINITY,C=-1,E=x;E<k;E+=c)for(var _=E-b,A=S;A<N;A+=l){var R=A-I,F=m.get(v,E,A,g);F>T&&(T=F,C=a?i?((v*r.inHeight+E)*r.inWidth+A)*r.inChannels+g:(E*r.inWidth+A)*r.inChannels+g:_*h+R)}o.set(C,v,y,w,g)}}return o}function XM(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=wu(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],S=a.outShape[4],N=0;N<a.batchSize;++N)for(var T=N*k,C=N*r[0],E=0;E<a.inChannels;++E)for(var _=0;_<a.outDepth;++_){for(var A=_*o-m,R=A;R<0;)R+=c;for(var F=Math.min(a.inDepth,h+A),D=T+_*w,M=0;M<a.outHeight;++M){for(var O=M*s-v,L=O;L<0;)L+=l;for(var z=Math.min(a.inHeight,d+O),P=D+M*I,B=0;B<a.outWidth;++B){for(var W=B*u-g,V=W;V<0;)V+=p;for(var U=Math.min(a.inWidth,f+W),G=P+B*S,H=y,j=0,q=0,K=R;K<F;K+=c){for(var X=C+K*r[1],Y=L;Y<z;Y+=l){for(var J=X+Y*r[2],Q=V;Q<U;Q+=p){var Z=e[J+Q*r[3]+E];if("max"===i&&Z>H?H=Z:"avg"===i&&(j+=Z,q++),isNaN(H))break}if(isNaN(H))break}if(isNaN(H))break}x[G+E]="avg"===i?j/Math.max(q,1):H}}}return b}var YM={kernelName:Nn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;FR(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Dv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Vi.arraysEqual(l.inShape,l.outShape))c=UR({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=Vi.computeStrides(a.shape),d=qM(p,a.shape,a.dtype,h,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var JM={kernelName:Cn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;FR(a,"avgPool3d");var l=Dv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=XM(n.data.get(a.dataId).values,a.shape,a.dtype,Vi.computeStrides(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var QM={kernelName:En,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;FR([a,i],"avgPool3DGrad");for(var l=Dv.computePool3DInfo(i.shape,o,s,1,u,c),p=l.strideDepth,h=l.strideHeight,d=l.strideWidth,f=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,I=x-1-l.padInfo.front,S=w-1-l.padInfo.left,N=k-1-l.padInfo.top,T=wu(i.shape,"float32"),C=1/(f*m*v),E=n.bufferSync(a),_=0;_<l.batchSize;++_)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var F=0;F<l.inHeight;++F)for(var D=0;D<l.inWidth;++D){for(var M=R-I,O=F-N,L=D-S,z=0,P=0;P<x;P+=g){var B=(M+P)/p;if(!(B<0||B>=l.outDepth||Math.floor(B)!==B))for(var W=0;W<k;W+=y){var V=(O+W)/h;if(!(V<0||V>=l.outHeight||Math.floor(V)!==V))for(var U=0;U<w;U+=b){var G=(L+U)/d;if(!(G<0||G>=l.outWidth||Math.floor(G)!==G))z+=E.get(_,B,V,G,A)}}}T.set(z*C,_,R,F,D,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var ZM={kernelName:Tn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;FR([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Dv.computePool2DInfo(o.shape,s,u,1,c),p=l.strideHeight,h=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=wu(o.shape,"float32"),w=1/(d*f),I=n.data.get(a.dataId).values,S=wu(a.shape,"float32",I),N=0;N<l.batchSize;++N)for(var T=0;T<l.inChannels;++T)for(var C=0;C<l.inHeight;++C)for(var E=0;E<l.inWidth;++E){for(var _=C-x,A=E-b,R=0,F=0;F<g;F+=m){var D=(_+F)/p;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var M=0;M<y;M+=v){var O=(A+M)/h;if(!(O<0||O>=l.outWidth||Math.floor(O)!==O))R+=S.get(N,D,O,T)}}k.set(R*w,N,C,E,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var $M={kernelName:kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Vi.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Vi.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Vi.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),FR([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,h=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=f.length,g=d.length,y=h.length,b=p.length,x=0,k=0,w=0,I=0,S=0;S<l.length;++S)m[S]=f[x++]+(l[S]-p[k++])*d[w++]/Math.sqrt(h[I++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),I>=y&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var eO={kernelName:An,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;FR([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=Dv.getReshaped(a.shape,i,s),c=Dv.getPermuted(u.length,i.length),l=Dv.getReshapedPermuted(a.shape,i,s),p=Dv.getSliceBeginCoords(o,i.length),h=Dv.getSliceSize(l,o,i.length),d=kM({inputs:{x:a},backend:n,attrs:{shape:u}}),f=cD({inputs:{x:d},backend:n,attrs:{perm:c}}),m=kM({inputs:{x:f},backend:n,attrs:{shape:l}}),v=DD({inputs:{x:m},backend:n,attrs:{begin:p,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var tO={kernelName:Rn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=tF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var nO={kernelName:Mn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Dv.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},rO=sF(zn,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),aO={kernelName:zn,backendName:"cpu",kernelFunc:rO},iO={kernelName:Bn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Vi.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function oO(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var sO={kernelName:Er,backendName:"cpu",kernelFunc:oO};function uO(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Vi.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Dv.assertParamsConsistent(i,a);var o=Dv.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Vi.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Vi.sizeFromShape(e.shape)>0}));if(1===s.length)return UR({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){var u=s.map((function(e){return HR({inputs:{input:e},backend:n})})),c=s.map((function(e){return oO({inputs:{input:e},backend:n})})),l=uO({inputs:u,backend:n,attrs:{axis:a}}),p=uO({inputs:c,backend:n,attrs:{axis:a}}),h=BR({inputs:{real:l,imag:p},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),h}var d=s.map((function(e){var t=[-1,Vi.sizeFromShape(e.shape.slice(a))];return kM({inputs:{x:e},backend:n,attrs:{shape:t}})})),f=d.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));o=Dv.computeOutShape(d.map((function(e){return e.shape})),1);var m=1===d[0].shape[0],v=hF(f,o,t[0].dtype,m),g=Dv.computeOutShape(s.map((function(e){return e.shape})),a),y=n.makeTensorInfo(g,t[0].dtype,v);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}var cO={kernelName:Wn,backendName:"cpu",kernelFunc:uO};function lO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;FR([a,i],"conv2d");for(var p=Dv.convertConv2DDataFormat(u),h=Dv.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,p),d=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new wo(h.outShape,a.dtype),k=Vi.computeStrides(a.shape),w=Vi.computeStrides(i.shape),I=k[0],S=b?k[1]:k[2],N=b?k[2]:1,T=b?1:k[1],C=x.strides[0],E=b?x.strides[1]:x.strides[2],_=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values,M=0;M<h.batchSize;++M)for(var O=M*I,L=M*C,z=0;z<h.outHeight;++z)for(var P=L+z*E,B=z*h.strideHeight-y,W=0;W<d;++W){var V=B+W*m;if(!(V<0||V>=h.inHeight))for(var U=W*w[0],G=O+V*S,H=0;H<h.outWidth;++H)for(var j=P+H*_,q=H*h.strideWidth-g,K=0;K<f;++K){var X=q+K*v;if(!(X<0||X>=h.inWidth))for(var Y=G+X*N,J=U+K*w[1],Q=0;Q<h.inChannels;++Q){for(var Z=R[Y+Q*T],$=0;$<h.outChannels;++$)D[j+$*A]+=Z*F[J+$];J+=h.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var pO={kernelName:Vn,backendName:"cpu",kernelFunc:lO};var hO={kernelName:Un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;FR([a,i],"conv2dBackpropFilter");for(var p=Dv.convertConv2DDataFormat(u),h=Dv.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g="channelsLast"===h.dataFormat,y=new wo(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=new wo(a.shape,a.dtype,k),S=new wo(i.shape,i.dtype,w),N=0;N<m;++N)for(var T=Math.max(0,Math.ceil((x-N)/d)),C=Math.min(h.outHeight,(h.inHeight+x-N)/d),E=0;E<v;++E)for(var _=Math.max(0,Math.ceil((b-E)/f)),A=Math.min(h.outWidth,(h.inWidth+b-E)/f),R=0;R<h.inChannels;++R)for(var F=0;F<h.outChannels;++F){for(var D=0,M=0;M<h.batchSize;++M)for(var O=T;O<C;++O)for(var L=N+O*d-x,z=_;z<A;++z){var P=E+z*f-b;D+=g?I.get(M,L,P,R)*S.get(M,O,z,F):I.get(M,R,L,P)*S.get(M,F,O,z)}y.set(D,N,E,R,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var dO={kernelName:Gn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;FR([a,i],"conv2dBackpropInput");var p=Vi.computeStrides(i.shape),h=Vi.computeStrides(a.shape),d=Dv.convertConv2DDataFormat(c),f=Dv.computeConv2DInfo(o,i.shape,s,1,u,l,!1,d),m=new wo(f.inShape,"float32"),v=m.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,b=C(p,3),x=b[0],k=b[1],w=b[2],I=f.batchSize,S=f.filterHeight,N=f.filterWidth,T=f.inChannels,E=f.inHeight,_=f.inWidth,A=f.outChannels,R=f.outHeight,F=f.outWidth,D=f.strideHeight,M=f.strideWidth;d=f.dataFormat;for(var O=S-1-f.padInfo.top,L=N-1-f.padInfo.left,z="channelsLast"===d,P=m.strides[0],B=z?m.strides[1]:m.strides[2],W=z?m.strides[2]:1,V=z?1:m.strides[1],U=h[0],G=z?h[1]:h[2],H=z?h[2]:1,j=z?1:h[1],q=0;q<I;++q)for(var K=0;K<T;++K)for(var X=0;X<E;++X)for(var Y=X-O,J=Math.max(0,Math.ceil(Y/D)),Q=Math.min(R,(S+Y)/D),Z=0;Z<_;++Z){for(var $=Z-L,ee=Math.max(0,Math.ceil($/M)),te=Math.min(F,(N+$)/M),ne=0,re=J;re<Q;++re)for(var ae=re*D-Y,ie=ee;ie<te;++ie)for(var oe=U*q+G*re+H*ie,se=x*(S-1-ae)+k*(N-1-(ie*M-$))+w*K,ue=0;ue<A;++ue){ne+=g[oe+j*ue]*y[se+ue]}v[P*q+B*X+W*Z+V*K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var fO={kernelName:Hn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;FR([a,i],"conv3d");for(var c=Dv.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,h=c.filterWidth,d=c.dilationDepth,f=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new wo(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=x.values,S=Vi.computeStrides(a.shape),N=Vi.computeStrides(i.shape),T=0;T<c.batchSize;++T)for(var C=T*S[0],E=T*x.strides[0],_=0;_<c.outDepth;++_)for(var A=E+_*x.strides[1],R=_*c.strideDepth-g,F=0;F<l;++F){var D=R+F*d;if(!(D<0||D>=c.inDepth))for(var M=F*N[0],O=C+D*S[1],L=0;L<c.outHeight;++L)for(var z=A+L*x.strides[2],P=L*c.strideHeight-b,B=0;B<p;++B){var W=P+B*f;if(!(W<0||W>=c.inHeight))for(var V=M+B*N[1],U=O+W*S[2],G=0;G<c.outWidth;++G)for(var H=z+G*c.outChannels,j=G*c.strideWidth-y,q=0;q<h;++q){var K=j+q*m;if(!(K<0||K>=c.inWidth))for(var X=V+q*N[2],Y=U+K*c.inChannels,J=X,Q=0;Q<c.inChannels;++Q){for(var Z=k[Y+Q],$=0;$<c.outChannels;++$)I[H+$]+=Z*w[J+$];J+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var mO={kernelName:jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;FR([a,i],"conv3dBackpropFilterV2");for(var c=Vi.computeStrides(a.shape),l=Vi.computeStrides(i.shape),p=Dv.computeConv3DInfo(a.shape,u,o,1,s),h=p.strideDepth,d=p.strideHeight,f=p.strideWidth,m=p.filterDepth,v=p.filterHeight,g=p.filterWidth,y=new wo(p.filterShape,"float32"),b=y.values,x=C(y.strides,4),k=x[0],w=x[1],I=x[2],S=x[3],N=n.data.get(i.dataId).values,T=C(l,4),E=T[0],_=T[1],A=T[2],R=T[3],F=n.data.get(a.dataId).values,D=C(c,4),M=D[0],O=D[1],L=D[2],z=D[3],P=p.padInfo.front,B=p.padInfo.left,W=p.padInfo.top,V=0;V<m;++V)for(var U=Math.max(0,Math.ceil((P-V)/h)),G=Math.min(p.outDepth,(p.inDepth+P-V)/h),H=V*k,j=0;j<v;++j)for(var q=Math.max(0,Math.ceil((W-j)/d)),K=Math.min(p.outHeight,(p.inHeight+W-j)/d),X=j*w+H,Y=0;Y<g;++Y)for(var J=Math.max(0,Math.ceil((B-Y)/f)),Q=Math.min(p.outWidth,(p.inWidth+B-Y)/f),Z=Y*I+X,$=0;$<p.inChannels;++$)for(var ee=$*S+Z,te=0;te<p.outChannels;++te){for(var ne=0,re=0;re<p.batchSize;++re)for(var ae=re*M,ie=re*E,oe=U;oe<G;++oe)for(var se=(V+oe*h-P)*O+ae,ue=oe*_+ie,ce=q;ce<K;++ce)for(var le=(j+ce*d-W)*L+se,pe=ce*A+ue,he=J;he<Q;++he){var de=he*R+pe;ne+=F[(Y+he*f-B)*z+le+$]*N[de+te]}b[ee+te]=ne}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var vO={kernelName:qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;FR([a],"conv3dBackpropInputV2");for(var c=Vi.computeStrides(a.shape),l=Vi.computeStrides(i.shape),p=Dv.computeConv3DInfo(u,i.shape,s,1,o),h=new wo(p.inShape,"float32"),d=h.values,f=C(h.strides,4),m=f[0],v=f[1],g=f[2],y=f[3],b=n.data.get(a.dataId).values,x=C(c,4),k=x[0],w=x[1],I=x[2],S=x[3],N=n.data.get(i.dataId).values,T=C(l,4),E=T[0],_=T[1],A=T[2],R=T[3],F=p.batchSize,D=p.filterDepth,M=p.filterHeight,O=p.filterWidth,L=p.inChannels,z=p.inDepth,P=p.inHeight,B=p.inWidth,W=p.outChannels,V=p.outDepth,U=p.outHeight,G=p.outWidth,H=p.strideDepth,j=p.strideHeight,q=p.strideWidth,K=D-1-p.padInfo.front,X=M-1-p.padInfo.top,Y=O-1-p.padInfo.left,J=0;J<F;++J)for(var Q=0;Q<L;++Q)for(var Z=0;Z<z;++Z)for(var $=Z-K,ee=Math.max(0,Math.ceil($/H)),te=Math.min(V,(D+$)/H),ne=0;ne<P;++ne)for(var re=ne-X,ae=Math.max(0,Math.ceil(re/j)),ie=Math.min(U,(M+re)/j),oe=0;oe<B;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/q)),ce=Math.min(G,(O+se)/q),le=0,pe=ee;pe<te;++pe)for(var he=pe*H-$,de=ae;de<ie;++de)for(var fe=de*j-re,me=ue;me<ce;++me)for(var ve=k*J+w*pe+I*de+S*me,ge=E*(D-1-he)+_*(M-1-fe)+A*(O-1-(me*q-se))+R*Q,ye=0;ye<W;++ye){le+=b[ve+ye]*N[ge+ye]}d[m*J+v*Z+g*ne+y*oe+Q]=le}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},gO=sF(Kn,(function(e){return Math.cos(e)})),yO={kernelName:Kn,backendName:"cpu",kernelFunc:gO},bO=sF(Xn,(function(e){return Math.cosh(e)})),xO={kernelName:Xn,backendName:"cpu",kernelFunc:bO};var kO={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=i.shape[0],v=C(s,2),g=v[0],y=v[1],b=wu([m,g,y,f],"float32"),x=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,I=Vi.computeStrides(a.shape),S=Vi.computeStrides(b.shape),N=0;N<m;N++){var T=4*N,E=x[T],_=x[T+1],A=x[T+2],R=x[T+3],F=k[N];if(!(F>=p))for(var D=g>1?(A-E)*(h-1)/(g-1):0,M=y>1?(R-_)*(d-1)/(y-1):0,O=0;O<g;O++){var L=g>1?E*(h-1)+O*D:.5*(E+A)*(h-1);if(L<0||L>h-1)for(var z=0;z<y;z++)for(var P=0;P<f;P++){var B=P+z*S[2]+O*S[1]+N*S[0];b.values[B]=c}else if("bilinear"===u)for(var W=Math.floor(L),V=Math.ceil(L),U=L-W,G=0;G<y;G++){var H=y>1?_*(d-1)+G*M:.5*(_+R)*(d-1);if(H<0||H>d-1)for(var j=0;j<f;j++){var q=j+G*S[2]+O*S[1]+N*S[0];b.values[q]=c}else for(var K=Math.floor(H),X=Math.ceil(H),Y=H-K,J=0;J<f;J++){var Q=J+K*I[2]+W*I[1]+F*I[0],Z=w[Q],$=w[Q=J+X*I[2]+W*I[1]+F*I[0]],ee=w[Q=J+K*I[2]+V*I[1]+F*I[0]],te=Z+($-Z)*Y,ne=ee+(w[Q=J+X*I[2]+V*I[1]+F*I[0]]-ee)*Y;Q=J+G*S[2]+O*S[1]+N*S[0],b.values[Q]=te+(ne-te)*U}}else for(var re=0;re<y;++re){var ae=y>1?_*(d-1)+re*M:.5*(_+R)*(d-1);if(ae<0||ae>d-1)for(var ie=0;ie<f;ie++){var oe=ie+re*S[2]+O*S[1]+N*S[0];b.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(L),ce=0;ce<f;ce++){var le=ce+se*I[2]+ue*I[1]+F*I[0],pe=ce+re*S[2]+O*S[1]+N*S[0];b.values[pe]=w[le]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var wO={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;FR(a,"cumprod");var u=Dv.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=cD({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Dv.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=Oo(c.dtype,"int32"),h=Vi.makeOnesTypedArray(Vi.sizeFromShape(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?1:d[y];else{var b=m(v,g-1);h[y]=o?d[b]*h[b]:d[y]*h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=cD({inputs:{x:x},backend:n,attrs:{perm:Dv.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var IO={kernelName:Jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;FR(a,"cumsum");var u=Dv.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=cD({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Dv.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=Oo(c.dtype,"int32"),h=Vi.makeZerosTypedArray(Vi.sizeFromShape(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?0:d[y];else{var b=m(v,g-1);h[y]=o?d[b]+h[b]:d[y]+h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=cD({inputs:{x:x},backend:n,attrs:{perm:Dv.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var SO={kernelName:Zn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=tF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=nF(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var NO={kernelName:$n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Vi.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,h=c*i,d=l/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(s*p*h*d),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<h;++k)for(var w=Math.floor(k/i),I=(x*i+k%i)*d,S=0;S<d;++S){var N=S+I+l*(w+c*(b+u*g));m[v++]=f[N]}return n.makeTensorInfo([s,p,h,d],a.dtype,m)}};function TO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;FR([a,i],"depthwiseConv2DNative");var l=Vi.computeStrides(a.shape),p=Vi.computeStrides(i.shape),h=u;null==h&&(h=[1,1]),Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,h),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(h,"'")}));for(var d=Dv.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),f=d.filterHeight,m=d.filterWidth,v=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,x=y.top,k=d.outChannels/d.inChannels,w=new wo(d.outShape,a.dtype),I=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,N=w.values,T=0;T<d.batchSize;++T)for(var C=T*l[0],E=T*w.strides[0],_=0;_<d.outHeight;++_)for(var A=E+_*w.strides[1],R=_*d.strideHeight-x,F=0;F<f;++F){var D=R+F*v;if(!(D<0||D>=d.inHeight))for(var M=F*p[0],O=C+D*l[1],L=0;L<d.outWidth;++L)for(var z=A+L*w.strides[2],P=L*d.strideWidth-b,B=0;B<m;++B){var W=P+B*g;if(!(W<0||W>=d.inWidth))for(var V=M+B*p[1],U=O+W*d.inChannels,G=z,H=V,j=0;j<d.inChannels;++j){for(var q=I[U+j],K=0;K<k;++K)N[G+K]+=q*S[H+K];G+=k,H+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var CO={kernelName:er,backendName:"cpu",kernelFunc:TO};var EO={kernelName:tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;FR([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=Dv.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=p.strideHeight,d=p.strideWidth,f=p.filterHeight,m=p.filterWidth,v=new wo(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new wo(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,I=new wo(i.shape,i.dtype,w),S=0;S<f;++S)for(var N=Math.max(0,Math.ceil((y-S)/h)),T=Math.min(p.outHeight,(p.inHeight+y-S)/h),C=0;C<m;++C)for(var E=Math.max(0,Math.ceil((g-C)/d)),_=Math.min(p.outWidth,(p.inWidth+g-C)/d),A=0;A<p.outChannels;++A){for(var R=Math.trunc(A/b),F=A%b,D=0,M=0;M<p.batchSize;++M)for(var O=N;O<T;++O)for(var L=S+O*h-y,z=E;z<_;++z){var P=C+z*d-g;D+=k.get(M,L,P,R)*I.get(M,O,z,A)}v.set(D,S,C,R,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var _O={kernelName:nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;FR([a,i],"depthwiseConv2DNativeBackpropInput");for(var p=Vi.computeStrides(a.shape),h=Vi.computeStrides(i.shape),d=Dv.computeConv2DInfo(l,i.shape,o,s,u,c,!0),f=new wo(d.inShape,"float32"),m=f.values,v=C(f.strides,3),g=v[0],y=v[1],b=v[2],x=n.data.get(a.dataId).values,k=C(p,3),w=k[0],I=k[1],S=k[2],N=n.data.get(i.dataId).values,T=C(h,3),E=T[0],_=T[1],A=T[2],R=d.batchSize,F=d.filterHeight,D=d.filterWidth,M=d.inChannels,O=d.inHeight,L=d.inWidth,z=d.outChannels,P=d.outHeight,B=d.outWidth,W=d.strideHeight,V=d.strideWidth,U=F-1-d.padInfo.top,G=D-1-d.padInfo.left,H=z/M,j=0;j<R;++j)for(var q=0;q<M;++q)for(var K=0;K<O;++K)for(var X=K-U,Y=Math.max(0,Math.ceil(X/W)),J=Math.min(P,(F+X)/W),Q=0;Q<L;++Q){for(var Z=Q-G,$=Math.max(0,Math.ceil(Z/V)),ee=Math.min(B,(D+Z)/V),te=0,ne=Y;ne<J;++ne)for(var re=ne*W-X,ae=$;ae<ee;++ae)for(var ie=w*j+I*ne+S*ae,oe=E*(F-1-re)+_*(D-1-(ae*V-Z))+A*q,se=0;se<H;++se){te+=x[ie+(q*H+se)]*N[oe+se]}m[g*j+y*K+b*Q+q]=te}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};var AO={kernelName:rr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Vi.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=wu([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Ie(r.shape),Ie(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},RO={kernelName:ar,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,h=c.data.get(i.dataId).values,d=i.shape.length,f=Dv.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=f.batchSize,v=f.inHeight,g=f.inWidth,y=f.inChannels,b=f.outHeight,x=f.outWidth,k=f.padInfo,w=f.strideHeight,I=f.strideWidth,S=f.filterHeight,N=f.filterWidth,T=f.dilationHeight,C=f.dilationWidth,E=f.outShape,_=Vi.sizeFromShape(E),A=E.length,R=Vi.getArrayFromDType(a.dtype,_),F=0;F<m;++F)for(var D=0;D<b;++D)for(var M=D*w-k.top,O=0;O<x;++O)for(var L=O*I-k.left,z=0;z<y;++z){for(var P=Number.MIN_SAFE_INTEGER,B=0;B<S;++B){var W=M+B*T;if(W>=0&&W<v)for(var V=0;V<N;++V){var U=L+V*C;if(U>=0&&U<g){var G=Vi.locToIndex([F,W,U,z],p,Vi.computeStrides(a.shape)),H=Vi.locToIndex([B,V,z],d,Vi.computeStrides(i.shape)),j=l[G]+h[H];j>P&&(P=j)}}}R[Vi.locToIndex([F,D,O,z],A,Vi.computeStrides(E))]=P}return{dataId:c.write(Vi.toTypedArray(R,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},FO={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Vi.toNestedArray(a.shape,l.data.get(a.dataId).values),h=Vi.toNestedArray(i.shape,l.data.get(i.dataId).values),d=Dv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;Vi.assert(o.rank===C.length,(function(){return"Error in ".concat(or,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var E=Vi.toNestedArray(C,l.data.get(o.dataId).values),_=Vi.makeZerosNestedTypedArray(i.shape,i.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,z=0,P=0,B=0;B<I;++B){var W=F+B*N;if(W>=0&&W<m)for(var V=0;V<S;++V){var U=M+V*T;if(U>=0&&U<v){var G=p[A][W][U][O]+h[B][V][O];G>L&&(L=G,z=B,P=V)}}}_[z][P][O]+=E[A][R][D][O]}return{dataId:l.write(Vi.toTypedArray(_,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},DO={kernelName:ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Vi.toNestedArray(a.shape,l.data.get(a.dataId).values),h=Vi.toNestedArray(i.shape,l.data.get(i.dataId).values),d=Dv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;Vi.assert(o.rank===C.length,(function(){return"Error in ".concat(ir,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var E=Vi.toNestedArray(C,l.data.get(o.dataId).values),_=Vi.makeZerosNestedTypedArray(a.shape,a.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,z=F<0?0:F,P=M<0?0:M,B=0;B<I;++B){var W=F+B*N;if(W>=0&&W<m)for(var V=0;V<S;++V){var U=M+V*T;if(U>=0&&U<v){var G=p[A][W][U][O]+h[B][V][O];G>L&&(L=G,z=W,P=U)}}}_[A][z][P][O]+=E[A][R][D][O]}return{dataId:l.write(Vi.toTypedArray(_,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};function MO(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;FR(i,"sum");var u=(t="bool"===i.dtype?KR({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):UR({inputs:{x:i},backend:r})).shape.length,c=Vi.parseAxisParam(o,t.shape),l=Dv.getAxesPermutation(c,u),p=c,h=t;null!=l&&(h=cD({inputs:{x:t},backend:r,attrs:{perm:l}}),p=Dv.getInnerMostAxes(p.length,u)),Dv.assertAxesAreInnerMostDims("sum",p,h.shape.length);for(var d=C(Dv.computeOutAndReduceShapes(h.shape,p),2),f=d[0],m=d[1],v=VR(r,f,Dv.upcastType(h.dtype,"int32")),g=Vi.sizeFromShape(m),y=r.data.get(v.dataId).values,b=r.data.get(h.dataId).values,x=0;x<y.length;++x){for(var k=x*g,w=0,I=0;I<g;++I)w+=b[k+I];y[x]=w}if(s){var S=v;v=kM({inputs:{x:v},backend:r,attrs:{shape:Dv.expandShapeToKeepDim(v.shape,c)}}),r.disposeIntermediateTensorInfo(S)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(h),v}var OO={kernelName:Xa,backendName:"cpu",kernelFunc:MO};var LO={kernelName:ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Dv.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Dv.checkEinsumDimSizes(o.length,u,a);for(var c=Dv.getEinsumComputePath(s,u),l=c.path,p=c.steps,h=p.length,d=null,f=o.length,m=[],v=0;v<h;++v){var g,y=Se(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,x=Dv.getEinsumPermutation(f,u[b]),k=x.permutationIndices,w=x.expandDims,I=void 0;Dv.isIdentityPermutation(k)?I=a[b]:(I=cD({inputs:{x:a[b]},backend:n,attrs:{perm:k}}),m.push(I));for(var S=I.shape.slice(),N=0;N<w.length;++N)S.splice(w[N],0,1);Vi.arraysEqual(I.shape,S)||(I=kM({inputs:{x:I},backend:n,attrs:{shape:S}}),m.push(I)),null===d?d=I:(d=tD({inputs:{a:I,b:d},backend:n}),m.push(d))}}catch(_){y.e(_)}finally{y.f()}v<h-1&&(l[v]>=0&&(d=MO({inputs:{x:d},backend:n,attrs:{axis:l[v]-(o.length-f),keepDims:!1}}),m.push(d)),f--)}for(var T=0,C=m;T<C.length;T++){var E=C[T];E!==d&&n.disposeIntermediateTensorInfo(E)}return d}};var zO={kernelName:lr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;FR([r,a],"eluGrad");for(var i=new Float32Array(Vi.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=0?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},PO=Dv.ERF_P,BO=Dv.ERF_A1,WO=Dv.ERF_A2,VO=Dv.ERF_A3,UO=Dv.ERF_A4,GO=Dv.ERF_A5,HO=sF(pr,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+PO*n);return t*(1-((((GO*r+UO)*r+VO)*r+WO)*r+BO)*r*Math.exp(-n*n))})),jO={kernelName:pr,backendName:"cpu",kernelFunc:HO};function qO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Vi.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),kM({inputs:{x:a},backend:n,attrs:{shape:s}})}var KO={kernelName:fr,backendName:"cpu",kernelFunc:qO},XO=PR((function(e,t){return e/t})),YO=YR(sr,XO),JO={kernelName:sr,backendName:"cpu",kernelFunc:YO};function QO(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Vi.sizeFromShape(c),p=Vi.getTypedArrayFromDType("float32",l),h=Vi.getTypedArrayFromDType("float32",l),d=0;d<a;d++){for(var f=DD({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=DD({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=BR({inputs:{real:f,imag:m},backend:n}),g=ZO(v,t,n),y=g.real,b=g.imag,x=Dv.mergeRealAndImagArrays(y,b),k=0;k<i;k++){var w=Dv.getComplexWithIndex(x,k);p[d*i+k]=w.real,h[d*i+k]=w.imag}n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var I=n.makeTensorInfo(c,"float32",p),S=n.makeTensorInfo(c,"float32",h),N=BR({inputs:{real:I,imag:S},backend:n});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(S),N}function ZO(e,t,n){var r=Vi.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=$O(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",Vi.createScalarValue(r,"float32")),h=UR({inputs:{x:p},backend:n}),d=JO.kernelFunc({inputs:{a:c,b:p},backend:n}),f=JO.kernelFunc({inputs:{a:l,b:h},backend:n}),m=n.data.get(d.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return s}var g=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=Dv.exponent(a*s,t,n),c=Dv.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),Dv.assignToTypedArray(r,i,o,a)}return r}(Dv.mergeRealAndImagArrays(i,o),r,t);return Dv.splitRealAndImagArrays(g)}function $O(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=Dv.mergeRealAndImagArrays(e,t),o=n/2,s=Dv.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),d=BR({inputs:{real:p,imag:h},backend:a}),f=Dv.complexWithOddIndex(i),m=f.real,v=f.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=BR({inputs:{real:y,imag:b},backend:a}),k=$O(u,c,o,r,a),w=k.real,I=k.imag,S=[w.length],N=a.makeTensorInfo(S,"float32",w),T=a.makeTensorInfo(S,"float32",I),C=BR({inputs:{real:N,imag:T},backend:a}),E=$O(m,v,o,r,a),_=E.real,A=E.imag,R=[_.length],F=a.makeTensorInfo(R,"float32",_),D=a.makeTensorInfo(R,"float32",A),M=BR({inputs:{real:F,imag:D},backend:a}),O=Dv.exponents(n,r),L=[O.real.length],z=a.makeTensorInfo(L,"float32",O.real),P=a.makeTensorInfo(L,"float32",O.imag),B=BR({inputs:{real:z,imag:P},backend:a}),W=tD({inputs:{a:B,b:M},backend:a}),V=$R({inputs:{a:C,b:W},backend:a}),U=tM({inputs:{a:C,b:W},backend:a}),G=HR({inputs:{input:V},backend:a}),H=HR({inputs:{input:U},backend:a}),j=oO({inputs:{input:V},backend:a}),q=oO({inputs:{input:U},backend:a}),K=uO({inputs:[G,H],backend:a,attrs:{axis:0}}),X=uO({inputs:[j,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,J=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:J}}var eL={kernelName:vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Vi.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=kM({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=QO(o,!1,n),u=kM({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function tL(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Vi.inferDtype(a),o=Vi.getArrayFromDType(i,Vi.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var nL={kernelName:gr,backendName:"cpu",kernelFunc:tL};var rL={kernelName:yr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=Vi.getTypedArrayFromDType(r.dtype,Vi.sizeFromShape(r.shape)),o=C(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],p=a.data.get(r.dataId).values,h=0;h<s;h++)for(var d=h*c*u*l,f=0;f<u;f++)for(var m=f*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var b=Math.round(c-v-1),x=d+m+g+y,k=p[x];if(b>=0&&b<c)k=p[d+m+b*l+y];i[x]=k}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var aL={kernelName:Ti,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=lO({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=kM({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=$R({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=$R({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(d){var y=m;if("NCHW"===l&&"prelu"===d&&1===s.shape.length&&1!==s.shape[0]){var b=kM({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=xM(n,m,d,b,f),n.disposeIntermediateTensorInfo(b)}else m=xM(n,m,d,s,f);n.disposeIntermediateTensorInfo(y)}return m}};var iL={kernelName:Ci,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=TO({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;m=$R({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=xM(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}};var oL={kernelName:Ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Vi.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=C(Dv.prepareAndValidate(r,a),4),c=u[0],l=u[1],p=u[2],h=u[3];if(0===l)return n.makeTensorInfo(c,r.dtype,[]);var d=EF(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,l,s,p,h,r.shape,i);return n.makeTensorInfo(c,r.dtype,d.values)}};var sL={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;FR([a,i],"gatherV2");for(var u=Vi.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(){var e=c[h];Vi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=s;null==s&&(d=0);var f=Vi.sizeFromShape(i.shape),m=Dv.segment_util.collectGatherOpShapeInfo(a,i,u,d),v=kM({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=kM({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),y=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=_F(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var uL={kernelName:Cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Vi.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=kM({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=QO(o,!0,n),u=kM({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},cL=sF(_r,(function(e){return Number.isFinite(e)?1:0}),"bool"),lL={kernelName:_r,backendName:"cpu",kernelFunc:cL},pL=sF(Ar,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),hL={kernelName:Ar,backendName:"cpu",kernelFunc:pL},dL=sF(Rr,(function(e){return Number.isNaN(e)?1:0}),"bool"),fL={kernelName:Rr,backendName:"cpu",kernelFunc:dL};var mL={kernelName:Or,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=UF(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},vL=sF(zr,(function(e){return Math.log1p(e)})),gL={kernelName:zr,backendName:"cpu",kernelFunc:vL},yL=PR((function(e,t){return e&&t})),bL=YR(Pr,yL,null,"bool"),xL={kernelName:Pr,backendName:"cpu",kernelFunc:bL},kL=sF(Br,(function(e){return e?0:1}),"bool"),wL={kernelName:Br,backendName:"cpu",kernelFunc:kL},IL=PR((function(e,t){return e||t})),SL=YR(Wr,IL,null,"bool"),NL={kernelName:Wr,backendName:"cpu",kernelFunc:SL};var TL={kernelName:Hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;FR(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,h=Vi.sizeFromShape(a.shape),d=new Float32Array(h);function f(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<h;m++){var v=f(m),g=p[m]*Math.pow(o+s*v,-u);d[m]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var CL={kernelName:jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;FR(o,"LRNGrad");for(var p=Vi.sizeFromShape(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%h,x=y-b+Math.max(0,b-s),k=y-b+Math.min(h,b+s+1),w=0,I=x;I<k;I++)w+=Math.pow(f[I],2);w=c*w+u;for(var S=x;S<k;S++){var N=-2*c*l*f[S]*m[y]/w;y===S&&(N+=Math.pow(w,-l)),N*=d[y],v[S]+=N}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function EL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=Vi.parseAxisParam(i,u),p=l,h=Dv.getAxesPermutation(p,c),d=s.data.get(a.dataId).values;if(null!=h){for(var f=new Array(c),m=0;m<f.length;m++)f[m]=u[h[m]];d=uD(d,u,a.dtype,h,f),p=Dv.getInnerMostAxes(p.length,c),u=f}FR(a,"max"),Dv.assertAxesAreInnerMostDims("max",p,c);var v=C(Dv.computeOutAndReduceShapes(u,p),2),g=v[0],y=v[1],b=qF(d,Vi.sizeFromShape(y),g,a.dtype),x=s.write(b,g,a.dtype),k=g;return o&&(k=Dv.expandShapeToKeepDim(g,l)),{dataId:x,shape:k,dtype:a.dtype}}var _L={kernelName:Kr,backendName:"cpu",kernelFunc:EL};var AL={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;FR(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Dv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Vi.arraysEqual(l.inShape,l.outShape))c=UR({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=Vi.computeStrides(a.shape),d=qM(p,a.shape,a.dtype,h,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var RL={kernelName:Qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;FR(a,"maxPool3d");var l=Dv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=XM(n.data.get(a.dataId).values,a.shape,a.dtype,Vi.computeStrides(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var FL={kernelName:Zr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;FR([a,i],"maxPool3DGrad");for(var l=Dv.computePool3DInfo(i.shape,o,s,1,u,c),p=function(e,t){for(var n=wu(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-d,I=w;I<0;)I+=s;for(var S=Math.min(t.inHeight,l+w),N=0;N<t.outWidth;++N){for(var T=N*i-f,C=T;C<0;)C+=u;for(var E=Math.min(t.inWidth,p+T),_=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var F=R-y,D=I;D<S;D+=s)for(var M=D-w,O=C;O<E;O+=u){var L=O-T,z=e.get(m,R,D,O,v);z>=_&&(_=z,A=F*l*p+M*l+L)}n.set(A,m,g,k,N,v)}}}return n}(n.bufferSync(i),l),h=l.strideDepth,d=l.strideHeight,f=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,I=b-1-l.padInfo.top,S=wu(i.shape,"float32"),N=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var C=0;C<l.inChannels;++C)for(var E=0;E<l.inDepth;++E)for(var _=0;_<l.inHeight;++_)for(var A=0;A<l.inWidth;++A){for(var R=E-k,F=_-I,D=A-w,M=0,O=0;O<y;O+=m){var L=(R+O)/h;if(!(L<0||L>=l.outDepth||Math.floor(L)!==L))for(var z=0;z<b;z+=v){var P=(F+z)/d;if(!(P<0||P>=l.outHeight||Math.floor(P)!==P))for(var B=0;B<x;B+=g){var W=(D+B)/f;if(!(W<0||W>=l.outWidth||Math.floor(W)!==W)){var V=y*b*x-1-p.get(T,L,P,W,C)===O*b*x+z*x+B?1:0;if(0!==V)M+=N.get(T,L,P,W,C)*V}}}}S.set(M,T,E,_,A,C)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};var DL={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;FR([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Dv.computePool2DInfo(o.shape,s,u,1,c,l),h=n.data.get(o.dataId).values,d=wu(p.outShape,o.dtype,KM(h,o.shape,o.dtype,p).values),f=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=wu(o.shape,"float32"),I=n.data.get(a.dataId).values,S=wu(a.shape,"float32",I),N=0;N<p.batchSize;++N)for(var T=0;T<p.inChannels;++T)for(var C=0;C<p.inHeight;++C)for(var E=0;E<p.inWidth;++E){for(var _=C-k,A=E-x,R=0,F=0;F<y;F+=v){var D=(_+F)/f;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var M=0;M<b;M+=g){var O=(A+M)/m;if(!(O<0||O>=p.outWidth||Math.floor(O)!==O)){var L=y*b-1-d.get(N,D,O,T)===F*b+M?1:0;if(0!==L)R+=S.get(N,D,O,T)*L}}}w.set(R,N,C,E,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var ML={kernelName:$r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;FR(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,p=Dv.computePool2DInfo(a.shape,i,o,[1,1],s),h=function(e,t,n,r,a){var i=qM(e,0,n,Vi.computeStrides(t),a,"max"),o=KM(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,p),d=C(h,2),f=d[0],m=d[1],v=c.write(f,p.outShape,a.dtype),g=c.write(m,p.outShape,a.dtype);return[{dataId:v,shape:p.outShape,dtype:a.dtype},{dataId:g,shape:p.outShape,dtype:"int32"}]}};var OL={kernelName:ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Vi.parseAxisParam(i,a.shape),u=Dv.computeOutAndReduceShapes(a.shape,s)[1],c=Vi.sizeFromShape(u),l=[],p=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(p);var h=KR({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(h);var d=YO({inputs:{a:h,b:p},backend:n});l.push(d);var f=MO({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}};var LL={kernelName:ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;FR(a,"min");var s=Vi.parseAxisParam(i,a.shape),u=s,c=Dv.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=cD({inputs:{x:a},backend:n,attrs:{perm:c}}),u=Dv.getInnerMostAxes(u.length,a.shape.length)),Dv.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var p=C(Dv.computeOutAndReduceShapes(l.shape,u),2),h=p[0],d=p[1],f=Vi.sizeFromShape(d),m=Vi.makeZerosTypedArray(Vi.sizeFromShape(h),l.dtype),v=n.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*f,b=v[y],x=0;x<f;++x){var k=v[y+x];(Number.isNaN(k)||k<b)&&(b=k)}m[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(h,l.dtype,m);if(o){var I=kM({inputs:{x:w},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(h,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}};var zL={kernelName:ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;FR(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,h=a.shape.length,d=Vi.computeStrides(a.shape),f=Vi.sizeFromShape(s),m=s.length,v=Vi.computeStrides(s),g=Vi.getTypedArrayFromDType(a.dtype,f),y=0;y<f;y++){for(var b=Vi.indexToLoc(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=Vi.locToIndex(b,h,d);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},PL=PR((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),BL=YR(aa,PL),WL={kernelName:aa,backendName:"cpu",kernelFunc:BL},VL=ze(Ye());function UL(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Vi.parseAxisParam([s],a.shape),c=EL({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Dv.expandShapeToKeepDim(c.shape,u),p=kM({inputs:{x:c},backend:n,attrs:{shape:l}}),h=tM({inputs:{a:a,b:p},backend:n}),d=gF({inputs:{x:h},backend:n}),f=MO({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=kM({inputs:{x:f},backend:n,attrs:{shape:l}}),v=YO({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}var GL={kernelName:Qa,backendName:"cpu",kernelFunc:UL};var HL={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;FR(a,"multinomial");for(var u=s?a:UL({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,h=[c,i],d=Vi.makeZerosTypedArray(Vi.sizeFromShape(h),"int32"),f=0;f<c;++f){var m=f*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=VL.alea(o.toString()),b=f*i,x=0;x<i;++x){var k=y();d[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){d[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}},jL=Bg.nonMaxSuppressionV3Impl;var qL={kernelName:ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;FR(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=jL(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},KL=Bg.nonMaxSuppressionV4Impl;var XL={kernelName:la,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;FR(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=KL(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},YL=Bg.nonMaxSuppressionV5Impl;var JL={kernelName:pa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;FR(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=YL(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}};var QL={kernelName:da,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;FR(a,"oneHot");var c=Vi.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var p=n.data.get(a.dataId).values,h=0;h<c;++h)p[h]>=0&&p[h]<o&&(l[h*o+p[h]]=s);return n.makeTensorInfo([].concat(Ie(a.shape),[o]),i,l)}};function ZL(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=HR({inputs:{input:r},backend:n}),i=ZL({inputs:{x:a},backend:n}),o=oO({inputs:{input:r},backend:n}),s=ZL({inputs:{x:o},backend:n}),u=BR({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return tL({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var $L={kernelName:ki,backendName:"cpu",kernelFunc:ZL};var ez={kernelName:ha,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=HR({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=oO({inputs:{input:a},backend:r}),u=ZL({inputs:{x:s},backend:r}),c=BR({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return tL({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function tz(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return qO({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Vi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Vi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=qO({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=uO({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var nz={kernelName:fa,backendName:"cpu",kernelFunc:tz};var rz={kernelName:ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;FR(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Vi.sizeFromShape(a.shape),p=a.shape.length,h=Vi.computeStrides(a.shape),d=Vi.sizeFromShape(s),f=s.length,m=Vi.computeStrides(s),v=Vi.getTypedArrayFromDType(a.dtype,d);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Vi.indexToLoc(g,p,h).map((function(e,t){return e+u[t]}));v[Vi.locToIndex(y,f,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},az=PR((function(e,t){return Math.pow(e,t)})),iz=YR(ga,az),oz={kernelName:ga,backendName:"cpu",kernelFunc:iz};var sz={kernelName:xa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,p=C(vD(s,u,c,i.shape,i.dtype,l,o.shape),3),h=p[0],d=p[1],f=p[2],m=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),v=n.makeTensorInfo(f,i.dtype,d);return m.concat([v])}};var uz={kernelName:ka,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(yD(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],p=c[1];return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([p.length],r.dtype,p)]}};var cz={kernelName:wa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=n.data.get(o.dataId).values,h=s.map((function(e){return n.data.get(e.dataId).values})),d=s.map((function(e){return e.shape})),f=C(ID(c,a.shape,l,i.shape,i.dtype,p,o.shape,h,d,u),2),m=f[0],v=f[1];return n.makeTensorInfo(m,i.dtype,v)}};var lz={kernelName:Ia,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=SD(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},pz=sF(Na,(function(e){return 1/e})),hz={kernelName:Na,backendName:"cpu",kernelFunc:pz};var dz={kernelName:Aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;FR(a,"resizeBilinear");for(var u=Vi.computeStrides(a.shape),c=C(s,2),l=c[0],p=c[1],h=C(a.shape,4),d=h[0],f=h[1],m=h[2],v=h[3],g=n.data.get(a.dataId).values,y=new Float32Array(Vi.sizeFromShape([d,l,p,v])),b=[i&&l>1?f-1:f,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=0,w=b[0]/x[0],I=b[1]/x[1],S=0;S<d;S++)for(var N=0;N<l;N++){var T=void 0;T=o?w*(N+.5)-.5:w*N;for(var E=Math.max(0,Math.floor(T)),_=T-E,A=Math.min(f-1,Math.ceil(T)),R=S*u[0]+E*u[1],F=S*u[0]+A*u[1],D=0;D<p;D++){var M=void 0;M=o?I*(D+.5)-.5:I*D;for(var O=Math.max(0,Math.floor(M)),L=M-O,z=Math.min(m-1,Math.ceil(M)),P=R+O*u[2],B=F+O*u[2],W=R+z*u[2],V=F+z*u[2],U=0;U<v;U++){var G=g[P+U],H=g[B+U],j=G+(g[W+U]-G)*L,q=j+(H+(g[V+U]-H)*L-j)*_;y[k++]=q}}}return n.makeTensorInfo([d,l,p,v],"float32",y)}};var fz={kernelName:Ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;FR([i,a],"resizeBilinearGrad");for(var s=Vi.computeStrides(a.shape),u=C(a.shape,4),c=u[0],l=u[1],p=u[2],h=u[3],d=C(i.shape,3),f=d[1],m=d[2],v=new Float32Array(c*l*p*h),g=[o&&f>1?l-1:l,o&&m>1?p-1:p],y=[o&&f>1?f-1:f,o&&m>1?m-1:m],b=g[0]/y[0],x=g[1]/y[1],k=n.data.get(i.dataId).values,w=0,I=0;I<c;I++)for(var S=I*s[0],N=0;N<f;N++)for(var T=N*b,E=Math.floor(T),_=Math.min(Math.ceil(T),l-1),A=S+E*s[1],R=S+_*s[1],F=T-E,D=1-F,M=0;M<m;M++)for(var O=M*x,L=Math.floor(O),z=Math.min(Math.ceil(O),p-1),P=O-L,B=1-P,W=A+L*s[2],V=A+z*s[2],U=R+L*s[2],G=R+z*s[2],H=D*B,j=D*P,q=F*B,K=F*P,X=0;X<h;X++){var Y=k[w++];v[W+X]+=Y*H,v[V+X]+=Y*j,v[U+X]+=Y*q,v[G+X]+=Y*K}return n.makeTensorInfo([c,p,l,h],"float32",v)}};var mz={kernelName:Ea,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;FR(a,"resizeNearestNeighbor");for(var u=Vi.computeStrides(a.shape),c=C(s,2),l=c[0],p=c[1],h=C(a.shape,4),d=h[0],f=h[1],m=h[2],v=h[3],g=n.data.get(a.dataId).values,y=new Float32Array(d*l*p*v),b=[i&&l>1?f-1:f,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=b[0]/x[0],w=b[1]/x[1],I=0,S=0;S<d;S++)for(var N=S*u[0],T=0;T<l;T++){var E=o?k*(T+.5):k*T,_=Math.min(f-1,i?Math.round(E):Math.floor(E));o&&(_=Math.max(0,_));for(var A=N+_*u[1],R=0;R<p;R++){var F=o?w*(R+.5):w*R,D=Math.min(m-1,i?Math.round(F):Math.floor(F));o&&(D=Math.max(0,D));for(var M=A+D*u[2],O=0;O<v;O++){var L=g[M+O];y[I++]=L}}}return n.makeTensorInfo([d,l,p,v],a.dtype,y)}};var vz={kernelName:_a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;FR([i,a],"resizeNearestNeighborGrad");for(var s=Vi.computeStrides(a.shape),u=Vi.computeStrides(i.shape),c=C(a.shape,4),l=c[0],p=c[1],h=c[2],d=c[3],f=C(i.shape,3),m=f[1],v=f[2],g=new Float32Array(l*p*h*d),y=n.data.get(i.dataId).values,b=[o&&m>1?p-1:p,o&&v>1?h-1:h],x=[o&&m>1?m-1:m,o&&v>1?v-1:v],k=b[0]/x[0],w=b[1]/x[1],I=1/k,S=1/w,N=2*Math.ceil(I)+2,T=2*Math.ceil(S)+2,E=0;E<l;E++)for(var _=E*s[0],A=0;A<p;A++)for(var R=_+A*s[1],F=Math.floor(A*I),D=Math.floor(F-N/2),M=0;M<h;M++)for(var O=R+M*s[2],L=Math.floor(M*S),z=Math.floor(L-T/2),P=0;P<d;P++){for(var B=0,W=0;W<N;W++){var V=W+D;if(!(V<0||V>=m)){var U=_+V*u[1],G=V*k;if(A===Math.min(p-1,o?Math.round(G):Math.floor(G)))for(var H=0;H<T;H++){var j=H+z;if(!(j<0||j>=v)){var q=U+j*u[2],K=j*w;M===Math.min(h-1,o?Math.round(K):Math.floor(K))&&(B+=y[q+P])}}}}g[O+P]=B}return n.makeTensorInfo(a.shape,a.dtype,g)}};var gz={kernelName:Da,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;FR(a,"reverse");var o=a.shape.length,s=Vi.parseAxisParam(i,a.shape);if(0===o)return UR({inputs:{x:a},backend:n});for(var u=new wo(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(p),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,Ie(t))].concat(Ie(e)))},p=0;p<u.size;p++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},yz={kernelName:Si,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=Vi.getTypedArrayFromDType(a.dtype,Vi.sizeFromShape(a.shape)),l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(Dv.getImageCenter(s,h,d),2),v=m[0],g=m[1],y=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,k=0;k<p;k++)for(var w=k*d*h*f,I=0;I<h;I++)for(var S=I*(d*f),N=0;N<d;N++)for(var T=N*f,E=0;E<f;E++){var _=[p,I,N,E],A=_[2],R=_[1],F=(A-v)*b-(R-g)*y,D=(A-v)*y+(R-g)*b;F=Math.round(F+v),D=Math.round(D+g);var M=o;if("number"!=typeof o&&(M=3===E?255:o[E]),F>=0&&F<d&&D>=0&&D<h)M=x[w+D*(d*f)+F*f+E];c[w+S+T+E]=M}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},bz=sF(Ma,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),xz={kernelName:Ma,backendName:"cpu",kernelFunc:bz};var kz={kernelName:La,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Dv.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=ED(n.bufferSync(a),n.bufferSync(i),o,h,l,c,u,p,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function wz(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function Iz(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var Sz={kernelName:Pa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Vi.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?wz(u,t[l+c]):Iz(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var Nz={kernelName:Ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;FR([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=Oo(a.dtype,i.dtype),p=Vi.makeZerosTypedArray(Vi.sizeFromShape(a.shape),l),h=0,d=0===o||o>1||1===a.shape.length?1:Vi.sizeFromShape(a.shape.slice(1)),f=0;f<s.length;f++)for(var m=0;m<d;m++)1===s[f]?p[h++]=u[f]:p[h++]=c[f];return n.makeTensorInfo(a.shape,l,p)}},Tz=Dv.SELU_SCALEALPHA,Cz=Dv.SELU_SCALE,Ez=sF(Wa,(function(e){return e>=0?Cz*e:Tz*(Math.exp(e)-1)})),_z={kernelName:Wa,backendName:"cpu",kernelFunc:Ez},Az=sF(Ha,(function(e){return e<0?-1:e>0?1:0})),Rz={kernelName:Ha,backendName:"cpu",kernelFunc:Az},Fz=sF(Ua,(function(e){return Math.sin(e)})),Dz={kernelName:Ua,backendName:"cpu",kernelFunc:Fz},Mz=sF(Ga,(function(e){return Math.sinh(e)})),Oz={kernelName:Ga,backendName:"cpu",kernelFunc:Mz},Lz=Math.log(1.1920928955078125e-7)+2,zz=sF(qa,(function(e){var t=e>-Lz,n=e<Lz,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),Pz={kernelName:qa,backendName:"cpu",kernelFunc:zz};var Bz={kernelName:Ya,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;FR([a],"spaceToBatchND");var s=Vi.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Ie(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=rz.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Dv.getReshaped(l.shape,i,s,!1),h=Dv.getPermuted(p.length,i.length,!1),d=Dv.getReshapedPermuted(l.shape,i,s,!1),f=kM({inputs:{x:l},backend:n,attrs:{shape:p}}),m=cD({inputs:{x:f},backend:n,attrs:{perm:h}}),v=kM({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var Wz={kernelName:Za,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],p=C(OD(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=p[0],d=p[1],f=p[2],m=p[3],v=p[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((function(e){return Number(e)})))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}};var Vz={kernelName:$a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=C(LD(s,r.shape,r.dtype,o,u),3),l=c[0],p=c[1],h=c[2];return[n.makeTensorInfo(p,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};var Uz={kernelName:ei,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(zD(o,r.shape,r.dtype,s,u,!0),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var Gz={kernelName:ti,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(zD(o,r.shape,r.dtype,s,u),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var Hz={kernelName:ni,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=Dv.calculateShapes(o,i,u),l=c.sliceRank,p=c.numUpdates,h=c.sliceSize,d=c.strides,f=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=ED(v,r.bufferSync(o),u,f,h,p,l,d,!!r.data.get(s.dataId).values[0],m);break;case"float32":t=ED(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"int32":t=ED(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"string":t=ED(v,r.bufferSync(o),u,f,h,p,l,d,Vi.decodeString(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var jz={kernelName:Ja,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Vi.parseAxisParam(o,a.shape)[0],u=Dv.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Ie(l);t[s]=e;var r=DD({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},qz={kernelName:ai,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;FR(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},Kz=sF(wi,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),Xz={kernelName:wi,backendName:"cpu",kernelFunc:Kz};var Yz={kernelName:oi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,h=r.shrinkAxisMask;FR(a,"stridedSlice");var d,f=sv.sliceInfo(a.shape,i,o,s,u,c,l,p,h),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)d=kM({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){Vi.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var I=sv.computeOutShape(x,k,w),S=DD({inputs:{x:a},backend:n,attrs:{begin:x,size:I}});d=kM({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(S)}else{var N=KD(m,n.bufferSync(a),w,x);d=n.makeTensorInfo(v,N.dtype,N.values)}return d}};var Jz={kernelName:si,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,h=C(YD(n.data.get(l.dataId).values,n.data.get(p.dataId).values,a,i,o,s,u,c),2),d=h[0],f=h[1];return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(p.shape,"int32",f)]}};var Qz={kernelName:ui,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=C(QD(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),3),s=o[0],u=o[1],c=o[2],l=u.length;return[n.makeTensorInfo([l,2],"int32",s),n.makeTensorInfo([l],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(c))]}};var Zz={kernelName:ci,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=ZD(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},$z=sF(pi,(function(e){return Math.tan(e)})),eP={kernelName:pi,backendName:"cpu",kernelFunc:$z},tP=sF(hi,(function(e){return Math.tanh(e)}));var nP={kernelName:za,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.tensor,a=t.indices,i=t.updates,o=Dv.calculateShapes(i,a,r.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,p=o.outputSize,h=n.bufferSync(a),d=n.bufferSync(i),f=n.bufferSync(r),m=ED(h,d,r.shape,p,c,u,s,l,f,!1);return n.makeTensorInfo(r.shape,m.dtype,m.values)}};var rP={kernelName:di,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;FR(a,"tile");var o=rM(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};var aP={kernelName:fi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;FR(a,"topk");var s=C(oM(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),2),u=s[0],c=s[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};var iP={kernelName:mi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(null!=c?c:[h,d],2),v=m[0],g=m[1],y=[p,v,g,f],b=Vi.computeStrides(a.shape),x=b[0],k=b[1],w=b[2],I=Vi.computeStrides(y),S=I[0],N=I[1],T=I[2],E=Vi.getTypedArrayFromDType(a.dtype,Vi.sizeFromShape(y));E.fill(u);for(var _=r.data.get(a.dataId).values,A=r.data.get(i.dataId).values,R=0;R<p;++R){for(var F=1===i.shape[0]?A:A.subarray(8*R,8*R+8),D=0;D<v;++D)for(var M=0;M<g;++M)for(var O=0;O<f;++O){var L=void 0,z=F[6]*M+F[7]*D+1;if(0!==z){var P=(F[0]*M+F[1]*D+F[2])/z,B=(F[3]*M+F[4]*D+F[5])/z,W=oP(P,d,s),V=oP(B,h,s);switch(o){case"nearest":L=uP(_,h,d,x,k,w,R,V,W,O,u);break;case"bilinear":L=cP(_,h,d,x,k,w,R,V,W,O,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(o))}E[R*S+D*N+M*T+O]=L}}return r.makeTensorInfo(y,a.dtype,E)}return{dataId:r.write(E,y,a.dtype),shape:a.shape,dtype:a.dtype}}};function oP(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Vi.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Vi.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Vi.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function sP(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function uP(e,t,n,r,a,i,o,s,u,c,l){return sP(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function cP(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),h=Math.floor(u),d=p+1,f=h+1;return(d-s)*((f-u)*sP(e,t,n,r,a,i,o,p,h,c,l)+(u-h)*sP(e,t,n,r,a,i,o,p,f,c,l))+(s-p)*((f-u)*sP(e,t,n,r,a,i,o,d,h,c,l)+(u-h)*sP(e,t,n,r,a,i,o,d,f,c,l))}var lP={kernelName:gi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;FR(i,"unique");var o=sM(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var pP={kernelName:yi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var d=new Array(s),f=0;f<d.length;f++){p[i]=f;var m=DD({inputs:{x:a},backend:n,attrs:{begin:p,size:h}});d[f]=kM({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return d}};for(var hP={kernelName:bi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;FR(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var h=qO({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=h,u.push(h)}for(var d=0;d<o;++d){var f=Vi.createScalarValue(d,"int32"),m=n.makeTensorInfo([],"int32",f),v=fF({inputs:{a:m,b:l},backend:n}),g=KR({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=tD({inputs:{a:g,b:a},backend:n}),b=MO({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=tz({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},dP=0,fP=[NM,zR,CM,_M,eF,AM,RM,FM,DM,MM,LM,PM,WM,GM,jM,YM,JM,QM,ZM,SM,$M,eO,tO,iF,nO,XR,pF,aO,WR,iO,cO,pO,hO,dO,fO,mO,vO,yO,xO,kO,wO,IO,SO,NO,CO,EO,_O,AO,RO,FO,DO,LO,lM,zO,mF,jO,yF,KO,kF,eL,nL,rL,SF,CF,aL,iL,oL,sL,FF,OF,GR,uL,sO,lL,hL,fL,hM,PF,VF,mL,jF,gL,xL,wL,NL,TL,CL,_L,YF,AL,RL,FL,DL,ML,OL,LL,ZF,zL,WL,HL,nD,aD,qL,XL,JL,sD,QL,ez,nz,rz,oz,mM,hD,sz,uz,cz,lz,jR,JO,hz,gM,bM,wM,dz,fz,mz,vz,gz,yz,xz,CD,kz,Sz,Nz,_z,RD,Rz,Dz,Oz,MD,GL,Pz,Bz,Wz,Vz,Uz,Gz,Hz,jz,WD,qz,GD,qD,Xz,Yz,Jz,Qz,Zz,nM,OO,eP,{kernelName:hi,backendName:"cpu",kernelFunc:tP},nP,rP,aP,iP,lD,lP,pP,hP,$L];dP<fP.length;dP++){Oi(fP[dP])}var mP={};Le(mP,{assertNotComplex:function(){return SB},bindCanvasToFramebuffer:function(){return eB},bindColorTextureToFramebuffer:function(){return tB},bindTextureToProgramUniformSampler:function(){return $P},bindTextureUnit:function(){return YP},bindVertexBufferToProgramAttribute:function(){return XP},callAndCheck:function(){return CP},canBeRepresented:function(){return AP},createFragmentShader:function(){return MP},createFramebuffer:function(){return KP},createProgram:function(){return BP},createStaticIndexBuffer:function(){return GP},createStaticVertexBuffer:function(){return UP},createTexture:function(){return jP},createVertexShader:function(){return DP},getBatchDim:function(){return sB},getExtensionOrThrow:function(){return FP},getFramebufferErrorMessage:function(){return aB},getMaxTexturesInShader:function(){return vB},getNumChannels:function(){return HP},getProgramUniformLocation:function(){return ZP},getProgramUniformLocationOrThrow:function(){return QP},getRowsCols:function(){return uB},getShapeAs3D:function(){return cB},getTextureShapeFromLogicalShape:function(){return lB},getWebGLDisjointQueryTimerVersion:function(){return gB},getWebGLErrorMessage:function(){return RP},getWebGLMaxTextureSize:function(){return dB},hasExtension:function(){return yB},isCapableOfRenderingToFloatTexture:function(){return xB},isDownloadFloatTextureEnabled:function(){return kB},isReshapeFree:function(){return hB},isWebGLFenceEnabled:function(){return IB},isWebGLVersionEnabled:function(){return bB},linkProgram:function(){return WP},logShaderSourceAndInfoLog:function(){return PP},resetMaxTextureSize:function(){return fB},resetMaxTexturesInShader:function(){return mB},unbindColorTextureFromFramebuffer:function(){return nB},unbindTextureUnit:function(){return JP},validateFramebuffer:function(){return rB},validateProgram:function(){return VP},validateTextureSize:function(){return qP}});var vP,gP,yP,bP={},xP={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function kP(e,t){bP[e]=t}function wP(e,t){if(!(e in bP)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if(!on().getBool("IS_SAFARI")&&"undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete bP[e]}),!1),on().getBool("SOFTWARE_WEBGL_ENABLED")&&(xP.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",xP)||n.getContext("experimental-webgl",xP):n.getContext("webgl2",xP)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;bP[e]=n}var r=bP[e];return null==r||r.isContextLost()?(delete bP[e],wP(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),bP[e])}function IP(e,t){return[t,e]}function SP(e){var t=Vi.sizeFromShape(e),n=Math.ceil(t/4);return Vi.sizeToSquarishShape(n)}function NP(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function TP(e,t){var n,r,a,i,o,s,u,c,l,p,h=e;return 2===on().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,u=4,c=1,l=h.HALF_FLOAT,p=h.FLOAT,s=h.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function CP(e,t){var n=t();return on().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+RP(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(vP||(vP={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(gP||(gP={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(yP||(yP={}));var EP=5.96e-8,_P=65504;function AP(e){return!!(on().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||EP<Math.abs(e)&&Math.abs(e)<_P)}function RP(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function FP(e,t){return iB(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function DP(e,t){var n=iB(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(CP(e,(function(){return e.shaderSource(n,t)})),CP(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function MP(e,t){var n=iB(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(CP(e,(function(){return e.shaderSource(n,t)})),CP(e,(function(){return e.compileShader(n)})),on().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw PP(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var OP,LP,zP=/ERROR: [0-9]+:([0-9]+):/g;function PP(e,t){var n=zP.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Vi.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Vi.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function BP(e){return iB(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function WP(e,t){if(CP(e,(function(){return e.linkProgram(t)})),!on().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function VP(e,t){if(CP(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function UP(e,t){var n=iB(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return CP(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),CP(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function GP(e,t){var n=iB(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return CP(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),CP(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function HP(){return 2===on().getNumber("WEBGL_VERSION")?1:4}function jP(e){return iB(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function qP(e,t){var n=on().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}function KP(e){return iB(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function XP(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(CP(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),CP(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),CP(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function YP(e,t,n){oB(e,n),CP(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function JP(e,t){oB(e,t),CP(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function QP(e,t,n){return iB(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function ZP(e,t,n){return e.getUniformLocation(t,n)}function $P(e,t,n,r){CP(e,(function(){return YP(e,t,r)})),CP(e,(function(){return e.uniform1i(n,r)}))}function eB(e){CP(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),CP(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),CP(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))}function tB(e,t,n){CP(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),CP(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function nB(e,t){CP(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),CP(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function rB(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+aB(e,t))}function aB(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function iB(e,t,n){var r=CP(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function oB(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function sB(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Vi.sizeFromShape(e.slice(0,e.length-t))}function uB(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function cB(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[sB(e)].concat(Ie(uB(e)))),t}function lB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=on().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=on().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&on().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((function(t,n){return n>=e.length-2?Vi.nearestLargerEven(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length&&(e=Vi.squeezeShape(e).newShape);var a=Vi.sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);var o=null!=i&&Math.max.apply(Math,Ie(i))>r&&Math.min.apply(Math,Ie(i))<=(t?2:1)&&Math.min.apply(Math,Ie(i))>0;if(null==i||o)if(t){var s,u=sB(e),c=2,l=2;e.length&&(c=(s=C(uB(e),2))[0],l=s[1]),a=u*(c/2)*(l/2),i=Vi.sizeToSquarishShape(a).map((function(e){return 2*e}))}else i=Vi.sizeToSquarishShape(a);return i}function pB(e){return e%2===0}function hB(e,t){if(e=e.slice(-2),t=t.slice(-2),Vi.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e[e.length-1],r=t[t.length-1];if(n===r||pB(n)&&pB(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&pB(e[0])&&pB(t[0])}function dB(e){if(null==OP){var t=wP(e);OP=t.getParameter(t.MAX_TEXTURE_SIZE)}return OP}function fB(){OP=null}function mB(){LP=null}function vB(e){if(null==LP){var t=wP(e);LP=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,LP)}function gB(e){if(0===e)return 0;var t=wP(e);return yB(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:yB(t,"EXT_disjoint_timer_query")?1:0}function yB(e,t){return null!=e.getExtension(t)}function bB(e){try{if(null!=wP(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function xB(e){if(0===e)return!1;var t=wP(e);if(1===e){if(!yB(t,"OES_texture_float"))return!1}else if(!yB(t,"EXT_color_buffer_float"))return!1;return wB(t)}function kB(e){if(0===e)return!1;var t=wP(e);if(1!==e){if(yB(t,"EXT_color_buffer_float"))return wB(t);var n="EXT_color_buffer_half_float";if(yB(t,n)){var r=t.getExtension(n);return function(e,t){var n=TP(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!(!yB(t,"OES_texture_float")||!yB(t,"WEBGL_color_buffer_float"))&&wB(t)}function wB(e){var t=TP(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function IB(e){return 2===e&&null!=wP(e).fenceSync}function SB(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Vi.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var NB=on();function TB(){var e,t,n,r,a,i,o,s,u,c;return 2===on().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=on().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function CB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Vi.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function EB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Vi.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function _B(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(e.map((function(e,t){return t})),t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(r[a]),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(r[a]):"index -= ".concat(e[a]," * ").concat(r[a]);return"".concat(i,"; ").concat(o,";")})).join("")}function AB(e){var t=Vi.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}NB.registerFlag("HAS_WEBGL",(function(){return NB.getNumber("WEBGL_VERSION")>0})),NB.registerFlag("WEBGL_VERSION",(function(){return bB(2)?2:bB(1)?1:0})),NB.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),NB.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===NB.get("WEBGL_VERSION")})),NB.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),NB.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),NB.registerFlag("WEBGL_PACK",(function(){return NB.getBool("HAS_WEBGL")})),NB.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_CLIP",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_REDUCE",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_CONV_IM2COL",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return dB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return vB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=NB.getNumber("WEBGL_VERSION");return 0===e?0:gB(e)})),NB.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return NB.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Qo.isMobile()})),NB.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return xB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!NB.getBool("WEBGL_FORCE_F16_TEXTURES")&&NB.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),NB.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return kB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return IB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return NB.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),NB.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),NB.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Qo.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),NB.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),NB.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),NB.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),NB.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),NB.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),NB.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return NB.getBool("IS_TEST")})),NB.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),NB.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),NB.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),NB.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var RB="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",FB=Dv.getBroadcastDims;function DB(e,t,n){var r=[];if(e.forEach((function(e){var t=Vi.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(GB(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?OB(e,r):MB(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=FB(e.shapeInfo.logicalShape,t.logicalShape),c=UB(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var h="";h=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var d="return outputValue;",f=1===Vi.sizeFromShape(e.shapeInfo.logicalShape),m=1===Vi.sizeFromShape(t.logicalShape);if(1!==o||f||m){if(f&&!m)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(v)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(h,");\n      ").concat(d,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Vi.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=UB(u),p=FB(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(d[e+h]," = 0;")})).join("\n");var f="";return f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+h])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=TB(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(LB,"\n    ").concat(zB,"\n    ").concat(PB,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Vi.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Vi.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(EB(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=CB(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(EB(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=CB(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=CB(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=CB(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=BB),[p,l,i,o,a,s,n.userCode].join("\n")}function MB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=C(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=WB(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=C(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(VB(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=WB(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Vi.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Vi.squeezeShape(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){var h=HB(e,p),d=["row","col"];return"\n      ".concat(MB(h,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(jB(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(VB(e),"\n      }\n    ");var f=i[0],m=i[1],v=WB(r);return 1===m?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===f?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Vi.squeezeShape(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=HB(e,l),h=["row","col","depth"];return"\n        ".concat(MB(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(jB(h,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var d=e.shapeInfo.texShape,f=d[0],m=d[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=WB(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Vi.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=HB(e,c),h=["row","col","depth","depth2"];return"\n      ".concat(MB(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(jB(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=WB(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Vi.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=HB(e,c),h=["row","col","depth","depth2","depth3"];return"\n      ".concat(MB(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(jB(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(VB(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1];if(v===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=WB(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Vi.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=HB(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(MB(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(jB(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,p=t[3]*l,h=t[2]*p,d=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(h,", ").concat(p,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===d&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=WB(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(h," + depth * ").concat(p," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function OB(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=TB();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=TB();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=TB();if(null!=i&&Vi.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=HB(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(OB(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(jB(c,s),");\n        }\n      ")}var l=TB();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],h=o[1],d=Math.ceil(n[2]/2),f=d*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(h,", ").concat(f,", ").concat(d,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=TB();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),h=p*Math.ceil(i[o-2]/2),d="int b, int row, int col",f="b * ".concat(h," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)d="int b".concat(m,", ")+d,h*=i[o-m-1],f="b".concat(m," * ").concat(h," + ")+f;return"\n    vec4 ".concat(r,"(").concat(d,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var LB="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zB="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",PB="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",BB="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function WB(e){return"offset".concat(e)}function VB(e){var t=e.name,n=Vi.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function UB(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function GB(e,t,n){var r=Vi.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Vi.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function HB(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function jB(e,t){return t.map((function(t){return e[t]})).join(", ")}function qB(e,t,n){var r,a,i,o,s=[],u=[],c=null;o=e.getUniformLocation(n,"NAN",!1),1===on().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));var l,p=!1,h=Se(t.variableNames);try{for(h.s();!(l=h.n()).done;){var d=l.value,f={name:d,uniform:e.getUniformLocation(n,d,p),offset:e.getUniformLocation(n,"offset".concat(d),p)};t.enableShapeUniforms&&(f.shape=e.getUniformLocation(n,"".concat(d,"Shape"),p),f.texShape=e.getUniformLocation(n,"".concat(d,"TexShape"),p)),s.push(f)}}catch(y){h.e(y)}finally{h.f()}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",p),i=e.getUniformLocation(n,"outShapeStrides",p),a=e.getUniformLocation(n,"outTexShape",p)),t.customUniforms){var m,v=Se(t.customUniforms);try{for(v.s();!(m=v.n()).done;){var g=m.value;u.push(e.getUniformLocation(n,g.name,p))}}catch(y){v.e(y)}finally{v.f()}}return{variablesLocations:s,customUniformLocations:u,infLoc:c,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function KB(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Vi.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Vi.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function XB(e){return on().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var YB=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=vP.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=TB();this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?EB(["r","c","d"],t):CB(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),JB=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=vP.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=TB();this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?EB(["r","c","d"],t):CB(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),QB=we((function e(t){xe(this,e),this.variableNames=["A"],this.outTexUsage=gP.DOWNLOAD;var n=TB();this.outputShape=t,this.userCode="\n      ".concat(RB,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),ZB=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gP.DOWNLOAD;var n=TB();this.outputShape=t,this.userCode="\n      ".concat(RB,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),$B={R:0,G:1,B:2,A:3},eW=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";xe(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=TB();this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat($B[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":AB(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),tW=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=TB();this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":AB(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")})),nW={};function rW(e){var t=TB();return DP(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function aW(e){return UP(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function iW(e){return GP(e,new Uint16Array([0,1,2,2,1,3]))}function oW(e,t,n,r,a,i){qP(t,n);var o=jP(e),s=e.TEXTURE_2D;return CP(e,(function(){return e.bindTexture(s,o)})),CP(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),CP(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),CP(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),CP(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===on().getNumber("WEBGL_VERSION")?CP(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):CP(e,(function(){return e.texStorage2D(s,1,r,t,n)})),CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function sW(e){return e.internalFormatFloat}function uW(e,t,n,r){var a=C(IP(t,n),2);return oW(e,a[0],a[1],sW(r),r.textureFormatFloat,e.FLOAT)}function cW(e){return e.internalFormatHalfFloat}function lW(e,t,n,r){var a=C(IP(t,n),2);return oW(e,a[0],a[1],cW(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function pW(e){return e.downloadTextureFormat}function hW(e,t,n,r){var a=C(IP(t,n),2);return oW(e,a[0],a[1],pW(r),e.RGBA,e.UNSIGNED_BYTE)}function dW(e){return e.internalFormatPackedFloat}function fW(e,t,n,r){var a=C(NP(t,n),2);return oW(e,a[0],a[1],dW(r),e.RGBA,e.FLOAT)}function mW(e){return e.internalFormatPackedHalfFloat}function vW(e,t,n,r){var a=C(NP(t,n),2);return oW(e,a[0],a[1],mW(r),e.RGBA,r.textureTypeHalfFloat)}function gW(e,t,n){return CP(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),XP(e,t,"clipSpacePos",n,3,20,0)&&XP(e,t,"uv",n,2,20,12)}function yW(e,t,n,r,a,i){var o,s,u;CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===on().getNumber("WEBGL_VERSION")?CP(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):CP(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function bW(e,t,n){CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===on().getNumber("WEBGL_VERSION")?CP(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):CP(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===on().getNumber("WEBGL_VERSION")?CP(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):CP(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),CP(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function xW(e,t,n,r){var a=e.createBuffer();CP(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return CP(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),CP(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),CP(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function kW(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function wW(e,t,n,r){var a=C(IP(t,n),2),i=a[0],o=a[1],s=new Uint8Array(function(e,t){return e*t}(t*n,4));return CP(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}function IW(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=C(NP(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function SW(e,t,n){var r=new Float32Array(t*n*4);return CP(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}Le(nW,{bindVertexProgramAttributeStreams:function(){return gW},createBufferFromOutputTexture:function(){return xW},createFloat16MatrixTexture:function(){return lW},createFloat16PackedMatrixTexture:function(){return vW},createFloat32MatrixTexture:function(){return uW},createIndexBuffer:function(){return iW},createPackedMatrixTexture:function(){return fW},createUnsignedBytesMatrixTexture:function(){return hW},createVertexBuffer:function(){return aW},createVertexShader:function(){return rW},downloadByteEncodedFloatMatrixFromOutputTexture:function(){return wW},downloadFloat32MatrixFromBuffer:function(){return kW},downloadMatrixFromPackedOutputTexture:function(){return SW},downloadPackedMatrixFromBuffer:function(){return IW},getInternalFormatForFloat16MatrixTexture:function(){return cW},getInternalFormatForFloat16PackedMatrixTexture:function(){return mW},getInternalFormatForFloat32MatrixTexture:function(){return sW},getInternalFormatForPackedMatrixTexture:function(){return dW},getInternalFormatForUnsignedBytesMatrixTexture:function(){return pW},uploadDenseMatrixToTexture:function(){return yW},uploadPixelDataToTexture:function(){return bW}});var NW=function(){function e(t){xe(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=on().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,kP(n,t)):this.gl=wP(n),t=this.gl,2===on().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return CP(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return CP(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return CP(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return CP(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return CP(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return CP(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return CP(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return CP(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===on().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=FP(this.gl,"OES_texture_float"),yB(this.gl,s))this.textureHalfFloatExtension=FP(this.gl,s);else if(on().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),yB(this.gl,o))this.colorBufferHalfFloatExtension=FP(this.gl,o);else if(on().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",yB(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!yB(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=aW(this.gl),this.indexBuffer=iW(this.gl),this.framebuffer=KP(this.gl),this.textureConfig=TP(this.gl,this.textureHalfFloatExtension)}return we(e,[{key:"debug",get:function(){return on().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;CP(t,(function(){return t.finish()})),CP(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),CP(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),CP(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),CP(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),CP(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),uW(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),lW(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),hW(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),bW(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),yW(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),vW(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),fW(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(nB(this.gl,this.framebuffer),this.outputTexture=null),CP(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return wW(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return IW(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return kW(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=xW(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(on().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return SW(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=rW(n));var r=BP(n);CP(n,(function(){return n.attachShader(r,t.vertexShader)})),CP(n,(function(){return n.attachShader(r,e)})),WP(n,r);var a=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&VP(n,a),a}},{key:"buildVao",value:function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;CP(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),gW(n,e,this.vertexBuffer)}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(CP(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&VP(this.gl,this.program),CP(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?QP(this.gl,e,t):ZP(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),CP(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),$P(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=C(NP(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&VP(this.gl,this.program),rB(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}CP(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),CP(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=FP(this.gl,2===on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Vi.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in on().platform&&(n=on().platform.setTimeoutCustom.bind(on().platform)),Vi.repeatedTry((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),tB(this.gl,e,this.framebuffer),this.debug&&rB(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(tB(this.gl,this.outputTexture,this.framebuffer),this.debug&&rB(this.gl)):nB(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;tB(r,e,this.framebuffer),this.debug&&rB(r),this.outputTexture=e,CP(r,(function(){return r.viewport(0,0,t,n)})),CP(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),CP(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var TW=OR.addImpl,CW=OR.bincountImpl,EW=OR.bincountReduceImpl,_W=OR.castImpl,AW=OR.ceilImpl,RW=OR.concatImpl,FW=OR.equalImpl,DW=OR.expImpl,MW=OR.expm1Impl,OW=OR.floorImpl,LW=OR.gatherNdImpl,zW=OR.gatherV2Impl,PW=OR.greaterImpl,BW=OR.greaterEqualImpl,WW=OR.lessImpl,VW=OR.lessEqualImpl,UW=OR.linSpaceImpl,GW=OR.logImpl,HW=OR.maxImpl,jW=OR.maximumImpl,qW=OR.minimumImpl,KW=OR.multiplyImpl,XW=OR.negImpl,YW=OR.notEqualImpl,JW=OR.prodImpl,QW=OR.raggedGatherImpl,ZW=OR.raggedRangeImpl,$W=OR.raggedTensorToTensorImpl,eV=OR.rangeImpl,tV=OR.rsqrtImpl,nV=OR.scatterImpl,rV=OR.sigmoidImpl,aV=OR.simpleAbsImpl,iV=OR.sliceImpl,oV=OR.sparseFillEmptyRowsImpl,sV=OR.sparseReshapeImpl,uV=OR.sparseSegmentReductionImpl,cV=OR.sqrtImpl,lV=OR.staticRegexReplaceImpl,pV=OR.stridedSliceImpl,hV=OR.stringNGramsImpl,dV=OR.stringSplitImpl,fV=OR.stringToHashBucketFastImpl,mV=OR.subImpl,vV=OR.tileImpl,gV=OR.topKImpl,yV=OR.transposeImpl,bV=OR.uniqueImpl;function xV(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function kV(e,t){return 1===t?[e]:xV(e,t)}var wV=function(){function e(t){if(xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=XB(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=kV("rc",this.rank),r=UB(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return we(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),IV=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?_B(["r","c","d"],"inputShape"):CB(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":AB(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var SV=function(){function e(t){xe(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return we(e,[{key:"acquireTexture",value:function(e,t,n){var r=TV(t,n),a=CV(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=NV(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].pop();return this.usedTextures[a].push(s),s}return r===yP.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===yP.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===yP.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===yP.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===yP.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=TV(n,r),i=CV(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=NV(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=on().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u&&u.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function NV(e,t,n,r,a){var i,o=function(e,t){switch(e){case yP.PACKED_2X2_FLOAT32:return dW(t);case yP.PACKED_2X2_FLOAT16:return mW(t);case yP.UNPACKED_FLOAT32:return sW(t);case yP.UNPACKED_FLOAT16:return cW(t);case yP.PACKED_4X1_UNSIGNED_BYTE:return pW(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=C(NP(e[0],e[1]),2);i=s[0]*s[1]}else{var u=C(IP(e[0],e[1]),2);i=u[0]*u[1]}var c=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*c}function TV(e,t){if(e===gP.UPLOAD)return yP.PACKED_2X2_FLOAT32;if(e===gP.RENDER||null==e)return function(e){return on().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?yP.PACKED_2X2_FLOAT32:yP.UNPACKED_FLOAT32:e?yP.PACKED_2X2_FLOAT16:yP.UNPACKED_FLOAT16}(t);if(e===gP.DOWNLOAD||e===gP.PIXELS)return yP.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function CV(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var EV=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),_V="if (isnan(x)) return x;",AV="return x;",RV="return abs(x);",FV="return (x >= 0.0) ? x : (exp(x) - 1.0);",DV=_V+"\n  return (x < 0.0) ? 0.0 : x;\n",MV=_V+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",OV="return x;",LV="return 1.0 / (1.0 + exp(-1.0 * x));",zV="return x;",PV="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",BV="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",WV="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",VV="return 1.0 / (1.0 + exp(-1.0 * x));",UV=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),GV=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length);var n=t.length,r=kV("rc",n),a=UB(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),HV=Bg.whereImpl,jV={};var qV=on().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var KV=function(e){ye(n,e);var t=be(n);function n(e){var r,a;if(xe(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!on().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof NW)a=e;else{var i=wP(on().getNumber("WEBGL_VERSION"),e);a=new NW(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=wP(on().getNumber("WEBGL_VERSION"));a=new NW(o),r.binaryCache=function(e){return e in jV||(jV[e]={}),jV[e]}(on().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new SV(r.gpgpu),r.numMBBeforeWarning=null==on().global.screen?1024:on().global.screen.height*on().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new it(he(r),Ru()),ge(r)}return we(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=cB(t),c=new eW(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((on().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||on().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:gP.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(on().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:gP.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new UV(o,OV):new EV(o,OV);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,h,d=null!=this.activeTimers;if(d&&(p=Vi.now()),"complex64"===r){var f=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);h=Dv.mergeRealAndImagArrays(f,m)}else h=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=Vi.now()-p),this.convertAndCacheOnCPU(e,h)}},{key:"read",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return l=c?new UV(i,OV):new EV(i,OV),p=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),h=this.read(p.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(p),h));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!on().getBool("DEBUG")||on().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==on().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(d=null,"complex64"!==s&&on().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),v=this.texData.get(f.dataId),d=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat(Ie(SP(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:y=e.sent,b=y[0],x=y[1],g=Dv.mergeRealAndImagArrays(b,x),e.next=29;break;case 28:null==d?g=this.getValuesFromTexture(t):(k=Vi.sizeFromShape(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k));case 29:return null!=f&&this.disposeIntermediateTensorInfo(f),null!=d&&CP(I=this.gpgpu.gl,(function(){return I.deleteBuffer(d)})),S=this.convertAndCacheOnCPU(t,g),N=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),N.forEach((function(e){return e(S)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Ru().removeDataId(t,this),this.pendingDeletes--),S));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new UV(a,OV):new EV(a,OV);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var h=this.decode(e,t.customTexShape),d=Ru().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Vi.decodeString(e)}));return wu(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return wu(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!AP(n))throw on().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Vi.sizeFromShape(n);if(on().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(Ie(SP(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=on().getBool("WEBGL_PACK")&&!0===a,p=l?cB(n):n,h=l?new ZB(p):new QB(p),d=this.runWebGLProgram(h,[{shape:p,dtype:r,dataId:e}],"float32"),f=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),m}},{key:"timerAvailable",value:function(){return on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Vi.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Vi.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return S(w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=Vi.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Vi.now(),endMs:null}}},{key:"endTimer",value:function(e){return on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Vi.now(),e)}},{key:"getQueryTime",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(on().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qV;return on().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Vi.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){Dv.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return HV(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new UV(e.shape,t),a=this.compileAndRun(r,[e],n);return Ru().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=aV(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(on().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RV,e.dtype);var n=new EV(e.shape,RV),r=this.compileAndRun(n,[e]);return Ru().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Vi.isString(n[0])){var a=n.map((function(e){return Vi.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Ru().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new GV(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new wV(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[sB(e.shape)].concat(Ie(uB(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[sB(t)].concat(Ie(uB(t))),i=new IV(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=Vi.sizeFromShape(a),s=t[0]*t[1]*4;Vi.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=cB(a);u=r?new JB(c):new YB(c);var l=[null!=t?t:SP(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,l,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===vP.DENSE){var c=null!=o?o:SP(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Vi.sizeFromShape(s.shape))return u.values=Vi.getTypedArrayFromDType(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Vi.sizeFromShape(t.shape)<=on().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!hB(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var h,d={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=GB(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",h="";if(1===u.length&&e.packedInputs){var d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(d[0]>1,"_").concat(d[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=Vi.computeStrides(u);h="".concat(f[0]===i[1],"_").concat(f[f.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&Vi.arraysEqual(t.shape,i),g=1===Vi.sizeFromShape(t.shape),y=Dv.getBroadcastDims(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&Vi.arraysEqual(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(h,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(on().getNumber("WEBGL_VERSION"))}(e,p,d),m=this.getAndSaveBinary(f,(function(){return function(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=DB(a,o,t),u=MP(e.gl,s),c=e.createProgram(u);return on().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},qB(e,t,c)))}(a.gpgpu,e,p,d)})),v=null!=this.activeTimers;v&&(h=this.startTimer()),on().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(KB(t.inShapeInfos,n),KB([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===on().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(var s=0;s<n.length;++s){var u=n[s],c=t.variablesLocations[s],l=c.uniform,p=c.offset,h=c.shape,d=c.texShape;if(h){var f=GB(t.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(f.length){case 1:e.gl.uniform1iv(h,new Int32Array(f));break;case 2:e.gl.uniform2iv(h,new Int32Array(f));break;case 3:e.gl.uniform3iv(h,new Int32Array(f));break;case 4:e.gl.uniform4iv(h,new Int32Array(f))}}if(d&&e.gl.uniform2i(d,u.texData.texShape[0],u.texData.texShape[1]),null!=l){if(u.isUniform){if(Vi.sizeFromShape(u.shape)<2)e.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),e.gl.uniform1fv(l,m)}continue}null!=u.texData.slice&&null!=p&&e.gl.uniform1i(p,u.texData.slice.flatOffset),e.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=t.outShapeLocation;if(v)switch(r.shape.length){case 1:e.gl.uniform1iv(v,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(v,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(v,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(v,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var g=Vi.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(g));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(g));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(g))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(var y=0;y<t.program.customUniforms.length;++y){var b=t.program.customUniforms[y],x=t.customUniformLocations[y],k=a[y];if("float"===b.type)e.gl.uniform1fv(x,k);else if("vec2"===b.type)e.gl.uniform2fv(x,k);else if("vec3"===b.type)e.gl.uniform3fv(x,k);else if("vec4"===b.type)e.gl.uniform4fv(x,k);else if("int"===b.type)e.gl.uniform1iv(x,k);else if("ivec2"===b.type)e.gl.uniform2iv(x,k);else if("ivec3"===b.type)e.gl.uniform3iv(x,k);else{if("ivec4"!==b.type)throw Error("uniform type ".concat(b.type," is not supported yet."));e.gl.uniform4iv(x,k)}}e.executeProgram()}(this.gpgpu,m,p,d,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var g=on().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Vi.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!on().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(on().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Mu((function(){if(!on().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=on().getBool("DEBUG");on().set("DEBUG",!1);var n=e.abs(zl(1e-8)).dataSync()[0];if(on().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Vi.now());var l=t.texShape;if(null==l&&(l=lB(n,s),t.texShape=l),null!=a){var p,h,d=cB(n),f=l[1],m=l[0],v=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(s||!v)&&(f=(p=C(NP(l[0],l[1]),2))[0],m=p[1]),h=s?new tW(d,v):new eW(d,v);var g=v?[m,f]:l,y=this.makeTensorInfo(g,r),b=this.texData.get(y.dataId);b.usage=v?gP.PIXELS:gP.UPLOAD,b.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),f,m,a);var x=[[m,f]],k=this.runWebGLProgram(h,[y],r,x,!0),w=this.texData.get(k.dataId);t.texShape=w.texShape,t.isPacked=w.isPacked,t.usage=w.usage,on().get("ENGINE_COMPILE_ONLY")?this.disposeData(k.dataId):(t.texture=w.texture,t.values=null,this.texData.delete(k.dataId)),this.disposeIntermediateTensorInfo(y),c&&(this.uploadWaitMs+=Vi.now()-u)}else{var I=this.acquireTexture(l,o,r,s);t.texture=I}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Vi.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=C(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=C(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:o=w().mark((function e(){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=C(u[s],2),r=n[1],a=new Promise((function(e){try{c.checkCompletion_(r),e(!0)}catch(D0){throw D0}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),s=0,u=Object.entries(this.binaryCache);case 8:if(!(s<u.length)){e.next=13;break}return e.delegateYield(o(),"t0",10);case 10:s++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,Rv();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(PP(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.values(this.binaryCache);e<t.length;e++){var n=t[e];this.gpgpu.buildVao(n.webGLProgram);var r=qB(this.gpgpu,n.program,n.webGLProgram),a=r.variablesLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.outShapeLocation,c=r.outShapeStridesLocation,l=r.outTexShapeLocation;n.variablesLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.outShapeLocation=u,n.outShapeStridesLocation=c,n.outTexShapeLocation=l}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=Ru().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return Ru().makeTensorFromDataId(u,t,n,s)}}]),n}(ot);KV.nextDataId=0;var XV="4.5.0";function YV(){on().set("WEBGL_FORCE_F16_TEXTURES",!0)}Qo.isBrowser()&&Hu("webgl",(function(){return new KV}),2);var JV={forceHalfFloat:YV},QV="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",ZV=we((function e(t,n,r){xe(this,e),this.variableNames=["A","B"],this.outputShape=Dv.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=XB(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),$V="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",eU=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];xe(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Dv.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=XB(i);var o="";if(a)if(0===i||1===Vi.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(UB(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=kV("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function tU(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var nU={kernelName:Tr,backendName:"webgl",kernelFunc:tU};function rU(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=tU({inputs:{x:r},backend:n}),u=tU({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var aU={kernelName:Pn,backendName:"webgl",kernelFunc:rU},iU="return (a < 0.) ? b * a : a;",oU="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var sU={kernelName:Fr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Vi.createScalarValue(i,"float32")),s=on().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eU(oU,a.shape,o.shape):new ZV(iU,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},uU="return (a < 0.) ? b * a : a;",cU="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var lU={kernelName:ya,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=on().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eU(cU,r.shape,a.shape):new ZV(uU,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},pU="if (isnan(x)) return x;";function hU(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),h=r(p.values,l);return c.makeTensorInfo(u.shape,l,h)}return i=on().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new UV(u.shape,n):new EV(u.shape,t),c.runWebGLProgram(i,[u],l)}}function dU(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,p=i;if(o&&"complex64"===c.dtype){var h=p.texData.get(c.dataId),d=p.texData.get(l.dataId),f=[[h.complexTensorInfos.real,d.complexTensorInfos.real],[h.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=C(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new ZV(t,c.shape,l.shape);return p.runWebGLProgram(s,[i,o],Oo(r.dtype,a.dtype))})),m=C(f,2),v=m[0],g=m[1],y=rU({inputs:{real:v,imag:g},backend:p});return p.disposeIntermediateTensorInfo(v),p.disposeIntermediateTensorInfo(g),y}var b,x=u||Oo(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||p.shouldExecuteOnCPU([c,l]))&&null!=s){var k=p.texData.get(c.dataId).values,w=p.texData.get(l.dataId).values,I="string"===c.dtype?Dv.fromUint8ToStringArray(k):k,S="string"===c.dtype?Dv.fromUint8ToStringArray(w):w,N=C(s(c.shape,l.shape,I,S,x),2),T=N[0],E=N[1],_=p.makeTensorInfo(E,x);return p.texData.get(_.dataId).values=T,_}return b=on().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new eU(n,c.shape,l.shape,a):new ZV(t,c.shape,l.shape),p.runWebGLProgram(b,[c,l],x)}}function fU(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?zV:AV;if("relu"===e)return t?BV:DV;if("elu"===e)return t?PV:FV;if("relu6"===e)return t?WV:MV;if("prelu"===e)return t?cU:uU;if("leakyrelu"===e)return t?oU:iU;if("sigmoid"===e)return t?VV:LV;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var mU=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];xe(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=XB(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(x="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(x,";\n        for (int i = 0; i < ").concat(p,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(m[0],");\n          result += (").concat(f[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),vU={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},gU=we((function e(t,n,r){xe(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Dv.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),yU="return a * b;";function bU(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=Dv.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new gU(vU.REAL,a.shape,i.shape),l=new gU(vU.IMAG,a.shape,i.shape),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=r.runWebGLProgram(c,p,"float32"),d=r.runWebGLProgram(l,p,"float32"),f=rU({inputs:{real:h,imag:d},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),f}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),v=r.texData.get(i.dataId),g=C(KW(a.shape,i.shape,m.values,v.values,o),2),y=g[0],b=g[1],x=r.makeTensorInfo(b,o);return r.texData.get(x.dataId).values=y,x}return t=on().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eU(yU,a.shape,i.shape):new ZV(yU,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var xU={kernelName:oa,backendName:"webgl",kernelFunc:bU};function kU(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Vi.sizeFromShape(a.shape),u=Vi.inferFromImplicitShape(i,s),c=Vi.sizeFromShape(u);Vi.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||hB(a.shape,u)||null!==l.texture&&hB(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[sB(e.shape)].concat(Ie(uB(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[sB(t)].concat(Ie(uB(t))),o=new IV(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var wU={kernelName:Ca,backendName:"webgl",kernelFunc:kU},IU=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Vi.isInt(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),SU=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,h="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===n?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function NU(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Dv.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,h=void 0;h="mean"===n?0===o?new IU({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new IU({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new SU({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(h,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var TU=we((function e(t,n){xe(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=UB(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var CU=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=UB(this.rank),o=xV("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function EU(e,t,n){var r=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CU(e.shape,t):new TU(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function _U(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Vi.parseAxisParam(a,e.shape),s=o,u=Dv.getAxesPermutation(s,i),c=null!=u,l=e;c&&(l=EU(e,u,r),s=Dv.getInnerMostAxes(s.length,i)),Dv.assertAxesAreInnerMostDims("sum",s,i);var p=C(Dv.computeOutAndReduceShapes(l.shape,s),2),h=p[0],d=p[1],f=h;n&&(f=Dv.expandShapeToKeepDim(h,o));var m=Vi.sizeFromShape(d),v=kU({inputs:{x:l},attrs:{shape:[Vi.sizeFromShape(e.shape)/m,m]},backend:r}),g=NU(v,Lo(e.dtype),"sum",r),y=kU({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(g),c&&r.disposeIntermediateTensorInfo(l),y}(t.x,r.axis,r.keepDims,n)}var AU={kernelName:Xa,backendName:"webgl",kernelFunc:_U};function RU(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,h=yV(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=h}else t=EU(i,o,s);return t}var FU={kernelName:vi,backendName:"webgl",kernelFunc:RU},DU=1e3;function MU(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=Vi.sizeFromShape(x),I=Vi.sizeFromShape(k),S=dl.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);Vi.assert(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var N,T=r?[w,v,y]:[w,y,v],C=a?[I,b,g]:[I,g,b],E=kU({inputs:{x:t},backend:i,attrs:{shape:T}}),_=kU({inputs:{x:n},backend:i,attrs:{shape:C}}),A=[E,_],R=Math.max(w,I),F=r?E.shape[1]:E.shape[2],D=null!=s,M=null!=c,O="leakyrelu"===d,L=null!=d?fU(d,!0):null;if((1===y||1===b)&&F>DU&&!1===(D||M||O||null!=L)){var z=E,P=_;r&&(z=RU({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(z)),a&&(P=RU({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),A.push(P));var B=1===b,W=z;1!==b&&(W=kU({inputs:{x:z},backend:i,attrs:{shape:[R,F,1]}}),A.push(W));var V=1===b?2:1,U=P;B&&(U=kU({inputs:{x:P},backend:i,attrs:{shape:[R,1,F]}}),A.push(U));var G=bU({inputs:{a:W,b:U},backend:i});N=_U({inputs:{x:G},backend:i,attrs:{axis:V,keepDims:!0}}),A.push(G)}else{var H=Oo(t.dtype,n.dtype),j=new mU(T,C,[R,y,b],r,a,D,L,M,O),q=[E,_];if(null!=s&&q.push(s),M&&q.push(c),O){var K=i.makeTensorInfo([],"float32",Vi.createScalarValue(p,"float32"));q.push(K),A.push(K)}N=i.runWebGLProgram(j,q,H)}var X=kU({inputs:{x:N},backend:i,attrs:{shape:S}});A.push(N);for(var Y=0,J=A;Y<J.length;Y++){var Q=J[Y];i.disposeIntermediateTensorInfo(Q)}return X}var OU={kernelName:Ni,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return MU({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},LU="return abs(x);";var zU={kernelName:pn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=aV(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=on().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new UV(a.shape,LU):new EV(a.shape,LU),r.runWebGLProgram(t,[a],a.dtype)}},PU=hU({opSnippet:_V+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),BU={kernelName:hn,backendName:"webgl",kernelFunc:PU},WU=hU({opSnippet:_V+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),VU={kernelName:dn,backendName:"webgl",kernelFunc:WU},UU="return a + b;",GU=dU({opSnippet:UU,packedOpSnippet:UU,supportsComplex:!0,cpuKernelImpl:TW}),HU={kernelName:fn,backendName:"webgl",kernelFunc:GU},jU=we((function e(t,n){xe(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),qU=we((function e(t,n){xe(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var KU={kernelName:mn,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return tU({inputs:{x:a[0]},backend:r});if(a.length>on().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Oo(e,t)})),c=a.map((function(e){return e.shape})),l=on().getBool("WEBGL_PACK")?new qU(a[0].shape,c):new jU(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var XU={kernelName:vn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Vi.parseAxisParam(i,a.shape),c=u,l=Dv.getAxesPermutation(c,s),p=a;null!=l&&(p=RU({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Dv.getInnerMostAxes(c.length,s)),Dv.assertAxesAreInnerMostDims("all",c,s);var h,d=C(Dv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],m=d[1],v=kU({inputs:{x:p},backend:n,attrs:{shape:[-1,Vi.sizeFromShape(m)]}}),g=NU(v,v.dtype,"all",n);return h=kU(o?{inputs:{x:g},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(f,u)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),h}};var YU={kernelName:gn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Vi.parseAxisParam(i,a.shape),c=u,l=Dv.getAxesPermutation(c,s),p=a;null!=l&&(p=RU({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Dv.getInnerMostAxes(c.length,s)),Dv.assertAxesAreInnerMostDims("any",c,s);var h,d=C(Dv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],m=d[1],v=kU({inputs:{x:p},backend:n,attrs:{shape:[-1,Vi.sizeFromShape(m)]}}),g=NU(v,v.dtype,"any",n);return h=kU(o?{inputs:{x:g},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(f,u)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),h}},JU=we((function e(t,n,r){xe(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),QU=we((function e(t,n,r,a){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Vi.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=UB(l),h=kV("coords",l);if(1===o){var d=UB(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(h[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(h[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(h[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(h[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),m="."+f[u-1],v=f.map((function(e){return"int "+e})),g=kV("sourceLocR",u-1).concat("inIdx.r"),y=kV("sourceLocG",u-1).concat("inIdx.g"),b=kV("sourceLocB",u-1).concat("inIdx.b"),x=kV("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),I="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(h[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function ZU(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=Dv.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new JU(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=ZU(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function $U(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=Dv.computeOptimalWindowSize(i),s=new QU(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=$U(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function eG(e,t,n,r){var a=[n];if(Dv.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!on().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=C(Dv.computeOutAndReduceShapes(s.shape,a),2),c=u[0],l=u[1],p=Vi.sizeFromShape(l),h=kU({inputs:{x:s},backend:e,attrs:{shape:[-1,p]}});i.push(h);var d=ZU(e,h,r);i.push(d);var f=kU({inputs:{x:d},backend:e,attrs:{shape:c}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),f}return $U(e,t,r)}var tG={kernelName:yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Vi.parseAxisParam(i,a.shape),s=Dv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=RU({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Dv.getInnerMostAxes(o.length,u.shape.length)),Dv.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=eG(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var nG={kernelName:bn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Vi.parseAxisParam(i,a.shape),s=Dv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=RU({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Dv.getInnerMostAxes(o.length,u.shape.length)),Dv.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=eG(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},rG=hU({opSnippet:_V+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),aG={kernelName:xn,backendName:"webgl",kernelFunc:rG},iG=hU({opSnippet:_V+"return log(x + sqrt(x * x + 1.0));"}),oG={kernelName:kn,backendName:"webgl",kernelFunc:iG},sG=hU({opSnippet:_V+"\n  return atan(x);\n"}),uG={kernelName:wn,backendName:"webgl",kernelFunc:sG},cG=dU({opSnippet:QV+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$V+"\n  return result;\n"}),lG={kernelName:Sn,backendName:"webgl",kernelFunc:cG},pG=hU({opSnippet:_V+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),hG={kernelName:In,backendName:"webgl",kernelFunc:pG},dG=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var b="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(b="avgValue / max(count, 1.0)");var x=4*Math.floor(o/4),k=o%4,w="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}})),fG=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var k="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(k="avgValue / max(count, 1.0)");var w=4*Math.floor(o/4),I=o%4,S="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}}));var mG={kernelName:Nn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;SB(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Dv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Vi.arraysEqual(c.inShape,c.outShape))return tU({inputs:{x:a},backend:n});var l=new dG(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var vG={kernelName:Cn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Dv.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),p=new fG(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},gG=we((function e(t){xe(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,h=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),yG=we((function e(t){xe(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=p-1-t.padInfo.front,m=h-1-t.padInfo.top,v=d-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var bG={kernelName:En,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Dv.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new yG(l);return n.runWebGLProgram(p,[a],i.dtype)}};var xG={kernelName:Tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;SB([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Dv.computePool2DInfo(o.shape,s,u,1,c),p=new gG(l);return n.runWebGLProgram(p,[a],o.dtype)}};var kG={kernelName:_n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return MU({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},wG=we((function e(t,n,r,a,i,o){xe(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Dv.assertAndGetBroadcastShape(t,n),Dv.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(Dv.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Dv.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),IG=we((function e(t,n,r,a,i,o){xe(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Dv.assertAndGetBroadcastShape(t,n),Dv.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(Dv.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Dv.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),SG={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Vi.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Vi.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Vi.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var h=null;null!=u&&(h=u.shape,l.push(u));var d=on().getBool("WEBGL_PACK_NORMALIZATION")?new IG(a.shape,i.shape,o.shape,p,h,c):new wG(a.shape,i.shape,o.shape,p,h,c);return n.runWebGLProgram(d,l,l[0].dtype)}},NG=we((function e(t){xe(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=UB(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return TG.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(TG[t]," = start[").concat(t,"] + coords.").concat(TG[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),TG=["x","y","z","w","u","v"];var CG=we((function e(t){xe(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=UB(this.rank),r=kV("coords",this.rank),a=kV("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function EG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size,s=C(sv.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(sv.assertParamsValid(a,u,c),0===Vi.sizeFromShape(c))return n.makeTensorInfo(c,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var l=n.texData.get(a.dataId),p=iV(l.values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,p)}var h=n.texData.get(a.dataId).isPacked,d=sv.isSliceContinous(a.shape,u,c);if(h||!d){var f=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CG(c):new NG(c),m=[u];return n.runWebGLProgram(f,[a],a.dtype,m)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=sv.computeFlatOffset(t,Vi.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,u,c,n)}var _G={kernelName:Va,backendName:"webgl",kernelFunc:EG},AG={kernelName:An,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Vi.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=Dv.getReshaped(a.shape,i,s),c=Dv.getPermuted(u.length,i.length),l=Dv.getReshapedPermuted(a.shape,i,s),p=Dv.getSliceBeginCoords(o,i.length),h=Dv.getSliceSize(l,o,i.length),d=[],f=kU({inputs:{x:a},backend:n,attrs:{shape:u}}),m=RU({inputs:{x:f},backend:n,attrs:{perm:c}}),v=kU({inputs:{x:m},backend:n,attrs:{shape:l}}),g=EG({inputs:{x:v},backend:n,attrs:{begin:p,size:h}});return d.push(f),d.push(m),d.push(v),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var RG={kernelName:Rn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=CW(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var FG={kernelName:Mn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Dv.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},DG=dU({opSnippet:"return float(a != b);",cpuKernelImpl:YW,dtype:"bool"}),MG={kernelName:ua,backendName:"webgl",kernelFunc:DG};function OG(e){var t=e.inputs,n=e.backend,r=t.input;return tU({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var LG={kernelName:Sa,backendName:"webgl",kernelFunc:OG},zG="return float(int(x));";var PG={kernelName:On,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return tU({inputs:{x:i},backend:r});var s=Op(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=rU({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=OG({inputs:{input:i},backend:r}),p=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),p}if(!Vi.hasEncodingLoss(i.dtype,o)){var h=tU({inputs:{x:i},backend:r});return{dataId:h.dataId,shape:h.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var d=r.texData.get(i.dataId).values,f=C(_W(d,i.shape,i.dtype,o),3),m=f[0],v=f[1],g=f[2];return r.makeTensorInfo(m,v,g)}if("int32"===o)return function(e,t){var n=new EV(e.shape,zG),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var y=r.makeTensorInfo([],"bool",Vi.getTypedArrayFromDType("bool",1)),b=DG({inputs:{a:i,b:y},backend:r});return r.disposeIntermediateTensorInfo(y),b}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},BG="return ceil(x);",WG=hU({opSnippet:BG,packedOpSnippet:BG,cpuKernelImpl:AW}),VG={kernelName:Ln,backendName:"webgl",kernelFunc:WG},UG=we((function e(t){xe(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),GG=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var HG={kernelName:zn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=on().getBool("WEBGL_PACK_CLIP")?new GG(i.shape):new UG(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},jG=we((function e(t){xe(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function qG(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var KG={kernelName:Bn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new jG(r.shape),o=[qG(r,a.complexTensorInfos.real),qG(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},XG=we((function e(t){xe(this,e),this.outputShape=[],this.outputShape=Dv.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),YG=we((function e(t,n){xe(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Dv.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=UB(a),o=kV("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),h=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(h,"), vec2(").concat(p.join(),"));\n        }"),f=1;f<u.length;f++){var m=u[f-1];d+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(JG(s,l,m),"),\n            vec2(").concat(JG(p,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(v,"(").concat(JG(s,l,g),"),\n          vec2(").concat(JG(p,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function JG(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function QG(e){var t=e.inputs,n=e.backend,r=t.input;return tU({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var ZG={kernelName:Er,backendName:"webgl",kernelFunc:QG};function $G(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return OG({inputs:{input:e},backend:n})})),i=e.map((function(e){return QG({inputs:{input:e},backend:n})})),o=$G(a,t,n),s=$G(i,t,n),u=rU({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=[-1,Vi.sizeFromShape(e.shape.slice(t))];return kU({inputs:{x:e},backend:n,attrs:{shape:r}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),h=Dv.computeOutShape(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],f=RW(p,h,r,d),m=Dv.computeOutShape(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=e.filter((function(e){return Vi.sizeFromShape(e.shape)>0})),y=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new EV(e[0].shape,OV):new UV(e[0].shape,OV);return n.runWebGLProgram(b,e,r)}var x=on().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var k=[],w=0;w<g.length;w+=x){var I=g.slice(w,w+x);k.push($G(I,t,n))}for(var S=$G(k,t,n),N=0,T=k;N<T.length;N++){var C=T[N];n.disposeIntermediateTensorInfo(C)}return S}if(y){var E=new YG(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(E,g,r)}var _=function(e,t,n){var r=Dv.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return kU({inputs:{x:e},attrs:{shape:[-1,Vi.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(g,t,n),A=_.tensors2D,R=_.outShape,F=new XG(A.map((function(e){return e.shape}))),D=n.runWebGLProgram(F,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var M=kU({inputs:{x:D},attrs:{shape:R},backend:n});return n.disposeIntermediateTensorInfo(D),M}function eH(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Vi.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Dv.assertParamsConsistent(i,a);var o=Dv.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Vi.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Vi.sizeFromShape(e.shape)>0}));return 1===s.length?tU({inputs:{x:s[0]},backend:n}):$G(s,a,n)}var tH={kernelName:Wn,backendName:"webgl",kernelFunc:eH},nH=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),rH=we((function e(t){xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),aH=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=XB(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,p=l,h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",d=0;d<l;d++)h+="\n           vec4 xTexelC".concat(2*d,";\n           int xTexelC").concat(2*d,"Ready;\n           vec4 xTexelC").concat(2*d+1,";\n           int xTexelC").concat(2*d+1,"Ready;\n           vec4 xC").concat(d,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var f=0;f<l;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(p+1)/2;m++){var v=2*m;if(h+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),h+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<l)){var g=o%2===0?Vi.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),h+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):h+=1===g?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<l&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<l&&(h+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<l&&(h+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<l&&(h+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";var y="",b="";r&&(y=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),b="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(b,"\n         setOutput(result);\n       }\n     ")})),iH=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=XB(this.outputShape.length);for(var r=n.dataFormat,a=TB(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function oH(e,t){var n=e.length;return n>=3?[].concat(Ie(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function sH(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=oH(c.shape,b);null!=k&&(c=kU({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=oH(s.shape,b);null!=w&&(s=kU({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if((1!==g&&1!==y||!(v>DU))&&m.isPacked&&b&&null!=m.texture&&f[2]%2!==0&&Vi.arraysEqual(m.shape.slice(-3),f.slice(-3))){var I=f[0]*f[1]*(f[2]+1),S={dataId:n.dataId,shape:[1,I,a.inChannels],dtype:n.dtype},N=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,Vi.assert(hB(m.shape,S.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(S.shape," isn't free")}));var T=kU({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var C=MU({a:S,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p}),E=i.texData.get(C.dataId);Vi.assert(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=N,E.shape=a.outShape,(t=tU({inputs:{x:C},backend:i})).shape=a.outShape,x.push(C)}else{var _=a.outHeight*a.outWidth,A=kU({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,_,a.inChannels]:[a.batchSize,a.inChannels,_]}}),R=kU({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),F=MU({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p});t=kU({inputs:{x:F},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(F)}for(var D=0,M=x;D<M.length;D++){var O=M[D];i.disposeIntermediateTensorInfo(O)}return t}function uH(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,h=void 0===p?null:p,d=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*f*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var I=oH(u.shape,y);null!=I&&(u=kU({inputs:{x:u},backend:a,attrs:{shape:I}}),w.push(u))}if(null!=o){var S=oH(o.shape,y);null!=S&&(o=kU({inputs:{x:o},backend:a,attrs:{shape:S}}),w.push(o))}var N=kU({inputs:{x:n},backend:a,attrs:{shape:[1,b,Vi.sizeFromShape(n.shape)/b]}});w.push(N);var T=new iH(k,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],E=a.runWebGLProgram(T,[t],"float32",C),_=kU({inputs:{x:E},backend:a,attrs:{shape:k}});w.push(E),w.push(_);var A=null!=o,R=null!=u,F="leakyrelu"===h,D=h?fU(h,!0):null,M=new mU(y?_.shape:N.shape,y?N.shape:_.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,D,R,F),O=y?[_,N]:[N,_];if(o&&O.push(o),R&&O.push(u),F){var L=a.makeTensorInfo([],"float32",Vi.createScalarValue(l,"float32"));O.push(L),w.push(L)}var z=a.runWebGLProgram(M,O,"float32"),P=kU({inputs:{x:z},backend:a,attrs:{shape:r.outShape}});w.push(z);for(var B=0,W=w;B<W.length;B++){var V=W[B];a.disposeIntermediateTensorInfo(V)}return P}var cH={kernelName:Vn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,h=Dv.convertConv2DDataFormat(c),d=Dv.computeConv2DInfo(i.shape,o.shape,s,l,u,p,!1,h);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&on().getBool("WEBGL_EXP_CONV")){var f=new aH(d),m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];t=r.runWebGLProgram(f,[i,o],"float32",m)}else if(on().getBool("WEBGL_CONV_IM2COL"))t=uH({x:i,filter:o,convInfo:d,backend:r});else{var v=new nH(d);t=r.runWebGLProgram(v,[i,o],"float32")}else t=sH({x:i,filter:o,convInfo:d,backend:r});var g=kU({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),g}},lH=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              ").concat(o?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),pH=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),hH=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),dH=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var fH={kernelName:Un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=Dv.convertConv2DDataFormat(u),h=Dv.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),d=new lH(h);return n.runWebGLProgram(d,[a,i],"float32")}},mH=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=XB(this.outputShape.length);var n=t.filterHeight,r=t.filterWidth,a=n-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(t.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(t.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}));var vH={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=Dv.convertConv2DDataFormat(c),h=Dv.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p);if(on().getBool("WEBGL_PACK")&&"channelsLast"===p){var d=[[h.strideHeight,h.strideWidth]],f=new mH(h);return n.runWebGLProgram(f,[a,i],"float32",d)}var m=new pH(h);return n.runWebGLProgram(m,[a,i],"float32")}};var gH={kernelName:Hn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Dv.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new rH(c);return n.runWebGLProgram(l,[a,i],"float32")}};var yH={kernelName:jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Dv.computeConv3DInfo(a.shape,u,o,1,s),l=new hH(c);return n.runWebGLProgram(l,[a,i],"float32")}};var bH,xH={kernelName:qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=Dv.computeConv3DInfo(u,i.shape,s,1,o),l=new dH(c);return n.runWebGLProgram(l,[a,i],"float32")}},kH=hU({opSnippet:pU+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat($V,"\n  return result;\n")}),wH={kernelName:Kn,backendName:"webgl",kernelFunc:kH},IH=hU({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),SH={kernelName:Xn,backendName:"webgl",kernelFunc:IH},NH=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3],p=C(n,1)[0],h=C(r,2),d=h[0],f=h[1];this.outputShape=[p,d,f,l];var m="bilinear"===a?1:0,v="".concat(u-1,".0"),g="".concat(c-1,".0"),y=C(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(v)],3),b=y[0],x=y[1],k=y[2],w=C(f>1?["".concat((c-1)/(f-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],3),I=w[0],S=w[1],N=w[2];this.userCode="\n      const float height_ratio = float(".concat(b,");\n      const float width_ratio = float(").concat(I,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(x,";\n        float width_scale = ").concat(S,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(N,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),TH={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new NH(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(bH||(bH={}));var CH=we((function e(t,n,r,a){xe(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===bH.Prod?"1.0":"0.0",s=r?o:"getX(".concat(EH(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(UB(i)," coords = getOutputCoords();\n        int end = ").concat(_H(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(_H(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(EH(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function EH(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function _H(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function AH(e,t,n,r,a,i){var o=t.shape.length,s=Dv.getAxesPermutation([r],o),u=t;null!=s&&(u=RU({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=Dv.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],p=tU({inputs:{x:u},backend:n}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var d=new CH(e,u.shape,!1,i),f=[[h]],m=p;p=n.runWebGLProgram(d,[p],p.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var v=new CH(e,u.shape,a,i),g=p;p=n.runWebGLProgram(v,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=RU({inputs:{x:p},backend:n,attrs:{perm:Dv.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var RH={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return AH(bH.Prod,a,n,i,o,s)}};var FH={kernelName:Jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return AH(bH.Sum,a,n,i,o,s)}};var DH={kernelName:Zn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=CW(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),h=n.bufferSync(i),d=EW(p,h,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},MH=function(){function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return we(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var OH={kernelName:$n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new MH("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},LH=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=XB(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),zH=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=XB(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,h=p,d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",f=0;f<p;f++)d+="\n          vec4 xTexelC".concat(2*f,";\n          int xTexelC").concat(2*f,"Ready;\n          vec4 xTexelC").concat(2*f+1,";\n          int xTexelC").concat(2*f+1,"Ready;\n          vec4 xC").concat(f,";");d+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<p;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(h+1)/2;v++){var g=2*v;if(d+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<p&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),d+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<p)){var y=s%2===0?Vi.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):d+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<p&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<p&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<p&&(d+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<p&&(d+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<p&&(d+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var PH={kernelName:er,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,h=Dv.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0);p=on().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new zH(h):new LH(h);var d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",d)}},BH=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),WH=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var VH={kernelName:tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=Dv.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new BH(p);return n.runWebGLProgram(h,[a,i],"float32")}};var UH={kernelName:nr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,p=Dv.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new WH(p);return n.runWebGLProgram(h,[a,i],"float32")}},GH=we((function e(t){xe(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var HH={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Ie(r.shape),Ie(r.shape)),i=Vi.sizeFromShape(r.shape),o=kU({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new GH(i),u=n.runWebGLProgram(s,[o],o.dtype),c=kU({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},jH=we((function e(t){xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,h=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var qH={kernelName:ar,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Dv.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),p=new jH(l),h=kU({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),h}};var KH={kernelName:ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Dv.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Dv.checkEinsumDimSizes(o.length,u,a);for(var c=Dv.getEinsumComputePath(s,u),l=c.path,p=c.steps,h=p.length,d=null,f=o.length,m=[],v=0;v<h;++v){var g,y=Se(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,x=Dv.getEinsumPermutation(f,u[b]),k=x.permutationIndices,w=x.expandDims,I=void 0;Dv.isIdentityPermutation(k)?I=a[b]:(I=RU({inputs:{x:a[b]},backend:n,attrs:{perm:k}}),m.push(I));for(var S=I.shape.slice(),N=0;N<w.length;++N)S.splice(w[N],0,1);Vi.arraysEqual(I.shape,S)||(I=kU({inputs:{x:I},backend:n,attrs:{shape:S}}),m.push(I)),null===d?d=I:(d=bU({inputs:{a:I,b:d},backend:n}),m.push(d))}}catch(_){y.e(_)}finally{y.f()}v<h-1&&(l[v]>=0&&(d=_U({inputs:{x:d},backend:n,attrs:{axis:l[v]-(o.length-f),keepDims:!1}}),m.push(d)),f--)}for(var T=0,C=m;T<C.length;T++){var E=C[T];E!==d&&n.disposeIntermediateTensorInfo(E)}return d}},XH=hU({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),YH={kernelName:cr,backendName:"webgl",kernelFunc:XH},JH={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=on().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new eU("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new ZV("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},QH=dU({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:FW}),ZH={kernelName:hr,backendName:"webgl",kernelFunc:QH},$H=hU({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Dv.ERF_P,";\n  float a1 = ").concat(Dv.ERF_A1,";\n  float a2 = ").concat(Dv.ERF_A2,";\n  float a3 = ").concat(Dv.ERF_A3,";\n  float a4 = ").concat(Dv.ERF_A4,";\n  float a5 = ").concat(Dv.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),ej={kernelName:pr,backendName:"webgl",kernelFunc:$H},tj=hU({opSnippet:pU+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:DW,dtype:"float32"}),nj={kernelName:dr,backendName:"webgl",kernelFunc:tj};function rj(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Vi.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),kU({inputs:{x:i},backend:r,attrs:{shape:s}})}var aj={kernelName:fr,backendName:"webgl",kernelFunc:rj},ij="return exp(x) - 1.0;",oj=hU({opSnippet:ij,packedOpSnippet:ij,cpuKernelImpl:MW}),sj={kernelName:mr,backendName:"webgl",kernelFunc:oj},uj=we((function e(t,n,r){xe(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function cj(e,t,n){var r=n.texData.get(e.dataId),a=Vi.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=kU({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new uj("real",s,t),c=new uj("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),d=rU({inputs:{real:p,imag:h},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h);var f=kU({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),f}var lj={kernelName:vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return cj(t.input,!1,n)}},pj=we((function e(t,n){xe(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function hj(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Vi.inferDtype(a))){var o=Vi.getArrayFromDType(i,Vi.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new pj(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var dj,fj={kernelName:gr,backendName:"webgl",kernelFunc:hj},mj=we((function e(t){xe(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),vj={kernelName:yr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new mj(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},gj="return floor(x);",yj=hU({opSnippet:gj,packedOpSnippet:gj,cpuKernelImpl:OW}),bj={kernelName:br,backendName:"webgl",kernelFunc:yj},xj=dU({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),kj={kernelName:xr,backendName:"webgl",kernelFunc:xj},wj=we((function e(t){xe(this,e),this.variableNames=["A"];var n=TB(),r=C(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),Ij=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=TB(),r=C(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Sj={kernelName:Ii,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=C(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],p=[l,c],h=[l,c,i];if(s||o){var d=on().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==dj||d!==Nj)&&(Nj=d,dj=document.createElement("canvas").getContext("2d",{willReadFrequently:Nj})),dj.canvas.width=c,dj.canvas.height=l,dj.drawImage(a,0,0,c,l),a=dj.canvas}var f=n.makeTensorInfo(p,"int32");n.texData.get(f.dataId).usage=gP.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),a);var m=on().getBool("WEBGL_PACK")?new Ij(h):new wj(h),v=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),v}},Nj=on().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var Tj={kernelName:Ti,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,h=a.dilations,d=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,v=Dv.convertConv2DDataFormat(p),g=Dv.computeConv2DInfo(i.shape,o.shape,c,h,l,d,!1,v),y=[],b=null!=s,x=null!=u,k="leakyrelu"===f,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=kU({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,p)),x&&e.push(t(u,p)),k){var n=r.makeTensorInfo([],"float32",Vi.createScalarValue(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&on().getBool("WEBGL_EXP_CONV")){var I=f?fU(f,!0):null,S=new aH(g,b,I,x,k),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=w();t=r.runWebGLProgram(S,T,"float32",N)}else if(on().getBool("WEBGL_CONV_IM2COL"))t=uH({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var C=f?fU(f,!1):null,E=new nH(g,b,C,x,k),_=w();t=r.runWebGLProgram(E,_,"float32")}else t=sH({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var A=kU({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var Cj={kernelName:Ci,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),Vi.assert(Dv.eitherStridesOrDilationsAreOne(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=Dv.computeConv2DInfo(a.shape,i.shape,u,m,c,p,!0),y=on().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?fU(h,y):null,x=[a,i],k=null!=o,w=null!=s,I="leakyrelu"===h;if(k&&x.push(o),w&&x.push(s),I){var S=n.makeTensorInfo([],"float32",Vi.createScalarValue(d,"float32"));x.push(S),f.push(S)}v=y?new zH(g,k,b,w,I):new LH(g,k,b,w,I);var N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",N);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},Ej=we((function e(t,n,r,a){xe(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=UB(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var _j={kernelName:Ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=Vi.sizeFromShape(r.shape),u=C(Dv.prepareAndValidate(r,a),4),c=u[0],l=u[1],p=u[2],h=u[3],d=kU({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),f=kU({inputs:{x:r},backend:n,attrs:{shape:[Vi.sizeFromShape(r.shape)/p,p]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var m=n.readSync(a.dataId),v=n.bufferSync(r),g=LW(m,v,r.dtype,l,o,p,h,r.shape,s);return n.makeTensorInfo(c,r.dtype,g.values)}var y=new Ej(o,h,[l,p],r.shape),b=n.runWebGLProgram(y,[f,d],f.dtype),x=kU({inputs:{x:b},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(b),x}},Aj=we((function e(t,n){xe(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=UB(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function Rj(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Vi.parseAxisParam(o,a.shape)[0];if(on().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[h];Vi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=Dv.segment_util.collectGatherOpShapeInfo(a,i,u,s),f=Vi.sizeFromShape(i.shape),m=[],v=kU({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=kU({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}});m.push(v),m.push(g);var y=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),k=zW(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d.outputShape,k.dtype,k.values)}var w=new Aj(v.shape,y),I=n.runWebGLProgram(w,[v,g],v.dtype);m.push(I);var S=kU({inputs:{x:I},backend:n,attrs:{shape:d.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),S}var Fj={kernelName:wr,backendName:"webgl",kernelFunc:Rj},Dj=dU({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:PW,dtype:"bool"}),Mj={kernelName:Sr,backendName:"webgl",kernelFunc:Dj},Oj=dU({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:BW}),Lj={kernelName:Nr,backendName:"webgl",kernelFunc:Oj};var zj={kernelName:Cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return cj(t.input,!0,n)}},Pj=hU({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),Bj={kernelName:_r,backendName:"webgl",kernelFunc:Pj},Wj=hU({opSnippet:"return float(isinf(x));",dtype:"bool"}),Vj={kernelName:Ar,backendName:"webgl",kernelFunc:Wj},Uj=hU({opSnippet:"return float(isnan(x));",dtype:"bool"}),Gj={kernelName:Rr,backendName:"webgl",kernelFunc:Uj},Hj=dU({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:WW,dtype:"bool"}),jj={kernelName:Dr,backendName:"webgl",kernelFunc:Hj},qj=dU({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:VW,dtype:"bool"}),Kj={kernelName:Mr,backendName:"webgl",kernelFunc:qj};var Xj={kernelName:Or,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=UW(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},Yj=hU({opSnippet:pU+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:GW}),Jj={kernelName:Lr,backendName:"webgl",kernelFunc:Yj},Qj=hU({opSnippet:pU+"\n  return log(1.0 + x);\n"}),Zj={kernelName:zr,backendName:"webgl",kernelFunc:Qj},$j=dU({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),eq={kernelName:Pr,backendName:"webgl",kernelFunc:$j},tq=hU({opSnippet:"return float(!(x >= 1.0));"}),nq={kernelName:Br,backendName:"webgl",kernelFunc:tq},rq=dU({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),aq={kernelName:Wr,backendName:"webgl",kernelFunc:rq},iq=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["x"],this.outputShape=[];var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(u,";\n        setOutput(val);\n      }\n    ")})),oq=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(u,";\n        setOutput(result);\n      }\n    ")})),sq={kernelName:Hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=on().getBool("WEBGL_PACK_NORMALIZATION")?new oq(a.shape,i,o,s,u):new iq(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},uq=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),cq={kernelName:jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new uq(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function lq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Vi.parseAxisParam(i,a.shape),c=u,l=Dv.getAxesPermutation(c,s),p=null!=l,h=n.shouldExecuteOnCPU([a]),d=a;if(p){if(h){for(var f=n.texData.get(d.dataId).values,m=new Array(s),v=0;v<m.length;v++)m[v]=a.shape[l[v]];var g=yV(f,a.shape,a.dtype,l,m);d=n.makeTensorInfo(m,a.dtype),n.texData.get(d.dataId).values=g}else d=EU(a,l,n);c=Dv.getInnerMostAxes(c.length,s)}Dv.assertAxesAreInnerMostDims("max",c,s);var y,b=C(Dv.computeOutAndReduceShapes(d.shape,c),2),x=b[0],k=b[1],w=x;if(o&&(w=Dv.expandShapeToKeepDim(x,u)),h){var I=n.texData.get(d.dataId).values,S=HW(I,Vi.sizeFromShape(k),w,a.dtype);y=n.makeTensorInfo(w,a.dtype),n.texData.get(y.dataId).values=S}else y=function(e,t,n,r){var a=Vi.sizeFromShape(t),i=kU({inputs:{x:e},attrs:{shape:[Vi.sizeFromShape(e.shape)/a,a]},backend:r}),o=NU(i,e.dtype,"max",r),s=kU({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(d,k,w,n);return p&&n.disposeIntermediateTensorInfo(d),y}var pq={kernelName:Kr,backendName:"webgl",kernelFunc:lq},hq=dU({opSnippet:QV+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$V+"\n  return result;\n",cpuKernelImpl:jW}),dq={kernelName:Xr,backendName:"webgl",kernelFunc:hq};var fq={kernelName:Yr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;SB(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Dv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Vi.arraysEqual(c.inShape,c.outShape))return tU({inputs:{x:a},backend:n});var l=new dG(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var mq={kernelName:Qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Dv.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),p=new fG(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},vq=we((function e(t){xe(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),gq=we((function e(t){xe(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,h=c-1-t.padInfo.top,d=l-1-t.padInfo.left,f=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var yq={kernelName:Zr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Dv.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new fG(l,"max",!0),h=n.runWebGLProgram(p,[i],i.dtype),d=new gq(l),f=n.runWebGLProgram(d,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),f}};var bq={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;SB([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Dv.computePool2DInfo(o.shape,s,u,1,c,l),h=new dG(p,"max",!0),d=n.runWebGLProgram(h,[o],o.dtype),f=new vq(p),m=n.runWebGLProgram(f,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}};var xq={kernelName:$r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Vi.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];Vi.assert(Dv.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p=Dv.computePool2DInfo(a.shape,i,o,l,s),h=function(e,t,n,r){var a=new dG(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new dG(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,p,c),d=C(h,2);return[d[0],d[1]]}};var kq={kernelName:ea,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Vi.parseAxisParam(o,a.shape),l=c,p=Dv.getAxesPermutation(l,u),h=null!=p,d=s.shouldExecuteOnCPU([a]),f=[],m=a;if(h){if(d){for(var v=s.texData.get(m.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=a.shape[p[y]];var b=yV(v,a.shape,a.dtype,p,g);m=s.makeTensorInfo(g,a.dtype),s.texData.get(m.dataId).values=b}else m=EU(a,p,s);f.push(m),l=Dv.getInnerMostAxes(l.length,u)}Dv.assertAxesAreInnerMostDims("sum",l,u);var x=C(Dv.computeOutAndReduceShapes(m.shape,l),2),k=x[0],w=x[1],I=k;i&&(I=Dv.expandShapeToKeepDim(k,c));for(var S=function(e,t,n,r){var a=Vi.sizeFromShape(t),i=kU({inputs:{x:e},attrs:{shape:[Vi.sizeFromShape(e.shape)/a,a]},backend:r}),o=NU(i,"float32","mean",r),s=kU({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,w,I,s),N=0,T=f;N<T.length;N++){var E=T[N];s.disposeIntermediateTensorInfo(E)}return S}};var wq={kernelName:ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Vi.parseAxisParam(i,a.shape),c=u,l=Dv.getAxesPermutation(c,s),p=a;null!=l&&(p=RU({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Dv.getInnerMostAxes(c.length,a.shape.length)),Dv.assertAxesAreInnerMostDims("min",c,s);var h,d=C(Dv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],m=d[1],v=kU({inputs:{x:p},backend:n,attrs:{shape:[-1,Vi.sizeFromShape(m)]}}),g=NU(v,v.dtype,"min",n);return h=kU(o?{inputs:{x:g},backend:n,attrs:{shape:Dv.expandShapeToKeepDim(f,u)}}:{inputs:{x:g},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(p),h}},Iq=dU({opSnippet:QV+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+$V+"\n  return result;\n",cpuKernelImpl:qW}),Sq={kernelName:na,backendName:"webgl",kernelFunc:Iq},Nq=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=UB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),Tq=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=UB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=kV("rc",a),c=kV("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===r?0:1,d="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),Cq={kernelName:ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tq(a.shape,i,o):new Nq(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},Eq=dU({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+$V+"\n  return result;\n"}),_q={kernelName:aa,backendName:"webgl",kernelFunc:Eq},Aq=we((function e(t,n,r){xe(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),Rq=dU({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Fq={kernelName:sr,backendName:"webgl",kernelFunc:Rq},Dq="return a - b;",Mq=dU({opSnippet:Dq,packedOpSnippet:Dq,supportsComplex:!0,cpuKernelImpl:mV}),Oq={kernelName:li,backendName:"webgl",kernelFunc:Mq};function Lq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=Vi.parseAxisParam([i],a.shape),s=lq({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Dv.expandShapeToKeepDim(s.shape,o),c=kU({inputs:{x:s},backend:n,attrs:{shape:u}}),l=Mq({inputs:{a:a,b:c},backend:n}),p=tj({inputs:{x:l},backend:n}),h=_U({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:!1}}),d=kU({inputs:{x:h},backend:n,attrs:{shape:u}}),f=Rq({inputs:{a:p,b:d},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),f}var zq={kernelName:Qa,backendName:"webgl",kernelFunc:Lq};var Pq={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Lq({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new Aq(c,l,i),h=[[o]],d=n.runWebGLProgram(p,[u],"int32",h);return s||n.disposeIntermediateTensorInfo(u),d}},Bq=_V+"\n  return -x;\n";var Wq={kernelName:sa,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=C(XW(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=on().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new UV(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new EV(a.shape,Bq),r.runWebGLProgram(t,[a],a.dtype)}},Vq=Bg.nonMaxSuppressionV3Impl;var Uq={kernelName:ca,backendName:"webgl",kernelFunc:function(e){Dv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=Vq(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},Gq=Bg.nonMaxSuppressionV4Impl;var Hq={kernelName:la,backendName:"webgl",kernelFunc:function(e){Dv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=Gq(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},jq=Bg.nonMaxSuppressionV5Impl;var qq={kernelName:pa,backendName:"webgl",kernelFunc:function(e){Dv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=jq(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},Kq=we((function e(t,n,r,a){xe(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),Xq={kernelName:da,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=Vi.sizeFromShape(a.shape),l=new Kq(c,o,s,u),p=kU({inputs:{x:a},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(l,[p],i);n.disposeIntermediateTensorInfo(p);var d=kU({inputs:{x:h},backend:n,attrs:{shape:[].concat(Ie(a.shape),[o])}});return n.disposeIntermediateTensorInfo(h),d}};function Yq(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=OG({inputs:{input:r},backend:n}),i=Yq({inputs:{x:a},backend:n}),o=QG({inputs:{input:r},backend:n}),s=Yq({inputs:{x:o},backend:n}),u=rU({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return hj({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var Jq={kernelName:ki,backendName:"webgl",kernelFunc:Yq};var Qq={kernelName:ha,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=OG({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=QG({inputs:{input:a},backend:r}),u=Yq({inputs:{x:s},backend:r}),c=rU({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return hj({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var Zq={kernelName:fa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return rj({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Vi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Vi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=rj({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=eH({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},$q=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=UB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),eK=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=UB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=kV("rc",a),c=kV("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,v=1===a?2:4;m<v;m++)f+="\n        ".concat(h[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),tK=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Vi.sizeFromShape(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return hj({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eK(a.shape,i,o):new $q(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},nK={kernelName:ma,backendName:"webgl",kernelFunc:tK},rK=dU({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+$V+"\n  return result;\n"}),aK={kernelName:ga,backendName:"webgl",kernelFunc:rK};var iK={kernelName:ba,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=Vi.parseAxisParam(o,i.shape),p=l,h=Dv.getAxesPermutation(p,u),d=i;if(null!=h&&(d=RU({inputs:{x:i},backend:r,attrs:{perm:h}}),p=Dv.getInnerMostAxes(p.length,u),c.push(d)),Dv.assertAxesAreInnerMostDims("prod",p,u),r.shouldExecuteOnCPU([d])){var f=r.texData.get(d.dataId).values,m=JW(d.shape,d.dtype,f,p),v=m.outVals,g=m.outShape,y=m.outDtype;t=r.makeTensorInfo(g,y,v)}else{var b=C(Dv.computeOutAndReduceShapes(d.shape,p),2),x=b[0],k=b[1],w=Vi.sizeFromShape(k),I=kU({inputs:{x:d},backend:r,attrs:{shape:[-1,w]}}),S=NU(I,Lo(i.dtype),"prod",r);t=kU({inputs:{x:S},backend:r,attrs:{shape:x}}),c.push(I),c.push(S)}if(s){c.push(t);var N=Dv.expandShapeToKeepDim(t.shape,l);t=kU({inputs:{x:t},backend:r,attrs:{shape:N}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var oK={kernelName:xa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),c=a.map((function(e){return e.shape})),l=n.readSync(i.dataId),p=n.readSync(o.dataId),h=C(QW(u,c,l,i.shape,i.dtype,p,o.shape,s),3),d=h[0],f=h[1],m=h[2],v=d.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(m,i.dtype,f);return v.concat([g])}};var sK={kernelName:ka,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C(ZW(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],p=c[1];return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([p.length],r.dtype,p)]}};var uK={kernelName:wa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=n.readSync(o.dataId),h=s.map((function(e){return n.readSync(e.dataId)})),d=s.map((function(e){return e.shape})),f=C($W(c,a.shape,l,i.shape,i.dtype,p,o.shape,h,d,u),2),m=f[0],v=f[1];return n.makeTensorInfo(m,i.dtype,v)}},cK=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=eV(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},lK={kernelName:Ia,backendName:"webgl",kernelFunc:cK},pK=hU({opSnippet:"return 1.0 / x;"}),hK={kernelName:Na,backendName:"webgl",kernelFunc:pK},dK=hU({opSnippet:_V+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),fK={kernelName:Ta,backendName:"webgl",kernelFunc:dK},mK=hU({opSnippet:_V+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),vK={kernelName:Fa,backendName:"webgl",kernelFunc:mK},gK=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),yK=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],",\n          ").concat(h[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var bK={kernelName:Aa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=C(r.size,2),u=s[0],c=s[1],l=on().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new yK(a.shape,u,c,i,o):new gK(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],"float32")}},xK=we((function e(t,n,r){xe(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=C(n,3),i=a[1],o=a[2],s=C(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/p[0],d=l[1]/p[1],f=1/h,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(h,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var kK={kernelName:Ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new xK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},wK=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),IK=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";p=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],",\n          ").concat(h[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var SK={kernelName:Ea,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=C(r.size,2),u=s[0],c=s[1],l=on().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new IK(a.shape,u,c,i,o):new wK(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],a.dtype)}},NK=we((function e(t,n,r){xe(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=C(n,3),i=a[1],o=a[2],s=C(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/p[0],d=l[1]/p[1],f=1/h,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(h,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var TK={kernelName:_a,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new NK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},CK=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=UB(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),EK=we((function e(t,n){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a,i=kV("rc",r),o="".concat(i[r-1]," + 1 < ").concat(this.outputShape[r-1]),s="".concat(i[r-2]," + 1 < ").concat(this.outputShape[r-2]),u=UB(r);function c(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(u," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat((a=i.slice(),c(a)),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",c(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var _K={kernelName:Da,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Vi.parseAxisParam(i,a.shape);if(0===o)return tU({inputs:{x:a},backend:n});var u=on().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EK(a.shape,s):new CK(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},AK=we((function e(t,n){xe(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),RK={kernelName:Si,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new AK(a.shape,o),l=C(Dv.getImageCenter(s,a.shape[1],a.shape[2]),2),p=[[l[0],l[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,p)}},FK=hU({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),DK={kernelName:Ma,backendName:"webgl",kernelFunc:FK},MK=hU({opSnippet:"return inversesqrt(x);",cpuKernelImpl:tV}),OK={kernelName:Oa,backendName:"webgl",kernelFunc:MK},LK=we((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];xe(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=UB(i.length),c=UB(o.length),l="";1===r?l="i":2===r&&(l="i, j");var p="getIndices(".concat(l,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(p,");\n              flattenedIndex += index * ").concat(v,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(m,", sum, float(found)));\n        }\n      ")})),zK=we((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];xe(this,e),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var u=UB(i.length),c=UB(o.length),l="";1===r?l="i":2===r&&(l="i, j");var p="getIndices(".concat(l,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides",g=n>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(t,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(n,"; j+=2) {\n              ivec4 index = round(").concat(p,");\n              flattenedIndex += index.xz * ").concat(v,";\n              if (j + 1 < ").concat(n,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(m,", sum, found));\n        }\n      ")}));var PK={kernelName:La,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Dv.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=[h/l,l];if(0===h)return n.makeTensorInfo(o,a.dtype);var f,m=kU({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=kU({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));f=on().getBool("WEBGL_PACK")?new zK(c,u,m.shape.length,v.shape.length,p,d):new LK(c,u,m.shape.length,v.shape.length,p,d);var y=n.runWebGLProgram(f,[v,m,g],v.dtype),b=kU({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},BK=we((function e(t,n,r,a){xe(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===on().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var WK={kernelName:Pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new BK(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},VK=we((function e(t,n,r){var a,i;if(xe(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=UB(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var UK={kernelName:Ba,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new VK(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Oo(a.dtype,i.dtype))}},GK=hU({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Dv.SELU_SCALEALPHA,";\n  float scale = ").concat(Dv.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),HK={kernelName:Wa,backendName:"webgl",kernelFunc:GK},jK=hU({opSnippet:pU+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:rV}),qK={kernelName:ja,backendName:"webgl",kernelFunc:jK},KK=hU({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),XK={kernelName:Ha,backendName:"webgl",kernelFunc:KK},YK=hU({opSnippet:pU+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat($V,"\n  return result;\n")}),JK={kernelName:Ua,backendName:"webgl",kernelFunc:YK},QK=hU({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),ZK={kernelName:Ga,backendName:"webgl",kernelFunc:QK},$K=hU({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),eX={kernelName:qa,backendName:"webgl",kernelFunc:$K},tX={kernelName:Ya,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Vi.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Ie(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=tK({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=Dv.getReshaped(p.shape,i,s,!1),d=Dv.getPermuted(h.length,i.length,!1),f=Dv.getReshapedPermuted(p.shape,i,s,!1),m=kU({inputs:{x:p},backend:n,attrs:{shape:h}}),v=RU({inputs:{x:m},backend:n,attrs:{perm:d}}),g=kU({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(p),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var nX={kernelName:Za,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],p=C(oV(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=p[0],d=p[1],f=p[2],m=p[3],v=p[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((function(e){return Number(e)})))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}};var rX={kernelName:$a,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=C(sV(s,r.shape,r.dtype,o,u),3),l=c[0],p=c[1],h=c[2];return[n.makeTensorInfo(p,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};var aX={kernelName:ei,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C(uV(o,r.shape,r.dtype,s,u,!0),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var iX={kernelName:ti,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C(uV(o,r.shape,r.dtype,s,u),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var oX={kernelName:ni,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=Dv.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=Vi.decodeString(n.readSync(o.dataId)[0]),g=nV(f,m,s,d,p,l,c,h,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new LK(l,c,a.shape.length,i.shape.length,h,[d,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=kU({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var sX={kernelName:Ja,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Vi.parseAxisParam(o,a.shape)[0],u=Dv.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),p=a.shape.slice();return u.map((function(e){var t=Ie(p);t[s]=e;var r=EG({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},uX="return sqrt(x);",cX=hU({opSnippet:uX,packedOpSnippet:uX,cpuKernelImpl:cV}),lX={kernelName:Ka,backendName:"webgl",kernelFunc:cX},pX=hU({opSnippet:"return x * x;"}),hX={kernelName:ai,backendName:"webgl",kernelFunc:pX},dX="return (a - b) * (a - b);",fX=dU({opSnippet:dX,packedOpSnippet:dX}),mX={kernelName:ri,backendName:"webgl",kernelFunc:fX};var vX={kernelName:ii,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;if("string"!==a.dtype)throw new Error("Input must be of datatype string");var i=n.readSync(a.dataId),o=Dv.fromUint8ToStringArray(i),s=lV(o,"string",r);return n.makeTensorInfo(a.shape,"string",s)}};var gX={kernelName:wi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=_V+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new EV(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},yX=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=UB(r.length),o=UB(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var bX={kernelName:oi,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,h=a.newAxisMask,d=a.shrinkAxisMask,f=sv.sliceInfo(i.shape,o,s,u,c,l,p,h,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=kU({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){Vi.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=sv.computeOutShape(x,k,w),S=EG({inputs:{x:i},backend:r,attrs:{begin:x,size:I}});t=kU({inputs:{x:S},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(S)}else if(r.shouldExecuteOnCPU([i])){var N=r.readSync(i.dataId),T=wu(i.shape,i.dtype,N),C=pV(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var E=new yX(x,w,m);t=r.runWebGLProgram(E,[i],i.dtype)}var _=kU({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),_}};var xX={kernelName:si,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,h=n.readSync(l.dataId),d=n.readSync(p.dataId),f=C(hV(h,d,a,i,o,s,u,c),2),m=f[0],v=f[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(p.shape,"int32",v)]}};var kX={kernelName:ui,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=C(dV(o,s,r),3),c=u[0],l=u[1],p=u[2],h=l.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(p))]}};var wX={kernelName:ci,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=fV(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},IX=hU({opSnippet:"return tan(x);"}),SX={kernelName:pi,backendName:"webgl",kernelFunc:IX},NX=hU({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),TX={kernelName:hi,backendName:"webgl",kernelFunc:NX};var CX={kernelName:za,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.tensor,i=t.indices,o=t.updates;ce(r);var s=Dv.calculateShapes(o,i,a.shape),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=[h/l,l];if(0===h)return n.makeTensorInfo(a.shape,i.dtype);var f=kU({inputs:{x:i},backend:n,attrs:{shape:[c,u]}}),m=kU({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),v=kU({inputs:{x:a},backend:n,attrs:{shape:d}}),g=new LK(c,u,f.shape.length,m.shape.length,p,d,!1,!0),y=n.runWebGLProgram(g,[m,f,v],v.dtype),b=kU({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),b}},EX=we((function e(t,n){xe(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=UB(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function _X(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Vi.decodeString(e)})):o,u=wu(a.shape,a.dtype,s),c=vV(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new EX(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var AX={kernelName:di,backendName:"webgl",kernelFunc:_X},RX=we((function e(t){xe(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),FX=we((function e(t){xe(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function DX(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function MX(e){for(var t=1;t<e;)t*=2;return t}var OX={kernelName:fi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=on().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=on().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var p=n.readSync(a.dataId),h=C(gV(p,c,a.dtype,i,o),2),d=h[0],f=h[1];return[n.makeTensorInfo(d.shape,d.dtype,d.values),n.makeTensorInfo(f.shape,f.dtype,f.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,hj({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var m=n.texData.get(a.dataId),v=null!==m&&m.isPacked,g=v?n.unpackTensor(a):a,y=Vi.sizeFromShape(c)/l,b=kU({inputs:{x:g},attrs:{shape:[y,l]},backend:n});v&&DX(n,g);for(var x=MX(i),k=MX(l),w=null,I=function(){return null===w?[b,b]:[b,w]},S=function(e,t,r){var a=I(),i=new RX(r),o=[[l],[null===w?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=w;w=n.runWebGLProgram(i,a,"int32",o),DX(n,s)},N=1;N<x;N*=2)for(var T=2*N,E=N;E>=1;E/=2)S(T,E,[y,k]);for(var _=k;_>x;_/=2){var A=I(),R=new FX([y,_/2]),F=[[l],[null===w?1:0],[x]],D=w;w=n.runWebGLProgram(R,A,"int32",F),DX(n,D);for(var M=x/2,O=2*M,L=M;L>=1;L/=2)S(O,L,w.shape)}var z=w;w=EG({inputs:{x:w},backend:n,attrs:{begin:0,size:[y,i]}}),DX(n,z);var P=Rj({inputs:{x:b,indices:w},backend:n,attrs:{axis:1,batchDims:1}});DX(n,b);var B=c.slice(0,-1);B.push(i),z=w,w=kU({inputs:{x:w},attrs:{shape:B},backend:n}),DX(n,z);var W=P;return P=kU({inputs:{x:P},attrs:{shape:B},backend:n}),DX(n,W),[P,w]}},LX=we((function e(t,n,r,a,i,o){xe(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var zX={kernelName:mi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(null!=c?c:[h,d],2),v=m[0],g=m[1],y=new LX(h,d,o,s,u,[p,v,g,f]);return n.runWebGLProgram(y,[a,i],"float32")}};var PX={kernelName:gi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;SB(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=bV(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var BX={kernelName:yi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var h=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=EG({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=kU({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,h.push(g)}return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},WX=we((function e(t,n){xe(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var VX,UX,GX,HX={kernelName:bi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Dv.getAxesPermutation([c],s),p=a;null!=l&&(p=RU({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=Dv.getInnerMostAxes(1,s)[0]);var h=Dv.segment_util.computeOutShape(p.shape,c,o),d=Vi.sizeFromShape([p.shape[c]]),f=kU({inputs:{x:p},backend:n,attrs:{shape:[-1,d]}});u.push(f);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=Dv.segment_util.segOpComputeOptimalWindowSize(c,o),p=new WX({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),h=n.compileAndRun(p,[t,a],i);if(u.push(h),h.shape[1]===o)return h;var d=cK({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=_X({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(f),e(h,r,f,i,o)}(f,"unsortedSegmentSum",i,Lo(a.dtype),o),v=kU({inputs:{x:m},backend:n,attrs:{shape:h}}),g=v;if(null!=l){u.push(v);var y=Dv.getUndoAxesPermutation(l);g=RU({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},jX=0,qX=[OU,zU,BU,VU,HU,KU,XU,YU,tG,nG,aG,oG,uG,lG,hG,mG,vG,bG,xG,kG,SG,AG,RG,FG,PG,VG,HG,aU,KG,tH,cH,fH,vH,gH,yH,xH,wH,SH,TH,RH,FH,DH,OH,PH,VH,UH,HH,qH,KH,YH,JH,ZH,ej,nj,aj,sj,lj,fj,vj,bj,kj,Sj,Tj,Cj,_j,Fj,Mj,Lj,nU,zj,ZG,Bj,Vj,Gj,sU,jj,Kj,Xj,Jj,Zj,eq,nq,aq,sq,cq,pq,dq,fq,mq,yq,bq,xq,kq,wq,Sq,Cq,_q,Pq,xU,Wq,Uq,Hq,qq,MG,Xq,Qq,Zq,nK,aK,lU,iK,oK,sK,uK,lK,LG,Fq,hK,fK,vK,wU,bK,kK,SK,TK,_K,RK,DK,OK,PK,WK,UK,HK,qK,XK,JK,ZK,_G,zq,eX,tX,nX,rX,aX,iX,oX,sX,lX,hX,mX,vX,gX,bX,xX,kX,wX,Oq,AU,SX,TX,CX,AX,OX,zX,FU,PX,BX,HX,Jq];jX<qX.length;jX++){Oi(qX[jX])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(VX||(VX={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(UX||(UX={}));var KX={kernelName:Ni,backendName:"wasm",setupFunc:function(e){GX=e.wasm.cwrap(Ni,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,c=r.transposeB,l=r.activation,p=r.leakyreluAlpha,h=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=0;if(null!=o){var m=n.dataIdMap.get(o.dataId);if(1!==m.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(m.shape.length,"."));f=m.id}var v=null==s?0:n.dataIdMap.get(s.dataId).id,g=UX[l];if(null==g)throw new Error("".concat(l," activation not yet supported for FusedConv2D in the wasm backend."));var y=u?a.shape[2]:a.shape[1],b=c?i.shape[1]:i.shape[2],x=dl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),k=n.makeOutput([].concat(Ie(x),[y,b]),a.dtype),w=n.dataIdMap.get(k.dataId).id,I=new Uint8Array(new Int32Array(a.shape).buffer),S=new Uint8Array(new Int32Array(i.shape).buffer);return GX(h,I,a.shape.length,d,S,i.shape.length,u,c,g,f,v,p||0,w),k}};function XX(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,i=r.dataIdMap.get(a.dataId).id,o=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(o.dataId).id;return 0===Vi.sizeFromShape(o.shape)||n(i,VX[a.dtype],s),o}}}var YX=XX(pn),JX=XX(hn),QX=XX(dn);function ZX(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,i=a.a,o=a.b,s=t.dataIdMap.get(i.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=null!=n?n:i.dtype,l=Dv.assertAndGetBroadcastShape(i.shape,o.shape),p=t.makeOutput(l,c);if(0===Vi.sizeFromShape(l))return p;var h=new Uint8Array(new Int32Array(i.shape).buffer),d=new Uint8Array(new Int32Array(o.shape).buffer),f=t.dataIdMap.get(p.dataId).id;return r(s,h,i.shape.length,u,d,o.shape.length,VX[i.dtype],f),p}}}var $X,eY=ZX(fn);var tY={kernelName:mn,backendName:"wasm",setupFunc:function(e){$X=e.wasm.cwrap(mn,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Vi.sizeFromShape(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),i=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return $X(i,a.length,VX[r.dtype],o),r}};function nY(e){var t=e.inputs.x,n=e.backend;if("string"===t.dtype)return ps(n.readSync(t.dataId),t.shape,t.dtype);var r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var rY,aY={kernelName:Tr,backendName:"wasm",kernelFunc:nY};function iY(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var i=0;i<r.length;++i){for(var o=-1,s=0;s<r.length;++s)r[s]>=i&&(-1===o||r[o]>r[s])&&(o=s);r[o]=i}return[n,r]}(t.x.shape,r.perm),i=C(a,2),o=i[0],s=i[1],u=!0,c=0;c<s.length;c++)s[c]!==c&&(u=!1);var l=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),p={dataId:t.x.dataId,shape:o,dtype:t.x.dtype};if(u){var h=nY({inputs:t,backend:n});return h.shape=l,h}var d=n.makeOutput(l,p.dtype),f=n.dataIdMap.get(p.dataId).id,m=n.dataIdMap.get(d.dataId).id,v=new Uint8Array(new Int32Array(s).buffer),g=new Uint8Array(new Int32Array(p.shape).buffer);return rY(f,g,p.shape.length,VX[p.dtype],m,v,s.length),d}var oY,sY={kernelName:vi,backendName:"wasm",kernelFunc:iY,setupFunc:function(e){rY=e.wasm.cwrap(vi,null,["number","array","number","number","number","array","number"])}};function uY(e,t,n){var r=e.shape,a=e.shape.length,i=Vi.parseAxisParam(t,r),o=i,s=Dv.getAxesPermutation(o,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),p=0;p<l.length;p++)l[p]=r[s[p]];o=Dv.getInnerMostAxes(o.length,a),u=iY({inputs:{x:e},attrs:{perm:s},backend:n});var h=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==h&&(c=!0)}return{transposed:u,originalAxes:i,axes:o,inputWasTransposed:c}}var cY,lY={kernelName:vn,backendName:"wasm",setupFunc:function(e){oY=e.wasm.cwrap(vn,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=uY(o,a,t),l=c.transposed,p=c.axes,h=c.originalAxes,d=c.inputWasTransposed;d&&(u=l,s=t.dataIdMap.get(l.dataId).id);var f=u.shape.length;Dv.assertAxesAreInnerMostDims("all",p,f);var m=C(Dv.computeOutAndReduceShapes(u.shape,p),2),v=m[0],g=m[1],y=Vi.sizeFromShape(g),b=t.makeOutput(v,o.dtype);if(0!==Vi.sizeFromShape(u.shape)){var x=t.dataIdMap.get(b.dataId).id;oY(s,y,x)}if(d&&t.disposeData(l.dataId),i){var k=Dv.expandShapeToKeepDim(b.shape,h);b.shape=k}return b}};var pY={kernelName:gn,backendName:"wasm",setupFunc:function(e){cY=e.wasm.cwrap(gn,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=uY(o,a,t),l=c.transposed,p=c.axes,h=c.originalAxes,d=c.inputWasTransposed;d&&(u=l,s=t.dataIdMap.get(l.dataId).id);var f=u.shape.length;Dv.assertAxesAreInnerMostDims("any",p,f);var m=C(Dv.computeOutAndReduceShapes(u.shape,p),2),v=m[0],g=m[1],y=Vi.sizeFromShape(g),b=t.makeOutput(v,o.dtype);if(0!==Vi.sizeFromShape(u.shape)){var x=t.dataIdMap.get(b.dataId).id;cY(s,y,x)}if(d&&t.disposeData(l.dataId),i){var k=Dv.expandShapeToKeepDim(b.shape,h);b.shape=k}return b}};function hY(e){var t;return{kernelName:e,backendName:"wasm",setupFunc:function(n){t=n.wasm.cwrap(e,null,["number","number","number","number","number"])},kernelFunc:function(e){var n=e.backend,r=e.inputs,a=e.attrs.axis,i=r.x,o=n.dataIdMap.get(i.dataId).id,s=o,u=i,c=uY(i,a,n),l=c.transposed,p=c.axes,h=c.inputWasTransposed;if(h){var d=n.dataIdMap.get(l.dataId).id;d!==o&&(u=l,s=d)}var f=u.shape.slice(0,-1),m=n.makeOutput(f,"int32"),v=n.dataIdMap.get(m.dataId).id,g=Vi.sizeFromShape(m.shape),y=u.shape[p[0]];return t(s,VX[u.dtype],g,y,v),h&&n.disposeData(l.dataId),m}}}var dY,fY=hY(yn),mY=hY(bn),vY=XX(xn),gY=XX(kn),yY=XX(wn),bY=ZX(Sn),xY=XX(In);var kY,wY={kernelName:Nn,backendName:"wasm",setupFunc:function(e){dY=e.wasm.cwrap(Nn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Dv.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,h=l.filterWidth,d=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.strideHeight,y=l.strideWidth,b=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),k=r.dataIdMap.get(x.dataId).id;return dY(i,a.shape[0],a.shape[1],a.shape[2],p,h,d,f,m,v,g,y,b,k),x}};var IY,SY={kernelName:Cn,backendName:"wasm",setupFunc:function(e){kY=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Dv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=n.makeOutput(l.outShape,a.dtype);return kY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),p}};var NY={kernelName:En,backendName:"wasm",setupFunc:function(e){IY=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Dv.computePool3DInfo(i.shape,o,s,1,u,c),p=n.makeOutput(i.shape,i.dtype);return IY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left,l.filterDepth,l.filterHeight,l.filterWidth),p}};function TY(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=Vi.sizeFromShape(r.shape),o=Vi.inferFromImplicitShape(a,i);return Vi.assert(i===Vi.sizeFromShape(o),(function(){return"new shape: ".concat(o,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var CY,EY={kernelName:Ca,backendName:"wasm",kernelFunc:TY};var _Y={kernelName:_n,backendName:"wasm",setupFunc:function(e){CY=e.wasm.cwrap(_n,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Vi.sizeFromShape(f),g=Vi.sizeFromShape(m),y=dl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,d]);Vi.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));var b=s?[g,d,p]:[g,p,d],x=TY({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,h]:[v,h,l]}}),k=TY({inputs:{x:i},backend:n,attrs:{shape:b}}),w=n.dataIdMap.get(x.dataId).id,I=n.dataIdMap.get(k.dataId).id,S=o?x.shape[2]:x.shape[1],N=s?k.shape[1]:k.shape[2],T=Math.max(v,g),C=n.makeOutput([T,S,N],x.dtype),E=n.dataIdMap.get(C.dataId).id,_=new Uint8Array(new Int32Array(x.shape).buffer),A=new Uint8Array(new Int32Array(k.shape).buffer);return CY(w,_,x.shape.length,I,A,k.shape.length,o,s,E),n.disposeData(x.dataId),n.disposeData(k.dataId),C.shape=y,C}};function AY(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,i=e.backend,o=C(sv.parseSliceParams(t,r,a),2),s=o[0],u=o[1],c=sv.isSliceContinous(t.shape,s,u),l=i.readSync(t.dataId),p=i.makeOutput(u,t.dtype),h=Vi.computeStrides(t.shape),d=i.dataIdMap.get(p.dataId);if(c){var f=sv.computeFlatOffset(s,h);return"string"===t.dtype?d.stringBytes=l.slice(f,f+Vi.sizeFromShape(u)):i.typedArrayFromHeap(p).set(l.subarray(f,f+Vi.sizeFromShape(u))),p}if("string"===t.dtype){var m=FD(l,s,u,t.shape,t.dtype);return d.stringBytes=m,p}var v=i.typedArrayFromHeap(p),g=t.shape.length;if(2===g)!function(e,t,n,r,a){for(var i=0,o=r[0],s=r[1],u=o+a[0],c=o;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),i),i+=a[1]}}(l,h[0],v,s,u);else if(3===g)!function(e,t,n,r,a,i){for(var o=0,s=a[0],u=a[1],c=a[2],l=s+i[0],p=u+i[1],h=s;h<l;h++)for(var d=u;d<p;d++){var f=h*t+d*n+c;r.set(e.subarray(f,f+i[2]),o),o+=i[2]}}(l,h[0],h[1],v,s,u);else if(4===g)!function(e,t,n,r,a,i,o){for(var s=0,u=i[0],c=i[1],l=i[2],p=u+o[0],h=c+o[1],d=l+o[2],f=i[3],m=u;m<p;m++)for(var v=c;v<h;v++)for(var g=l;g<d;g++){var y=m*t+v*n+g*r+f;a.set(e.subarray(y,y+o[3]),s),s+=o[3]}}(l,h[0],h[1],h[2],v,s,u);else{var y=FD(l,s,u,t.shape,t.dtype);v.set(y)}return p}var RY={kernelName:Va,backendName:"wasm",kernelFunc:AY};var FY,DY={kernelName:An,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops,s=i.reduce((function(e,t){return e*t})),u=Dv.getReshaped(a.shape,i,s),c=Dv.getPermuted(u.length,i.length),l=Dv.getReshapedPermuted(a.shape,i,s),p=Dv.getSliceBeginCoords(o,i.length),h=Dv.getSliceSize(l,o,i.length),d=TY({inputs:{x:a},backend:n,attrs:{shape:u}}),f=iY({inputs:{x:d},backend:n,attrs:{perm:c}}),m=AY({inputs:{x:TY({inputs:{x:f},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:p,size:h}});return n.disposeData(d.dataId),n.disposeData(f.dataId),n.disposeData(d.dataId),m}};var MY={kernelName:Rn,backendName:"wasm",setupFunc:function(e){FY=e.wasm.cwrap(Rn,null,["number","number","boolean","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.weights,o=r.size,s=0!==i.shape.reduce((function(e,t){return e*t}),1),u=1===a.shape.length?[o]:[a.shape[0],o],c=t.makeOutput(u,i.dtype);function l(e){return t.dataIdMap.get(e.dataId).id}return FY(l(a),o,s,l(i),VX[i.dtype],l(c)),c}};var OY={kernelName:Mn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.typedArrayFromHeap(r),o=n.typedArrayFromHeap(a),s=Dv.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeOutput([s.length],"int32",void 0,new Int32Array(s))}};function LY(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var zY,PY={kernelName:On,backendName:"wasm",kernelFunc:LY},BY=XX(Ln);var WY={kernelName:zn,backendName:"wasm",setupFunc:function(e){zY=e.wasm.cwrap(zn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.clipValueMin,o=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return zY(s,i,o,c),u}};function VY(e){var t=e.inputs,n=e.backend,r=Vi.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));Dv.assertParamsConsistent(a,r);var i=Dv.computeOutShape(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Vi.sizeFromShape(e.shape)>0}));if(1===o.length)return nY({inputs:{x:o[0]},backend:n});var s=n.makeOutput(i,t[0].dtype);if(0===Vi.sizeFromShape(i))return s;if("string"===o[0].dtype){var u=o.map((function(e){var t=[-1,Vi.sizeFromShape(e.shape.slice(r))];return TY({inputs:{x:e},backend:n,attrs:{shape:t}})})),c=u.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));i=Dv.computeOutShape(u.map((function(e){return e.shape})),1);var l=1===u[0].shape[0],p=hF(c,i,t[0].dtype,l),h=Dv.computeOutShape(o.map((function(e){return e.shape})),r);return s.shape=h,n.dataIdMap.get(s.dataId).stringBytes=Dv.fromStringArrayToUint8(p),u.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var d=Vi.sizeFromShape(o[0].shape.slice(0,r)),f=0,m=o.map((function(e){var t=Vi.sizeFromShape(e.shape.slice(r));return f+=t,t})),v=o.map((function(e){return n.typedArrayFromHeap(e)})),g=n.typedArrayFromHeap(s),y=0;y<d;y++)for(var b=y*f,x=0;x<v.length;x++){var k=m[x],w=y*k,I=v[x].subarray(w,w+k);g.set(I,b),b+=k}return s}var UY,GY={kernelName:Wn,backendName:"wasm",kernelFunc:VY};var HY,jY={kernelName:Vn,backendName:"wasm",setupFunc:function(e){UY=e.wasm.cwrap(Vn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,h=n.dataFormat,d=Dv.convertConv2DDataFormat(h),f=Dv.computeConv2DInfo(a.shape,i.shape,u,c,l,p,!1,d),m=f.filterHeight,v=f.filterWidth,g=f.padInfo.top,y=f.padInfo.right,b=f.padInfo.bottom,x=f.padInfo.left,k=f.dilationHeight,w=f.dilationWidth,I=f.strideHeight,S=f.strideWidth,N=f.inChannels,T=f.outChannels,C="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var E=r.makeOutput(f.outShape,"float32"),_=r.dataIdMap.get(E.dataId).id;return UY(o,a.shape[0],a.shape[1],a.shape[2],s,m,v,g,y,b,x,C,k,w,I,S,N,T,_),E}};var qY,KY={kernelName:Gn,backendName:"wasm",setupFunc:function(e){HY=e.wasm.cwrap(Gn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,i=n.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.inputShape,p=Dv.convertConv2DDataFormat(u),h=Dv.computeConv2DInfo(l,i.shape,o,1,s,c,!1,p),d=h.batchSize,f=h.filterHeight,m=h.filterWidth,v=h.inChannels,g=h.inHeight,y=h.inWidth,b=h.outChannels,x=h.outHeight,k=h.outWidth,w=h.strideHeight,I=h.strideWidth,S=f-1-h.padInfo.top,N=m-1-h.padInfo.left,T="channelsLast"===h.dataFormat,E=Vi.computeStrides(h.inShape),_=Vi.computeStrides(a.shape),A=C(Vi.computeStrides(i.shape),3),R=A[0],F=A[1],D=A[2],M=E[0],O=T?E[1]:E[2],L=T?E[2]:1,z=T?1:E[1],P=_[0],B=T?_[1]:_[2],W=T?_[2]:1,V=T?1:_[1],U=t.makeOutput(h.inShape,"float32"),G=t.dataIdMap.get(U.dataId).id,H=t.dataIdMap.get(a.dataId).id,j=t.dataIdMap.get(i.dataId).id;return HY(H,j,d,f,m,g,y,v,x,k,b,w,I,S,N,R,F,D,M,O,L,z,P,B,W,V,G),U}};var XY,YY={kernelName:Hn,backendName:"wasm",setupFunc:function(e){qY=e.wasm.cwrap(Hn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;if("float32"!==a.dtype)throw new Error("Tensor x must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Dv.computeConv3DInfo(a.shape,i.shape,o,u,s),l=n.makeOutput(c.outShape,a.dtype);return qY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}};var JY,QY={kernelName:jn,backendName:"wasm",setupFunc:function(e){XY=e.wasm.cwrap(jn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;if("float32"!==a.dtype)throw new Error("Tensor dy must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Dv.computeConv3DInfo(a.shape,u,o,1,s),l=n.makeOutput(c.filterShape,i.dtype);return XY(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}};var ZY,$Y,eJ={kernelName:qn,backendName:"wasm",setupFunc:function(e){JY=e.wasm.cwrap(qn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;if("float32"!==a.dtype)throw new Error("Tensor dy must have dtype float32, got ".concat(a.dtype));if("float32"!==i.dtype)throw new Error("Tensor filter must have dtype float32, got ".concat(i.dtype));var c=Dv.computeConv3DInfo(u,i.shape,s,1,o),l=n.makeOutput(c.inShape,a.dtype);return JY(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(l.dataId).id,c.batchSize,c.inDepth,c.inHeight,c.inWidth,c.inChannels,c.outDepth,c.outHeight,c.outWidth,c.outChannels,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.filterDepth,c.filterHeight,c.filterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),l}},tJ=XX(Kn),nJ=XX(Xn);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(ZY||(ZY={}));var rJ,aJ={kernelName:Qn,backendName:"wasm",setupFunc:function(e){$Y=e.wasm.cwrap(Qn,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=a.method,o=a.extrapolationValue,s=a.cropSize,u=r.image,c=r.boxes,l=r.boxInd,p=c.shape[0],h=C(s,2),d=h[0],f=h[1],m=[p,d,f,u.shape[3]],v=n.dataIdMap.get(u.dataId);"float32"!==u.dtype&&(t=LY({backend:n,inputs:{x:u},attrs:{dtype:"float32"}}),v=n.dataIdMap.get(t.dataId));var g=v.id,y=n.dataIdMap.get(c.dataId).id,b=n.dataIdMap.get(l.dataId).id,x=n.makeOutput(m,"float32"),k=n.dataIdMap.get(x.dataId).id,w=new Uint8Array(new Int32Array(u.shape).buffer);return $Y(g,y,b,p,w,d,f,ZY[i],o,k),null!=t&&n.disposeData(t.dataId),x}};var iJ,oJ={kernelName:Yn,backendName:"wasm",setupFunc:function(e){rJ=e.wasm.cwrap(Yn,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Vi.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Dv.getAxesPermutation([i],u),l=a;null!==c&&(l=iY({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Dv.getInnerMostAxes(1,u)[0];Dv.assertAxesAreInnerMostDims("cumprod",[p],u);var h=n.makeOutput(l.shape,l.dtype),d=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(h.dataId).id;rJ(f,o?1:0,s?1:0,d,m,VX[a.dtype]);var v=h;return null!==c&&(v=iY({inputs:{x:h},attrs:{perm:Dv.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(h.dataId)),v}};var sJ,uJ={kernelName:Jn,backendName:"wasm",setupFunc:function(e){iJ=e.wasm.cwrap(Jn,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Vi.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Dv.getAxesPermutation([i],u),l=a;null!==c&&(l=iY({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Dv.getInnerMostAxes(1,u)[0];Dv.assertAxesAreInnerMostDims("cumsum",[p],u);var h=n.makeOutput(l.shape,l.dtype),d=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(h.dataId).id;iJ(f,o?1:0,s?1:0,d,m,VX[a.dtype]);var v=h;return null!==c&&(v=iY({inputs:{x:h},attrs:{perm:Dv.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(h.dataId)),v}};var cJ,lJ={kernelName:Zn,backendName:"wasm",setupFunc:function(e){sJ=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.weights,o=r.size,s=r.binaryOutput,u=0!==i.shape.reduce((function(e,t){return e*t}),1),c=1===a.shape.length?[o]:[a.shape[0],o],l=t.makeOutput(c,i.dtype);function p(e){return t.dataIdMap.get(e.dataId).id}return sJ(p(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,o,u,p(i),VX[i.dtype],s,p(l)),l}};var pJ,hJ={kernelName:$n,backendName:"wasm",setupFunc:function(e){cJ=e.wasm.cwrap($n,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p="NHWC"===o?[s,u,c,l]:[s,l,u,c],h=t.makeOutput(p,"float32"),d=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(Vi.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(p).buffer),v=new Uint8Array(new Int32Array(Vi.computeStrides(p)).buffer),g=t.dataIdMap.get(h.dataId).id;return cJ(d,i,"NHWC"===o?1:0,f,a.shape.length-1,m,v,p.length,g),h}};var dJ,fJ={kernelName:er,backendName:"wasm",setupFunc:function(e){pJ=e.wasm.cwrap(er,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,h=null==c?[1,1]:c,d=Dv.computeConv2DInfo(a.shape,i.shape,u,h,l,p,!0),f=d.filterHeight,m=d.filterWidth,v=d.padInfo.top,g=d.padInfo.right,y=d.padInfo.bottom,b=d.padInfo.left,x=d.dilationHeight,k=d.dilationWidth,w=d.strideHeight,I=d.strideWidth,S=d.inChannels,N=d.outChannels,T="SAME"===d.padInfo.type?1:0;if("channelsLast"!==d.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(d.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(d.outShape,"float32"),E=r.dataIdMap.get(C.dataId).id;return pJ(o,a.shape[0],a.shape[1],a.shape[2],s,f,m,v,g,y,b,T,x,k,w,I,S,N,E),C}};var mJ,vJ={kernelName:rr,backendName:"wasm",setupFunc:function(e){dJ=e.wasm.cwrap("Diag",null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=Vi.sizeFromShape(r.shape),i=n.makeOutput([].concat(Ie(r.shape),Ie(r.shape)),r.dtype);return dJ(n.dataIdMap.get(r.dataId).id,VX[r.dtype],a,n.dataIdMap.get(i.dataId).id),i}};var gJ,yJ={kernelName:ar,backendName:"wasm",setupFunc:function(e){mJ=e.wasm.cwrap(ar,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;if(a.dtype!==i.dtype)throw new Error("Dilation2D error: x must have the same dtype as filter. Got ".concat(a.dtype," and ").concat(i.dtype));var c=Dv.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l=n.makeOutput(c.outShape,a.dtype);return mJ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(l.dataId).id,VX[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),l}};var bJ,xJ={kernelName:or,backendName:"wasm",setupFunc:function(e){gJ=e.wasm.cwrap(or,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations;if(a.dtype!==i.dtype||a.dtype!==o.dtype)throw new Error("Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ".concat(a.dtype,", ").concat(i.dtype,", and ").concat(o.dtype));var l=Dv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=n.makeOutput(i.shape,i.dtype);return gJ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(p.dataId).id,VX[a.dtype],l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.filterHeight,l.filterWidth,l.padInfo.top,l.padInfo.left),p}};var kJ,wJ={kernelName:ir,backendName:"wasm",setupFunc:function(e){bJ=e.wasm.cwrap(ir,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations;if(a.dtype!==i.dtype||a.dtype!==o.dtype)throw new Error("Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ".concat(a.dtype,", ").concat(i.dtype,", and ").concat(o.dtype));var l=Dv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=n.makeOutput(a.shape,a.dtype);return bJ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(p.dataId).id,VX[a.dtype],l.batchSize,l.inChannels,l.inHeight,l.inWidth,l.outHeight,l.outWidth,l.strideHeight,l.strideWidth,l.dilationHeight,l.dilationWidth,l.filterHeight,l.filterWidth,l.padInfo.top,l.padInfo.left),p}},IJ=XX(cr);var SJ={kernelName:lr,backendName:"wasm",setupFunc:function(e){kJ=e.wasm.cwrap(lr,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=n.makeOutput(a.shape,"float32"),o=function(e){return n.dataIdMap.get(e.dataId).id};return kJ(o(a),o(r),o(i)),i}},NJ=ZX(hr,0,"bool"),TJ=XX(dr,"float32");function CJ(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Vi.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),TY({inputs:{x:a},backend:r,attrs:{shape:s}})}var EJ={kernelName:fr,backendName:"wasm",kernelFunc:CJ},_J=XX(mr,"float32");function AJ(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,i=e.backend,o=i.makeOutput(n,a);return i.typedArrayFromHeap(o).fill(r),o}var RJ,FJ={kernelName:gr,backendName:"wasm",kernelFunc:AJ};var DJ,MJ={kernelName:yr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=C(r.shape,4),u=s[0],c=s[1],l=s[2],p=s[3];return RJ(i,u,c,l,p,o),a},setupFunc:function(e){RJ=e.wasm.cwrap(yr,null,["number","number","number","number","number","number"])}},OJ=XX(br),LJ=ZX(xr);var zJ,PJ={kernelName:kr,backendName:"wasm",setupFunc:function(e){DJ=e.wasm.cwrap(kr,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,i=n.mean,o=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(o.dataId).id,h=null!=s?t.dataIdMap.get(s.dataId).id:0,d=null!=u?t.dataIdMap.get(u.dataId).id:0,f=t.makeOutput(a.shape,a.dtype);if(0===Vi.sizeFromShape(a.shape))return f;var m=t.dataIdMap.get(f.dataId).id;return DJ(c,l,p,h,d,r,m),f}};var BJ,WJ={kernelName:Ti,backendName:"wasm",setupFunc:function(e){zJ=e.wasm.cwrap(Ti,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,h=n.dimRoundingMode,d=n.activation,f=n.leakyreluAlpha,m=Dv.computeConv2DInfo(a.shape,i.shape,u,l,c,h),v=UX[d];if(null==v)throw new Error("".concat(d," activation not yet supported for FusedConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,_=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,M=m.batchSize,O=m.inHeight,L=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),P=r.dataIdMap.get(z.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return zJ(g,M,O,L,y,w,I,x,S,N,T,C,D,E,_,A,R,F,b,v,B,f||0,P),z}};var VJ,UJ={kernelName:Ci,backendName:"wasm",setupFunc:function(e){BJ=e.wasm.cwrap(Ci,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,h=n.dimRoundingMode,d=n.activation,f=n.leakyreluAlpha,m=Dv.computeConv2DInfo(a.shape,i.shape,u,l,c,h,!0),v=UX[d];if(null==v)throw new Error("".concat(d," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedDepthwiseConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,E=m.dilationHeight,_=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,M=m.batchSize,O=m.inHeight,L=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var z=r.makeOutput(m.outShape,"float32"),P=r.dataIdMap.get(z.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return BJ(g,M,O,L,y,w,I,x,S,N,T,C,D,E,_,A,R,F,b,v,B,f||0,P),z}};var GJ,HJ={kernelName:Ir,backendName:"wasm",setupFunc:function(e){VJ=e.wasm.cwrap(Ir,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,i=C(iv.prepareAndValidate(r,a),4),o=i[0],s=i[1],u=i[2],c=i[3],l=t.makeOutput(o,r.dtype);if(0===s)return l;var p=a.shape,h=p[p.length-1],d=t.dataIdMap.get(r.dataId).id,f=t.dataIdMap.get(a.dataId).id,m=new Uint8Array(new Int32Array(c).buffer),v=t.dataIdMap.get(l.dataId).id;return VJ(d,VX[r.dtype],f,s,h,u,m,v),l}};var jJ,qJ={kernelName:wr,backendName:"wasm",setupFunc:function(e){GJ=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.indices,o=r.axis,s=r.batchDims,u=Vi.parseAxisParam(o,a.shape)[0],c=t.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[h];Vi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=Dv.segment_util.collectGatherOpShapeInfo(a,i,u,s),f=TY({inputs:{x:a},attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]},backend:t}),m=Vi.sizeFromShape(i.shape),v=TY({inputs:{x:i},attrs:{shape:[d.batchSize,m/d.batchSize]},backend:t}),g=[d.batchSize,d.outerSize,m/d.batchSize,d.sliceSize],y=t.makeOutput(g,a.dtype);if(0===Vi.sizeFromShape(a.shape))return y;var b=f.shape.length-1,x=t.dataIdMap.get(f.dataId).id,k=t.dataIdMap.get(v.dataId).id,w=t.dataIdMap.get(y.dataId).id,I=new Uint8Array(new Int32Array(Vi.computeStrides(f.shape)).buffer),S=new Uint8Array(new Int32Array(Vi.computeStrides(g)).buffer);return GJ(x,VX[a.dtype],I,b,k,d.batchSize,S,w),t.disposeData(f.dataId),t.disposeData(v.dataId),y.shape=d.outputShape,y}},KJ=ZX(Sr,0,"bool"),XJ=ZX(Nr,0,"bool"),YJ=XX(_r,"bool"),JJ=XX(Ar,"bool"),QJ=XX(Rr,"bool");var ZJ,$J={kernelName:Fr,backendName:"wasm",setupFunc:function(e){jJ=e.wasm.cwrap(Fr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Vi.sizeFromShape(t.shape)){var o=r.dataIdMap.get(i.dataId).id;jJ(a,VX[t.dtype],n,o)}return i}},eQ=ZX(Dr,0,"bool"),tQ=ZX(Mr,0,"bool");var nQ,rQ={kernelName:Or,backendName:"wasm",setupFunc:function(e){ZJ=e.wasm.cwrap(Or,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.attrs,n=e.backend,r=t.start,a=t.stop,i=t.num,o=Math.floor(i),s=n.makeOutput([o],"float32");return ZJ(n.dataIdMap.get(s.dataId).id,r,a,o),s}},aQ=XX(Lr),iQ=XX(zr),oQ=ZX(Pr,0,"bool"),sQ=XX(Br),uQ=ZX(Wr,0,"bool"),cQ=ZX(Vr,0,"bool");var lQ,pQ={kernelName:Hr,backendName:"wasm",setupFunc:function(e){nQ=e.wasm.cwrap(Hr,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;if("float32"!==a.dtype)throw new Error("LRN error: x must have dtype float32");var c=n.makeOutput(a.shape,a.dtype);return nQ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,a.shape[3],i,o,s,u),c}};var hQ,dQ={kernelName:jr,backendName:"wasm",setupFunc:function(e){lQ=e.wasm.cwrap(jr,null,["number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;if("float32"!==a.dtype||"float32"!==i.dtype||"float32"!==o.dtype)throw new Error("LRNGrad error: x, y, and dy must have dtype float32");var p=n.makeOutput(a.shape,a.dtype);return lQ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(p.dataId).id,o.shape[3],s,u,c,l),p}};var fQ,mQ={kernelName:Kr,backendName:"wasm",setupFunc:function(e){hQ=e.wasm.cwrap(Kr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=uY(o,a,t),l=c.transposed,p=c.axes,h=c.originalAxes,d=c.inputWasTransposed;d&&(u=l,s=t.dataIdMap.get(l.dataId).id);var f=u.shape.length;Dv.assertAxesAreInnerMostDims("max",p,f);var m=C(Dv.computeOutAndReduceShapes(u.shape,p),2),v=m[0],g=m[1],y=Vi.sizeFromShape(g),b=t.makeOutput(v,o.dtype);if(0!==Vi.sizeFromShape(u.shape)){var x=t.dataIdMap.get(b.dataId).id;hQ(s,VX[o.dtype],y,x)}if(d&&t.disposeData(l.dataId),i){var k=Dv.expandShapeToKeepDim(b.shape,h);b.shape=k}return b}},vQ=ZX(Xr);var gQ,yQ={kernelName:Yr,backendName:"wasm",setupFunc:function(e){fQ=e.wasm.cwrap(Yr,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id;Vi.assert("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Dv.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,h=l.filterWidth,d=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.dilationHeight,y=l.dilationWidth,b=l.strideHeight,x=l.strideWidth,k=l.inChannels,w=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var I=r.makeOutput(l.outShape,"float32"),S=r.dataIdMap.get(I.dataId).id;return fQ(i,a.shape[0],a.shape[1],a.shape[2],p,h,d,f,m,v,g,y,b,x,k,w,S),I}};var bQ,xQ={kernelName:Qr,backendName:"wasm",setupFunc:function(e){gQ=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Dv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=n.makeOutput(l.outShape,a.dtype);return gQ(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),p}};var kQ,wQ={kernelName:Zr,backendName:"wasm",setupFunc:function(e){bQ=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Dv.computePool3DInfo(i.shape,o,s,1,u,c),p=n.makeOutput(i.shape,i.dtype);return bQ(n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(p.dataId).id,l.batchSize,l.inChannels,l.inDepth,l.inHeight,l.inWidth,l.outDepth,l.outHeight,l.outWidth,l.strideDepth,l.strideHeight,l.strideWidth,l.dilationDepth,l.dilationHeight,l.dilationWidth,l.effectiveFilterDepth,l.effectiveFilterHeight,l.effectiveFilterWidth,l.padInfo.front,l.padInfo.top,l.padInfo.left),p}};var IQ,SQ={kernelName:ea,backendName:"wasm",setupFunc:function(e){kQ=e.wasm.cwrap(ea,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=uY(o,a,t),p=l.transposed,h=l.axes,d=l.originalAxes,f=l.inputWasTransposed,m=h;if(f){var v=t.dataIdMap.get(p.dataId).id;v!==s&&(c=p,u=v,m=Dv.getInnerMostAxes(m.length,c.shape.length))}Dv.assertAxesAreInnerMostDims("mean",m,c.shape.length);var g=C(Dv.computeOutAndReduceShapes(c.shape,m),2),y=g[0],b=g[1],x=Vi.sizeFromShape(b),k=c;"float32"!==c.dtype&&(k=LY({backend:t,inputs:{x:c},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(k.dataId).id);var w=t.makeOutput(y,"float32");if(0!==Vi.sizeFromShape(c.shape)){var I=t.dataIdMap.get(w.dataId).id;kQ(u,x,I)}if(f&&t.disposeData(p.dataId),i){var S=Dv.expandShapeToKeepDim(w.shape,d);w.shape=S}return"float32"!==c.dtype&&t.disposeData(k.dataId),w}};var NQ,TQ,CQ={kernelName:ta,backendName:"wasm",setupFunc:function(e){IQ=e.wasm.cwrap(ta,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=uY(o,a,t),p=l.transposed,h=l.axes,d=l.originalAxes,f=l.inputWasTransposed;if(f){var m=t.dataIdMap.get(p.dataId).id;m!==s&&(c=p,u=m)}var v=c.shape.length;Dv.assertAxesAreInnerMostDims("min",h,v);var g=C(Dv.computeOutAndReduceShapes(c.shape,h),2),y=g[0],b=g[1],x=Vi.sizeFromShape(b),k=t.makeOutput(y,c.dtype);if(0!==Vi.sizeFromShape(c.shape)){var w=t.dataIdMap.get(k.dataId).id;IQ(u,VX[o.dtype],x,w)}if(f&&t.disposeData(p.dataId),i){var I=Dv.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}},EQ=ZX(na);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(NQ||(NQ={}));var _Q,AQ={kernelName:ra,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.mode,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),h=a.map((function(e){return e[1]})),d=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(h).buffer);return TQ(s,l,t.shape.length,VX[t.dtype],d,f,NQ[i],c),u},setupFunc:function(e){TQ=e.wasm.cwrap(ra,null,["number","array","number","number","array","array","number","number"])}};function RQ(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(i.dataId).id,s=n.shape[r],u=Vi.sizeFromShape(n.shape)/s;return 0===Vi.sizeFromShape(i.shape)||_Q(a,o,s,u),i}var FQ,DQ={kernelName:Qa,backendName:"wasm",setupFunc:function(e){_Q=e.wasm.cwrap(Qa,null,["number","number","number","number"])},kernelFunc:RQ};var MQ,OQ={kernelName:ia,backendName:"wasm",setupFunc:function(e){FQ=e.wasm.cwrap(ia,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;if("float32"!==a.dtype)throw new Error("Tensor logits must have dtype float32, got ".concat(a.dtype));var u=s?a:RQ({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=C(u.shape,2),l=c[0],p=c[1],h=n.makeOutput([l,i],"int32");return FQ(n.dataIdMap.get(u.dataId).id,l,p,i,o,n.dataIdMap.get(h.dataId).id),s||n.disposeData(u.dataId),h}},LQ=ZX(oa),zQ=XX(sa);function PQ(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:o}}var BQ,WQ={kernelName:ca,backendName:"wasm",setupFunc:function(e){MQ=e.wasm.cwrap(ca,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,p=PQ(t,MQ(c,l,i,a,o)),h=p.pSelectedIndices,d=p.selectedSize,f=p.pSelectedScores,m=p.pValidOutputs;return t.wasm._free(f),t.wasm._free(m),t.makeOutput([d],"int32",h)}};var VQ,UQ={kernelName:la,backendName:"wasm",setupFunc:function(e){BQ=e.wasm.cwrap(la,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,h=PQ(t,BQ(l,p,i,a,o,s)),d=h.pSelectedIndices,f=h.selectedSize,m=h.pSelectedScores,v=h.pValidOutputs;return t.wasm._free(m),[t.makeOutput([f],"int32",d),t.makeOutput([],"int32",v)]}};var GQ,HQ={kernelName:pa,backendName:"wasm",setupFunc:function(e){VQ=e.wasm.cwrap(pa,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,h=PQ(t,VQ(l,p,i,a,o,s)),d=h.pSelectedIndices,f=h.selectedSize,m=h.pSelectedScores,v=h.pValidOutputs;return t.wasm._free(v),[t.makeOutput([f],"int32",d),t.makeOutput([f],"float32",m)]}},jQ=ZX(ua,0,"bool");var qQ={kernelName:da,backendName:"wasm",setupFunc:function(e){GQ=e.wasm.cwrap(da,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=n.makeOutput([].concat(Ie(a.shape),[o]),i),l=n.dataIdMap.get(c.dataId).id,p=n.dataIdMap.get(a.dataId).id;return GQ(p,o,s,u,l),c}};var KQ={kernelName:ha,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}};var XQ,YQ={kernelName:fa,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return CJ({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Vi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Vi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=CJ({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=VY({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),u}};var JQ,QQ={kernelName:ma,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.constantValue,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Vi.sizeFromShape(t.shape))return AJ({backend:n,attrs:{shape:o,value:i,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),h=a.map((function(e){return e[1]})),d=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(h).buffer);return XQ(s,l,t.shape.length,VX[t.dtype],d,f,i,c),u},setupFunc:function(e){XQ=e.wasm.cwrap(ma,null,["number","array","number","number","array","array","number","number"])}},ZQ=ZX(ga);var $Q,eZ={kernelName:ya,backendName:"wasm",setupFunc:function(e){JQ=e.wasm.cwrap(ya,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=i,u=r,c=u;"float32"!==u.dtype&&(c=LY({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(l.dataId).id;return JQ(s,o,p),"float32"!==u.dtype&&n.disposeData(c.dataId),l}};var tZ,nZ={kernelName:ba,backendName:"wasm",setupFunc:function(e){$Q=e.wasm.cwrap(ba,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=uY(o,a,t),p=l.transposed,h=l.axes,d=l.originalAxes,f=l.inputWasTransposed,m=h;if(f){var v=t.dataIdMap.get(p.dataId).id;v!==s&&(c=p,u=v,m=Dv.getInnerMostAxes(m.length,c.shape.length))}Dv.assertAxesAreInnerMostDims("prod",m,c.shape.length);var g=C(Dv.computeOutAndReduceShapes(c.shape,m),2),y=g[0],b=g[1],x=Vi.sizeFromShape(b),k=t.makeOutput(y,c.dtype);if(0!==Vi.sizeFromShape(c.shape)){var w=t.dataIdMap.get(k.dataId).id;$Q(u,x,VX[k.dtype],w)}if(f&&t.disposeData(p.dataId),i){var I=Dv.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}},rZ={kernelName:Ia,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=SD(r,a,i,o),u=t.makeOutput([s.length],o);return t.typedArrayFromHeap(u).set(s),u}},aZ=ZX(sr),iZ=XX(Na),oZ=XX(Ta),sZ=XX(Fa);var uZ,cZ={kernelName:Aa,backendName:"wasm",setupFunc:function(e){tZ=e.wasm.cwrap(Aa,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.images,o=a.alignCorners,s=a.halfPixelCenters,u=C(a.size,2),c=u[0],l=u[1],p=C(i.shape,4),h=p[0],d=p[1],f=p[2],m=p[3],v=[h,c,l,m],g=n.dataIdMap.get(i.dataId);"float32"!==g.dtype&&(t=LY({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));var y=g.id,b=n.makeOutput(v,"float32");if(0===Vi.sizeFromShape(i.shape))return b;var x=n.dataIdMap.get(b.dataId).id;return tZ(y,h,d,f,m,c,l,o?1:0,s?1:0,x),null!=t&&n.disposeData(t.dataId),b}};var lZ,pZ={kernelName:Ra,backendName:"wasm",setupFunc:function(e){uZ=e.wasm.cwrap(Ra,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.images,o=n.dy,s=a.alignCorners,u=r.makeOutput(i.shape,"float32"),c=r.dataIdMap.get(i.dataId);return"float32"!==c.dtype&&(t=LY({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),c=r.dataIdMap.get(t.dataId)),uZ(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(o.dataId).id,r.dataIdMap.get(u.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(o.shape).buffer),s),null!=t&&r.disposeData(t.dataId),u}};var hZ,dZ={kernelName:Ea,backendName:"wasm",setupFunc:function(e){lZ=e.wasm.cwrap(Ea,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,i=r.alignCorners,o=r.halfPixelCenters,s=C(r.size,2),u=s[0],c=s[1],l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=[p,u,c,f],v=t.makeOutput(m,"float32");if(0===Vi.sizeFromShape(a.shape))return v;var g,y=t.dataIdMap.get(a.dataId);"float32"!==y.dtype&&(g=LY({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),y=t.dataIdMap.get(g.dataId));var b=y.id,x=t.dataIdMap.get(v.dataId).id;return lZ(b,p,h,d,f,u,c,i?1:0,o?1:0,x),null!=g&&t.disposeData(g.dataId),v}};var fZ,mZ={kernelName:_a,backendName:"wasm",setupFunc:function(e){hZ=e.wasm.cwrap(_a,null,["number","number","number","array","array","boolean"])},kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.images,o=n.dy,s=a.alignCorners,u=r.makeOutput(i.shape,"float32"),c=r.dataIdMap.get(i.dataId);return"float32"!==c.dtype&&(t=LY({backend:r,inputs:{x:i},attrs:{dtype:"float32"}}),c=r.dataIdMap.get(t.dataId)),hZ(r.dataIdMap.get(i.dataId).id,r.dataIdMap.get(o.dataId).id,r.dataIdMap.get(u.dataId).id,new Uint8Array(new Int32Array(i.shape).buffer),new Uint8Array(new Int32Array(o.shape).buffer),s),null!=t&&r.disposeData(t.dataId),u}};var vZ,gZ={kernelName:Da,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=Vi.parseAxisParam(i,a.shape);if(0===a.shape.length)return nY({inputs:{x:a},backend:n});var s=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,l=new Uint8Array(new Int32Array(o).buffer),p=new Uint8Array(new Int32Array(a.shape).buffer);fZ(u,l,o.length,p,a.shape.length,c);var h=TY({inputs:{x:s},attrs:{shape:a.shape},backend:n});return n.disposeData(s.dataId),h},setupFunc:function(e){fZ=e.wasm.cwrap(Da,null,["number","array","number","array","number","number"])}};var yZ,bZ={kernelName:Si,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,o=r.fillValue,s=r.center,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(u.dataId).id,p=C(a.shape,4),h=p[0],d=p[1],f=p[2],m=p[3],v=C(Dv.getImageCenter(s,d,f),2),g=v[0],y=v[1],b="number"==typeof o?[o,o,o,0===o?0:255]:[].concat(Ie(o),[255]),x=new Uint8Array(new Int32Array(b).buffer);return vZ(c,h,d,f,m,i,g,y,x,b.length,l),u},setupFunc:function(e){vZ=e.wasm.cwrap(Si,null,["number","number","number","number","number","number","number","number","array","number","number"])}},xZ=XX(Ma),kZ=XX(Oa);var wZ,IZ={kernelName:La,backendName:"wasm",setupFunc:function(e){yZ=e.wasm.cwrap(La,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,i=n.updates,o=r.shape,s=t.makeOutput(o,i.dtype);if(0===Vi.sizeFromShape(o))return s;var u=bd.calculateShapes(i,a,o),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize,f=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,v=new Uint8Array(new Int32Array(h).buffer),g=t.dataIdMap.get(s.dataId).id;return yZ(f,m,VX[i.dtype],c,l,p,v,d,g),s}};var SZ,NZ={kernelName:Pa,backendName:"wasm",setupFunc:function(e){wZ=e.wasm.cwrap(Pa,null,["number","number","number","number","number","number","bool","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side;if(a.dtype!==i.dtype)throw new Error("SearchSorted error: sorted_sequence must have the same dtype as values. Got ".concat(a.dtype," and ").concat(i.dtype));var s=n.makeOutput(i.shape,"int32");function u(e){return n.dataIdMap.get(e.dataId).id}return wZ(u(a),u(i),a.shape[0],a.shape[1],i.shape[1],VX[a.dtype],"left"===o,u(s)),s}};var TZ,CZ={kernelName:Ba,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,p=r.shape.length,h=a.shape.length,d=0===p||p>1||1===h?1:Vi.sizeFromShape(a.shape.slice(1));return SZ(o,s,u,d,l),c},setupFunc:function(e){SZ=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},EZ=XX(Wa);var _Z={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){TZ=e.wasm.cwrap(ja,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Vi.sizeFromShape(a.shape)||TZ(r,i),a}},AZ=XX(Ha),RZ=XX(Ua),FZ=XX(qa);var DZ,MZ={kernelName:Ya,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings,s=Vi.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Ie(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=QQ.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Dv.getReshaped(l.shape,i,s,!1),h=Dv.getPermuted(p.length,i.length,!1),d=Dv.getReshapedPermuted(l.shape,i,s,!1),f=TY({inputs:{x:l},backend:n,attrs:{shape:p}}),m=iY({inputs:{x:f},backend:n,attrs:{perm:h}}),v=TY({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeData(l.dataId),n.disposeData(f.dataId),n.disposeData(m.dataId),v}};var OZ,LZ={kernelName:Za,backendName:"wasm",setupFunc:function(e){DZ=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,i=r.values,o=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(o.dataId)[0],p=[u+l,c],h=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(p,a.dtype),v=n.dataIdMap.get(m.dataId).id,g=n.makeOutput(p.slice(0,1),i.dtype),y=n.dataIdMap.get(g.dataId).id,b=n.makeOutput([l],"bool"),x=n.dataIdMap.get(b.dataId).id,k=n.makeOutput([u],a.dtype),w=n.dataIdMap.get(k.dataId).id,I=n.makeOutput([4],"int32"),S=n.dataIdMap.get(I.dataId).id,N=DZ(h,d,VX[i.dtype],u,l,c,f,v,y,x,w,S),T=n.readSync(I.dataId);switch(T[0]){case 1:t=Dv.getSparseFillEmptyRowsIndicesDenseShapeMismatch(T[1]);break;case 2:t=Dv.getSparseFillEmptyRowsNegativeIndexErrorMessage(T[1],T[2]);break;case 3:t=Dv.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(T[1],T[2],T[3]);break;default:t=""}if(n.disposeData(I.dataId),t)throw n.disposeData(m.dataId),n.disposeData(g.dataId),n.disposeData(b.dataId),n.disposeData(k.dataId),new Error(t);var C=m,E=g;return N!==p[0]&&(C=AY({inputs:{x:m},attrs:{begin:0,size:[N,c]},backend:n}),E=AY({inputs:{x:g},attrs:{begin:0,size:N},backend:n}),n.disposeData(m.dataId),n.disposeData(g.dataId)),[C,E,b,k]}};var zZ,PZ={kernelName:$a,backendName:"wasm",setupFunc:function(e){OZ=e.wasm.cwrap($a,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,i=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=r.shape[0],l=Vi.sizeFromShape(i.shape),p=t.makeOutput([c,l],r.dtype),h=t.dataIdMap.get(p.dataId).id,d=t.makeOutput([l],i.dtype),f=t.dataIdMap.get(d.dataId).id,m=t.makeOutput([3],"int32"),v=t.dataIdMap.get(m.dataId).id;OZ(o,s,u,c,h,f,v);var g,y=t.readSync(m.dataId);switch(y[0]){case 0:g=Dv.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break;case 1:g=Dv.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break;case 2:g=Dv.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:var b=Array.from(t.readSync(a.dataId)),x=Array.from(t.readSync(d.dataId));g=Dv.getSparseReshapeInputOutputMultipleErrorMessage(b,x);break;case 4:var k=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(d.dataId));g=Dv.getSparseReshapeInputOutputMismatchErrorMessage(k,w);break;default:g=""}if(t.disposeData(m.dataId),g)throw t.disposeData(p.dataId),t.disposeData(d.dataId),new Error(g);return[p,d]}};function BZ(e){zZ=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function WZ(e,t){var n=e.backend,r=e.inputs,a=r.data,i=r.indices,o=r.segmentIds,s=i.shape[0],u=n.readSync(o.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error(Dv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var l=a.shape.slice();l[0]=c;var p=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(i.dataId).id,d=n.dataIdMap.get(o.dataId).id,f=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(f.dataId).id,v=n.makeOutput([4],"int32"),g=n.dataIdMap.get(v.dataId).id;zZ(p,VX[a.dtype],a.shape[0],h,d,m,g,t,0);var y,b=n.readSync(v.dataId);switch(b[0]){case 0:y=Dv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:y=Dv.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:y=Dv.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:y=Dv.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:y=""}if(n.disposeData(v.dataId),y)throw n.disposeData(f.dataId),new Error(y);return f}var VZ={kernelName:ei,backendName:"wasm",setupFunc:BZ,kernelFunc:function(e){return WZ(e,!0)}};var UZ,GZ={kernelName:ti,backendName:"wasm",setupFunc:BZ,kernelFunc:function(e){return WZ(e,!1)}};var HZ={kernelName:ni,backendName:"wasm",setupFunc:function(e){UZ=e.wasm.cwrap(ni,null,["number","number","number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.sparseIndices,i=n.sparseValues,o=n.defaultValue,s=r.outputShape,u=t.makeOutput(s,o.dtype);if(0===Vi.sizeFromShape(s))return u;var c=Dv.calculateShapes(i,a,s),l=c.sliceRank,p=c.numUpdates,h=c.sliceSize,d=c.strides,f=c.outputSize,m=t.dataIdMap.get(a.dataId).id,v=t.dataIdMap.get(i.dataId).id,g=t.dataIdMap.get(o.dataId).id,y=new Uint8Array(new Int32Array(d).buffer),b=t.dataIdMap.get(u.dataId).id;return UZ(m,v,i.shape.length,g,VX[o.dtype],l,p,h,y,f,b),u}};var jZ,qZ={kernelName:Ja,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,o=n.axis,s=Vi.parseAxisParam(o,a.shape)[0],u=Dv.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Ie(l);t[s]=e;var n=AY({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},KZ=XX(Ka),XZ=XX(ai),YZ=ZX(ri);var JZ,QZ={kernelName:wi,backendName:"wasm",setupFunc:function(e){jZ=e.wasm.cwrap(wi,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(o.dataId).id;return jZ(i,r,VX[a.dtype],s),o}};var ZZ={kernelName:oi,backendName:"wasm",setupFunc:function(e){JZ=e.wasm.cwrap(oi,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,h=a.newAxisMask,d=a.shrinkAxisMask,f=sv.sliceInfo(i.shape,o,s,u,c,l,p,h,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=TY({inputs:{x:i},backend:n,attrs:{shape:v}});else if(y||b){Vi.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=sv.computeOutShape(x,k,w),S=AY({inputs:{x:i},backend:n,attrs:{begin:x,size:I}});t=TY({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeData(S.dataId)}else{var N=n.makeOutput(m,"float32"),T=n.dataIdMap.get(i.dataId).id,C=new Uint8Array(new Int32Array(Vi.computeStrides(i.shape)).buffer),E=new Uint8Array(new Int32Array(x).buffer),_=new Uint8Array(new Int32Array(k).buffer),A=new Uint8Array(new Int32Array(w).buffer),R=new Uint8Array(new Int32Array(m).buffer),F=new Uint8Array(new Int32Array(Vi.computeStrides(m)).buffer),D=n.dataIdMap.get(N.dataId).id;JZ(T,C,i.shape.length,E,_,A,R,F,m.length,D),t=TY({inputs:{x:N},backend:n,attrs:{shape:v}}),n.disposeData(N.dataId)}return t}};var $Z={kernelName:si,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,i=n.dataSplits,o=r.separator,s=r.nGramWidths,u=r.leftPad,c=r.rightPad,l=r.padWidth,p=r.preserveShortSequences,h=C(YD(t.readSync(a.dataId),t.readSync(i.dataId),o,s,u,c,l,p),2),d=h[0],f=h[1],m=t.makeOutput([d.length],"string");t.dataIdMap.get(m.dataId).stringBytes=d;var v=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(v).set(f),[m,v]}};var e$={kernelName:ui,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=n.delimiter,o=r.skipEmpty,s=C(QD(t.readSync(a.dataId),t.readSync(i.dataId)[0],o),3),u=s[0],c=s[1],l=s[2],p=c.length,h=t.makeOutput([p,2],"int32");t.typedArrayFromHeap(h).set(u);var d=t.makeOutput([p],"string");t.dataIdMap.get(d.dataId).stringBytes=c;var f=t.makeOutput([2],"int32");return t.typedArrayFromHeap(f).set(l),[h,d,f]}};var t$,n$={kernelName:ci,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=r.numBuckets,o=ZD(t.readSync(a.dataId),i),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(o),s}},r$=ZX(li);var a$,i$={kernelName:Xa,backendName:"wasm",setupFunc:function(e){t$=e.wasm.cwrap(Xa,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=uY(o,a,t),p=l.transposed,h=l.axes,d=l.originalAxes,f=l.inputWasTransposed,m=h;if(f){var v=t.dataIdMap.get(p.dataId).id;v!==s&&(c=p,u=v,m=Dv.getInnerMostAxes(m.length,c.shape.length))}Dv.assertAxesAreInnerMostDims("sum",m,c.shape.length);var g=C(Dv.computeOutAndReduceShapes(c.shape,m),2),y=g[0],b=g[1],x=Vi.sizeFromShape(b),k=t.makeOutput(y,c.dtype);if(0!==Vi.sizeFromShape(c.shape)){var w=t.dataIdMap.get(k.dataId).id;t$(u,x,VX[k.dtype],w)}if(f&&t.disposeData(p.dataId),i){var I=Dv.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}},o$=XX(pi),s$=XX(hi);var u$,c$={kernelName:za,backendName:"wasm",setupFunc:function(e){a$=e.wasm.cwrap(za,null,["number","number","number","number","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.tensor,i=n.indices,o=n.updates;ce(r);var s=t.makeOutput(a.shape,a.dtype);if(0===Vi.sizeFromShape(a.shape))return s;var u=bd.calculateShapes(o,i,a.shape),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize,f=t.dataIdMap.get(i.dataId).id,m=t.dataIdMap.get(o.dataId).id,v=t.dataIdMap.get(a.dataId).id,g=new Uint8Array(new Int32Array(h).buffer),y=t.dataIdMap.get(s.dataId).id;return a$(f,m,VX[o.dtype],c,l,p,g,d,y,v),s}};var l$,p$={kernelName:di,backendName:"wasm",setupFunc:function(e){u$=e.wasm.cwrap(di,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=n.dataIdMap.get(a.dataId).id,o=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*o[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),p=n.makeOutput(s,a.dtype),h=n.dataIdMap.get(p.dataId).id;return u$(i,c,a.shape.length,l,s.length,VX[p.dtype],h),p}};var h$,d$={kernelName:fi,backendName:"wasm",setupFunc:function(e){l$=e.wasm.cwrap(fi,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=i;var l=n.makeOutput(c,a.dtype),p=n.dataIdMap.get(l.dataId).id,h=n.makeOutput(c,"int32"),d=n.dataIdMap.get(h.dataId).id;return l$(s,u,a.shape.length,VX[a.dtype],i,o,p,d),[l,h]}};var f$={kernelName:mi,backendName:"wasm",setupFunc:function(e){h$=e.wasm.cwrap(mi,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.image,o=r.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,p=C(i.shape,4),h=p[0],d=p[1],f=p[2],m=p[3],v=C(null!=l?l:[d,f],2),g=v[0],y=v[1],b=[h,g,y,m],x=new Uint8Array(new Int32Array(Vi.computeStrides(i.shape)).buffer),k=new Uint8Array(new Int32Array(Vi.computeStrides(b)).buffer),w=n.makeOutput(b,i.dtype),I=n.dataIdMap.get(w.dataId).id,S=n.dataIdMap.get(i.dataId).id,N=n.dataIdMap.get(o.dataId).id,T="nearest"===s?1:2;switch(u){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return h$(S,N,o.shape[0]>1,h,g,y,m,f,d,x,i.shape.length-1,k,b.length-1,T,t,c,I),w}};var m$={kernelName:gi,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x,o=sM(r.readSync(i.dataId),a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeOutput(u,i.dtype,void 0,s),r.makeOutput([c.length],"int32",void 0,c)]}};var v$={kernelName:yi,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape[i],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o),h=new Array(s).fill(0),d=a.shape.slice();d[i]=1;for(var f=0;f<p.length;f++)h[i]=f,p[f]=AY({inputs:{x:a},attrs:{begin:h,size:d},backend:n});return p.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}};for(var g$={kernelName:ki,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}},y$=0,b$=[KX,YX,JX,QX,eY,tY,lY,pY,fY,mY,vY,gY,yY,bY,xY,wY,SY,NY,_Y,DY,MY,OY,PY,BY,WY,GY,jY,KY,YY,QY,eJ,tJ,nJ,aJ,oJ,uJ,lJ,hJ,fJ,vJ,yJ,xJ,wJ,IJ,SJ,NJ,TJ,EJ,_J,FJ,MJ,OJ,LJ,PJ,WJ,UJ,HJ,qJ,KJ,XJ,aY,YJ,JJ,QJ,$J,eQ,tQ,rQ,iQ,aQ,oQ,sQ,uQ,cQ,pQ,dQ,mQ,vQ,yQ,xQ,wQ,SQ,CQ,EQ,AQ,OQ,LQ,zQ,WQ,UQ,HQ,jQ,qQ,KQ,YQ,QQ,ZQ,eZ,nZ,rZ,aZ,iZ,oZ,sZ,EY,cZ,pZ,dZ,mZ,gZ,bZ,xZ,kZ,IZ,NZ,CZ,EZ,_Z,AZ,RZ,RY,DQ,FZ,MZ,LZ,PZ,VZ,GZ,HZ,qZ,KZ,XZ,YZ,QZ,ZZ,$Z,e$,n$,r$,i$,o$,s$,c$,p$,d$,f$,sY,m$,v$,g$];y$<b$.length;y$++){Oi(b$[y$])}var x$=on();x$.registerFlag("WASM_HAS_SIMD_SUPPORT",S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})))),x$.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x$.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var k$=ze(nt()),w$=ze(rt()),I$=ze(at()),S$=k$.default||k$,N$=I$.default||I$,T$=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(B$),W$=r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new it(he(r),Ru()),r}return we(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Vi.now(),e.abrupt("return",(t(),{kernelMs:Vi.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(e,t,n,r,a){var i=this.dataIdNextNumber++;if("string"!==r){var o=Vi.sizeFromShape(n),s=o*Vi.bytesPerElement(r),u=this.wasm._malloc(s)>>>0;this.dataIdMap.set(e,{id:i,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,o,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:i,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,i=r.dtype,o=r.shape,s=r.stringBytes;if("string"===i)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Vi.sizeFromShape(o);var u=Vi.bytesPerElement(i);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,i)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n,r){var a;if(null==n)a=this.write(null!=r?r:null,e,t);else{var i=this.dataIdNextNumber++;a={id:i},this.dataIdMap.set(a,{id:i,memoryOffset:n,shape:e,dtype:t,refCount:1});var o=Vi.sizeFromShape(e);this.wasm.tfjs.registerTensor(i,o,n)}return{dataId:a,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(r).memoryOffset,o=Vi.sizeFromShape(t);switch(n){case"float32":return new Float32Array(a,i,o);case"int32":return new Int32Array(a,i,o);case"bool":return new Uint8Array(a,i,o);default:throw new Error("Unknown dtype ".concat(n))}}}]),n}(ot);function C$(e){return function(t,n){return Vi.fetch(e,{credentials:"same-origin"}).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance,e.module)}))}))})),{}}}function E$(e,t,n){if(null!=F$)return F$;var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=M$&&null!=M$[r]?M$[r]:n+r}function _$(){return A$.apply(this,arguments)}function A$(){return A$=S(w().mark((function e(){var t,n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([on().getAsync("WASM_HAS_SIMD_SUPPORT"),on().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=C(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n={locateFile:function(e,t){if(e.endsWith(".worker.js")){var n=w$.wasmWorkerContents.replace(/\n/g,"\\n"),i=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(i)}return e.endsWith(".wasm")?E$(r,a,null!=D$?D$:t):t+e}};L$&&(n.instantiateWasm=C$(E$(r,a,null!=D$?D$:"")));var i,o=!1;n.onAbort=function(){o||O$||(O$=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==F$?(n.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+S$.toString()],{type:"text/javascript"}),i=S$(n)):i=N$(n),i.then((function(t){o=!0,O$=!1;t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)}))),A$.apply(this,arguments)}var R$=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],F$=null,D$=null,M$={},O$=!1,L$=!1;function z$(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(_u("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),O$)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");F$=e,L$=t}function P$(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(O$)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)D$=e;else{M$=e;var n=R$.filter((function(e){return null==M$[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}L$=t}var B$=-1,W$=-1;function V$(e){B$=e}function U$(){if(-1===W$)throw new Error("WASM backend not initialized.");return W$}var G$="4.5.0";Hu("wasm",S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_$();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new T$(n));case 5:case"end":return e.stop()}}),e)}))),2);var H$="4.5.0",j$={tfjs:H$,"tfjs-core":H$,"tfjs-converter":"4.5.0","tfjs-backend-cpu":"4.5.0","tfjs-backend-webgl":"4.5.0","tfjs-backend-wasm":"4.5.0"};function q$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}Ee({},{AnchorPosition:function(){return M0},DrawBox:function(){return P0},DrawBoxOptions:function(){return z0},DrawFaceLandmarks:function(){return L1},DrawFaceLandmarksOptions:function(){return O1},DrawTextField:function(){return L0},DrawTextFieldOptions:function(){return O0},drawContour:function(){return q$},drawDetections:function(){return B0},drawFaceExpressions:function(){return F1},drawFaceLandmarks:function(){return z1}});Ee({},{computeReshapedDimensions:function(){return r0},getCenterPoint:function(){return a0},isDimensions:function(){return n0},isEven:function(){return e0},isFloat:function(){return $$},isTensor:function(){return X$},isTensor1D:function(){return Y$},isTensor2D:function(){return J$},isTensor3D:function(){return Q$},isTensor4D:function(){return Z$},isValidNumber:function(){return o0},isValidProbablitiy:function(){return s0},range:function(){return i0},round:function(){return t0}});var K$=function(){function e(t,n){if(xe(this,e),!o0(t)||!o0(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have ".concat(JSON.stringify({width:t,height:n})));this._width=t,this._height=n}return we(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"reverse",value:function(){return new e(1/this.width,1/this.height)}}]),e}();function X$(e,t){return e instanceof No&&e.shape.length===t}function Y$(e){return X$(e,1)}function J$(e){return X$(e,2)}function Q$(e){return X$(e,3)}function Z$(e){return X$(e,4)}function $$(e){return e%1!==0}function e0(e){return e%2===0}function t0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.pow(10,t);return Math.floor(e*n)/n}function n0(e){return e&&e.width&&e.height}function r0(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new K$(Math.round(n*a),Math.round(r*a))}function a0(e){return e.reduce((function(e,t){return e.add(t)}),new u0(0,0)).div(new u0(e.length,e.length))}function i0(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function o0(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||0===e}function s0(e){return o0(e)&&e>=0&&e<=1}var u0=function(){function e(t,n){xe(this,e),this._x=t,this._y=n}return we(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"div",value:function(t){return new e(this.x/t.x,this.y/t.y)}},{key:"abs",value:function(){return new e(Math.abs(this.x),Math.abs(this.y))}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}]),e}(),c0=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];xe(this,e);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(o0),i=[r.x,r.y,r.width,r.height].every(o0);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have ".concat(JSON.stringify(r)));var o=C(i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],4),s=o[0],u=o[1],c=o[2],l=o[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return we(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"area",get:function(){return this.width*this.height}},{key:"topLeft",get:function(){return new u0(this.left,this.top)}},{key:"topRight",get:function(){return new u0(this.right,this.top)}},{key:"bottomLeft",get:function(){return new u0(this.left,this.bottom)}},{key:"bottomRight",get:function(){return new u0(this.right,this.bottom)}},{key:"round",value:function(){var t=C([this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)})),4);return new e({x:t[0],y:t[1],width:t[2],height:t[3]})}},{key:"floor",value:function(){var t=C([this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)})),4);return new e({x:t[0],y:t[1],width:t[2],height:t[3]})}},{key:"toSquare",value:function(){var t=this.x,n=this.y,r=this.width,a=this.height,i=Math.abs(r-a);return r<a&&(t-=i/2,r+=i),a<r&&(n-=i/2,a+=i),new e({x:t,y:n,width:r,height:a})}},{key:"rescale",value:function(t){var n=n0(t)?t.width:t,r=n0(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}},{key:"pad",value:function(t,n){return new e({x:this.x-t/2,y:this.y-n/2,width:this.width+t,height:this.height+n})}},{key:"clipAtImageBorders",value:function(t,n){var r=this.x,a=this.y,i=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(a,0),c=i-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()}},{key:"shift",value:function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})}},{key:"padAtBorders",value:function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}}},{key:"calibrate",value:function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}}],[{key:"isRect",value:function(e){return!!e&&[e.x,e.y,e.width,e.height].every(o0)}},{key:"assertIsValidBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.isRect(t))throw new Error("".concat(n," - invalid box: ").concat(JSON.stringify(t),", expected object with properties x, y, width, height"));if(!r&&(t.width<0||t.height<0))throw new Error("".concat(n," - width (").concat(t.width,") and height (").concat(t.height,") must be positive numbers"))}}]),e}(),l0=function(e){ye(n,e);var t=be(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return xe(this,n),t.call(this,{left:e,top:r,right:a,bottom:i},o)}return we(n)}(c0),p0=function(){function e(t,n,r,a,i){xe(this,e),this._imageDims=new K$(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new c0(a).rescale(this._imageDims)}return we(e,[{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}},{key:"className",get:function(){return this._className}},{key:"box",get:function(){return this._box}},{key:"imageDims",get:function(){return this._imageDims}},{key:"imageWidth",get:function(){return this.imageDims.width}},{key:"imageHeight",get:function(){return this.imageDims.height}},{key:"relativeBox",get:function(){return new c0(this._box).rescale(this.imageDims.reverse())}},{key:"forSize",value:function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}}]),e}(),h0=function(e){ye(n,e);var t=be(n);function n(e,r,a){return xe(this,n),t.call(this,e,e,"",r,a)}return we(n,[{key:"forSize",value:function(e,t){var r=pe(le(n.prototype),"forSize",this).call(this,e,t);return new n(r.score,r.relativeBox,r.imageDims)}}]),n}(p0);function d0(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function f0(e,t,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],p=e[c];s.push(d0(l,p,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function m0(e,t){return Mu((function(){var n=C(t,3),r=n[0],a=n[1],i=n[2],o=jc([].concat(Ie(e.shape.slice(0,3)),[1]),r,"float32"),s=jc([].concat(Ie(e.shape.slice(0,3)),[1]),a,"float32"),u=jc([].concat(Ie(e.shape.slice(0,3)),[1]),i,"float32"),c=Ec([o,s,u],3);return xp(e,c)}))}function v0(e){return 1/(1+Math.exp(-e))}var g0,y0=function(e){ye(n,e);var t=be(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return xe(this,n),t.call(this,{x:e,y:r,width:a,height:i},o)}return we(n)}(c0),b0=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new u0(0,0);xe(this,e);var a=n.width,i=n.height;this._imgDims=new K$(a,i),this._shift=r,this._positions=t.map((function(e){return e.mul(new u0(a,i)).add(r)}))}return we(e,[{key:"shift",get:function(){return new u0(this._shift.x,this._shift.y)}},{key:"imageWidth",get:function(){return this._imgDims.width}},{key:"imageHeight",get:function(){return this._imgDims.height}},{key:"positions",get:function(){return this._positions}},{key:"relativePositions",get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new u0(e.imageWidth,e.imageHeight))}))}},{key:"forSize",value:function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}},{key:"shiftBy",value:function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new u0(e,t))}},{key:"shiftByPoint",value:function(e){return this.shiftBy(e.x,e.y)}},{key:"align",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=e instanceof h0?e.box.floor():new c0(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=ue({useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)}},{key:"alignDlib",value:function(){var e=this.getRefPointsForAlignment(),t=C(e,3),n=t[0],r=t[1],a=t[2],i=function(e){return a.sub(e).magnitude()},o=(i(n)+i(r))/2,s=Math.floor(o/.45),u=a0(e),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new y0(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))}},{key:"alignMinBbox",value:function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new l0(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)}},{key:"getRefPointsForAlignment",value:function(){throw new Error("getRefPointsForAlignment not implemented by base class")}}]),e}(),x0=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"getJawOutline",value:function(){return this.positions.slice(0,17)}},{key:"getLeftEyeBrow",value:function(){return this.positions.slice(17,22)}},{key:"getRightEyeBrow",value:function(){return this.positions.slice(22,27)}},{key:"getNose",value:function(){return this.positions.slice(27,36)}},{key:"getLeftEye",value:function(){return this.positions.slice(36,42)}},{key:"getRightEye",value:function(){return this.positions.slice(42,48)}},{key:"getMouth",value:function(){return this.positions.slice(48,68)}},{key:"getRefPointsForAlignment",value:function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(a0)}}]),n}(b0);function k0(e){return e.detection instanceof h0}function w0(e,t){return ue(ue({},e),{detection:t})}function I0(){var e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},createVideoElement:function(){return document.createElement("video")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function S0(){return"object"==typeof n.g&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function N0(e){var t="";if(!e&&S0())try{e=Ce("fs")}catch(MAe){t=MAe.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: ".concat(t))}}}function T0(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.Video||n.g.HTMLVideoElement,a=n.g.fetch,i=N0();return ue({Canvas:e||function(){return we((function e(){xe(this,e)}))}(),CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){return we((function e(){xe(this,e)}))}(),Image:t||function(){return we((function e(){xe(this,e)}))}(),ImageData:n.g.ImageData||function(){return we((function e(){xe(this,e)}))}(),Video:n.g.HTMLVideoElement||function(){return we((function e(){xe(this,e)}))}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},createVideoElement:function(){if(r)return new r;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},fetch:a},i)}function C0(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function E0(e){g0=e}function _0(){return C0()?E0(I0()):S0()?E0(T0()):null}var A0={getEnv:function(){if(!g0)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return g0},setEnv:E0,initialize:_0,createBrowserEnv:I0,createFileSystem:N0,createNodejsEnv:T0,monkeyPatch:function(e){if(g0||_0(),!g0)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?g0.Canvas:t,r=e.Image,a=void 0===r?g0.Image:r;g0.Canvas=n,g0.Image=a,g0.createCanvasElement=e.createCanvasElement||function(){return new n},g0.createImageElement=e.createImageElement||function(){return new a},g0.ImageData=e.ImageData||g0.ImageData,g0.Video=e.Video||g0.Video,g0.fetch=e.fetch||g0.fetch,g0.readFile=e.readFile||g0.readFile},isBrowser:C0,isNodejs:S0};function R0(e){return A0.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function F0(e){var t=A0.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=R0(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}_0();var D0,M0=((D0=M0||{}).TOP_LEFT="TOP_LEFT",D0.TOP_RIGHT="TOP_RIGHT",D0.BOTTOM_LEFT="BOTTOM_LEFT",D0.BOTTOM_RIGHT="BOTTOM_RIGHT",D0),O0=we((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(this,e);var n=t.anchorPosition,r=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,s=t.padding;this.anchorPosition=n||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4})),L0=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};xe(this,e),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new O0(r)}return we(e,[{key:"measureWidth",value:function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t}},{key:"measureHeight",value:function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n}},{key:"getUpperLeft",value:function(e,t){var n=this.options.anchorPosition,r="BOTTOM_RIGHT"===n||"TOP_RIGHT"===n,a="BOTTOM_LEFT"===n||"BOTTOM_RIGHT"===n,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=a?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}}},{key:"draw",value:function(e){var t=R0(e),n=F0(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font="".concat(o,"px ").concat(s);var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var p=this.getUpperLeft(n,t);n.fillRect(p.x,p.y,c,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=u+p.x,a=u+p.y+(t+1)*o;n.fillText(e,r,a)}))}}]),e}(),z0=we((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(this,e);var n=t.boxColor,r=t.lineWidth,a=t.label,i=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=a;var o={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new O0(ue(ue({},o),i))})),P0=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xe(this,e),this.box=new c0(t),this.options=new z0(n)}return we(e,[{key:"draw",value:function(e){var t=F0(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new L0([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}]),e}();function B0(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof h0?t.score:k0(t)?t.detection.score:void 0,r=t instanceof h0?t.box:k0(t)?t.detection.box:new c0(t),a=n?"".concat(t0(n)):void 0;new P0(r,{label:a}).draw(e)}))}function W0(e){var t=A0.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function V0(e){return new Promise((function(t,n){function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),n(e))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),t(e))}(e instanceof A0.getEnv().Canvas||W0(e))&&t(null),e.addEventListener("load",a),e.addEventListener("error",r)}))}function U0(e){var t=A0.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new K$(e.naturalWidth,e.naturalHeight):e instanceof r?new K$(e.videoWidth,e.videoHeight):new K$(e.width,e.height)}function G0(e){var t=e.width,n=e.height,r=(0,A0.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function H0(e,t){var n=A0.getEnv().ImageData;if(!(e instanceof n)&&!W0(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||U0(e),a=r.width,i=r.height,o=G0({width:a,height:i});return e instanceof n?F0(o).putImageData(e,0,0):F0(o).drawImage(e,0,0,a,i),o}function j0(e,t){return q0.apply(this,arguments)}function q0(){return q0=S(w().mark((function e(t,n){var r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||A0.getEnv().createCanvasElement(),a=t.shape.slice(Z$(t)?1:0),i=C(a,3),o=i[0],s=i[1],u=i[2],c=Mu((function(){return t.as3D(o,s,u).toInt()})),e.next=3,Qm.toPixels(c,r);case 3:return c.dispose(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),q0.apply(this,arguments)}function K0(e){var t=A0.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}var X0=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(xe(this,e),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ".concat(t));this._treatAsBatchInput=r,this._batchSize=t.length,t.forEach((function(e,t){if(Q$(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(Z$(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize ".concat(r," passed, but not supported in input array"));return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof A0.getEnv().Canvas?e:H0(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return we(e,[{key:"imageTensors",get:function(){return this._imageTensors}},{key:"canvases",get:function(){return this._canvases}},{key:"isBatchInput",get:function(){return this.batchSize>1||this._treatAsBatchInput}},{key:"batchSize",get:function(){return this._batchSize}},{key:"inputDimensions",get:function(){return this._inputDimensions}},{key:"inputSize",get:function(){return this._inputSize}},{key:"reshapedInputDimensions",get:function(){var e=this;return i0(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))}},{key:"getInput",value:function(e){return this.canvases[e]||this.imageTensors[e]}},{key:"getInputDimensions",value:function(e){return this._inputDimensions[e]}},{key:"getInputHeight",value:function(e){return this._inputDimensions[e][0]}},{key:"getInputWidth",value:function(e){return this._inputDimensions[e][1]}},{key:"getReshapedInputDimensions",value:function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return r0({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)}},{key:"toBatchTensor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._inputSize=e,Mu((function(){var r=i0(t.batchSize,0,1).map((function(r){var a=t.getInput(r);if(a instanceof No){var i=Z$(a)?a:jl(a);return i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Mu((function(){var n=C(e.shape.slice(1),2),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),o=Math.round(i*(t?.5:1)),s=r>a?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,jc(n,0,"float32")},c=u(o),l=i-c.shape[s],p=[t&&l?u(l):null,e,c].filter((function(e){return!!e})).map((function(e){return Iu(e,"float32")}));return Ec(p,s)}))}(i,n),(i.shape[1]!==e||i.shape[2]!==e)&&(i=im.resizeBilinear(i,[e,e],!1,!1)),i.as3D(e,e,3)}if(a instanceof A0.getEnv().Canvas)return Qm.fromPixels(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=A0.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return G0({width:1,height:1});var o=U0(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=G0({width:t,height:t}),p=e instanceof i?e:H0(e),h=Math.abs(u-c)/2,d=n&&u<c?h:0,f=n&&c<u?h:0;return p.width>0&&p.height>0&&F0(l).drawImage(p,d,f,u,c),l}(a,e,n));throw new Error("toBatchTensor - at batchIdx ".concat(r,", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ").concat(a))}));return cd(r.map((function(e){return Iu(e,"float32")}))).as4D(t.batchSize,e,e,3)}))}}]),e}();function Y0(e){return J0.apply(this,arguments)}function J0(){return J0=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof X0)){e.next=2;break}return e.abrupt("return",t);case 2:if((n=Array.isArray(t)?t:[t]).length){e.next=5;break}throw new Error("toNetInput - empty array passed as input");case 5:return r=function(e){return Array.isArray(t)?" at input index ".concat(e,":"):""},(a=n.map(R0)).forEach((function(e,t){if(!K0(e)&&!Q$(e)&&!Z$(e))throw"string"==typeof n[t]?new Error("toNetInput -".concat(r(t)," string passed, but could not resolve HTMLElement for element id ").concat(n[t])):new Error("toNetInput -".concat(r(t)," expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id"));if(Z$(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -".concat(r(t)," tf.Tensor4D with batchSize ").concat(a," passed, but not supported in input array"))}})),e.next=9,Promise.all(a.map((function(e){return K0(e)&&V0(e)})));case 9:return e.abrupt("return",new X0(a,Array.isArray(t)));case 10:case"end":return e.stop()}}),e)}))),J0.apply(this,arguments)}function Q0(e,t){return Z0.apply(this,arguments)}function Z0(){return Z0=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=A0.getEnv(),a=r.Canvas,i=t,t instanceof a){e.next=16;break}return e.next=4,Y0(t);case 4:if(!((o=e.sent).batchSize>1)){e.next=7;break}throw new Error("extractFaces - batchSize > 1 not supported");case 7:if(!((s=o.getInput(0))instanceof a)){e.next=12;break}e.t0=s,e.next=15;break;case 12:return e.next=14,j0(s);case 14:e.t0=e.sent;case 15:i=e.t0;case 16:return u=F0(i),e.abrupt("return",n.map((function(e){return e instanceof h0?e.forSize(i.width,i.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(i.width,i.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=G0({width:r,height:a});return r>0&&a>0&&F0(i).putImageData(u.getImageData(t,n,r,a),0,0),i})));case 18:case"end":return e.stop()}}),e)}))),Z0.apply(this,arguments)}function $0(e,t){return e1.apply(this,arguments)}function e1(){return e1=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q$(t)||Z$(t)){e.next=2;break}throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");case 2:if(!(Z$(t)&&t.shape[0]>1)){e.next=4;break}throw new Error("extractFaceTensors - batchSize > 1 not supported");case 4:return e.abrupt("return",Mu((function(){var e=C(t.shape.slice(Z$(t)?1:0),3),r=e[0],a=e[1],i=e[2];return n.map((function(e){return e instanceof h0?e.forSize(a,r).box:e})).map((function(e){return e.clipAtImageBorders(a,r)})).filter((function(e){return e.width>0&&e.height>0})).map((function(e){var n=e.x,o=e.y,s=e.width,u=e.height;return $h(t.as3D(r,a,i),[o,n,0],[u,s,i])}))})));case 5:case"end":return e.stop()}}),e)}))),e1.apply(this,arguments)}function t1(e,t){return n1.apply(this,arguments)}function n1(){return n1=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=A0.getEnv(),a=r.fetch,e.next=4,a(t,n);case 4:if((i=e.sent).status<400){e.next=7;break}throw new Error("failed to fetch: (".concat(i.status,") ").concat(i.statusText,", from url: ").concat(i.url));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)}))),n1.apply(this,arguments)}function r1(e){return a1.apply(this,arguments)}function a1(){return a1=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t1(t);case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)}))),a1.apply(this,arguments)}function i1(e,t){var n="".concat(t,"-weights_manifest.json");if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/".concat(n)};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/".concat(o):o,manifestUri:"/"===o?"/".concat(i):"".concat(o,"/").concat(i)}}function o1(e,t){return s1.apply(this,arguments)}function s1(){return s1=S(w().mark((function e(t,n){var r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i1(t,n),a=r.manifestUri,i=r.modelBaseUri,e.next=5,r1(a);case 5:return o=e.sent,e.abrupt("return",Im.loadWeights(o,i));case 7:case"end":return e.stop()}}),e)}))),s1.apply(this,arguments)}var u1=function(){function e(t){xe(this,e),this._params=void 0,this._paramMappings=[],this._name=t}return we(e,[{key:"params",get:function(){return this._params}},{key:"paramMappings",get:function(){return this._paramMappings}},{key:"isLoaded",get:function(){return!!this.params}},{key:"getParamFromPath",value:function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]}},{key:"reassignParamFromPath",value:function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t}},{key:"getParamList",value:function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))}},{key:"getTrainableParams",value:function(){return this.getParamList().filter((function(e){return e.tensor instanceof Co}))}},{key:"getFrozenParams",value:function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Co)}))}},{key:"variable",value:function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))}},{key:"freeze",value:function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=ps(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path ".concat(t.path));t.tensor.dispose()})),this._params=void 0}},{key:"serializeParams",value:function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))}},{key:"load",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Float32Array)){e.next=3;break}return this.extractWeights(t),e.abrupt("return");case 3:return e.next=5,this.loadFromUri(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromUri",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromUri - expected model uri"));case 2:return e.next=4,o1(t,this.getDefaultModelName());case 4:n=e.sent,this.loadFromWeightMap(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromDisk",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromDisk - expected model file path"));case 2:return n=A0.getEnv(),r=n.readFile,a=i1(t,this.getDefaultModelName()),i=a.manifestUri,o=a.modelBaseUri,s=function(e){return Promise.all(e.map((function(e){return r(e).then((function(e){return e.buffer}))})))},u=Im.weightsLoaderFactory(s),e.t0=JSON,e.next=12,r(i);case 12:return e.t1=e.sent.toString(),c=e.t0.parse.call(e.t0,e.t1),e.next=16,u(c,o);case 16:l=e.sent,this.loadFromWeightMap(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromWeightMap",value:function(e){var t=this.extractParamsFromWeightMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"extractWeights",value:function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"traversePropertyPath",value:function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property ".concat(n,", for path ").concat(e));return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof No))throw new Error("traversePropertyPath - parameter is not a tensor, for path ".concat(e));return{obj:n,objProp:r}}}]),e}();function c1(e,t,n){return Mu((function(){var r=jh(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Ku(r,t.bias)}))}function l1(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Mu((function(){var r=Oh(n?Ku(Qc(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):c1(e,t.conv0,[2,2])),a=c1(r,t.conv1,[1,1]),i=c1(Oh(Ku(r,a)),t.conv2,[1,1]);return Oh(Ku(r,Ku(a,i)))}))}function p1(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Mu((function(){var a=Oh(n?Ku(Qc(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):c1(e,t.conv0,r?[2,2]:[1,1])),i=c1(a,t.conv1,[1,1]),o=c1(Oh(Ku(a,i)),t.conv2,[1,1]),s=c1(Oh(Ku(a,Ku(i,o))),t.conv3,[1,1]);return Oh(Ku(a,Ku(i,Ku(o,s))))}))}function h1(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"same",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Mu((function(){var a=Ku(Qc(e,t.filters,[1,1],n),t.bias);return r?Oh(a):a}))}function d1(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function f1(e,t){return function(n,r,a,i){var o=vd(e(n*r*a*a),[a,a,n,r]),s=dd(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}}function m1(e,t){return function(n,r,a){var i=fd(e(n*r),[n,r]),o=dd(e(r));return t.push({paramPath:"".concat(a,"/weights")},{paramPath:"".concat(a,"/bias")}),{weights:i,bias:o}}}var v1=we((function e(t,n,r){xe(this,e),this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}));function g1(e,t){return function(n,r,a){var i=vd(e(9*n),[3,3,n,1]),o=vd(e(n*r),[1,1,n,r]),s=dd(e(r));return t.push({paramPath:"".concat(a,"/depthwise_filter")},{paramPath:"".concat(a,"/pointwise_filter")},{paramPath:"".concat(a,"/bias")}),new v1(i,o,s)}}function y1(e){return function(t){var n=e("".concat(t,"/depthwise_filter"),4),r=e("".concat(t,"/pointwise_filter"),4),a=e("".concat(t,"/bias"),1);return new v1(n,r,a)}}function b1(e,t){return function(n,r,a){var i=e[n];if(!X$(i,r))throw new Error("expected weightMap[".concat(n,"] to be a Tensor").concat(r,"D, instead have ").concat(i));return t.push({originalPath:n,paramPath:a||n}),i}}function x1(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function k1(e,t){var n=f1(e,t),r=g1(e,t);function a(e,t,a){return{conv0:arguments.length>3&&void 0!==arguments[3]&&arguments[3]?n(e,t,3,"".concat(a,"/conv0")):r(e,t,"".concat(a,"/conv0")),conv1:r(t,t,"".concat(a,"/conv1")),conv2:r(t,t,"".concat(a,"/conv2"))}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n){var i=a(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3]);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,"".concat(n,"/conv3"))}}}}function w1(e){return function(t){return{filters:e("".concat(t,"/filters"),4),bias:e("".concat(t,"/bias"),1)}}}function I1(e,t){var n=b1(e,t),r=w1(n),a=y1(n);return{extractDenseBlock3Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2"))}},extractDenseBlock4Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2")),conv3:a("".concat(e,"/conv3"))}}}}var S1=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,"FaceFeatureExtractor")}return we(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Mu((function(){var n=p1(m0(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=p1(n,t.dense1),n=p1(n,t.dense2),n=p1(n,t.dense3),n=Tc(n,[7,7],[2,2],"valid")}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=I1(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return d1(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=x1(e),r=n.extractWeights,a=n.getRemainingWeights,i=k1(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)}}]),n}(u1);function N1(e,t){return Mu((function(){return Ku(_c(e,t.weights),t.bias)}))}function T1(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var C1=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this,e))._faceFeatureExtractor=r,a}return we(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return Mu((function(){var r=e instanceof X0?t.faceFeatureExtractor.forwardInput(e):e;return N1(r.as2D(r.shape[0],-1),n.fc)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),pe(le(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e,t,n){var r=[],a=x1(e),i=a.extractWeights,o=a.getRemainingWeights,s=m1(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: ".concat(o().length));return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}},{key:"extractParamsFromWeightMap",value:function(e){var t=T1(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=b1(e,n),a={fc:(t="fc",{weights:r("".concat(t,"/weights"),2),bias:r("".concat(t,"/bias"),1)})};return d1(e,n),{params:a,paramMappings:n}}(r)}},{key:"extractParams",value:function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)}}]),n}(u1),E1=["neutral","happy","sad","angry","fearful","disgusted","surprised"],_1=function(){function e(t){var n=this;if(xe(this,e),this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: ".concat(t.length));E1.forEach((function(e,r){n[e]=t[r]}))}return we(e,[{key:"asSortedArray",value:function(){var e=this;return E1.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))}}]),e}(),A1=function(e){ye(n,e);var t=be(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S1;return xe(this,n),t.call(this,"FaceExpressionNet",e)}return we(n,[{key:"forwardInput",value:function(e){var t=this;return Mu((function(){return td(t.runNet(e))}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictExpressions",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y0(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,e.next=8,Promise.all(Ed(r).map(function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataSync(),e.abrupt("return",(t.dispose(),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return a=e.sent,r.dispose(),i=a.map((function(e){return new _1(e)})),e.abrupt("return",n.isBatchInput?i:i[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_expression_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}},{key:"getClassifierChannelsOut",value:function(){return 7}}]),n}(C1);function R1(e,t){return ue(ue({},e),{expressions:t})}function F1(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3?arguments[3]:void 0;(Array.isArray(t)?t:[t]).forEach((function(t){var a=t instanceof _1?t:function(e){return e.expressions instanceof _1}(t)?t.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=a.asSortedArray().filter((function(e){return e.probability>n})),o=k0(t)?t.detection.box.bottomLeft:r||new u0(0,0);new L0(i.map((function(e){return"".concat(e.expression," (").concat(t0(e.probability),")")})),o).draw(e)}))}function D1(e){return k0(e)&&e.landmarks instanceof b0&&e.unshiftedLandmarks instanceof b0&&e.alignedRect instanceof h0}function M1(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o=new h0(e.detection.score,a.rescale(i.reverse()),i),s=function(e){var t=function(e){return 180*e/Math.PI},n=function(e,t){return Math.sqrt(Math.pow(e._x-t._x,2)+Math.pow(e._y-t._y,2))},r={roll:void 0,pitch:void 0,yaw:void 0};if(!e||!e._positions||68!==e._positions.length)return r;var a=e._positions;return r.roll=function(e,n){var r=Math.hypot(n._x-e._x,n._y-e._y),a=n._y-e._y,i=Math.asin(a/r),o=t(i);return Math.floor(90-o)*(n._x-e._x<0?-1:1)}(a[27],a[66]),r.pitch=function(e,r,a){var i=n(e,a),o={_x:(e._x+a._x)/2,_y:(e._y+a._y)/2},s=n(r,o),u=Math.atan(s/i);return Math.floor(t(u))*(o._y-r._y<0?-1:1)}(a[14],a[30],a[2]),r.yaw=function(e,t,n){return Math.floor(e._x-t._x)-Math.floor(t._x-n._x)}(a[14],a[33],a[2]),r}(t);return ue(ue({},e),{landmarks:r,unshiftedLandmarks:t,alignedRect:o,angle:s})}var O1=we((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(this,e);var n=t.drawLines,r=void 0===n||n,a=t.drawPoints,i=void 0===a||a,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"})),L1=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xe(this,e),this.faceLandmarks=t,this.options=new O1(n)}return we(e,[{key:"draw",value:function(e){var t=F0(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof x0&&(t.strokeStyle=o,t.lineWidth=i,q$(t,this.faceLandmarks.getJawOutline()),q$(t,this.faceLandmarks.getLeftEyeBrow()),q$(t,this.faceLandmarks.getRightEyeBrow()),q$(t,this.faceLandmarks.getNose()),q$(t,this.faceLandmarks.getLeftEye(),!0),q$(t,this.faceLandmarks.getRightEye(),!0),q$(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}]),e}();function z1(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof b0?t:D1(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new L1(n).draw(e)}))}function P1(e,t){var n=[],r=x1(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=f1(e,t),r=g1(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,"".concat(a,"/separable_conv0")),separable_conv1:r(t,t,"".concat(a,"/separable_conv1")),expansion_conv:n(e,t,1,"".concat(a,"/expansion_conv"))}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,"".concat(t,"/separable_conv0")),separable_conv1:r(e,e,"".concat(t,"/separable_conv1")),separable_conv2:r(e,e,"".concat(t,"/separable_conv2"))}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,p={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},h={};i0(t,0,1).forEach((function(e){h["main_block_".concat(e)]=l(128,"middle_flow/main_block_".concat(e))}));var d={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: ".concat(i().length));return{paramMappings:n,params:{entry_flow:p,middle_flow:h,exit_flow:d}}}function B1(e,t){var n=[],r=function(e,t){var n=b1(e,t),r=w1(n),a=y1(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),expansion_conv:r("".concat(e,"/expansion_conv"))}},extractMainBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),separable_conv2:a("".concat(e,"/separable_conv2"))}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};i0(t,0,1).forEach((function(e){c["main_block_".concat(e)]=s("middle_flow/main_block_".concat(e))}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return d1(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function W1(e,t,n){return Ku(Qc(e,t.filters,n,"same"),t.bias)}function V1(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?Oh(e):e;return n=c1(n,t.separable_conv0,[1,1]),n=c1(Oh(n),t.separable_conv1,[1,1]),n=Ap(n,[3,3],[2,2],"same"),n=Ku(n,W1(e,t.expansion_conv,[2,2]))}var U1=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,"TinyXception"))._numMainBlocks=e,r}return we(n,[{key:"forwardInput",value:function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Mu((function(){var r=m0(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),a=Oh(W1(r,n.entry_flow.conv_in,[2,2]));return a=V1(a,n.entry_flow.reduction_block_0,!1),a=V1(a,n.entry_flow.reduction_block_1),i0(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=c1(Oh(e),t.separable_conv0,[1,1]);return n=c1(Oh(n),t.separable_conv1,[1,1]),n=c1(Oh(n),t.separable_conv2,[1,1]),Ku(n,e)}(a,n.middle_flow["main_block_".concat(e)])})),a=V1(a,n.exit_flow.reduction_block),a=Oh(c1(a,n.exit_flow.separable_conv,[1,1]))}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_xception_model"}},{key:"extractParamsFromWeightMap",value:function(e){return B1(e,this._numMainBlocks)}},{key:"extractParams",value:function(e){return P1(e,this._numMainBlocks)}}]),n}(u1);var G1,H1=((G1=H1||{}).FEMALE="female",G1.MALE="male",G1),j1=function(e){ye(n,e);var t=be(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new U1(2);return xe(this,n),(e=t.call(this,"AgeGenderNet"))._faceFeatureExtractor=r,e}return we(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return Mu((function(){var r=e instanceof X0?t.faceFeatureExtractor.forwardInput(e):e,a=Tc(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:N1(a,n.fc.age).as1D(),gender:N1(a,n.fc.gender)}}))}},{key:"forwardInput",value:function(e){var t=this;return Mu((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:td(a)}}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictAgeAndGender",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y0(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,a=Ed(r.age),i=Ed(r.gender),o=a.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),e.next=11,Promise.all(o.map(function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ageTensor,r=t.genderTensor,a=n.dataSync()[0],i=r.dataSync()[0],s=(o=i>.5)?"male":"female",u=o?i:1-i,e.abrupt("return",(n.dispose(),r.dispose(),{age:a,gender:s,genderProbability:u}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=e.sent,e.abrupt("return",(r.age.dispose(),r.gender.dispose(),n.isBatchInput?s:s[0]));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"age_gender_model"}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),pe(le(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e){var t=[],n=x1(e),r=n.extractWeights,a=n.getRemainingWeights,i=m1(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)}},{key:"extractParamsFromWeightMap",value:function(e){var t=T1(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=b1(e,t);function r(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return d1(e,t),{params:a,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}}]),n}(u1),q1=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"postProcess",value:function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return Mu((function(){var n=function(e,t){return cd([jc([68],e,"float32"),jc([68],t,"float32")],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(jc([a,136],t,"float32")).sub(cd(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(cd(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))}},{key:"forwardInput",value:function(e){var t=this;return Mu((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){var t=C(e,2);return{height:t[0],width:t[1]}})))}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectLandmarks",value:function(){var e=S(w().mark((function e(t){var n,r,a,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y0(t);case 2:return n=e.sent,r=Mu((function(){return Ed(i.forwardInput(n))})),e.next=6,Promise.all(r.map(function(){var e=S(w().mark((function e(t,r){var a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.from(t.dataSync()),i=a.filter((function(e,t){return e0(t)})),o=a.filter((function(e,t){return!e0(t)})),e.abrupt("return",new x0(Array(68).fill(0).map((function(e,t){return new u0(i[t],o[t])})),{height:n.getInputHeight(r),width:n.getInputWidth(r)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e.dispose()})),n.isBatchInput?a:a[0]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClassifierChannelsOut",value:function(){return 136}}]),n}(C1),K1=function(e){ye(n,e);var t=be(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new S1;return xe(this,n),t.call(this,"FaceLandmark68Net",e)}return we(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}}]),n}(q1);var X1=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,"TinyFaceFeatureExtractor")}return we(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Mu((function(){var n=l1(m0(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=l1(n,t.dense1),n=l1(n,t.dense2),n=Tc(n,[14,14],[2,2],"valid")}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_tiny_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=I1(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return d1(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=x1(e),r=n.extractWeights,a=n.getRemainingWeights,i=k1(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)}}]),n}(u1),Y1=function(e){ye(n,e);var t=be(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new X1;return xe(this,n),t.call(this,"FaceLandmark68TinyNet",e)}return we(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_tiny_model"}},{key:"getClassifierChannelsIn",value:function(){return 128}}]),n}(q1);function J1(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"same",i=t.conv,o=i.filters,s=i.bias,u=Qc(e,o,n,a);return u=function(e,t){return Ku(Ju(e,t.weights),t.biases)}(u=Ku(u,s),t.scale),r?Oh(u):u}function Q1(e,t){return J1(e,t,[1,1],!1)}function Z1(e,t){return J1(e,t,[2,2],!0,"valid")}function $1(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if($$(i))throw new Error("depth has to be an integer: ".concat(i,", weights.length: ").concat(a.length,", numFilters: ").concat(n,", filterSize: ").concat(r));return Mu((function(){return Ld(vd(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=dd(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,"".concat(o,"/conv")),u=function(n,r){var a=dd(e(n)),i=dd(e(n));return t.push({paramPath:"".concat(r,"/weights")},{paramPath:"".concat(r,"/biases")}),{weights:a,biases:i}}(a,"".concat(o,"/scale"));return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a){return{conv1:r((arguments.length>4&&void 0!==arguments[4]&&arguments[4]?.5:1)*e,t,n,"".concat(a,"/conv1")),conv2:r(e,t,n,"".concat(a,"/conv2"))}}}}function e2(e,t){var n=b1(e,t);function r(e){var t=n("".concat(e,"/conv/filters"),4),r=n("".concat(e,"/conv/bias"),1),a=function(e){return{weights:n("".concat(e,"/scale/weights"),1),biases:n("".concat(e,"/scale/biases"),1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r("".concat(e,"/conv1")),conv2:r("".concat(e,"/conv2"))}}}}function t2(e,t){var n=function(e,t){return J1(e,t,[1,1],!0)}(e,t.conv1);return n=Q1(n,t.conv2),n=Ku(n,e),n=Oh(n)}function n2(e,t){var n=Z1(e,t.conv1);n=Q1(n,t.conv2);var r=Tc(e,2,2,"valid"),a=Op(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Ie(n.shape);o[1]=1;var s=Op(o),u=Ie((n=Ec([n,s],1)).shape);u[2]=1;var c=Op(u);n=Ec([n,c],2)}return r=i?Ec([r,a],3):r,n=Ku(r,n),n=Oh(n)}var r2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,"FaceRecognitionNet")}return we(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Mu((function(){var n=Z1(m0(Iu(e.toBatchTensor(150,!0),"float32"),[122.782,117.001,104.298]).div(255),t.conv32_down);n=t2(n=Ap(n,3,2,"valid"),t.conv32_1),n=t2(n,t.conv32_2),n=t2(n,t.conv32_3),n=t2(n=n2(n,t.conv64_down),t.conv64_1),n=t2(n,t.conv64_2),n=t2(n,t.conv64_3),n=t2(n=n2(n,t.conv128_down),t.conv128_1),n=t2(n,t.conv128_2),n=t2(n=n2(n,t.conv256_down),t.conv256_1);var r=(n=n2(n=t2(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return _c(r,t.fc)}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeFaceDescriptor",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=null==t?void 0:t.shape)||!n.some((function(e){return e<=0}))){e.next=2;break}return e.abrupt("return",new Float32Array(128));case 2:return e.next=4,Y0(t);case 4:return r=e.sent,a=Mu((function(){return Ed(o.forwardInput(r))})),e.next=8,Promise.all(a.map((function(e){return e.data()})));case 8:return i=e.sent,e.abrupt("return",(a.forEach((function(e){return e.dispose()})),r.isBatchInput?i:i[0]));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_recognition_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=e2(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),p=a("conv64_2"),h=a("conv64_3"),d=a("conv128_down"),f=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),g=a("conv256_1"),y=a("conv256_2"),b=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!J$(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have ".concat(x));var k={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:p,conv64_3:h,conv128_down:d,conv128_1:f,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return d1(e,t),{params:k,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=x1(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=$1(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),f=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),I=Mu((function(){return Ld(fd(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: ".concat(r().length));return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:p,conv64_down:h,conv64_1:d,conv64_2:f,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:k,conv256_down_out:w,fc:I},paramMappings:a}}(e)}}]),n}(u1);function a2(e,t){return ue(ue({},e),{descriptor:t})}function i2(e,t){return ue(ue({},e),{age:t})}function o2(e,t,n){return ue(ue({},e),{gender:t,genderProbability:n})}function s2(e,t){function n(n,r,a,i,o){var s=vd(e(n*r*a*a),[a,a,n,r]),u=dd(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/").concat(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=vd(e(9*n),[3,3,n,1]),i=dd(e(n)),o=dd(e(n)),s=dd(e(n)),u=dd(e(n));return t.push({paramPath:"".concat(r,"/filters")},{paramPath:"".concat(r,"/batch_norm_scale")},{paramPath:"".concat(r,"/batch_norm_offset")},{paramPath:"".concat(r,"/batch_norm_mean")},{paramPath:"".concat(r,"/batch_norm_variance")}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,"".concat(i,"/depthwise_conv"));return{depthwise_conv:o,pointwise_conv:r(n,a,1,"".concat(i,"/pointwise_conv"))}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function u2(e){var t=[],n=function(e,t){var n=b1(e,t);function r(e,t,r){return{filters:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/weights"),4,"".concat(r,"/filters")),batch_norm_offset:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/convolution_bn_offset"),1,"".concat(r,"/batch_norm_offset"))}}function a(e){var t="mobilenetv1/conv_".concat(e),a="MobilenetV1/Conv2d_".concat(e,"_depthwise"),i="".concat(t,"/depthwise_conv"),o="".concat(t,"/pointwise_conv");return{depthwise_conv:{filters:n("".concat(a,"/depthwise_weights"),4,"".concat(i,"/filters")),batch_norm_scale:n("".concat(a,"/BatchNorm/gamma"),1,"".concat(i,"/batch_norm_scale")),batch_norm_offset:n("".concat(a,"/BatchNorm/beta"),1,"".concat(i,"/batch_norm_offset")),batch_norm_mean:n("".concat(a,"/BatchNorm/moving_mean"),1,"".concat(i,"/batch_norm_mean")),batch_norm_variance:n("".concat(a,"/BatchNorm/moving_variance"),1,"".concat(i,"/batch_norm_variance"))},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n("".concat(e,"/weights"),4,"".concat(t,"/filters")),bias:n("".concat(e,"/biases"),1,"".concat(t,"/bias"))}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_".concat(e,"/BoxEncodingPredictor"),"prediction_layer/box_predictor_".concat(e,"/box_encoding_predictor")),class_predictor:i("Prediction/BoxPredictor_".concat(e,"/ClassPredictor"),"prediction_layer/box_predictor_".concat(e,"/class_predictor"))}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Q$(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ".concat(i));var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return d1(e,t),{params:o,paramMappings:t}}function c2(e,t,n){return Mu((function(){var r=Qc(e,t.filters,n,"same");return r=Ku(r,t.batch_norm_offset),qc(r,0,6)}))}var l2=.0010000000474974513;function p2(e,t){return Mu((function(){var n,r=c2(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=function(e,t,n){return Mu((function(){var r=ll(e,t.filters,n,"same");return r=Lc(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,l2),qc(r,0,6)}))}(r,e.depthwise_conv,i),r=c2(r,e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function h2(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),h=(o-a)*(s-i),d=(l-u)*(p-c);if(h<=0||d<=0)return 0;var f=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),g=Math.min(s,p),y=Math.max(v-f,0)*Math.max(g-m,0);return y/(h+d-y)}function d2(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=r?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=h2(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}})),c}function f2(e,t){var n=function(e){var t=Ed(Ld(e,[1,0])),n=[xp(t[2],t[0]),xp(t[3],t[1])];return{sizes:n,centers:[Ku(t[0],Yu(n[0],2)),Ku(t[1],Yu(n[1],2))]}}(e),r=n.sizes,a=n.centers,i=Ed(Ld(t,[1,0])),o=Yu(Ju(Hl(Yu(i[2],5)),r[0]),2),s=Ku(Ju(Yu(i[0],10),r[0]),a[0]),u=Yu(Ju(Hl(Yu(i[3],5)),r[1]),2),c=Ku(Ju(Yu(i[1],10),r[1]),a[1]);return Ld(cd([xp(s,o),xp(c,u),Ku(s,o),Ku(c,u)]),[1,0])}function m2(e,t){return Mu((function(){var n=e.shape[0];return{boxPredictionEncoding:Nc(h1(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Nc(h1(e,t.class_predictor),[n,-1,3])}}))}var v2=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minConfidence,r=t.maxResults;if(xe(this,e),this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error("".concat(this._name," - expected minConfidence to be a number between 0 and 1"));if("number"!=typeof this._maxResults)throw new Error("".concat(this._name," - expected maxResults to be a number"))}return we(e,[{key:"minConfidence",get:function(){return this._minConfidence}},{key:"maxResults",get:function(){return this._maxResults}}]),e}(),g2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,"SsdMobilenetv1")}return we(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Mu((function(){var n=Iu(e.toBatchTensor(512,!1),"float32"),r=p2(xp(Yu(n,127.5),1),t.mobilenetv1),a=function(e,t,n){return Mu((function(){var r=c2(e,n.conv_0,[1,1]),a=c2(r,n.conv_1,[2,2]),i=c2(a,n.conv_2,[1,1]),o=c2(i,n.conv_3,[2,2]),s=c2(o,n.conv_4,[1,1]),u=c2(s,n.conv_5,[2,2]),c=c2(u,n.conv_6,[1,1]),l=c2(c,n.conv_7,[2,2]),p=m2(t,n.box_predictor_0),h=m2(e,n.box_predictor_1),d=m2(a,n.box_predictor_2),f=m2(o,n.box_predictor_3),m=m2(u,n.box_predictor_4),v=m2(l,n.box_predictor_5);return{boxPredictions:Ec([p.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Ec([p.classPrediction,h.classPrediction,d.classPrediction,f.classPrediction,m.classPrediction,v.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Mu((function(){var r=e.shape[0],a=f2(Nc(Kl(n.extra_dim,[r,1,1]),[-1,4]),Nc(e,[-1,4]));a=Nc(a,[r,a.shape[0]/r,4]);var i=Ac(Rc(t,[0,0,1],[-1,-1,-1])),o=Rc(i,[0,0,0],[-1,-1,1]);return o=Nc(o,[r,o.shape[1]]),{boxes:Ed(a),scores:Ed(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"locateFaces",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new v2(x.length>1&&void 0!==x[1]?x[1]:{}),r=n.maxResults,a=n.minConfidence,e.next=6,Y0(t);case 6:for(i=e.sent,o=this.forwardInput(i),s=o.boxes,u=o.scores,c=s[0],l=u[0],p=1;p<s.length;p++)s[p].dispose(),u[p].dispose();return h=Array.from(l.dataSync()),d=d2(c,h,r,.5,a),f=i.getReshapedInputDimensions(0),m=i.inputSize,v=m/f.width,g=m/f.height,y=c.arraySync(),b=d.map((function(e){var t=[Math.max(0,y[e][0]),Math.min(1,y[e][2])].map((function(e){return e*g})),n=C(t,2),r=n[0],a=n[1],o=[Math.max(0,y[e][1]),Math.min(1,y[e][3])].map((function(e){return e*v})),s=C(o,2),u=s[0],c=s[1];return new h0(h[e],new y0(u,r,c-u,a-r),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),e.abrupt("return",(c.dispose(),l.dispose(),b));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"ssd_mobilenetv1_model"}},{key:"extractParamsFromWeightMap",value:function(e){return u2(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=x1(e),r=n.extractWeights,a=n.getRemainingWeights,i=s2(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:md(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)}}]),n}(u1);var y2=[new u0(.738768,.874946),new u0(2.42204,2.65704),new u0(4.30971,7.04493),new u0(10.246,4.59428),new u0(12.6868,11.8741)],b2=[new u0(1.603231,2.094468),new u0(6.041143,7.080126),new u0(2.882459,3.518061),new u0(4.266906,5.178857),new u0(9.041765,10.66308)],x2=[117.001,114.697,97.404],k2=function(e){return"number"==typeof e};function w2(e){return Mu((function(){var t=Ju(e,zl(.10000000149011612));return Ku(Oh(xp(e,t)),t)}))}function I2(e,t){return Mu((function(){var n=Xp(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Qc(n,t.conv.filters,[1,1],"valid"),n=xp(n,t.bn.sub),n=Ju(n,t.bn.truediv),w2(n=Ku(n,t.conv.bias))}))}function S2(e,t){return Mu((function(){var n=Xp(e,[[0,0],[1,1],[1,1],[0,0]]);return n=jh(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),w2(n=Ku(n,t.bias))}))}function N2(e,t){var n=f1(e,t);var r=g1(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,"".concat(i,"/conv")),s=function(n,r){var a=dd(e(n)),i=dd(e(n));return t.push({paramPath:"".concat(r,"/sub")},{paramPath:"".concat(r,"/truediv")}),{sub:a,truediv:i}}(a,"".concat(i,"/bn"));return{conv:o,bn:s}},extractSeparableConvParams:r}}function T2(e,t){var n=b1(e,t);function r(e){return{filters:n("".concat(e,"/filters"),4),bias:n("".concat(e,"/bias"),1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r("".concat(e,"/conv")),a=function(e){return{sub:n("".concat(e,"/sub"),1),truediv:n("".concat(e,"/truediv"),1)}}("".concat(e,"/bn"));return{conv:t,bn:a}},extractSeparableConvParams:y1(n)}}var C2=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inputSize,r=t.scoreThreshold;if(xe(this,e),this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!==0)throw new Error("".concat(this._name," - expected inputSize to be a number divisible by 32"));if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error("".concat(this._name," - expected scoreThreshold to be a number between 0 and 1"))}return we(e,[{key:"inputSize",get:function(){return this._inputSize}},{key:"scoreThreshold",get:function(){return this._scoreThreshold}}]),e}(),E2=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,"TinyYolov2"),function(e){if(!e)throw new Error("invalid config: ".concat(e));if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: ".concat(e.withSeparableConvs));if(!k2(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: ".concat(e.iouThreshold));if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: ".concat(JSON.stringify(e.classes)));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return k2(e.x)&&k2(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: ".concat(JSON.stringify(e.anchors)));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(k2)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: ".concat(JSON.stringify(e.meanRgb)))}(e),r._config=e,r}return we(n,[{key:"config",get:function(){return this._config}},{key:"withClassScores",get:function(){return this.config.withClassScores||this.config.classes.length>1}},{key:"boxEncodingSize",get:function(){return 5+(this.withClassScores?this.config.classes.length:0)}},{key:"runTinyYolov2",value:function(e,t){var n=I2(e,t.conv0);return n=I2(n=Ap(n,[2,2],[2,2],"same"),t.conv1),n=I2(n=Ap(n,[2,2],[2,2],"same"),t.conv2),n=I2(n=Ap(n,[2,2],[2,2],"same"),t.conv3),n=I2(n=Ap(n,[2,2],[2,2],"same"),t.conv4),n=I2(n=Ap(n,[2,2],[2,2],"same"),t.conv5),n=I2(n=Ap(n,[2,2],[1,1],"same"),t.conv6),h1(n=I2(n,t.conv7),t.conv8,"valid",!1)}},{key:"runMobilenet",value:function(e,t){var n=this.config.isFirstLayerConv2d?w2(h1(e,t.conv0,"valid",!1)):S2(e,t.conv0);return n=S2(n=Ap(n,[2,2],[2,2],"same"),t.conv1),n=S2(n=Ap(n,[2,2],[2,2],"same"),t.conv2),n=S2(n=Ap(n,[2,2],[2,2],"same"),t.conv3),n=S2(n=Ap(n,[2,2],[2,2],"same"),t.conv4),n=S2(n=Ap(n,[2,2],[2,2],"same"),t.conv5),n=Ap(n,[2,2],[1,1],"same"),n=t.conv6?S2(n,t.conv6):n,h1(n=t.conv7?S2(n,t.conv7):n,t.conv8,"valid",!1)}},{key:"forwardInput",value:function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Mu((function(){var a=Iu(e.toBatchTensor(t,!1),"float32");return a=(a=n.config.meanRgb?m0(a,n.config.meanRgb):a).div(255),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))}},{key:"forward",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,Y0(t);case 3:return e.t1=e.sent,e.t2=n,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f=this,m=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new C2(m.length>1&&void 0!==m[1]?m[1]:{}),r=n.inputSize,a=n.scoreThreshold,e.next=6,Y0(t);case 6:return i=e.sent,e.next=9,this.forwardInput(i,r);case 9:return o=e.sent,s=Mu((function(){return Ed(o)[0].expandDims()})),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},e.next=14,this.extractBoxes(s,i.getReshapedInputDimensions(0),a);case 14:return c=e.sent,o.dispose(),s.dispose(),l=c.map((function(e){return e.box})),p=c.map((function(e){return e.score})),h=c.map((function(e){return e.classScore})),d=c.map((function(e){return f.config.classes[e.label]})),e.abrupt("return",f0(l.map((function(e){return e.rescale(r)})),p,this.config.iouThreshold,!0).map((function(e){return new p0(p[e],h[e],d[e],l[e],u)})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return""}},{key:"extractParamsFromWeightMap",value:function(e){return function(e,t){var n,r=[],a=T2(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return d1(e,r),{params:n,paramMappings:r}}(e,this.config)}},{key:"extractParams",value:function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,r=t?t.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ".concat(r," filterSizes in config"));return function(e,t,n,r){var a,i=x1(e),o=i.extractWeights,s=i.getRemainingWeights,u=[],c=N2(o,u),l=c.extractConvParams,p=c.extractConvWithBatchNormParams,h=c.extractSeparableConvParams;if(t.withSeparableConvs){var d=C(r,9),f=d[0],m=d[1],v=d[2],g=d[3],y=d[4],b=d[5],x=d[6],k=d[7],w=d[8];a={conv0:t.isFirstLayerConv2d?l(f,m,3,"conv0"):h(f,m,"conv0"),conv1:h(m,v,"conv1"),conv2:h(v,g,"conv2"),conv3:h(g,y,"conv3"),conv4:h(y,b,"conv4"),conv5:h(b,x,"conv5"),conv6:k?h(x,k,"conv6"):void 0,conv7:w?h(k,w,"conv7"):void 0,conv8:l(w||k||x,5*n,1,"conv8")}}else{var I=C(r,9),S=I[0],N=I[1],T=I[2],E=I[3],_=I[4],A=I[5],R=I[6],F=I[7],D=I[8];a={conv0:p(S,N,"conv0"),conv1:p(N,T,"conv1"),conv2:p(T,E,"conv2"),conv3:p(E,_,"conv3"),conv4:p(_,A,"conv4"),conv5:p(A,R,"conv5"),conv6:p(R,F,"conv6"),conv7:p(F,D,"conv7"),conv8:l(D,5*n,1,"conv8")}}if(0!==s().length)throw new Error("weights remaing after extract: ".concat(s().length));return{params:a,paramMappings:u}}(e,this.config,this.boxEncodingSize,t)}},{key:"extractBoxes",value:function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,E,_,A,R,F,D,M,O=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.width,i=n.height,o=Math.max(a,i),s=o/a,u=o/i,c=t.shape[1],l=this.config.anchors.length,p=Mu((function(){var e=t.reshape([c,c,l,O.boxEncodingSize]);return[e.slice([0,0,0,0],[c,c,l,4]),e.slice([0,0,0,4],[c,c,l,1]),O.withClassScores?td(e.slice([0,0,0,5],[c,c,l,O.config.classes.length]),3):zl(0)]})),h=C(p,3),d=h[0],f=h[1],m=h[2],v=[],e.next=15,f.array();case 15:return g=e.sent,e.next=18,d.array();case 18:y=e.sent,b=0;case 20:if(!(b<c)){e.next=54;break}x=0;case 22:if(!(x<c)){e.next=51;break}k=0;case 24:if(!(k<l)){e.next=48;break}if(I=v0(g[b][x][k][0]),r&&!(I>r)){e.next=45;break}if(S=(x+v0(y[b][x][k][0]))/c*s,N=(b+v0(y[b][x][k][1]))/c*u,T=Math.exp(y[b][x][k][2])*this.config.anchors[k].x/c*s,E=Math.exp(y[b][x][k][3])*this.config.anchors[k].y/c*u,_=S-T/2,A=N-E/2,R={row:b,col:x,anchor:k},!this.withClassScores){e.next=40;break}return e.next=37,this.extractPredictedClass(m,R);case 37:e.t0=e.sent,e.next=41;break;case 40:e.t0={classScore:1,label:0};case 41:F=e.t0,D=F.classScore,M=F.label,v.push(ue({box:new l0(_,A,_+T,A+E),score:I,classScore:I*D,label:M},R));case 45:k++,e.next=24;break;case 48:x++,e.next=22;break;case 51:b++,e.next=20;break;case 54:return e.abrupt("return",(d.dispose(),f.dispose(),m.dispose(),v));case 55:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"extractPredictedClass",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,a=n.col,i=n.anchor,e.next=5,t.array();case 5:return o=e.sent,e.abrupt("return",Array(this.config.classes.length).fill(0).map((function(e,t){return o[r][a][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(u1),_2=E2;_2.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var A2=function(e){ye(n,e);var t=be(n);function n(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];xe(this,n);var r=ue({withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:b2,meanRgb:x2}:{anchors:y2,withClassScores:!0});return t.call(this,r)}return we(n,[{key:"withSeparableConvs",get:function(){return this.config.withSeparableConvs}},{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new h0(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"}},{key:"extractParamsFromWeightMap",value:function(e){return pe(le(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(_2);var R2=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.apply(this,arguments))._name="TinyFaceDetectorOptions",e}return we(n)}(C2),F2=function(){function e(){xe(this,e)}return we(e,[{key:"then",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,this.run();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("ComposableTask - run is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function D2(e,t,n,r){return M2.apply(this,arguments)}function M2(){return M2=S(w().mark((function e(t,n,r,a){var i,o,s,u,c=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>4&&void 0!==c[4]?c[4]:function(e){return e.alignedRect},o=t.map((function(e){return D1(e)?i(e):e.detection})),e.t0=a,e.t0){e.next=14;break}if(!(n instanceof No)){e.next=10;break}return e.next=7,$0(n,o);case 7:e.t1=e.sent,e.next=13;break;case 10:return e.next=12,Q0(n,o);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:return s=e.t0,e.next=17,r(s);case 17:return u=e.sent,e.abrupt("return",(s.forEach((function(e){return e instanceof No&&e.dispose()})),u));case 19:case"end":return e.stop()}}),e)}))),M2.apply(this,arguments)}var O2=[new u0(1.603231,2.094468),new u0(6.041143,7.080126),new u0(2.882459,3.518061),new u0(4.266906,5.178857),new u0(9.041765,10.66308)],L2=[117.001,114.697,97.404],z2=function(e){ye(n,e);var t=be(n);function n(){xe(this,n);var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:O2,meanRgb:L2,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)}return we(n,[{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new h0(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_face_detector_model"}},{key:"extractParamsFromWeightMap",value:function(e){return pe(le(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(_2),P2={ssdMobilenetv1:new g2,tinyFaceDetector:new z2,tinyYolov2:new A2,faceLandmark68Net:new K1,faceLandmark68TinyNet:new Y1,faceRecognitionNet:new r2,faceExpressionNet:new A1,ageGenderNet:new j1},B2=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i;return xe(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return we(n)}(F2),W2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"run",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,D2(t,this.input,function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return P2.faceExpressionNet.predictExpressions(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){return R1(e,n[t])})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new G2(this,this.input)}}]),n}(B2),V2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"withAgeAndGender",value:function(){return new H2(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new q2(this,this.input)}}]),n}(W2),U2=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i;return xe(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return we(n)}(F2),G2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"run",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,D2(t,this.input,function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return P2.ageGenderNet.predictAgeAndGender(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){var r=n[t],a=r.age;return i2(o2(e,r.gender,r.genderProbability),a)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new W2(this,this.input)}}]),n}(U2),H2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"withFaceExpressions",value:function(){return new V2(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new q2(this,this.input)}}]),n}(G2),j2=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).parentTask=e,a.input=r,a}return we(n)}(F2),q2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"run",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,D2(t,this.input,(function(e){return Promise.all(e.map((function(e){return P2.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 5:return e.abrupt("return",e.sent.map((function(e,n){return a2(t[n],e)})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new V2(this,this.input)}},{key:"withAgeAndGender",value:function(){return new H2(this,this.input)}}]),n}(j2),K2=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i;return xe(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.useTinyLandmarkNet=a,i}return we(n,[{key:"landmarkNet",get:function(){return this.useTinyLandmarkNet?P2.faceLandmark68TinyNet:P2.faceLandmark68Net}}]),n}(F2),X2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"run",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent,n=t.map((function(e){return e.detection})),!(this.input instanceof No)){e.next=10;break}return e.next=7,$0(this.input,n);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,Q0(this.input,n);case 12:e.t0=e.sent;case 13:return r=e.t0,e.next=16,Promise.all(r.map((function(e){return i.landmarkNet.detectLandmarks(e)})));case 16:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof No&&e.dispose()})),t.filter((function(e,t){return a[t]})).map((function(e,t){return M1(e,a[t])}))));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new V2(this,this.input)}},{key:"withAgeAndGender",value:function(){return new H2(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new q2(this,this.input)}}]),n}(K2),Y2=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v2;return xe(this,n),(r=t.call(this)).input=e,r.options=a,r}return we(n)}(F2),J2=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"run",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.input,!((n=this.options)instanceof R2)){e.next=5;break}r=P2.tinyFaceDetector.locateFaces(t,n),e.next=14;break;case 5:if(!(n instanceof v2)){e.next=9;break}r=P2.ssdMobilenetv1.locateFaces(t,n),e.next=14;break;case 9:if(!(n instanceof C2)){e.next=13;break}r=P2.tinyYolov2.locateFaces(t,n),e.next=14;break;case 13:throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetections",value:function(){var e=this;return new Promise((function(t,n){e.run().then((function(e){return t(e.map((function(e){return w0({},e)})))})).catch((function(e){return n(e)}))}))}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new X2(this.runAndExtendWithFaceDetections(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new W2(this.runAndExtendWithFaceDetections(),this.input)}},{key:"withAgeAndGender",value:function(){return new G2(this.runAndExtendWithFaceDetections(),this.input)}}]),n}(Y2);function Q2(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new v2;return new J2(e,t)}function Z2(e,t){var n=new K$(t.width,t.height),r=n.width,a=n.height;if(r<=0||a<=0)throw new Error("resizeResults - invalid dimensions: ".concat(JSON.stringify({width:r,height:a})));if(Array.isArray(e))return e.map((function(e){return Z2(e,{width:r,height:a})}));if(D1(e)){var i=e.detection.forSize(r,a),o=e.unshiftedLandmarks.forSize(i.box.width,i.box.height);return M1(w0(e,i),o)}return k0(e)?w0(e,e.detection.forSize(r,a)):e instanceof b0||e instanceof h0?e.forSize(r,a):e}var $2=function(){function e(t,n){xe(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return we(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),e3=function(){function e(){xe(this,e)}return we(e,[{key:"refCount",value:function(e){return t3("refCount")}},{key:"incRef",value:function(e){return t3("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return t3("time")}},{key:"read",value:function(e){return t3("read")}},{key:"readSync",value:function(e){return t3("readSync")}},{key:"readToGPU",value:function(e,t){return t3("readToGPU")}},{key:"numDataIds",value:function(){return t3("numDataIds")}},{key:"disposeData",value:function(e,t){return t3("disposeData")}},{key:"write",value:function(e,t,n){return t3("write")}},{key:"move",value:function(e,t,n,r,a){return t3("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return t3("createTensorFromGPUData")}},{key:"memory",value:function(){return t3("memory")}},{key:"floatPrecision",value:function(){return t3("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return t3("dispose")}}]),e}();function t3(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function n3(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,i3(e,--t,n)}function r3(e,t,n){return Math.max(e,Math.min(t,n))}function a3(e){return e%2===0?e:e+1}function i3(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function o3(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function s3(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function u3(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";s3(p3(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function c3(e){s3(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function l3(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function p3(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function h3(e){return e%1===0}function d3(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function f3(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function m3(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function v3(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function g3(e,t){var n=t.length;return s3((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),s3(e.every((function(e){return h3(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function y3(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:g3(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function b3(e,t){return x3(e,t)}function x3(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function k3(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function w3(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function I3(e){return"string"===typeof e||e instanceof String}function S3(e){return"number"===typeof e}function N3(e){return Array.isArray(e)?N3(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":S3(e)?"float32":I3(e)?"string":"boolean"===typeof e?"bool":"float32"}function T3(e){return!!(e&&e.constructor&&e.call&&e.apply)}function C3(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function E3(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function _3(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=_3(e+l*c,u,n,r);return a}function A3(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return _3(0,e,t,n)}function R3(e,t){for(var n=F3(e,t),r=0;r<n.length;r++)n[r]=1;return n}function F3(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function D3(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return A3(e,new Float32Array(n));if("int32"===t)return A3(e,new Int32Array(n));if("bool"===t)return A3(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function M3(e){e.forEach((function(t){s3(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function O3(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function L3(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function z3(e){return e&&e.then&&"function"===typeof e.then}var P3="tfjsflags",B3=function(){function e(t){xe(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=W3,this.populateURLFlags()}return we(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(V3().getBool("IS_TEST")||V3().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];V3().getBool("IS_TEST")||V3().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(z3(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getString",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(P3 in t)t[P3].split(",").forEach((function(t){var n=C(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){var n=t.toLowerCase();return"true"===n||"false"===n?"true"===n:"".concat(+n)===n?+n:t}(0,a)}))}}}]),e}();function W3(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function V3(){return G3}var U3,G3=null;function H3(){if(null==U3){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}U3=e}return U3}function j3(e,t){var n=function(){var e=H3();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var q3="Abs",K3="Acos",X3="Acosh",Y3="Add",J3="AddN",Q3="All",Z3="Any",$3="ArgMax",e4="ArgMin",t4="Asin",n4="Asinh",r4="Atan",a4="Atanh",i4="Atan2",o4="AvgPool",s4="AvgPoolGrad",u4="AvgPool3D",c4="AvgPool3DGrad",l4="BatchMatMul",p4="BatchToSpaceND",h4="Bincount",d4="BitwiseAnd",f4="BroadcastArgs",m4="Cast",v4="Ceil",g4="ClipByValue",y4="Complex",b4="ComplexAbs",x4="Concat",k4="Conv2D",w4="Conv2DBackpropFilter",I4="Conv2DBackpropInput",S4="Conv3D",N4="Conv3DBackpropFilterV2",T4="Conv3DBackpropInputV2",C4="Cos",E4="Cosh",_4="Cumprod",A4="Cumsum",R4="CropAndResize",F4="DenseBincount",D4="DepthToSpace",M4="DepthwiseConv2dNative",O4="DepthwiseConv2dNativeBackpropFilter",L4="DepthwiseConv2dNativeBackpropInput",z4="Diag",P4="Dilation2D",B4="Dilation2DBackpropInput",W4="Dilation2DBackpropFilter",V4="RealDiv",U4="Einsum",G4="Elu",H4="EluGrad",j4="Erf",q4="Equal",K4="Exp",X4="ExpandDims",Y4="Expm1",J4="FFT",Q4="Fill",Z4="FlipLeftRight",$4="Floor",e5="FloorDiv",t5="FusedBatchNorm",n5="GatherV2",r5="GatherNd",a5="Greater",i5="GreaterEqual",o5="Identity",s5="IFFT",u5="Imag",c5="IsFinite",l5="IsInf",p5="IsNan",h5="LeakyRelu",d5="Less",f5="LessEqual",m5="LinSpace",v5="Log",g5="Log1p",y5="LogicalAnd",b5="LogicalNot",x5="LogicalOr",k5="LRN",w5="LRNGrad",I5="Max",S5="Maximum",N5="MaxPool",T5="MaxPoolGrad",C5="MaxPool3D",E5="MaxPool3DGrad",_5="MaxPoolWithArgmax",A5="Mean",R5="Min",F5="Minimum",D5="MirrorPad",M5="Mod",O5="Multinomial",L5="Multiply",z5="Neg",P5="NotEqual",B5="NonMaxSuppressionV3",W5="NonMaxSuppressionV4",V5="NonMaxSuppressionV5",U5="OnesLike",G5="OneHot",H5="Pack",j5="PadV2",q5="Pow",K5="Prelu",X5="Prod",Y5="RaggedGather",J5="RaggedRange",Q5="RaggedTensorToTensor",Z5="Range",$5="Real",e6="Reciprocal",t6="Relu",n6="Reshape",r6="ResizeNearestNeighbor",a6="ResizeNearestNeighborGrad",i6="ResizeBilinear",o6="ResizeBilinearGrad",s6="Relu6",u6="Reverse",c6="Round",l6="Rsqrt",p6="ScatterNd",h6="TensorScatterUpdate",d6="SearchSorted",f6="Select",m6="Selu",v6="Slice",g6="Sin",y6="Sinh",b6="Sign",x6="Sigmoid",k6="Softplus",w6="Sqrt",I6="Sum",S6="SpaceToBatchND",N6="SplitV",T6="Softmax",C6="SparseFillEmptyRows",E6="SparseReshape",_6="SparseSegmentMean",A6="SparseSegmentSum",R6="SparseToDense",F6="SquaredDifference",D6="Square",M6="StaticRegexReplace",O6="StridedSlice",L6="StringNGrams",z6="StringSplit",P6="StringToHashBucketFast",B6="Sub",W6="Tan",V6="Tanh",U6="Tile",G6="TopK",H6="Transform",j6="Transpose",q6="Unique",K6="Unpack",X6="UnsortedSegmentSum",Y6="ZerosLike",J6="Step",Q6="RotateWithOffset",Z6="_FusedMatMul",$6="FusedConv2D",e8="FusedDepthwiseConv2D";function t8(){var e;V3().getBool("IS_TEST")||V3().getBool("PROD")||(e=console).warn.apply(e,arguments)}var n8=j3("kernelRegistry",(function(){return new Map})),r8=j3("gradRegistry",(function(){return new Map}));function a8(e,t){var n=c8(e,t);return n8.get(n)}function i8(e){return r8.get(e)}function o8(e){for(var t=n8.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=C(i,2),s=o[0],u=o[1];C(s.split("_"),1)[0]===e&&n.push(u)}return n}function s8(e){var t=e.kernelName,n=e.backendName,r=c8(t,n);n8.has(r)&&t8("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),n8.set(r,e)}function u8(e){var t=e.kernelName;r8.has(t)&&V3().getBool("DEBUG")&&t8("Overriding the gradient for '".concat(t,"'")),r8.set(t,e)}function c8(e,t){return"".concat(t,"_").concat(e)}function l8(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var p8=n(987),h8=n.n(p8)()||p8;function d8(e){return h8.fromString(e,!0,16)}var f8=d8("c3a5c85c97cb3127"),m8=d8("b492b66fbe98f273"),v8=d8("9ae16a3b2f90404f");function g8(e){return e.xor(e.shru(47))}function y8(e,t,n){var r=e.slice(t,t+n);return h8.fromBytes(Array.from(r),!0,!0)}function b8(e,t){return y8(e,t,8)}function x8(e,t){return y8(e,t,4)}function k8(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function w8(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d8("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function I8(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=k8(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(k8(a,44)),[a.add(r),i.add(o)]}(b8(e,t),b8(e,t+8),b8(e,t+16),b8(e,t+24),n,r)}function S8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=h8.fromNumber(81,!0);if(t<=32)return t<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=v8.add(2*t),r=b8(e,0).add(v8),a=b8(e,t-8);return w8(k8(a,37).mul(n).add(r),k8(r,25).add(a).mul(n),n)}if(t>=4){var i=v8.add(2*t);return w8(x8(e,0).shl(3).add(t),x8(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return g8(v8.mul(o).xor(f8.mul(s))).mul(v8)}return v8}(e,t):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=v8.add(2*t),r=b8(e,0).mul(m8),a=b8(e,8),i=b8(e,t-8).mul(n),o=b8(e,t-16).mul(v8);return w8(k8(r.add(a),43).add(k8(i,30)).add(o),r.add(k8(a.add(v8),18)).add(i),n)}(e,t);if(t<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=v8.add(2*t),r=b8(e,0).mul(v8),a=b8(e,8),i=b8(e,t-8).mul(n),o=b8(e,t-16).mul(v8),s=k8(r.add(a),43).add(k8(i,30)).add(o),u=w8(s,r.add(k8(a.add(v8),18)).add(i),n),c=b8(e,16).mul(n),l=b8(e,24),p=s.add(b8(e,t-32)).mul(n),h=u.add(b8(e,t-24)).mul(n);return w8(k8(c.add(l),43).add(k8(p,30)).add(h),c.add(k8(l.add(r),18)).add(p),n)}(e,t);var r=n,a=n.mul(m8).add(113),i=g8(a.mul(v8).add(113)).mul(v8),o=[h8.UZERO,h8.UZERO],s=[h8.UZERO,h8.UZERO];r=r.mul(v8).add(b8(e,0));var u=0,c=64*(t-1>>6),l=c+(t-1&63)-63;do{r=k8(r.add(a).add(o[0]).add(b8(e,u+8)),37).mul(m8),a=k8(a.add(o[1]).add(b8(e,u+48)),42).mul(m8),r=r.xor(s[1]),a=a.add(o[0]).add(b8(e,u+40)),i=k8(i.add(s[0]),33).mul(m8),o=I8(e,u,o[1].mul(m8),r.add(s[0])),s=I8(e,u+32,i.add(s[1]),a.add(b8(e,u+16)));var p=[r,i];i=p[0],r=p[1],u+=64}while(u!==c);var h=m8.add(i.and(255).shl(1));u=l,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=k8(r.add(a).add(o[0]).add(b8(e,u+8)),37).mul(h),a=k8(a.add(o[1]).add(b8(e,u+48)),42).mul(h),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(b8(e,u+40))),i=k8(i.add(s[0]),33).mul(h),o=I8(e,u,o[1].mul(h),r.add(s[0])),s=I8(e,u+32,i.add(s[1]),a.add(b8(e,u+16)));var d=[r,i];return i=d[0],r=d[1],w8(w8(o[0],s[0],h).add(g8(a).mul(f8)).add(i),w8(o[1],s[1],h).add(r),h)}function N8(e,t){return"string"===t?E8(e):T8([e],t)}function T8(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=R8(e)),V3().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function C8(){return V3().platform.now()}function E8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",V3().platform.encode(e,t)}function _8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",V3().platform.decode(e,t)}function A8(e){return null!=V3().platform.isTypedArray?V3().platform.isTypedArray(e):l8(e)}function R8(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"===typeof e||"number"===typeof e||"string"===typeof e||z3(e)||null==e||A8(e)&&n)t.push(e);else if(Array.isArray(e)||A8(e))for(var r=0;r<e.length;++r)R8(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)R8(e[u],t,n)}return t}var F8=function(){function e(t,n){xe(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new D8)}return we(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=C8();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=Se(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:C8()-o})}if(V3().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var D8=function(){function e(){xe(this,e)}return we(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?f3("".concat(r,"ms"),9):r.error,s=f3(e,25),u=t.rank,c=t.size,l=f3(t.shape.toString(),14),p="";for(var h in a){var d=a[h];if(null!=d){var f=d.shape||t.shape,m=f.length;p+="".concat(h,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var M8=20,O8=3,L8=7;function z8(e,t,n,r){var a=E3(t),i=function(e,t,n,r){var a=l3(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?V8(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],P8(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=W8(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function P8(e,t,n){return f3(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(L8))," + ")+"".concat(parseFloat(e[1].toFixed(L8)),"j"):I3(e)?"'".concat(e,"'"):"bool"===n?B8(e):parseFloat(e.toFixed(L8)).toString(),t)}function B8(e){return 0===e?"false":"true"}function W8(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[P8(V8(e)[0],0,n)]:"bool"===n?[B8(e[0])]:[e[0].toString()];if(1===u){if(s>M8){var c=O8*o,l=Array.from(e.slice(0,c)),p=Array.from(e.slice((s-O8)*o,s*o));return"complex64"===n&&(l=V8(l),p=V8(p)),["["+l.map((function(e,t){return P8(e,a[t],n)})).join(", ")+", ..., "+p.map((function(e,t){return P8(e,a[s-O8+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?V8(e):Array.from(e)).map((function(e,t){return P8(e,a[t],n)})).join(", ")+"]"]}var h=t.slice(1),d=r.slice(1),f=r[0]*o,m=[];if(s>M8){for(var v=0;v<O8;v++){var g=v*f,y=g+f;m.push.apply(m,Ie(W8(e.slice(g,y),h,n,d,a,!1)))}m.push("...");for(var b=s-O8;b<s;b++){var x=b*f,k=x+f;m.push.apply(m,Ie(W8(e.slice(x,k),h,n,d,a,b===s-1)))}}else for(var w=0;w<s;w++){var I=w*f,S=I+f;m.push.apply(m,Ie(W8(e.slice(I,S),h,n,d,a,w===s-1)))}var N=2===u?",":"";m[0]="["+(s>0?m[0]+N:"");for(var T=1;T<m.length-1;T++)m[T]=" "+m[T]+N;for(var C=",\n",E=2;E<u;E++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":C),m}function V8(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var U8=function(){function e(t,n,r){var a=this;if(xe(this,e),this.dtype=n,this.shape=t.slice(),this.size=l3(t),null!=r){var i=r.length;s3(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||x3(n,this.size),this.strides=E3(t)}return we(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),s3(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return G8().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),G8=null,H8=null;var j8=function(){function e(t,n,r,a){xe(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=l3(t),this.strides=E3(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return we(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",H8.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return H8.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",A3(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return A3(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=G8().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return _8(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),G8().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=G8().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return _8(e)}))}catch(Ru){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,G8().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(G8().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return H8.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),H8.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return z8(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),H8.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),G8().makeVariable(this,e,t,n)}}]),e}();function q8(){return j3("Tensor",(function(){return j8}))}Object.defineProperty(j8,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),q8();var K8,X8,Y8,J8,Q8,Z8=function(e){ye(n,e);var t=be(n);function n(e,r,a,i){var o;return xe(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return we(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!p3(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));G8().disposeTensor(this),this.dataId=e.dataId,G8().incRef(this,null)}},{key:"dispose",value:function(){G8().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(j8);Object.defineProperty(Z8,Symbol.hasInstance,{value:function(e){return e instanceof j8&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(K8||(K8={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(X8||(X8={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Y8||(Y8={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(J8||(J8={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Q8||(Q8={}));var $8={float32:J8,int32:X8,bool:Y8,complex64:Q8};function e9(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return $8[e][t]}function t9(e){return e9(e,"int32")}function n9(e){return null!=e&&"object"===typeof e&&"texture"in e&&e.texture instanceof WebGLTexture}function r9(e){return"undefined"!==typeof GPUBuffer&&null!=e&&"object"===typeof e&&"buffer"in e&&e.buffer instanceof GPUBuffer}function a9(e,t){if(e.dtype===t.dtype)return[e,t];var n=e9(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function i9(e,t){return t.some((function(t){return t.id===e.id}))}function o9(e){var t=[];return s9(e,t,new Set),t}function s9(e,t,n){if(null!=e)if(e instanceof j8)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),s9(o,t,n))}}}function u9(e){return null!=e.kernelName}var c9=function(){function e(){xe(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return we(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),l9=function(){function e(t){xe(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new c9}return we(e,[{key:"ready",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(t8("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new F8(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;o8(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;o8(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof e3||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,t8("Initialization of backend ".concat(e," failed")),t8(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return t8("Initialization of backend ".concat(e," failed")),t8(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(Mx){throw t(),Mx}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=d9.runKernel(o5,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return d9.runKernel(m4,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=a8(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=u9(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(u9(e)){var l=e.kernelName,p=e.inputs,h=e.attrs;null==this.backendName&&this.backend;var d=a8(l,this.backendName);s3(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=d.kernelFunc({inputs:p,attrs:h,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,p,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var f=e.forwardFunc,m=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return f(a.backend,m)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=u9(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(v=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(v),t=v.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=i8(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(s3(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&I3(e[0])&&(a=e.map((function(e){return E8(e)})));var i=r.write(a,t,n),o=new j8(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new j8(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Z8(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*w3(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Z8||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*w3(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Ie(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=Se(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=i8(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=F3(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=o9(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(s3(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));s3(i instanceof j8,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,h=0;h<t.length;h++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&f[w.id]){var I={};for(var S in w.inputs){var N=w.inputs[S];r[N.id]&&(I[S]=N)}var T=Object.assign({},w);T.inputs=I,T.outputs=w.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=R3(l3(e),"float32");return d9.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!p3(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(i.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),f9);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=Se(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return s3(T3(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;s3(r.every((function(e){return e instanceof j8})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return s3((i=e.apply(void 0,[].concat(r,[n]))).value instanceof j8,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),s3(T3(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];s3(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),s3(a.every((function(e){return e instanceof j8})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=C8(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=C8()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new c9,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function p9(){var e=H3();if(null==e._tfengine){var t=new B3(e);e._tfengine=new l9(t)}return function(e){G3=e}(e._tfengine.ENV),function(e){G8=e}((function(){return e._tfengine})),e._tfengine}l9.nextTensorId=0,l9.nextVariableId=0;var h9,d9=p9();function f9(e,t){var n={a:e,b:t};return d9.runKernel(Y3,n)}function m9(e){if(void 0!==h9)return h9;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function v9(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var g9=V3();function y9(e,t){var n=e;if(A8(e))return"string"===t?[]:[e.length];if(n9(e)){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if(r9(e))return[e.buffer.size/(null==t?4:w3(t))];if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||A8(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&V3().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&b9(e,a,[]),a}function b9(e,t,n){if(n=n||[],Array.isArray(e)||A8(e)){s3(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),s3(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)b9(e[a],r,n.concat(a))}else s3(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function x9(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function k9(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof j8)return x9(r,e.dtype,t,n),e;var a=N3(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),x9(r,a,t,n),null==e||!A8(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=y9(e,a);A8(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?T8(e,a):R8(e,[],!0);return d9.makeTensor(s,o,a)}function w9(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((function(e,a){return k9(e,"".concat(t,"[").concat(a,"]"),n,r)}))}g9.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),g9.registerFlag("IS_BROWSER",(function(){return v9()})),g9.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),g9.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),g9.registerFlag("IS_SAFARI",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)})),g9.registerFlag("PROD",(function(){return!1})),g9.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return g9.getBool("DEBUG")})),g9.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),g9.registerFlag("IS_TEST",(function(){return!1})),g9.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return g9.getBool("DEBUG")})),g9.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),g9.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),g9.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));function I9(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){d9.startScope(n);try{var e=r.apply(void 0,arguments);return z3(e)&&console.error("Cannot return a Promise inside of tidy."),d9.endScope(e),e}catch(Mx){throw d9.endScope(null),Mx}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var S9=I9({complex_:function(e,t){var n=k9(e,"real","complex"),r=k9(t,"imag","complex");u3(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return d9.runKernel(y4,a)}});function N9(e,t,n,r){if(null==r)r=N3(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(r9(e)||n9(e)){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return d9.backend.createTensorFromGPUData(e,t||n,r)}if(!A8(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){M3(t);var a=l3(t),i=l3(n);s3(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==l3(t.slice(o));s3(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return A8(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?T8(e,r):R8(e,[],!0),d9.makeTensor(e,t,r)}function T9(e,t,n){return N9(e,t,y9(e,n),n)}var C9={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},E9=function(){function e(t){if(xe(this,e),this.shards=[],this.previousShardIndex=0,null!=t&&(t instanceof Array||(t=[t]),0!==(t=t.map((function(e){return A8(e)?e.buffer:e}))).length)){this.bufferUniformSize=t[0].byteLength;for(var n=0,r=0;r<t.length;r++){var a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=n+a.byteLength;this.shards.push({buffer:a,start:n,end:i}),n=i}0===this.shards.length&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return we(e,[{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.byteLength;if(0===this.shards.length)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),(t=Math.min(this.byteLength,t))<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(-1===n)throw new Error("Could not find start shard for byte ".concat(e));for(var r=new ArrayBuffer(t-e),a=new Uint8Array(r),i=0,o=n;o<this.shards.length;o++){var s=this.shards[o],u=e+i-s.start,c=i,l=Math.min(t,s.end)-s.start,p=new Uint8Array(s.buffer,u,l-u);if(a.set(p,c),i+=p.length,t<s.end)break}return r}},{key:"findShardForByte",value:function(e){if(0===this.shards.length||e<0||e>=this.byteLength)return-1;if(null!=this.bufferUniformSize)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(t){return e<t.start?-1:e>=t.end?1:0}if(0===t(this.shards[this.previousShardIndex]))return this.previousShardIndex;var n=function(e,t){var n=0,r=e.length;for(;n<=r;){var a=Math.floor((r-n)/2)+n,i=t(e[a]);if(0===i)return a;i<0?r=a:n=a+1}return-1}(this.shards,t);return-1===n?-1:(this.previousShardIndex=n,this.previousShardIndex)}}],[{key:"join",value:function(t){return new e(t).slice()}}]),e}();var _9=4;function A9(e,t){return R9.apply(this,arguments)}function R9(){return R9=S(w().mark((function e(t,n){var r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=w().mark((function e(){var o,u,c,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=4;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 4:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+_9*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=_9,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 8:case"end":return e.stop()}}),e)})),s=0;case 5:if(!(s<i.length)){e.next=10;break}return e.delegateYield(o(),"t0",7);case 7:++s,e.next=5;break;case 10:return e.next=12,Promise.all(a);case 12:return u=e.sent,e.abrupt("return",{data:D9(u),specs:r});case 14:case"end":return e.stop()}}),e)}))),R9.apply(this,arguments)}function F9(e,t){var n,r,a=new E9(e),i={},o=0,s=Se(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=u.name,l=u.dtype,p=u.shape,h=l3(p),d=void 0;if("quantization"in u){var f=u.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(u.name," with quantization ").concat(f.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(u.name," has unknown ")+"quantization dtype ".concat(f.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==l)throw new Error("Weight ".concat(u.name," is quantized with ").concat(f.dtype," ")+"which only supports weights of type float32 not ".concat(l,"."))}var m=C9[f.dtype],v=a.slice(o,o+h*m),g="uint8"===f.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===l)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(g.length);for(var y=0;y<g.length;y++){var b=g[y];d[y]=b*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type float32.");void 0===n&&(n=q9()),d=n(g)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," ")+"for weight type int32.");d=new Int32Array(g.length);for(var x=0;x<g.length;x++){var k=g[x];d[x]=Math.round(k*f.scale+f.min)}}o+=h*m}else if("string"===l){var w=l3(u.shape);d=[];for(var I=0;I<w;I++){var S=new Uint32Array(a.slice(o,o+_9))[0];o+=_9;var N=new Uint8Array(a.slice(o,o+S));d.push(N),o+=S}}else{var T=C9[l],C=a.slice(o,o+h*T);if("float32"===l)d=new Float32Array(C);else if("int32"===l)d=new Int32Array(C);else if("bool"===l)d=new Uint8Array(C);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));d=new Float32Array(C);for(var E=new Float32Array(d.length/2),_=new Float32Array(d.length/2),A=0;A<E.length;A++)E[A]=d[2*A],_[A]=d[2*A+1];var R=T9(E,p,"float32"),F=T9(_,p,"float32");i[c]=S9(R,F),R.dispose(),F.dispose()}o+=h*T}"complex64"!==l&&(i[c]=T9(d,p,l))}}catch(D){s.e(D)}finally{s.f()}return i}function D9(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var M9="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function O9(e){return M9?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function L9(e){if(M9)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function z9(e){if(M9){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function P9(e){return E9.join(e)}function B9(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function W9(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function V9(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function U9(e,t){return G9.apply(this,arguments)}function G9(){return G9=S(w().mark((function e(t,n){var r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.weightsManifest){e.next=7;break}return e.next=3,n(t.weightsManifest);case 3:i=e.sent,o=C(i,2),r=o[0],a=o[1];case 7:return e.abrupt("return",V9(t,r,a));case 8:case"end":return e.stop()}}),e)}))),G9.apply(this,arguments)}function H9(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:O9(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:O9(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:new E9(e.weightData).byteLength}}function j9(e){var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,Ie(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function q9(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var K9=function(){function e(){xe(this,e),this.saveRouters=[],this.loadRouters=[]}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),X9=function(e){return K9.registerSaveRouter(e)},Y9=function(e){return K9.registerLoadRouter(e)},J9=function(e){return K9.getSaveHandlers(e)},Q9=function(e,t){return K9.getLoadHandlers(e,t)},Z9="tensorflowjs",$9="models_store",e7="model_info_store";function t7(){if(!V3().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function n7(e){var t=e.result;t.createObjectStore($9,{keyPath:"modelPath"}),t.createObjectStore(e7,{keyPath:"modelPath"})}var r7=function(){function e(t){if(xe(this,e),this.indexedDB=t7(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Z9,1);a.onupgradeneeded=function(){return n7(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction($9,"readonly"),s=o.objectStore($9).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c,l=H9(t),p=i.transaction(e7,"readwrite"),h=p.objectStore(e7);try{u=h.put({modelPath:n.modelPath,modelArtifactsInfo:l})}catch(d){return r(d)}u.onsuccess=function(){var a,o=(c=i.transaction($9,"readwrite")).objectStore($9);try{a=o.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:l})}catch(d){return r(d)}a.onsuccess=function(){return e({modelArtifactsInfo:l})},a.onerror=function(e){var t=(h=p.objectStore(e7)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},u.onerror=function(e){return i.close(),r(u.error)},p.oncomplete=function(){null==c?i.close():c.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();r7.URL_SCHEME="indexeddb://";var a7=function(e){return V3().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(r7.URL_SCHEME)?(t=e.slice(r7.URL_SCHEME.length),new r7(t)):null;var t};K9.registerSaveRouter(a7),K9.registerLoadRouter(a7);var i7=function(){function e(){xe(this,e),this.indexedDB=t7()}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Z9,1);r.onupgradeneeded=function(){return n7(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(e7,"readonly"),i=a.objectStore(e7).getAll();i.onsuccess=function(){var t,n={},r=Se(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(r7.URL_SCHEME)?r.slice(r7.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(Z9,1);a.onupgradeneeded=function(){return n7(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(e7,"readwrite"),s=o.objectStore(e7),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction($9,"readwrite")).objectStore($9).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),o7="/",s7="tensorflowjs_models",u7="info",c7="model_topology",l7="weight_specs",p7="weight_data",h7="model_metadata";function d7(e){return{info:[s7,e,u7].join(o7),topology:[s7,e,c7].join(o7),weightSpecs:[s7,e,l7].join(o7),weightData:[s7,e,p7].join(o7),modelMetadata:[s7,e,h7].join(o7)}}function f7(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function m7(e){var t=e.split(o7);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(o7)}var v7=function(){function e(t){if(xe(this,e),!V3().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=d7(this.modelPath)}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=H9(t),i=E9.join(t.weightData),e.prev=8,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,L9(i)),o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),e.abrupt("return",{modelArtifactsInfo:a});case 18:throw e.prev=18,e.t0=e.catch(8),f7(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 22:case"end":return e.stop()}}),e,this,[[8,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=z9(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();v7.URL_SCHEME="localstorage://";var g7=function(e){return V3().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(v7.URL_SCHEME)?(t=e.slice(v7.URL_SCHEME.length),new v7(t)):null;var t};K9.registerSaveRouter(g7),K9.registerLoadRouter(g7);var y7=function(){function e(){xe(this,e),s3(V3().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),s3("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=s7+o7,r=o7+u7,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=m7(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(v7.URL_SCHEME)?a.slice(v7.URL_SCHEME.length):a,n=d7(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),f7(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),b7="://",x7=function(){function e(){xe(this,e),this.managers={}}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){s3(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(b7)&&(t=t.slice(0,t.indexOf(b7))),s3(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();s3(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function k7(e){if(-1===e.indexOf(b7))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(x7.getSchemes().join(",")));return{scheme:e.split(b7)[0],path:e.split(b7)[1]}}function w7(e,t){return I7.apply(this,arguments)}function I7(){return I7=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],s3(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),s3((a=K9.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),s3(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],s3((o=K9.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),s3(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=k7(t).scheme,c=k7(t).path,l=u===k7(t).scheme,e.next=15,i.load();case 15:if(p=e.sent,!r||!l){e.next=19;break}return e.next=19,x7.getManager(u).removeModel(c);case 19:return e.next=21,s.save(p);case 21:if(h=e.sent,!r||l){e.next=25;break}return e.next=25,x7.getManager(u).removeModel(c);case 25:return e.abrupt("return",h.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),I7.apply(this,arguments)}function S7(){return N7.apply(this,arguments)}function N7(){return(N7=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=x7.getSchemes(),n={},r=Se(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,x7.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+b7+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function T7(e){return C7.apply(this,arguments)}function C7(){return(C7=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k7(t),r=x7.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E7(e,t){return _7.apply(this,arguments)}function _7(){return(_7=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",w7(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A7(e,t){return R7.apply(this,arguments)}function R7(){return(R7=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",w7(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F7=function(){function e(){xe(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return we(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!==typeof window&&V3().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return l8(e)}}]),e}();if(V3().get("IS_BROWSER")){V3().setPlatform("browser",new F7);try{x7.registerManager(v7.URL_SCHEME,new y7)}catch(aGe){}try{x7.registerManager(r7.URL_SCHEME,new i7)}catch(aGe){}}var D7,M7=function(){return n(755)};var O7=function(){function e(){xe(this,e),this.util=n(4),this.textEncoder=new this.util.TextEncoder}return we(e,[{key:"fetch",value:function(e,t){return null!=V3().global.fetch?V3().global.fetch(e,t):(null==D7&&(D7=M7()),D7(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function L7(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",M3(e),new U8(e,t,n)}V3().get("IS_NODE")&&!V3().get("IS_BROWSER")&&V3().setPlatform("node",new O7);var z7=I9({cast_:function(e,t){var n=k9(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return d9.runKernel(m4,r,a)}});var P7=I9({clone_:function(e){var t={x:k9(e,"x","clone","string_or_numeric")};return d9.runKernel(o5,t)}});p9();var B7={buffer:L7,cast:z7,clone:P7,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};function W7(){return d9}function V7(){return d9.memory()}function U7(e,t){return d9.tidy(e,t)}function G7(e){o9(e).forEach((function(e){return e.dispose()}))}function H7(e){return d9.keep(e)}function j7(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return d9.registerBackend(e,t,n)}H8=B7,function(e){e}((function(e){V3().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}));var q7=I9({add_:function(e,t){var n=k9(e,"a","add"),r=k9(t,"b","add"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(Y3,i)}});var K7=I9({floorDiv_:function(e,t){var n=k9(e,"a","floorDiv"),r=k9(t,"b","floorDiv"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(e5,i)}});var X7=I9({div_:function(e,t){var n=k9(e,"a","div"),r=k9(t,"b","div"),a=C(a9(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return K7(n,r);var i={a:n,b:r};return d9.runKernel(V4,i,{})}});var Y7=I9({mul_:function(e,t){var n=k9(e,"a","mul"),r=k9(t,"b","mul"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(L5,i)}});var J7=I9({sqrt_:function(e){var t={x:k9(e,"x","sqrt","float32")};return d9.runKernel(w6,t)}});var Q7=I9({square_:function(e){var t=k9(e,"x","square");return d9.runKernel("Square",{x:t},{})}});var Z7=I9({zerosLike_:function(e){var t={x:k9(e,"x","zerosLike")};return d9.runKernel(Y6,t)}});function $7(e){return d9.customGrad(e)}function eee(e,t){if((A8(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&A8(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return N9(e,[],[],t)}var tee=function(){function e(){xe(this,e)}return we(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),nee=function(){function e(){xe(this,e),this.classNameMap={}}return we(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function ree(e){s3(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),s3("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),s3(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),nee.register(e)}var aee=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return G7(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){s3(T3(e),(function(){return"The f passed in variableGrads(f) must be a function"})),s3(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Z8})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],d9.registeredVariables)t.push(d9.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),s3(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=d9.gradients(e,t,null,!0),s=o.value,u=o.grads;s3(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),s3(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&G7(this.iterations_)}},{key:"saveIterations",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:eee(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(tee);Object.defineProperty(aee,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var iee=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return xe(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=d9.backend.epsilon()),a}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=d9.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:U7((function(){return Z7(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:U7((function(){return Z7(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;U7((function(){var e=q7(Y7(o,t.rho),Y7(Q7(i),1-t.rho)),n=Y7(X7(J7(q7(s,t.epsilon)),J7(q7(o,t.epsilon))),i),r=q7(Y7(s,t.rho),Y7(Q7(n),1-t.rho));o.assign(e),s.assign(r);var u=q7(Y7(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(G7(this.accumulatedGrads.map((function(e){return e.variable}))),G7(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedGrads),Ie(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(aee);function oee(e,t,n){M3(e);var r={shape:e,value:t,dtype:n=n||N3(t)};return d9.runKernel(Q4,{},r)}var see=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return xe(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=d9.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:U7((function(){return oee(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;U7((function(){var e=q7(o,Q7(i));o.assign(e);var n=q7(Y7(X7(i,J7(q7(e,d9.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&G7(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(aee);var uee=I9({pow_:function(e,t){var n=k9(e,"base","pow"),r=k9(t,"exp","pow"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(q5,i)}});var cee=I9({sub_:function(e,t){var n=k9(e,"a","sub"),r=k9(t,"b","sub"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(B6,i)}}),lee=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return xe(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],U7((function(){i.accBeta1=eee(r).variable(),i.accBeta2=eee(a).variable()})),null==o&&(i.epsilon=d9.backend.epsilon()),i}return we(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);U7((function(){var r=cee(1,t.accBeta1),a=cee(1,t.accBeta2);n.forEach((function(n,i){var o=d9.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:U7((function(){return Z7(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:U7((function(){return Z7(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=q7(Y7(u,t.beta1),Y7(s,1-t.beta1)),p=q7(Y7(c,t.beta2),Y7(Q7(s),1-t.beta2)),h=X7(l,r),d=X7(p,a);u.assign(l),c.assign(p);var f=q7(Y7(X7(h,q7(J7(d),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(Y7(t.accBeta1,t.beta1)),t.accBeta2.assign(Y7(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&G7(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&G7(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedFirstMoment),Ie(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,U7((function(){r.accBeta1.assign(uee(r.beta1,r.iterations_+1)),r.accBeta2.assign(uee(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(aee);var pee=I9({abs_:function(e){var t=k9(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return d9.runKernel(b4,n)}var r={x:t};return d9.runKernel(q3,r)}});function hee(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function dee(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function fee(e,t){for(var n=Math.max(e.length,t.length),r=new Array(n),a=0;a<n;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)r[n-a-1]=o;else if(1===o)r[n-a-1]=i;else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}r[n-a-1]=i}}return r}var mee=I9({maximum_:function(e,t){var n=k9(e,"a","maximum"),r=k9(t,"b","maximum"),a=C(a9(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=z7(n,"int32"),r=z7(r,"int32")),fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(S5,i)}}),vee=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return xe(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],U7((function(){i.iteration=eee(0).variable(),i.accBeta1=eee(r).variable()})),null==o&&(i.epsilon=d9.backend.epsilon()),i}return we(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);U7((function(){var r=cee(1,t.accBeta1),a=X7(-t.learningRate,q7(Y7(t.iteration,t.decay),1));n.forEach((function(n,i){var o=d9.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Z7(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Z7(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=q7(Y7(u,t.beta1),Y7(s,1-t.beta1)),p=Y7(c,t.beta2),h=pee(s),d=mee(p,h);u.assign(l),c.assign(d);var f=q7(Y7(X7(a,r),X7(l,q7(d,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(q7(t.iteration,1)),t.accBeta1.assign(Y7(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&G7(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&G7(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(aee),gee=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return we(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);n.forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=d9.registeredVariables[n];U7((function(){var e=q7(Y7(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=H7(eee(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(aee),yee=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xe(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=eee(a.momentum),a}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=d9.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:U7((function(){return Z7(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&U7((function(){var e,n=q7(Y7(t.m,i),o);e=t.useNesterov?q7(Y7(t.c,q7(o,Y7(n,t.m))),a):q7(Y7(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&G7(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(gee),bee=function(e){ye(n,e);var t=be(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=d9.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return we(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=d9.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:U7((function(){return Z7(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:U7((function(){return Z7(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:U7((function(){return Z7(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;U7((function(){var e=q7(Y7(s,t.decay),Y7(Q7(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=q7(Y7(n,t.decay),Y7(o,1-t.decay)),c=X7(Y7(o,t.learningRate),J7(cee(e,q7(Q7(i),t.epsilon)))),l=q7(Y7(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=cee(a,l);a.assign(p)}else{var h=q7(Y7(s,t.decay),Y7(Q7(o),1-t.decay)),d=q7(Y7(u,t.momentum),X7(Y7(o,t.learningRate),J7(q7(h,t.epsilon))));s.assign(h),u.assign(d);var f=cee(a,d);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&G7(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&G7(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&G7(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Ie(this.accumulatedMeanSquares),Ie(this.accumulatedMoments)),this.centered&&t.push.apply(t,Ie(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(aee),xee=[iee,see,lee,vee,yee,bee,gee];function kee(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var wee=function(){function e(t){if(xe(this,e),!V3().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=E9.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=8;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 8:return a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],i=W9(t,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,s.href=o,e.next=16,kee((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:if(null==t.weightData){e.next=22;break}return(u=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=r,e.next=22,kee((function(){return u.dispatchEvent(new MouseEvent("click"))}));case 22:return e.abrupt("return",{modelArtifactsInfo:H9(t)});case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();wee.URL_SCHEME="downloads://";var Iee=function(){function e(t){if(xe(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return we(e,[{key:"load",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=U9(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=Se(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Ie(o.weights)),a.push.apply(a,Ie(o.paths))}}catch(aGe){i.e(aGe)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,e]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return B9(e.name)})),i={},o=Se(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=B9(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(aGe){o.e(aGe)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function See(e){return new Iee(e)}function Nee(e,t,n,r){!function(e){s3(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){s3(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),s3(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),s3(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Tee(e,t){return Cee.apply(this,arguments)}function Cee(){return(Cee=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?V3().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Nee(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,Nee(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return p=e.t1,e.abrupt("return",p);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Eee(e){return _ee.apply(this,arguments)}function _ee(){return _ee=S(w().mark((function e(t){var n,r,a,i,o=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=Aee((function(e){return Tee(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),_ee.apply(this,arguments)}function Aee(e){return function(){var t=S(w().mark((function t(n){var r,a,i,o,s,u,c,l,p,h,d,f,m=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=C9[r]*l3(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=15,e(p);case 15:return h=t.sent,d={},f=0,l.forEach((function(e){var t=n[e].paths.length,r=new E9(h.slice(f,f+t));o[e].forEach((function(e){var t=F9(r.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),f+=t})),t.abrupt("return",d);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}K9.registerSaveRouter((function(e){return V3().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(wee.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new wee(e)}(e.slice(wee.URL_SCHEME.length)):null}));var Ree=function(){function e(t,n){if(xe(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(s3("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=V3().platform.fetch,s3(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&s3(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=W9(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&(i=E9.join(t.weightData),n.body.append("model.weights.bin",new Blob([i],{type:"application/octet-stream"}),"model.weights.bin")),e.next=10,this.fetch(this.path,n);case 10:if(!(o=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:H9(t),responses:[o]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",U9(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Fee(n),a=C(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=j9(t),c=[],l=[],p=Se(t);try{for(p.s();!(h=p.n()).done;){d=h.value,f=Se(d.paths);try{for(f.s();!(m=f.n()).done;)v=m.value,null!=this.weightUrlConverter?l.push(this.weightUrlConverter(v)):c.push(s+v+o)}catch(aGe){f.e(aGe)}finally{f.f()}}}catch(aGe){p.e(aGe)}finally{p.f()}if(!this.weightUrlConverter){e.next=17;break}return e.t0=c.push,e.t1=c,e.t2=Ie,e.next=14,Promise.all(l);case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 17:return e.next=19,Tee(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 19:return g=e.sent,e.abrupt("return",[u,g]);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Fee(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Dee(e){return null!=e.match(Ree.URL_SCHEME_REGEX)}Ree.URL_SCHEME_REGEX=/^https?:\/\//;var Mee=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Dee(e)})):Dee(e))?Oee(e,t):null};function Oee(e,t){return new Ree(e,t)}function Lee(e,t){return Oee(e,t)}K9.registerSaveRouter(Mee),K9.registerLoadRouter(Mee);var zee=function(){function e(t){xe(this,e),this.modelArtifacts=t}return we(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Pee=function(){function e(t){xe(this,e),this.saveHandler=t}return we(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Bee=we((function e(t){xe(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Wee(e,t,n,r){var a=arguments;return new Bee(Vee.apply(void 0,Ie(a)))}function Vee(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new zee(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zee({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zee({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Uee(e){return new Pee(e)}function Gee(e){return new Pee(e)}var Hee=-2,jee=-1;function qee(e,t,n){var r=e.shape.length;s3(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),s3(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){s3(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Kee(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Xee(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function Yee(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Jee(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Ie(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){s3(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Ie(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(s3(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Qee(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<p.dims;h++)l&&0!==(1<<h&s)&&p.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(Hee),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(jee),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,d);for(var f=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(d.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[d.beginMask&1<<b,d.endMask&1<<b],I=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===d.strides[b];var S=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){var N=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=N,d.end[b]=d.begin[b]+1,N<0||N>=k)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=Zee(d.begin[b],0,d.strides[b],k,w,I),d.end[b]=Zee(d.end[b],1,d.strides[b],k,w,I);var T=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===k;f=f&&T,m=m&&(0===b&&1===d.strides[b]||T)}else f=f&&1===d.strides[b]&&S,m=m&&(0===b&&1===d.strides[b]||S);var C=void 0,E=!1;if(d.beginValid&&d.endValid?(C=d.end[b]-d.begin[b],E=!0):x?(C=1,E=!0):S&&k>=0&&(C=d.strides[b]<0?-k:k,E=!0),E){var _=void 0;_=0===C||C<0!==d.strides[b]<0?0:Math.trunc(C/d.strides[b])+(C%d.strides[b]!==0?1:0),g.push(_)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<d.finalShapeGatherIndices.length;++A){var R=d.finalShapeGatherIndices[A];R>=0?y.push(g[R]):R===Hee&&y.push(1)}var F=y.filter((function(e,t){return d.finalShapeGatherIndices[t]!==Hee}));return{finalShapeSparse:F,finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function Zee(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var $ee=I9({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:k9(e,"x","all","bool")},a={axis:t,keepDims:n};return d9.runKernel(Q3,r,a)}});var ete=I9({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:k9(e,"x","any","bool")},a={axis:t,keepDims:n};return d9.runKernel(Z3,r,a)}});var tte=I9({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:k9(e,"x","argMax")},r={axis:t};return d9.runKernel($3,n,r)}});function nte(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return ite(e,[].concat(Ie(t),[o]),n,i,r,null,null,mte(a))}function rte(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=C(ute(t),2),c=u[0],l=u[1];if("channelsLast"===s)o=[c,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[c,l,e[1],e[1]]}return ite(e,o,n,r,a,i,!1,s)}function ate(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=C(cte(t),3),l=c[0],p=c[1],h=c[2];if("NDHWC"===u)s="channelsLast",o=[l,p,h,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[l,p,h,e[1],e[1]]}return ote(e,o,n,r,a,!1,s,i)}function ite(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var h=C(e,4);u=h[0],c=h[1],l=h[2],p=h[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var d=C(e,4);u=d[0],p=d[1],c=d[2],l=d[3]}var f,m=C(t,4),v=m[0],g=m[1],y=m[3],b=C(ute(n),2),x=b[0],k=b[1],w=C(ute(r),2),I=w[0],S=w[1],N=lte(v,I),T=lte(g,S),E=function(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=ste(e,t,n));var i=e[0],o=e[1],s=pte((i-t+2*r)/n+1,a),u=pte((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=h[0],p=h[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(p-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=pte((t-i+y+b)/r+1,s),p=pte((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,c,l,x,k,N,T,i,s),_=E.padInfo,A=E.outHeight,R=E.outWidth,F=o?y*p:y;return"channelsFirst"===s?f=[u,F,A,R]:"channelsLast"===s&&(f=[u,A,R,F]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:A,outWidth:R,outChannels:F,padInfo:_,strideHeight:x,strideWidth:k,filterHeight:v,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:T,dilationHeight:I,dilationWidth:S,inShape:e,outShape:f,filterShape:t}}function ote(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,p=-1,h=-1;if("channelsLast"===o){var d=C(e,5);u=d[0],c=d[1],l=d[2],p=d[3],h=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var f=C(e,5);u=f[0],h=f[1],c=f[2],l=f[3],p=f[4]}var m,v=C(t,5),g=v[0],y=v[1],b=v[2],x=v[4],k=C(cte(n),3),w=k[0],I=k[1],S=k[2],N=C(cte(r),3),T=N[0],E=N[1],_=N[2],A=lte(g,T),R=lte(y,E),F=lte(b,_),D=function(e,t,n,r,a,i,o,s,u,c,l){var p,h,d,f;"valid"===e&&(e=0);if("number"===typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=ste(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=pte((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);h=m[0],d=m[1],f=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((h=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,I=Math.floor(y/2);p={top:k,bottom:w,left:I,right:y-I,front:b,back:x,type:"SAME"}}return{padInfo:p,outDepth:h,outHeight:d,outWidth:f}}(a,c,l,p,w,I,S,A,R,F,s),M=D.padInfo,O=D.outDepth,L=D.outHeight,z=D.outWidth,P=i?x*h:x;return"channelsFirst"===o?m=[u,P,O,L,z]:"channelsLast"===o&&(m=[u,O,L,z,P]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:p,inChannels:h,outDepth:O,outHeight:L,outWidth:z,outChannels:P,padInfo:M,strideDepth:w,strideHeight:I,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:F,dilationDepth:T,dilationHeight:E,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function ste(e,t,n){var r=lte(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function ute(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function cte(e){return"number"===typeof e?[e,e,e]:e}function lte(e,t){return t<=1?e:e+(e-1)*(t-1)}function pte(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function hte(e){var t=C(ute(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function dte(e,t){return hte(e)||hte(t)}function fte(e){return ute(e).every((function(e){return e>0}))}function mte(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function vte(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)s3(h3(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){s3(h3(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}var gte=I9({reshape_:function(e,t){var n={x:k9(e,"x","reshape","string_or_numeric")},r={shape:t};return d9.runKernel(n6,n,r)}});var yte=I9({avgPool_:function(e,t,n,r,a){var i=k9(e,"x","avgPool","float32");s3(dte(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=gte(i,[1,i.shape[0],i.shape[1],i.shape[2]])),s3(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),vte("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=d9.runKernel(o4,u,c);return l=z7(l,i.dtype),s?gte(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var bte=I9({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=k9(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=gte(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),s3(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),s3("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),s3("number"===typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),vte("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=d9.runKernel(u4,c,l);return p=z7(p,s.dtype),u?gte(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var xte=I9({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=k9(e,"x","batchNorm"),c=k9(t,"mean","batchNorm"),l=k9(n,"variance","batchNorm");null!=a&&(o=k9(a,"scale","batchNorm")),null!=r&&(s=k9(r,"offset","batchNorm")),s3(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),s3(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),s3(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p=function(e){return 0===e.rank||1===e.rank?gte(e,[1,1,1,e.size]):2===e.rank?gte(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?gte(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),h={x:p,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},f=d9.runKernel(t5,h,d);return gte(f,u.shape)}});var kte=I9({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=k9(e,"x","batchNorm"),c=k9(t,"mean","batchNorm"),l=k9(n,"variance","batchNorm");return null!=a&&(o=k9(a,"scale","batchNorm")),null!=r&&(s=k9(r,"offset","batchNorm")),s3(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),s3(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),s3(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&s3(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&s3(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),xte(u,c,l,s,o,i)}});var wte=I9({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=k9(e,"x","batchNorm"),c=k9(t,"mean","batchNorm"),l=k9(n,"variance","batchNorm");return null!=a&&(o=k9(a,"scale","batchNorm")),null!=r&&(s=k9(r,"offset","batchNorm")),s3(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),s3(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),s3(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&s3(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&s3(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),xte(u,c,l,s,o,i)}});var Ite=I9({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=k9(e,"x","batchNorm"),c=k9(t,"mean","batchNorm"),l=k9(n,"variance","batchNorm");return null!=a&&(o=k9(a,"scale","batchNorm")),null!=r&&(s=k9(r,"offset","batchNorm")),s3(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),s3(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),s3(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&s3(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&s3(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),xte(u,c,l,s,o,i)}});var Ste=I9({broadcastTo_:function(e,t){var n=k9(e,"broadcastTo","x"),r=n.shape;if(M3(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=gte(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return P7(n);var c={x:n},l={reps:o};return d9.runKernel(U6,c,l)}});var Nte=I9({clipByValue_:function(e,t,n){var r=k9(e,"x","clipByValue");if(s3(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")})),t===n)return oee(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return d9.runKernel(g4,a,i)}});var Tte=I9({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;s3(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=w9(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return P7(n[0]);var r=n,a={axis:t};return d9.runKernel(x4,r,a)}});var Cte=I9({concat1d_:function(e){return Tte(e,0)}});var Ete=I9({concat2d_:function(e,t){return Tte(e,t)}});var _te=I9({concat3d_:function(e,t){return Tte(e,t)}});var Ate=I9({concat4d_:function(e,t){return Tte(e,t)}});var Rte=I9({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=k9(e,"x","conv2d","float32"),u=k9(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=gte(s,[1,s.shape[0],s.shape[1],s.shape[2]])),s3(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),s3(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),vte("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];s3(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),s3(dte(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),s3(fte(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),s3(fte(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=d9.runKernel(k4,h,d);return l?gte(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Fte=I9({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=k9(e,"x","conv1d"),u=k9(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=gte(s,[1,s.shape[0],s.shape[1]])),s3(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),s3(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),vte("conv1d",r,o),s3(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),s3(dte(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),s3(fte(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),s3(fte(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),s3("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=gte(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=gte(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=Rte(h,p,[1,n],r,"NHWC",[1,i],o);return gte(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});var Dte=I9({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;s3(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=gte(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),s3(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),s3(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),s3(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];s3(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),s3(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),vte("conv2dDerInput",a,o);var h={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=d9.runKernel(I4,h,d);return c?gte(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Mte=I9({conv2dTranspose_:function(e,t,n,r,a,i){var o=k9(e,"x","conv2dTranspose"),s=k9(t,"filter","conv2dTranspose");return Dte(n,o,s,r,a,"NHWC",i)}});var Ote=I9({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=k9(e,"x","conv3d"),s=k9(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=gte(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),s3(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),s3(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),s3(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),s3(dte(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),s3("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),s3(fte(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),s3(fte(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},h=d9.runKernel(S4,l,p);return c?gte(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Lte=I9({conv3DBackpropInput_:function(e,t,n,r,a){s3(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=gte(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];s3(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),s3(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),s3(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),s3(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),s3(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},h=d9.runKernel(T4,l,p);return s?gte(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var zte=I9({conv3dTranspose_:function(e,t,n,r,a){var i=k9(e,"x","conv3dTranspose"),o=k9(t,"filter","conv3dTranspose");return Lte(n,i,o,r,a)}});var Pte=I9({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=k9(e,"x","denseBincount"),i=k9(t,"weights","denseBincount");s3("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),s3(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),s3(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),s3(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return d9.runKernel(F4,o,s)}});var Bte=I9({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=k9(e,"x","depthwiseConv2d","float32"),u=k9(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=gte(s,[1,s.shape[0],s.shape[1],s.shape[2]])),s3(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),s3(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];s3(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(p,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),vte("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=d9.runKernel(M4,h,d);return l?gte(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Wte=I9({elu_:function(e){var t={x:k9(e,"x","elu","float32")};return d9.runKernel(G4,t)}});var Vte=I9({equal_:function(e,t){var n=k9(e,"a","equal","string_or_numeric"),r=k9(t,"b","equal","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(q4,i)}});var Ute=I9({exp_:function(e){var t={x:k9(e,"x","exp")};return d9.runKernel(K4,t)}});var Gte=I9({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=k9(e,"x","expandDims","string_or_numeric");s3(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return d9.runKernel(X4,r,a)}});var Hte=I9({tile_:function(e,t){var n=k9(e,"x","tile","string_or_numeric");s3(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return d9.runKernel(U6,r,a)}});var jte=I9({eye_:function(e,t,n){null==t&&(t=e);for(var r=L7([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=gte(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return Hte(Gte(o,0),[n[0],1,1]);if(2===n.length)return Hte(Gte(Gte(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return Hte(Gte(Gte(Gte(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var qte=I9({floor_:function(e){var t={x:k9(e,"x","floor","float32")};return d9.runKernel($4,t)}});var Kte=I9({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:k9(e,"x","gather"),indices:k9(t,"indices","gather","int32")},i={axis:n,batchDims:r};return d9.runKernel(n5,a,i)}});var Xte=I9({greater_:function(e,t){var n=k9(e,"a","greater","string_or_numeric"),r=k9(t,"b","greater","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(a5,i)}});var Yte=I9({greaterEqual_:function(e,t){var n=k9(e,"a","greaterEqual","string_or_numeric"),r=k9(t,"b","greaterEqual","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(i5,i)}});var Jte=I9({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:k9(e,"x","leakyRelu")},r={alpha:t};return d9.runKernel(h5,n,r)}});var Qte=I9({log_:function(e){var t={x:k9(e,"x","log","float32")};return d9.runKernel(v5,t)}});var Zte=I9({log1p_:function(e){var t={x:k9(e,"x","log1p")};return d9.runKernel(g5,t)}});var $te=I9({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:k9(e,"x","max")},a={reductionIndices:t,keepDims:n};return d9.runKernel(I5,r,a)}});var ene=I9({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=k9(e,"x","sum");"bool"===r.dtype&&(r=z7(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return d9.runKernel(I6,a,i)}});var tne=I9({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=k9(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=$7((function(e,n){var r=$te(e,t,!0),a=cee(e,r),i=cee(z7(a,"float32"),Qte(ene(Ute(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=C(n,1)[0],a=Ute(r);return cee(e,Y7(ene(e,t,!0),a))}}}));return r(n)}});var nne=I9({logicalAnd_:function(e,t){var n=k9(e,"a","logicalAnd","bool"),r=k9(t,"b","logicalAnd","bool");fee(n.shape,r.shape);var a={a:n,b:r};return d9.runKernel(y5,a)}});var rne=I9({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=k9(e,"a","matMul"),i=k9(t,"b","matMul"),o=C(a9(a,i),2),s={a:a=o[0],b:i=o[1]},u={transposeA:n,transposeB:r};return d9.runKernel(l4,s,u)}});var ane=I9({maxPool_:function(e,t,n,r,a){var i=k9(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=gte(i,[1,i.shape[0],i.shape[1],i.shape[2]])),s3(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),s3(dte(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),vte("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=d9.runKernel(N5,u,c);return s?gte(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var ine=I9({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=k9(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=gte(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),s3(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),s3("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),vte("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=d9.runKernel(C5,c,l);return u?gte(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var one=I9({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:k9(e,"x","mean")},a={axis:t,keepDims:n};return d9.runKernel(A5,r,a)}});var sne=I9({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:k9(e,"x","min")},a={axis:t,keepDims:n};return d9.runKernel(R5,r,a)}});var une=I9({minimum_:function(e,t){var n=k9(e,"a","minimum"),r=k9(t,"b","minimum"),a=C(a9(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=z7(n,"int32"),r=z7(r,"int32")),fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(F5,i)}});function cne(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function lne(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function pne(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function hne(e,t,n){s3(cne(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function dne(e,t){if(cne(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function fne(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function mne(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var vne=I9({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=g3(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=k9(e,"x","moments")).shape),r=one(e,n,t),a=r.shape;t||(a=pne(r.shape,n));var i=Q7(cee(z7(e,"float32"),gte(r,a)));return{mean:r,variance:one(i,n,t)}}});var gne=I9({neg_:function(e){var t={x:k9(e,"x","neg")};return d9.runKernel(z5,t)}});var yne=I9({notEqual_:function(e,t){var n=k9(e,"a","notEqual","string_or_numeric"),r=k9(t,"b","notEqual","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(P5,i)}});var bne=I9({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:k9(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return d9.runKernel(G5,i,o)}});function xne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(M3(e),"complex64"===t){var n=xne(e,"float32"),r=xne(e,"float32");return S9(n,r)}var a=F3(l3(e),t);return d9.makeTensor(a,e,t)}function kne(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(M3(e),"complex64"===t){var n=kne(e,"float32"),r=xne(e,"float32");return S9(n,r)}var a=R3(l3(e),t);return d9.makeTensor(a,e,t)}var wne=I9({onesLike_:function(e){var t={x:k9(e,"x","onesLike")};return d9.runKernel(U5,t)}});var Ine=I9({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=k9(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return d9.runKernel(j5,i,a)}});var Sne=I9({prelu_:function(e,t){var n={x:k9(e,"x","prelu"),alpha:k9(t,"alpha","prelu")};return d9.runKernel(K5,n)}}),Nne=n(699),Tne=function(){function e(t,n,r,a,i){xe(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Nne.alea(o.toString())}return we(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Cne=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(xe(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Nne.alea(i)}return we(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Ene=I9({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(M3(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new Tne(t,n,r,!1,a),o=L7(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var _ne=I9({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;M3(e);for(var i=L7(e,r),o=new Cne(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function Ane(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return d9.runKernel(Z5,{},a)}var Rne=I9({relu_:function(e){var t={x:k9(e,"x","relu")};return d9.runKernel(t6,t)}});var Fne=I9({reverse_:function(e,t){var n={x:k9(e,"x","reverse")},r={dims:t};return d9.runKernel(u6,n,r)}});var Dne=I9({selu_:function(e){var t={x:k9(e,"x","selu")};return d9.runKernel(m6,t)}});var Mne=I9({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=k9(e,"x","separableConv2d"),u=k9(t,"depthwiseFilter","separableConv2d"),c=k9(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=gte(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");s3(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),s3(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),s3(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),s3(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),s3(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var h=u.shape[2],d=u.shape[3];s3(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")}));var f=Bte(l,u,r,a,o,i),m=Rte(f,c,1,"valid",o);return p?gte(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});var One=I9({sigmoid_:function(e){var t={x:k9(e,"x","sigmoid","float32")};return d9.runKernel(x6,t)}});var Lne=I9({slice_:function(e,t,n){var r=k9(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return d9.runKernel(v6,a,i)}});var zne=I9({slice1d_:function(e,t,n){var r=k9(e,"x","slice1d");return s3(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Lne(r,[t],[n])}});var Pne=I9({slice2d_:function(e,t,n){var r=k9(e,"x","slice2d");return s3(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Lne(r,t,n)}});var Bne=I9({slice3d_:function(e,t,n){var r=k9(e,"x","slice3d");return s3(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Lne(r,t,n)}});var Wne=I9({slice4d_:function(e,t,n){var r=k9(e,"x","slice4d");return s3(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Lne(r,t,n)}});var Vne=I9({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=k9(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return d9.runKernel(T6,r,a)}});var Une=I9({softplus_:function(e){var t={x:k9(e,"x","softplus")};return d9.runKernel(k6,t)}});var Gne=I9({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:k9(e,"x","split")},a={numOrSizeSplits:t,axis:n};return d9.runKernel(N6,r,a)}});var Hne=I9({squeeze_:function(e,t){var n=k9(e,"x","squeeze","string_or_numeric");return gte(n,y3(n.shape,t).newShape)}});var jne=I9({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=w9(e,"tensors","stack","string_or_numeric");s3(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&s3(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return d9.runKernel(H5,r,a)}});var qne=I9({tanh_:function(e){var t={x:k9(e,"x","tanh","float32")};return d9.runKernel(V6,t)}});function Kne(e,t){c3(e);var n=y9(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return N9(e,null,n,t)}var Xne=I9({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(M3(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Tne(t,n,r,!0,a),o=L7(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Yne=I9({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=k9(e,"x","unstack","string_or_numeric");s3(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return d9.runKernel(K6,r,a)}});var Jne=I9({where_:function(e,t,n){var r=k9(t,"a","where"),a=k9(n,"b","where"),i=k9(e,"condition","where","bool"),o=fee(fee(i.shape,r.shape),a.shape),s={condition:Ste(i,o),t:Ste(r,o),e:Ste(a,o)};return d9.runKernel(f6,s)}});var Qne=I9({imag_:function(e){var t={input:k9(e,"input","imag")};return d9.runKernel(u5,t)}});var Zne=I9({real_:function(e){var t={input:k9(e,"input","real")};return d9.runKernel($5,t)}});var $ne=I9({transpose_:function(e,t,n){var r=k9(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),s3(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){s3(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?U7((function(){var e=Zne(r),t=Qne(r);return e=d9.runKernel(j6,{x:e},i),t=d9.runKernel(j6,{x:t},i),n&&(t=gne(t)),S9(e,t)})):d9.runKernel(j6,a,i)}});var ere=I9({dropout_:function(e,t,n,r){var a=k9(e,"x","dropout");if(s3("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),s3(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof j8?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(p3(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=X7(qte(q7(_ne(i,0,1,"float32",r),o)),o);return Y7(a,s)}});var tre=I9({fft_:function(e){s3("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return d9.runKernel(J4,t)}});var nre=I9({rfft_:function(e,t){s3("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Lne(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Tte([e,xne(s)],e.shape.length-1),r=t}else n=e;var u=Z7(n),c=gte(S9(n,u),[a,r]),l=tre(c),p=Math.floor(r/2)+1,h=Zne(l),d=Qne(l),f=Gne(h,[p,r-p],h.shape.length-1),m=Gne(d,[p,r-p],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,gte(S9(f[0],m[0]),v)}});var rre=I9({ifft_:function(e){s3("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return d9.runKernel(s5,t)}});var are=I9({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=gte(e,[r,n]);t=rre(a)}else{var i=[r,2*(n-1)],o=gte(Zne(e),[r,n]),s=gte(Qne(e),[r,n]),u=Fne(Lne(o,[0,1],[r,n-2]),1),c=Y7(Fne(Lne(s,[0,1],[r,n-2]),1),eee(-1)),l=Tte([o,u],1),p=Tte([s,c],1),h=gte(S9(l,p),[i[0],i[1]]);t=rre(h)}if(t=Zne(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=gte(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}});var ire=I9({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=gte(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=gte(t,[1,t.shape[0],t.shape[1],t.shape[2]])),s3(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),s3(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),s3(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];s3(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),s3(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),vte("conv2dDerFilter",a,o);var p={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return d9.runKernel(w4,p,h)}});var ore=I9({relu6_:function(e){var t={x:k9(e,"x","relu6")};return d9.runKernel(s6,t)}});var sre=I9({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:k9(e,"x","step")},r={alpha:t};return d9.runKernel(J6,n,r)}});function ure(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Y7(e,sre(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function cre(e,t){var n=t,r=dee(e.shape,t.shape);return r.length>0&&(n=ene(n,r)),gte(n,e.shape)}function lre(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Rne(e);if("elu"===t)return Wte(e);if("relu6"===t)return ore(e);if("prelu"===t)return Sne(e,n);if("leakyrelu"===t)return Jte(e,r);if("sigmoid"===t)return One(e);throw new Error("Unknown fused activation ".concat(t,"."))}var pre=function(e,t){return!(e>0)||"linear"===t};var hre=I9({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,p=e.activation,h=void 0===p?"linear":p,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(h=h||"linear",!1===pre(d9.state.gradientDepth,h)){s3("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var m=Rte(t,n,r,a,o,u,c);return null!=l&&(m=q7(m,l)),lre(m,h,d,f)}var v=k9(t,"x","conv2d","float32"),g=k9(n,"filter","conv2d","float32"),y=v,b=!1;3===v.rank&&(b=!0,y=gte(v,[1,v.shape[0],v.shape[1],v.shape[2]])),s3(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),s3(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),vte("fused conv2d",a,c);var x="NHWC"===o?y.shape[3]:y.shape[1];s3(g.shape[2]===x,(function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(g.shape[2],".")})),s3(dte(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")}));var k,w,I=ite(y.shape,g.shape,r,u,a,c);if(null!=l){var S=C(a9(k=k9(l,"bias","fused conv2d"),v),1);k=S[0],"NHWC"===o?fee(I.outShape,k.shape):(s3(k.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(k.shape.length,".")})),s3(0===k.shape.length||k.shape[0]===I.outChannels||1===k.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(k.shape,") is not ")+"compatible with the number of output channels "+"(".concat(I.outChannels,")")})))}if(null!=d){var N=d.shape;if(s3(N.length<=1||3===N.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(N.length,".")})),1===N.length)s3(1===N[0]||N[0]===I.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(N,") is not compatible with the number of output ")+"channels (".concat(I.outChannels,").")}));else if(3===N.length)try{fee(N,I.outShape)}catch(rGe){var T="Error in fused conv2d: PReLU activation weights (".concat(N,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(I.outShape,").");throw Error(T)}w=k9(d,"prelu weights","fused conv2d")}var E=function(e,t){s3("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=C(t,4),i=n[0],s=n[1],c=n[2],l=n[3],p=ure(e,c,h);s3(hte(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var d=[Dte(s.shape,p,i,r,a),ire(s,p,i.shape,r,a)];if(null!=l){var f=cre(l,p);d.push(f)}return d},_={x:y,filter:g,bias:k,preluActivationWeights:w},A={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:h,leakyreluAlpha:f};if(null==l){var R=$7((function(e,t,n){var r=d9.runKernel($6,_,A);return n([t,e,r]),b&&(r=gte(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:E}}));return R(y,g)}var F=$7((function(e,t,n,r){var a=d9.runKernel($6,_,A);return r([t,e,a,n]),b&&(a=gte(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:E}}));return F(y,g,k)}});var dre=I9({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=gte(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=gte(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return d9.runKernel(O4,c,l)}});var fre=I9({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=gte(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=d9.runKernel(L4,c,l);return u?gte(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var mre=I9({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,p=e.leakyreluAlpha,h=void 0===p?.2:p;if(!1===pre(d9.state.gradientDepth,c)){var d=rne(t,n,a,o);return null!=s&&(d=q7(d,s)),lre(d,c,l,h)}var f=k9(t,"a","fused matMul"),m=k9(n,"b","fused matMul"),v=C(a9(f,m),2);f=v[0],m=v[1];var g=a?f.shape[f.rank-2]:f.shape[f.rank-1],y=o?m.shape[m.rank-1]:m.shape[m.rank-2],b=a?f.shape[f.rank-1]:f.shape[f.rank-2],x=o?m.shape[m.rank-2]:m.shape[m.rank-1],k=f.shape.slice(0,-2),w=m.shape.slice(0,-2),I=l3(k),S=l3(w);s3(g===y,(function(){return"Error in fused matMul: inner shapes (".concat(g,") and (")+"".concat(y,") of Tensors with shapes ").concat(f.shape," and ")+"".concat(m.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var N,T,E=fee(f.shape.slice(0,-2),m.shape.slice(0,-2)).concat([b,x]),_=gte(f,a?[I,g,b]:[I,b,g]),A=gte(m,o?[S,x,y]:[S,y,x]);null!=s&&(N=C(a9(N=k9(s,"bias","fused matMul"),f),1)[0],fee(E,N.shape)),null!=l&&(T=k9(l,"prelu weights","fused matMul"));var R=function(e,t){var n,r,i=C(t,4),u=i[0],l=i[1],p=i[2],h=i[3],d=ure(gte(e,p.shape),p,c);return a||o?!a&&o?(n=rne(d,l,!1,!1),r=rne(d,u,!0,!1)):a&&!o?(n=rne(l,d,!1,!0),r=rne(u,d,!1,!1)):(n=rne(l,d,!0,!0),r=rne(d,u,!0,!0)):(n=rne(d,l,!1,!0),r=rne(u,d,!0,!1)),null!=s?[n,r,cre(h,d)]:[n,r]},F={a:_,b:A,bias:N,preluActivationWeights:T},D={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:h};if(null==s){var M=$7((function(e,t,n){var r=d9.runKernel(Z6,F,D);return n([e,t,r]),{value:gte(r,E),gradFunc:R}}));return M(_,A)}var O=$7((function(e,t,n,r){var a=d9.runKernel(Z6,F,D);return r([e,t,a,n]),{value:gte(a,E),gradFunc:R}}));return O(_,A,N)}});function vre(e,t,n){if(c3(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=y9(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return N9(e,t,r,n)}var gre=I9({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=k9(e,"image","cropAndResize"),s=k9(t,"boxes","cropAndResize","float32"),u=k9(n,"boxInd","cropAndResize","int32"),c=s.shape[0];s3(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),s3(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),s3(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),s3(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),s3(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),s3("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return d9.runKernel(R4,l,p)}});var yre=I9({flipLeftRight_:function(e){var t=k9(e,"image","flipLeftRight","float32");s3(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return d9.runKernel(Z4,n,{})}});var bre=I9({grayscaleToRGB_:function(e){var t=k9(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];s3(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),s3(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Hte(t,a)}});var xre=I9({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=k9(e,"image","rotateWithOffset","float32");s3(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return d9.runKernel(Q6,i,o)}});function kre(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),s3(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),s3(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),s3(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),s3(1===t.rank,(function(){return"scores must be a 1D tensor"})),s3(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),s3(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var wre=I9({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=k9(e,"boxes","nonMaxSuppression","float32"),o=k9(t,"scores","nonMaxSuppression","float32"),s=kre(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return d9.runKernel(B5,{boxes:i,scores:o},u)}});function Ire(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Sre)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Sre(e,t){return e>t?1:e<t?-1:0}function Nre(e,t,n,r,a){return Ere(e,t,n,r,a,0)}function Tre(e,t,n,r,a,i){return Ere(e,t,n,r,a,0,!1,i,!0)}function Cre(e,t,n,r,a,i){return Ere(e,t,n,r,a,i,!0)}function Ere(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Rre);for(var p=i>0?-.5/i:0,h=[],d=[];h.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var x=_re(e,v,h[b]);if(x>=r){y=!0;break}if(f.score=f.score*Are(r,p,x),f.score<=a)break}f.suppressBeginIndex=h.length,y||(f.score===m?(h.push(v),d.push(f.score)):f.score>a&&Ire(c,f,Rre))}var k=h.length,w=n-k;s&&w>0&&(h.push.apply(h,Ie(new Array(w).fill(0))),d.push.apply(d,Ie(new Array(w).fill(0))));var I={selectedIndices:h};return o&&(I.selectedScores=d),u&&(I.validOutputs=k),I}function _re(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(p-c)*(h-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function Are(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Rre(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function Fre(){return Fre=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=k9(t,"boxes","nonMaxSuppressionAsync"),s=k9(n,"scores","nonMaxSuppressionAsync"),u=kre(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,l=c[0],p=c[1],h=Nre(l,p,r,a,i),d=h.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",Kne(d,"int32"));case 17:case"end":return e.stop()}}),e)}))),Fre.apply(this,arguments)}var Dre=function(e,t,n){return Fre.apply(this,arguments)};var Mre=I9({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=k9(e,"boxes","nonMaxSuppression"),s=k9(t,"scores","nonMaxSuppression"),u=kre(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=d9.runKernel(V5,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function Ore(){return Ore=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=k9(t,"boxes","nonMaxSuppressionAsync"),u=k9(n,"scores","nonMaxSuppressionAsync"),c=kre(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return l=e.sent,p=l[0],h=l[1],d=Cre(p,h,r,a,i,o),f=d.selectedIndices,m=d.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Kne(f,"int32"),selectedScores:Kne(m)});case 19:case"end":return e.stop()}}),e)}))),Ore.apply(this,arguments)}var Lre=function(e,t,n){return Ore.apply(this,arguments)};var zre=I9({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=k9(e,"boxes","nonMaxSuppression"),s=k9(t,"scores","nonMaxSuppression"),u=kre(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},p=d9.runKernel(W5,c,l);return{selectedIndices:p[0],validOutputs:p[1]}}});function Pre(){return Pre=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],s=k9(t,"boxes","nonMaxSuppressionAsync"),u=k9(n,"scores","nonMaxSuppressionAsync"),c=kre(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,h=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,f=C(d,2),m=f[0],v=f[1],g=Tre(m,v,l,p,h,o),y=g.selectedIndices,b=g.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:Kne(y,"int32"),validOutputs:eee(b,"int32")});case 19:case"end":return e.stop()}}),e)}))),Pre.apply(this,arguments)}var Bre=function(e,t,n){return Pre.apply(this,arguments)};var Wre=I9({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=k9(e,"images","resizeBilinear");s3(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),s3(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),s3(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=gte(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=d9.runKernel(i6,s,u);return o?gte(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Vre=I9({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=k9(e,"images","resizeNearestNeighbor");s3(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),s3(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),s3("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),s3(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=gte(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=d9.runKernel(r6,s,u);return o?gte(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Ure=I9({bincount_:function(e,t,n){var r=k9(e,"x","bincount"),a=k9(t,"weights","bincount");s3("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),s3(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),s3(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return d9.runKernel(h4,i,o)}});var Gre=I9({lessEqual_:function(e,t){var n=k9(e,"a","lessEqual","string_or_numeric"),r=k9(t,"b","lessEqual","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(f5,i)}});var Hre=I9({round_:function(e){var t={x:k9(e,"x","round")};return d9.runKernel(c6,t)}});var jre=I9({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=k9(e,"image","threshold"),c=u.shape[0]*u.shape[1],l=Y7(Kne([s]),255);if(s3(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),s3(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),s3("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),s3("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var p=C(Gne(u,[1,1,1],-1),3);t=p[0],n=p[1],r=p[2];var h=Y7(t,.2989),d=Y7(n,.587),f=Y7(r,.114);a=q7(q7(h,d),f)}else a=e;"otsu"===i&&(l=function(e,t){for(var n,r,a,i,o,s,u=Kne([-1]),c=Kne([0]),l=Kne([0]),p=0;p<e.size-1;p++){n=Lne(e,0,p+1),r=Lne(e,p+1),o=X7(ene(n),t),s=X7(ene(r),t);var h=ene(Y7(n,Ane(0,n.size)));a=X7(h,ene(n));var d=oee(r.shape,n.size),f=q7(Ane(0,r.size),d),m=Y7(r,f);i=X7(ene(m),ene(r));var v=cee(a,i),g=cee(a,i),y=Y7(o,s);l=Y7(Y7(y,v),g);var b=Xte(l,c);c=Jne(b,l,c),u=Jne(b,Kne([p]),u)}return u}(Ure(z7(Hre(a),"int32"),T9([]),256),c));var m=o?Gre(a,l):Xte(a,l);return z7(Y7(m,255),"int32")}});var qre=I9({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=k9(e,"image","transform","float32"),s=k9(t,"transforms","transform","float32");s3(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),s3(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),s3(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return d9.runKernel(H6,u,c)}});var Kre=I9({less_:function(e,t){var n=k9(e,"a","less","string_or_numeric"),r=k9(t,"b","less","string_or_numeric"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(d5,i)}});var Xre=I9({bandPart_:function(e,t,n){var r=k9(e,"a","bandPart");s3(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a,i,o=r.shape,s=C(r.shape.slice(-2),2),u=s[0],c=s[1];"number"===typeof t?(s3(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),s3(t<=u,(function(){return"bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(u,").")})),a=k9(t<0?u:t,"numLower","bandPart")):(s3("int32"===t.dtype,(function(){return"bandPart(): numLower's dtype must be an int32."})),a=Jne(Kre(t,0),u,une(t,u))),"number"===typeof n?(s3(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")})),s3(n<=c,(function(){return"bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(c,").")})),i=k9(n<0?c:n,"numUpper","bandPart")):(s3("int32"===n.dtype,(function(){return"bandPart(): numUpper's dtype must be an int32."})),i=Jne(Kre(n,0),c,une(n,c)));var l=gte(Ane(0,u,1,"int32"),[-1,1]),p=Ane(0,c,1,"int32"),h=cee(l,p),d=nne(Gre(h,a),Yte(h,gne(i))),f=xne([u,c],r.dtype);return gte(jne(Yne(gte(r,[-1,u,c])).map((function(e){return Jne(d,e,f)}))),o)}});function Yre(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return pee(e);if(1!==e.rank&&null===n)return Yre(gte(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return ene(pee(e),n);if(t===1/0)return $te(pee(e),n);if(t===-1/0)return sne(pee(e),n);if("euclidean"===t||2===t)return J7(ene(uee(pee(e),eee(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return $te(ene(pee(e),n[0]),n[1]-1);if(t===1/0)return $te(ene(pee(e),n[1]),n[0]);if(t===-1/0)return sne(ene(pee(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return J7(ene(Q7(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Jre=I9({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Yre(e=k9(e,"x","norm"),t,n),i=a.shape;if(r){var o=g3(n,e.shape);i=pne(a.shape,o)}return gte(a,i)}});var Qre=I9({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,s3(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){s3(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=Gne(e,e.shape[0],0).map((function(e){return Hne(e,[0])}));s3(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(d9.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Y7(ene(Y7(i[n],t)),i[n]);t=cee(t,r)}return X7(t,Jre(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?jne(i,0):i}});function Zre(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return d9.tidy((function(){s3(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=jte(n),i=P7(e),o=vre([[1]],[1,1]),s=P7(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=d9.tidy((function(){var t=Lne(i,[e,e],[n-e,1]),u=Jre(t),c=Lne(i,[e,e],[1,1]),l=Jne(Xte(c,0),vre([[-1]]),vre([[1]])),p=cee(c,Y7(l,u)),h=X7(t,p);s=1===h.shape[0]?P7(o):Tte([o,Lne(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);var d=gne(X7(rne(l,p),u)),f=Lne(i,[e,0],[n-e,r]),m=Y7(d,s),v=$ne(s);if(0===e)i=cee(f,rne(m,rne(v,f)));else{var g=cee(f,rne(m,rne(v,f)));i=Tte([Lne(i,[0,0],[e,r]),g],0)}var y=$ne(m),b=Lne(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=cee(b,rne(rne(b,s),y));else{var x=cee(b,rne(rne(b,s),y));a=Tte([Lne(a,[0,0],[n,e]),x],1)}return[s,i,a]})),p=C(l,3);s=p[0],i=p[1],a=p[2],G7([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Lne(a,[0,0],[n,r]),i=Lne(i,[0,0],[r,r])),[a,i]}))}var $re,eae=I9({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s3(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return Zre(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Yne(gte(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=C(Zre(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[gte(jne(a,0),e.shape),gte(jne(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}($re||($re={}));var tae=I9({squaredDifference_:function(e,t){var n=k9(e,"a","squaredDifference"),r=k9(t,"b","squaredDifference"),a=C(a9(n,r),2);n=a[0],r=a[1],fee(n.shape,r.shape);var i={a:n,b:r};return d9.runKernel(F6,i,{})}});var nae=I9({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=k9(e,"x","logSumExp"),a=g3(t,r.shape),i=$te(r,a,!0),o=cee(r,i),s=Ute(o),u=ene(s,a),c=Qte(u),l=q7(gte(i,c.shape),c);if(n){var p=pne(l.shape,a);return gte(l,p)}return l}});var rae,aae={flipLeftRight:yre,grayscaleToRGB:bre,resizeNearestNeighbor:Vre,resizeBilinear:Wre,rotateWithOffset:xre,cropAndResize:gre,nonMaxSuppression:wre,nonMaxSuppressionAsync:Dre,nonMaxSuppressionWithScore:Mre,nonMaxSuppressionWithScoreAsync:Lre,nonMaxSuppressionPadded:zre,nonMaxSuppressionPaddedAsync:Bre,threshold:jre,transform:qre},iae={bandPart:Xre,gramSchmidt:Qre,qr:eae},oae=function(){function e(){xe(this,e)}return we(e,null,[{key:"sgd",value:function(e){return new gee(e)}},{key:"momentum",value:function(e,t){return new yee(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new bee(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new lee(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new iee(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new vee(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new see(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),sae=oae,uae="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function cae(){return new Promise((function(e){return uae((function(){return e()}))}))}function lae(e,t){var n=e[0].length;e.forEach((function(e,t){s3(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),s3(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)s3(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function pae(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(rae||(rae={}));var hae=30;function dae(e){return e<=hae?e:C3(e,Math.floor(Math.sqrt(e)))}function fae(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function mae(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function vae(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function gae(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function yae(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function bae(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function xae(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===l3(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var h=[].concat(Ie(E3(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,h]}function kae(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:l3(t.shape)/u,sliceSize:o,strides:[].concat(Ie(E3(n.slice(0,a))),[1]),outputSize:l3(n)}}var wae=1.7580993408473768,Iae=1.0507009873554805,Sae=.3275911,Nae=.254829592,Tae=-.284496736,Cae=1.421413741,Eae=-1.453152027,_ae=1.061405429;function Aae(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Rae(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Fae(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Dae(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var Mae="->",Oae=/->/g,Lae=",",zae="...";function Pae(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(Oae,"").length)/Mae.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(Mae,'").'));var r=C(e.split(Mae),2),a=r[0],i=r[1];s3(-1===a.indexOf(zae),(function(){return'The ellipsis notation ("'.concat(zae,'") is not supported yet.')}));var o=a.split(Lae),s=o.length;if(t!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(t));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(){var e=i[l];if(!o.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," ")+"not present in the input subscripts.");-1===u.indexOf(e)&&u.push(e)},l=0;l<i.length;++l)c();for(var p=0;p<a.length;++p){var h=a[p];-1===u.indexOf(h)&&h!==Lae&&u.push(h)}for(var d=new Array(o.length),f=0;f<s;++f){if(new Set(o[f].split("")).size!==o[f].length)throw new Error("Found duplicate axes in input component ".concat(o[f],". ")+"Support for duplicate axes in input is not implemented yet.");d[f]=[];for(var m=0;m<o[f].length;++m)d[f].push(u.indexOf(o[f][m]))}for(var v=u.length,g=[],y=i.length;y<v;++y)g.push(y);return{allDims:u,summedDims:g,idDims:d}}function Bae(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function Wae(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:s3(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function Vae(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=Se(Gae(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch(aGe){c.e(aGe)}finally{c.f()}}return{path:r,steps:a}}function Uae(e){return e.every((function(e,t){return e===t}))}function Gae(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function Hae(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)s3(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);s3(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}s3(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function jae(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function qae(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function Kae(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function Xae(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,h=0;h<r;++h)u.push(e.shape[h]),c*=e.shape[h];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function Yae(e){try{return e.map((function(e){return _8(e)}))}catch(aGe){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(aGe))}}function Jae(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=L7(e,"int32"),i=L7([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}!function(){var e,t=Se(xee);try{for(t.s();!(e=t.n()).done;){ree(e.value)}}catch(aGe){t.e(aGe)}finally{t.f()}}();var Qae={kernelName:q3,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,sre(z7(n,"float32"),-1))}}}},Zae={kernelName:K3,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Q7(z7(n,"float32")),r=J7(cee(eee(1),t));return gne(X7(e,r))}}}},$ae={kernelName:X3,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=J7(cee(Q7(z7(n,"float32")),1));return X7(e,t)}}}},eie={kernelName:Y3,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=e,n=dee(r.shape,i);return n.length>0&&(t=ene(t,n)),gte(t,r.shape)},b:function(){var t=e,n=dee(a.shape,i);return n.length>0&&(t=ene(t,n)),gte(t,a.shape)}}}},tie={kernelName:J3,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},nie={kernelName:$3,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Z7(n)}}}},rie={kernelName:e4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Z7(n)}}}},aie={kernelName:t4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,J7(cee(eee(1),Q7(z7(n,"float32")))))}}}},iie={kernelName:n4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=J7(q7(eee(1),Q7(z7(n,"float32"))));return X7(e,t)}}}},oie={kernelName:i4,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=q7(Q7(r),Q7(a)),n=Y7(e,X7(a,t)),o=dee(r.shape,i);return o.length>0&&(n=ene(n,o)),gte(n,r.shape)},b:function(){var t=q7(Q7(r),Q7(a)),n=gne(Y7(e,X7(r,t))),o=dee(a.shape,i);return o.length>0&&(n=ene(n,o)),gte(n,a.shape)}}}},sie={kernelName:r4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,q7(Q7(z7(n,"float32")),1))}}}},uie={kernelName:a4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,cee(eee(1),Q7(z7(n,"float32"))))}}}};var cie=I9({avgPool3dGrad_:function(e,t,n,r,a,i){var o=k9(e,"dy","avgPool3dGrad"),s=k9(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=gte(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=gte(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),s3(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),s3(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")})),vte("avgPool3dGrad",a,i);var p={dy:u,input:c},h={filterSize:n,strides:r,pad:a,dimRoundingMode:i},d=d9.runKernel(c4,p,h);return l?gte(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),lie={kernelName:u4,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return cie(e,r,a,i,o,s)}}}};var pie=I9({avgPoolGrad_:function(e,t,n,r,a){var i=k9(e,"dy","avgPoolGrad"),o=k9(t,"input","avgPoolGrad");s3(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=gte(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=gte(i,[1,i.shape[0],i.shape[1],i.shape[2]])),s3(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),s3(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},h=d9.runKernel(s4,l,p);return c?gte(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),hie={kernelName:o4,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return pie(e,r,a,i,o)}}}},die={kernelName:l4,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return rne(e,i,!1,!1)},b:function(){return rne(e,a,!0,!1)}}:o&&!s?{a:function(){return rne(i,e,!1,!0)},b:function(){return rne(a,e,!1,!1)}}:{a:function(){return rne(i,e,!0,!0)},b:function(){return rne(e,a,!0,!0)}}:{a:function(){return rne(e,i,!1,!0)},b:function(){return rne(a,e,!0,!1)}}}};var fie=I9({spaceToBatchND_:function(e,t,n){var r=k9(e,"x","spaceToBatchND");s3(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),s3(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),s3(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return d9.runKernel(S6,a,i)}}),mie={kernelName:p4,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return fie(e,r,a)}}}},vie={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return ene(e,u,!0)}}}},gie={kernelName:m4,gradFunc:function(e){return{x:function(){return e.clone()}}}},yie={kernelName:v4,gradFunc:function(e){return{x:function(){return Z7(e)}}}},bie={kernelName:g4,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Jne(nne(Yte(r,a),Gre(r,i)),e,Z7(e))}}}},xie={kernelName:b4,inputsToSave:["x"],gradFunc:Qae.gradFunc},kie={kernelName:x4,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=g3(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Gne(e,i,a).map((function(e){return function(){return e}}))}},wie={kernelName:k4,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return s3(hte(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return Dte(a.shape,e,i,s,u,c)},filter:function(){return ire(a,e,i.shape,s,u,c)}}}},Iie={kernelName:I4,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Rte(e,i,o,s,u,1,c)},filter:function(){return ire(e,a,i.shape,o,s,u,c)}}}};var Sie=I9({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=gte(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=gte(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),s3(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),s3(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),s3(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),s3(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),s3(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return d9.runKernel(N4,s,u)}}),Nie={kernelName:S4,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;s3(hte(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=C(t,2),s=o[0],u=o[1];return{x:function(){return Lte(s.shape,e,u,a,i)},filter:function(){return Sie(s,e,u.shape,a,i)}}}};var Tie=I9({sin_:function(e){var t={x:k9(e,"x","sin","float32")};return d9.runKernel(g6,t)}}),Cie={kernelName:C4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(gne(Tie(z7(n,"float32"))),e)}}}};var Eie=I9({sinh_:function(e){var t={x:k9(e,"x","sinh")};return d9.runKernel(y6,t)}}),_ie={kernelName:E4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(Eie(z7(n,"float32")),e)}}}};var Aie=I9({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:k9(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return d9.runKernel(A4,a,i)}}),Rie={kernelName:A4,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=dne([a],r.rank),n=Aie(e,a,i,!o);return null!=t&&(n=$ne(n,t)),n}}}},Fie={kernelName:M4,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;s3(hte(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=C(t,2),c=u[0],l=u[1];return s3(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),s3(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),s3(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),s3(dte(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),vte("depthwiseConv2d",i,o),{x:function(){return fre(c.shape,e,l,a,i,s,o)},filter:function(){return dre(c,e,l.shape,a,i,s,o)}}}},Die={kernelName:P4,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return d9.runKernel(B4,o,n)},filter:function(){return d9.runKernel(W4,s,n)}}}},Mie={kernelName:G4,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:C(t,1)[0]};return{x:function(){return d9.runKernel(H4,n)}}}},Oie={kernelName:j4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=Y7(Ute(gne(Q7(n))),2/Math.sqrt(Math.PI));return{x:function(){return Y7(e,r)}}}},Lie={kernelName:K4,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,n)}}}},zie={kernelName:X4,inputsToSave:["input"],gradFunc:function(e,t){var n=C(t,1)[0];return{input:function(){return gte(e,n.shape)}}}},Pie={kernelName:Y4,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,Ute(n))}}}},Bie={kernelName:$4,gradFunc:function(e){return{x:function(){return Z7(e)}}}},Wie={kernelName:e5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=X7(e,z7(a,"float32")),n=dee(r.shape,i);return n.length>0?gte(ene(t,n),r.shape):t},b:function(){var t=Y7(e,z7(r,"float32")),n=dee(a.shape,i);n.length>0&&(t=gte(ene(t,n),a.shape));var o=Q7(a);return gne(X7(t,z7(o,"float32")))}}}};var Vie=I9({rsqrt_:function(e){var t={x:k9(e,"x","rsqrt","float32")};return d9.runKernel(l6,t)}}),Uie={kernelName:t5,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=C(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?eee(1):u,l=dee(o.shape,i.shape),p=[];if(1===o.rank){for(var h=0;h<i.shape.length-1;++h)p.push(i.shape[h]);p.push(1)}var d=cee(i,o),f=Y7(e,c),m=Vie(q7(s,eee(r))),v=Y7(Y7(Y7(m,m),m),eee(-.5));return{x:function(){return 1===o.rank?gte(Y7(Y7(e,Hte(gte(m,[1,1,1,o.shape[0]]),p)),c),i.shape):gte(Y7(Y7(e,m),c),i.shape)},mean:function(){var e=Y7(Y7(m,eee(-1)),f);return 1===o.rank&&(e=ene(e,l)),gte(e,o.shape)},variance:function(){var e=Y7(Y7(v,d),f);return 1===o.rank&&(e=ene(e,l)),gte(e,o.shape)},scale:function(){var t=Y7(d,m),n=Y7(e,t);return 1===o.rank&&(n=ene(n,l)),gte(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=ene(t,l)),gte(t,o.shape)}}}};var Gie=I9({unsortedSegmentSum_:function(e,t,n){var r=k9(e,"x","unsortedSegmentSum"),a=k9(t,"segmentIds","unsortedSegmentSum","int32");s3(h3(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return d9.runKernel(X6,i,o)}}),Hie={kernelName:n5,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.axis,s=g3(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=jie(0,u),h=jie(u+1,u+1+l),d=qie([r,[n],c]),f=gte(e,d),m=gte(i,[n]),v=qie([[u],p,h]),g=$ne(f,v),y=Gie(g,m,a.shape[s]),b=fne(v);return y=$ne(y,b)},indices:function(){return i}}}};function jie(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function qie(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Kie={kernelName:i5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return Z7(r)},b:function(){return Z7(a)}}}},Xie={kernelName:o5,gradFunc:function(e){return{x:function(){return z7(e,"float32")}}}},Yie={kernelName:c5,gradFunc:function(e){return{x:function(){return Z7(e)}}}},Jie={kernelName:l5,gradFunc:function(e){return{x:function(){return Z7(e)}}}},Qie={kernelName:p5,gradFunc:function(e){return{x:function(){return Z7(e)}}}},Zie={kernelName:h5,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.alpha,i=Xte(r,0);return{x:function(){return Jne(i,e,Y7(e,a))}}}},$ie={kernelName:g5,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,q7(n,1))}}}},eoe={kernelName:v5,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,z7(n,"float32"))}}}},toe={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis;return{logits:function(){var t=Ute(r);return cee(e,Y7(ene(e,a,!0),t))}}}};var noe=I9({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return d9.runKernel(w5,r,a)}}),roe={kernelName:k5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return noe(a,i,e,o,s,u,c)}}}};function aoe(e,t,n,r){return t.rank<n.rank&&(t=gte(t,pne(t.shape,r))),e.rank<n.rank&&(e=gte(e,pne(e.shape,r))),{x:function(){return Y7(e,z7(Vte(n,t),e.dtype))}}}var ioe={kernelName:I5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=aoe(e,t[1],a,g3(r,a.shape));return{x:function(){return i.x()}}}},ooe={kernelName:S5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return Y7(e,z7(Yte(r,a),"float32"))},b:function(){return Y7(e,z7(Kre(r,a),"float32"))}}}};var soe=I9({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=k9(e,"dy","maxPool3dGrad"),u=k9(t,"input","maxPool3dGrad"),c=k9(n,"output","maxPool3dGrad"),l=s,p=u,h=c,d=!1;4===u.rank&&(d=!0,l=gte(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=gte(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=gte(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),s3(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")})),s3(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(p.rank,".")})),s3(5===h.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")})),vte("maxPool3dGrad",i,o);var f={dy:l,input:p,output:h},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=d9.runKernel(E5,f,m);return d?gte(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),uoe={kernelName:C5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return soe(e,a,i,o,s,u,c)}}}};var coe=I9({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=k9(e,"dy","maxPoolGrad"),u=k9(t,"input","maxPoolGrad"),c=k9(n,"output","maxPoolGrad");s3(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),s3(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),s3(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),vte("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return d9.runKernel(T5,l,p)}}),loe={kernelName:N5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return coe(e,a,i,o,s,u)}}}},poe={kernelName:A5,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=g3(n.axis,r.shape),i=l3(lne(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=gte(e,t);return X7(Y7(n,kne(r.shape,"float32")),i)}}}},hoe={kernelName:R5,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=C(t,2),i=a[0],o=aoe(e,a[1],i,g3(r,i.shape));return{x:function(){return o.x()}}}},doe={kernelName:F5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return Y7(e,z7(Gre(r,a),"float32"))},b:function(){return Y7(e,z7(Xte(r,a),"float32"))}}}},foe={kernelName:D5,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Lne(e,a,r.shape)}}}},moe={kernelName:M5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=dee(r.shape,i);return t.length>0?gte(ene(e,t),r.shape):e},b:function(){var t=Y7(e,gne(qte(X7(r,a)))),n=dee(a.shape,i);return n.length>0?gte(ene(t,n),a.shape):t}}}},voe={kernelName:L5,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=Y7(e,z7(a,"float32")),n=dee(r.shape,i);return n.length>0?gte(ene(t,n),r.shape):t},b:function(){var t=Y7(e,z7(r,"float32")),n=dee(a.shape,i);return n.length>0?gte(ene(t,n),a.shape):t}}}},goe={kernelName:z5,gradFunc:function(e){return{x:function(){return gne(e)}}}},yoe={kernelName:G5,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return xne(n.shape,"float32")}}}},boe={kernelName:U5,gradFunc:function(e){return{x:function(){return Z7(e)}}}},xoe={kernelName:H5,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Yne(e,r).map((function(e){return function(){return e}}))}},koe={kernelName:j5,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Lne(e,a,r.shape)}}}},woe={kernelName:q5,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=fee(o.shape,s.shape);return{a:function(){var t=z7(s,"float32"),n=Y7(e,Y7(t,uee(o,cee(t,eee(1))))),r=dee(o.shape,u);return r.length>0&&(n=ene(n,r)),gte(n,o.shape)},b:function(){var t=Xte(o,0),n=Jne(t,Qte(o),Z7(o)),r=Y7(e,Y7(i,n)),a=dee(s.shape,u);return a.length>0&&(r=ene(r,a)),gte(r,s.shape)}}}},Ioe={kernelName:K5,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=Xte(r,0);return{x:function(){return Jne(i,e,Y7(e,a))},alpha:function(){var t=Jne(i,Z7(e),Y7(e,r)),n=dee(a.shape,e.shape);return n.length>0&&(t=ene(t,n)),gte(t,a.shape)}}}};var Soe=I9({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:k9(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return d9.runKernel(_4,a,i)}});function Noe(e,t,n){var r=e.shape.length,a=r-n.length,i=dne(n,r),o=e;null!=i&&(o=$ne(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=gte(t,r),i=Soe(e,n,!0,!1),o=Soe(e,n,!0,!0),s=Y7(i,o);return Y7(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=fne(i);c=$ne(c,l)}return c}var Toe={kernelName:X5,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis,i=[];return i=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return Noe(r,e,i)}}}},Coe={kernelName:V4,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=X7(e,z7(a,"float32")),n=dee(r.shape,i);return n.length>0?gte(ene(t,n),r.shape):t},b:function(){var t=Y7(e,z7(r,"float32")),n=dee(a.shape,i);n.length>0&&(t=gte(ene(t,n),a.shape));var o=Q7(a);return gne(X7(t,z7(o,"float32")))}}}},Eoe={kernelName:e6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,gne(Q7(n)))}}}},_oe={kernelName:s6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=Y7(Gre(n,6),sre(n));return{x:function(){return Y7(e,z7(r,"float32"))}}}},Aoe={kernelName:t6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,z7(sre(n),"float32"))}}}},Roe={kernelName:n6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return gte(e,n.shape)}}}},Foe={kernelName:i6,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return d9.runKernel(o6,r,n)}}}},Doe={kernelName:r6,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return d9.runKernel(a6,r,n)}}}},Moe={kernelName:u6,gradFunc:function(e,t,n){var r=g3(n.dims,e.shape);return{x:function(){return Fne(e,r)}}}},Ooe={kernelName:c6,gradFunc:function(e){return{x:function(){return Z7(e)}}}},Loe={kernelName:l6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return gne(X7(e,Y7(uee(n,1.5),2)))}}}};var zoe=I9({logicalNot_:function(e){var t={x:k9(e,"x","logicalNot","bool")};return d9.runKernel(b5,t)}}),Poe={kernelName:f6,inputsToSave:["condition"],gradFunc:function(e,t){var n=C(t,1)[0];return{condition:function(){return z7(Z7(n),"float32")},t:function(){return Y7(e,z7(n,e.dtype))},e:function(){return Y7(e,z7(zoe(n),e.dtype))}}}},Boe={kernelName:m6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=Xte(n,eee(0)),r=eee(wae),a=eee(Iae),i=Y7(e,a),o=Y7(Y7(e,r),Ute(z7(n,"float32")));return Jne(t,i,o)}}}},Woe={kernelName:x6,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,Y7(n,cee(eee(1),n)))}}}},Voe={kernelName:b6,gradFunc:function(e){return{x:function(){return Z7(e)}}}};var Uoe=I9({cos_:function(e){var t={x:k9(e,"x","cos","float32")};return d9.runKernel(C4,t)}}),Goe={kernelName:g6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(Uoe(z7(n,"float32")),e)}}}};var Hoe=I9({cosh_:function(e){var t={x:k9(e,"x","cosh","float32")};return d9.runKernel(E4,t)}}),joe={kernelName:y6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(Hoe(z7(n,"float32")),e)}}}},qoe={kernelName:v6,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=C(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=C(Jee(r,a,i),2),u=s[0],c=s[1],l=[],p=0;p<e.rank;p++)l.push([u[p],o[p]-u[p]-c[p]]);return{x:function(){return Ine(e,l)}}}},Koe={kernelName:T6,outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.dim,i=Y7(e,r);return{logits:function(){return cee(i,Y7(ene(i,[a],true),r))}}}},Xoe={kernelName:k6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,One(n))}}}};var Yoe=I9({batchToSpaceND_:function(e,t,n){var r=k9(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));s3(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),s3(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),s3(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return d9.runKernel(p4,i,o)}}),Joe={kernelName:S6,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Yoe(e,r,a)}}}},Qoe={kernelName:N6,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Tte(e,r)}}}},Zoe={kernelName:w6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,Y7(J7(z7(n,"float32")),2))}}}},$oe={kernelName:D6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(e,Y7(z7(n,"float32"),2))}}}},ese={kernelName:F6,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=eee(2);return{a:function(){return Y7(e,Y7(i,cee(r,a)))},b:function(){return Y7(e,Y7(i,cee(a,r)))}}}},tse={kernelName:B6,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=fee(r.shape,a.shape);return{a:function(){var t=e,n=dee(r.shape,i);return n.length>0&&(t=ene(t,n)),gte(t,r.shape)},b:function(){var t=e,n=dee(a.shape,i);return n.length>0&&(t=ene(t,n)),gte(gne(t),a.shape)}}}},nse={kernelName:I6,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=r.shape.slice();g3(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=gte(e,a),o=Y7(i,kne(r.shape,"float32"));return{x:function(){return o}}}},rse={kernelName:W6,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return X7(e,Q7(Uoe(n)))}}}},ase={kernelName:V6,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return Y7(cee(eee(1),Q7(n)),e)}}}},ise={kernelName:U6,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.reps;return{x:function(){var t=Z7(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=q7(t,Lne(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=q7(t,Lne(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=q7(t,Lne(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var h=0;h<a[2];++h)for(var d=0;d<a[3];++d)t=q7(t,Lne(e,[l*r.shape[0],p*r.shape[1],h*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},ose={kernelName:X6,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return function(e,t){for(var n=mee(t,Z7(t)),r=Kte(e,n),a=Yte(t,eee(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Gte(a,o+1);a=nne(a,kne(r.shape,"bool"));var s=Z7(r);return Jne(a,r,s)}(e,n)}}}};for(var sse=0,use=[Qae,Zae,$ae,eie,tie,nie,rie,aie,iie,oie,sie,uie,lie,hie,die,mie,vie,gie,yie,bie,xie,kie,Iie,wie,Nie,Cie,_ie,Rie,Fie,Die,Coe,Mie,Oie,Lie,zie,Pie,Wie,Bie,Uie,Hie,Kie,Xie,Yie,Jie,Qie,Zie,$ie,eoe,toe,roe,ioe,ioe,ooe,uoe,loe,poe,hoe,doe,foe,moe,voe,goe,yoe,boe,xoe,koe,koe,woe,Ioe,Toe,Eoe,_oe,Aoe,Roe,Foe,Doe,Moe,Ooe,Loe,Poe,Boe,Woe,Voe,Goe,joe,qoe,Koe,Xoe,Joe,Joe,Qoe,Qoe,Zoe,ese,$oe,{kernelName:J6,gradFunc:function(e){return{x:function(){return Z7(e)}}}},tse,nse,rse,ase,ise,{kernelName:j6,gradFunc:function(e,t,n){var r=fne(n.perm);return{x:function(){return $ne(e,r)}}}},{kernelName:K6,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return jne(e,r)}}}},ose,{kernelName:Y6,gradFunc:function(e){return{x:function(){return Z7(e)}}}}];sse<use.length;sse++){u8(use[sse])}q8().prototype.abs=function(){return this.throwIfDisposed(),pee(this)};var cse=I9({acos_:function(e){var t={x:k9(e,"x","acos")};return d9.runKernel(K3,t)}});q8().prototype.acos=function(){return this.throwIfDisposed(),cse(this)};var lse=I9({acosh_:function(e){var t={x:k9(e,"x","acosh")};return d9.runKernel(X3,t)}});q8().prototype.acosh=function(){return this.throwIfDisposed(),lse(this)},q8().prototype.add=function(e){return this.throwIfDisposed(),q7(this,e)},q8().prototype.all=function(e,t){return this.throwIfDisposed(),$ee(this,e,t)},q8().prototype.any=function(e,t){return this.throwIfDisposed(),ete(this,e,t)},q8().prototype.argMax=function(e){return this.throwIfDisposed(),tte(this,e)};var pse=I9({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:k9(e,"x","argMin")},r={axis:t};return d9.runKernel(e4,n,r)}});q8().prototype.argMin=function(e){return this.throwIfDisposed(),pse(this,e)},q8().prototype.asScalar=function(){return this.throwIfDisposed(),s3(1===this.size,(function(){return"The array must have only 1 element."})),gte(this,[])},q8().prototype.asType=function(e){return this.throwIfDisposed(),z7(this,e)},q8().prototype.as1D=function(){return this.throwIfDisposed(),gte(this,[this.size])},q8().prototype.as2D=function(e,t){return this.throwIfDisposed(),gte(this,[e,t])},q8().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),gte(this,[e,t,n])},q8().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),gte(this,[e,t,n,r])},q8().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),gte(this,[e,t,n,r,a])};var hse=I9({asin_:function(e){var t={x:k9(e,"x","asin")};return d9.runKernel(t4,t)}});q8().prototype.asin=function(){return this.throwIfDisposed(),hse(this)};var dse=I9({asinh_:function(e){var t={x:k9(e,"x","asinh")};return d9.runKernel(n4,t)}});q8().prototype.asinh=function(){return this.throwIfDisposed(),dse(this)};var fse=I9({atan_:function(e){var t={x:k9(e,"x","atan")};return d9.runKernel(r4,t)}});q8().prototype.atan=function(){return this.throwIfDisposed(),fse(this)};var mse=I9({atan2_:function(e,t){var n=k9(e,"a","atan2"),r=k9(t,"b","atan2"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(i4,i)}});q8().prototype.atan2=function(e){return this.throwIfDisposed(),mse(this,e)};var vse=I9({atanh_:function(e){var t={x:k9(e,"x","atanh")};return d9.runKernel(a4,t)}});q8().prototype.atanh=function(){return this.throwIfDisposed(),vse(this)},q8().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),yte(this,e,t,n,r)},q8().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Yoe(this,e,t)},q8().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),xte(this,e,t,n,r,a)},q8().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Ste(this,e)},q8().prototype.cast=function(e){return this.throwIfDisposed(),z7(this,e)};var gse=I9({ceil_:function(e){var t={x:k9(e,"x","ceil","float32")};return d9.runKernel(v4,t)}});q8().prototype.ceil=function(){return this.throwIfDisposed(),gse(this)},q8().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Nte(this,e,t)},q8().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof j8&&(e=[e]),Tte([this].concat(Ie(e)),t)},q8().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Fte(this,e,t,n,r,a,i)},q8().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),Mte(this,e,t,n,r,a)},q8().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Rte(this,e,t,n,r,a,i)},q8().prototype.cos=function(){return this.throwIfDisposed(),Uoe(this)},q8().prototype.cosh=function(){return this.throwIfDisposed(),Hoe(this)},q8().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Soe(this,e,t,n)},q8().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Aie(this,e,t,n)};var yse=I9({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=k9(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];s3(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),s3(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),s3(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),s3(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return d9.runKernel(D4,s,u)}});q8().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),yse(this,e,t)},q8().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Bte(this,e,t,n,r,a,i)};var bse=I9({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=k9(e,"x","dilation2d"),s=k9(t,"filter","dilation2d");s3(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),s3(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),s3("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=gte(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),s3(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},h=d9.runKernel(P4,l,p);return c?gte(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});q8().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),bse(this,e,t,n,r,a)};var xse=I9({divNoNan_:function(e,t){var n=k9(e,"a","div"),r=k9(t,"b","div"),a=C(a9(n,r),2);n=a[0],r=a[1];var i=X7(n,r),o=Z7(i),s=Vte(r,o);return Jne(s,o,i)}});q8().prototype.divNoNan=function(e){return this.throwIfDisposed(),xse(this,e)},q8().prototype.div=function(e){return this.throwIfDisposed(),X7(this,e)};var kse=I9({dot_:function(e,t){var n=k9(e,"t1","dot"),r=k9(t,"t2","dot");s3((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(s3(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=gte(n,[1,-1]),s=gte(r,[-1,1]),u=rne(o,s);return gte(u,[])}if(1===n.rank&&2===r.rank){var c=gte(n,[1,-1]),l=gte(r,[r.shape[0],r.shape[1]]),p=rne(c,l);return gte(p,[p.size])}if(2===n.rank&&1===r.rank){var h=gte(r,[-1,1]),d=rne(n,h);return gte(d,[d.size])}var f=gte(r,[r.shape[0],r.shape[1]]);return rne(n,f)}});q8().prototype.dot=function(e){return this.throwIfDisposed(),kse(this,e)},q8().prototype.elu=function(){return this.throwIfDisposed(),Wte(this)},q8().prototype.equal=function(e){return this.throwIfDisposed(),Vte(this,e)};var wse=I9({erf_:function(e){var t=k9(e,"x","erf");s3("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=z7(t,"float32"));var n={x:t};return d9.runKernel(j4,n)}});q8().prototype.erf=function(){return this.throwIfDisposed(),wse(this)};var Ise=I9({euclideanNorm_:function(e){return Jre(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});q8().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Ise(this,e,t)},q8().prototype.exp=function(){return this.throwIfDisposed(),Ute(this)},q8().prototype.expandDims=function(e){return this.throwIfDisposed(),Gte(this,e)};var Sse=I9({expm1_:function(e){var t={x:k9(e,"x","expm1")};return d9.runKernel(Y4,t)}});q8().prototype.expm1=function(){return this.throwIfDisposed(),Sse(this)},q8().prototype.fft=function(){return this.throwIfDisposed(),tre(this)},q8().prototype.flatten=function(){return this.throwIfDisposed(),gte(this,[this.size])},q8().prototype.floor=function(){return this.throwIfDisposed(),qte(this)},q8().prototype.floorDiv=function(e){return this.throwIfDisposed(),K7(this,e)},q8().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Kte(this,e,t,n)},q8().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Yte(this,e)},q8().prototype.greater=function(e){return this.throwIfDisposed(),Xte(this,e)},q8().prototype.ifft=function(){return this.throwIfDisposed(),rre(this)},q8().prototype.irfft=function(){return this.throwIfDisposed(),are(this)};var Nse=I9({isFinite_:function(e){var t={x:k9(e,"x","isFinite")};return d9.runKernel(c5,t)}});q8().prototype.isFinite=function(){return this.throwIfDisposed(),Nse(this)};var Tse=I9({isInf_:function(e){var t={x:k9(e,"x","isInf")};return d9.runKernel(l5,t)}});q8().prototype.isInf=function(){return this.throwIfDisposed(),Tse(this)};var Cse=I9({isNaN_:function(e){var t={x:k9(e,"x","isNaN")};return d9.runKernel(p5,t)}});q8().prototype.isNaN=function(){return this.throwIfDisposed(),Cse(this)},q8().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Jte(this,e)},q8().prototype.lessEqual=function(e){return this.throwIfDisposed(),Gre(this,e)},q8().prototype.less=function(e){return this.throwIfDisposed(),Kre(this,e)};var Ese=I9({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=k9(e,"x","localResponseNormalization");s3(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),s3(h3(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=gte(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=d9.runKernel(k5,u,c);return s?gte(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});q8().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Ese(this,e,t,n,r)};var _se=I9({logSigmoid_:function(e){var t=k9(e,"x","logSigmoid"),n=$7((function(e){return{value:gne(Une(gne(e))),gradFunc:function(t){return Y7(t,One(gne(e)))}}}));return n(t)}});q8().prototype.logSigmoid=function(){return this.throwIfDisposed(),_se(this)},q8().prototype.logSoftmax=function(e){return this.throwIfDisposed(),tne(this,e)},q8().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),nae(this,e,t)},q8().prototype.log=function(){return this.throwIfDisposed(),Qte(this)},q8().prototype.log1p=function(){return this.throwIfDisposed(),Zte(this)},q8().prototype.logicalAnd=function(e){return this.throwIfDisposed(),nne(this,e)},q8().prototype.logicalNot=function(){return this.throwIfDisposed(),zoe(this)};var Ase=I9({logicalOr_:function(e,t){var n=k9(e,"a","logicalOr","bool"),r=k9(t,"b","logicalOr","bool");fee(n.shape,r.shape);var a={a:n,b:r};return d9.runKernel(x5,a)}});q8().prototype.logicalOr=function(e){return this.throwIfDisposed(),Ase(this,e)};var Rse=I9({logicalXor_:function(e,t){var n=k9(e,"a","logicalXor","bool"),r=k9(t,"b","logicalXor","bool");return fee(n.shape,r.shape),nne(Ase(e,t),zoe(nne(e,t)))}});q8().prototype.logicalXor=function(e){return this.throwIfDisposed(),Rse(this,e)},q8().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),rne(this,e,t,n)},q8().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ane(this,e,t,n,r)},q8().prototype.max=function(e,t){return this.throwIfDisposed(),$te(this,e,t)},q8().prototype.maximum=function(e){return this.throwIfDisposed(),mee(this,e)},q8().prototype.mean=function(e,t){return this.throwIfDisposed(),one(this,e,t)},q8().prototype.min=function(e,t){return this.throwIfDisposed(),sne(this,e,t)},q8().prototype.minimum=function(e){return this.throwIfDisposed(),une(this,e)};var Fse=I9({mirrorPad_:function(e,t,n){s3("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=k9(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");s3(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){s3(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),s3(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return d9.runKernel(D5,u,s)}});q8().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Fse(this,e,t)};var Dse=I9({mod_:function(e,t){var n=k9(e,"a","mod"),r=k9(t,"b","mod"),a=C(a9(n,r),2),i={a:n=a[0],b:r=a[1]};return d9.runKernel(M5,i)}});q8().prototype.mod=function(e){return this.throwIfDisposed(),Dse(this,e)},q8().prototype.mul=function(e){return this.throwIfDisposed(),Y7(this,e)},q8().prototype.neg=function(){return this.throwIfDisposed(),gne(this)},q8().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Jre(this,e,t,n)},q8().prototype.notEqual=function(e){return this.throwIfDisposed(),yne(this,e)},q8().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),bne(this,e,t,n)},q8().prototype.onesLike=function(){return this.throwIfDisposed(),wne(this)},q8().prototype.pad=function(e,t){return this.throwIfDisposed(),Ine(this,e,t)};var Mse=I9({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=k9(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=gte(s,[1,s.shape[0],s.shape[1],s.shape[2]])),s3(dte(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,p=rte(u.shape,t,i,a,r),h=[p.dilationHeight,p.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([p.filterHeight,p.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=C(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([p.inHeight,p.inWidth],h,l),2),m=f[0],v=f[1],g=d?r:"valid",y=d?u:fie(u,h,m),b=("avg"===n?function(){return yte(y,t,i,g,o)}:function(){return ane(y,t,i,g,o)})(),x=d?b:Yoe(b,h,v);return c?gte(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});q8().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),Mse(this,e,t,n,r,a,i)},q8().prototype.pow=function(e){return this.throwIfDisposed(),uee(this,e)},q8().prototype.prelu=function(e){return this.throwIfDisposed(),Sne(this,e)};var Ose=I9({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=k9(e,"x","prod");"bool"===r.dtype&&(r=z7(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return d9.runKernel(X5,a,i)}});q8().prototype.prod=function(e,t){return this.throwIfDisposed(),Ose(this,e,t)};var Lse=I9({reciprocal_:function(e){var t={x:k9(e,"x","reciprocal")};return d9.runKernel(e6,t)}});q8().prototype.reciprocal=function(){return this.throwIfDisposed(),Lse(this)},q8().prototype.relu=function(){return this.throwIfDisposed(),Rne(this)},q8().prototype.relu6=function(){return this.throwIfDisposed(),ore(this)},q8().prototype.reshapeAs=function(e){return this.throwIfDisposed(),gte(this,e.shape)},q8().prototype.reshape=function(e){return this.throwIfDisposed(),gte(this,e)},q8().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Wre(this,e,t,n)},q8().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Vre(this,e,t,n)},q8().prototype.reverse=function(e){return this.throwIfDisposed(),Fne(this,e)},q8().prototype.rfft=function(){return this.throwIfDisposed(),nre(this)},q8().prototype.round=function(){return this.throwIfDisposed(),Hre(this)},q8().prototype.rsqrt=function(){return this.throwIfDisposed(),Vie(this)},q8().prototype.selu=function(){return this.throwIfDisposed(),Dne(this)},q8().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Mne(this,e,t,n,r,a,i)},q8().prototype.sigmoid=function(){return this.throwIfDisposed(),One(this)};var zse=I9({sign_:function(e){var t={x:k9(e,"x","sign")};return d9.runKernel(b6,t)}});q8().prototype.sign=function(){return this.throwIfDisposed(),zse(this)},q8().prototype.sin=function(){return this.throwIfDisposed(),Tie(this)},q8().prototype.sinh=function(){return this.throwIfDisposed(),Eie(this)},q8().prototype.slice=function(e,t){return this.throwIfDisposed(),Lne(this,e,t)},q8().prototype.softmax=function(e){return this.throwIfDisposed(),Vne(this,e)},q8().prototype.softplus=function(){return this.throwIfDisposed(),Une(this)},q8().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),fie(this,e,t)},q8().prototype.split=function(e,t){return this.throwIfDisposed(),Gne(this,e,t)},q8().prototype.sqrt=function(){return this.throwIfDisposed(),J7(this)},q8().prototype.square=function(){return this.throwIfDisposed(),Q7(this)},q8().prototype.squaredDifference=function(e){return this.throwIfDisposed(),tae(this,e)},q8().prototype.squeeze=function(e){return this.throwIfDisposed(),Hne(this,e)},q8().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof j8?[this,e]:[this].concat(Ie(e));return jne(n,t)},q8().prototype.step=function(e){return this.throwIfDisposed(),sre(this,e)};var Pse=I9({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:k9(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return d9.runKernel(O6,c,l)}});q8().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),Pse(this,e,t,n,r,a,i,o,s)},q8().prototype.sub=function(e){return this.throwIfDisposed(),cee(this,e)},q8().prototype.sum=function(e,t){return this.throwIfDisposed(),ene(this,e,t)};var Bse=I9({tan_:function(e){var t={x:k9(e,"x","tan","float32")};return d9.runKernel(W6,t)}});q8().prototype.tan=function(){return this.throwIfDisposed(),Bse(this)},q8().prototype.tanh=function(){return this.throwIfDisposed(),qne(this)},q8().prototype.tile=function(e){return this.throwIfDisposed(),Hte(this,e)},q8().prototype.toBool=function(){return this.throwIfDisposed(),z7(this,"bool")},q8().prototype.toFloat=function(){return this.throwIfDisposed(),z7(this,"float32")},q8().prototype.toInt=function(){return this.throwIfDisposed(),z7(this,"int32")};var Wse=I9({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=k9(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=C(d9.runKernel(G6,i,o),2);return{values:s[0],indices:s[1]}}});q8().prototype.topk=function(e,t){return this.throwIfDisposed(),Wse(this,e,t)},q8().prototype.transpose=function(e){return this.throwIfDisposed(),$ne(this,e)};var Vse=I9({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=k9(e,"x","unique","string_or_numeric");s3(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=C(d9.runKernel(q6,r,a),2);return{values:i[0],indices:i[1]}}});q8().prototype.unique=function(e){return this.throwIfDisposed(),Vse(this,e)},q8().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Gie(this,e,t)},q8().prototype.unstack=function(e){return this.throwIfDisposed(),Yne(this,e)},q8().prototype.where=function(e,t){return this.throwIfDisposed(),Jne(e,this,t)},q8().prototype.zerosLike=function(){return this.throwIfDisposed(),Z7(this)};var Use=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Gse=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Hse=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),jse=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),qse=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),Object.setPrototypeOf(he(r),n.prototype),r}return we(n)}(ve(Error)),Kse=function(){function e(t){xe(this,e),this.maxEntries=t||100,this.cache=new Map}return we(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function Xse(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function Yse(e,t){if(!e)throw new qse(t)}function Jse(e,t){var n,r=0,a=Se(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(aGe){a.e(aGe)}finally{a.f()}return r}function Qse(e){return 1===e.length?e[0]:e}function Zse(e){return Array.isArray(e)?e:[e]}function $se(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function eue(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var tue={};function nue(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function rue(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return rue(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?rue(a):e[r]=a.value)}}function aue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in tue)i=tue[o];else if(null==(i=t[o]))throw new Hse("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new Hse("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,l=s.className;if(l in n){var p=C(n[l],2);u=p[0],c=p[1]}else if(l in tue){var h=C(tue.className,2);u=h[0],c=h[1]}else if(l in t){var d=C(t[l],2);u=d[0],c=d[1]}if(null==u)throw new Hse("Unknown ".concat(r,": ").concat(l,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var f={},m=0,v=Object.keys(tue);m<v.length;m++){var g=v[m];f[g]=tue[g]}for(var y=0,b=Object.keys(n);y<b.length;y++){var x=b[y];f[x]=n[x]}s.config.customObjects=f;for(var k=Object.assign({},tue),w=0,I=Object.keys(n);w<I.length;w++){var S=I[w];tue[S]=n[S]}rue(s.config);var N=c(u,s.config,n,a);return tue=Object.assign({},k),N}for(var T=Object.assign({},tue),E=0,_=Object.keys(n);E<_.length;E++){var A=_[E];tue[A]=n[A]}var R=new u(s.config);return tue=Object.assign({},T),R}function iue(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function oue(e){if(null==e)return e;var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(aGe){r.e(aGe)}finally{r.f()}return n}function sue(e){if(null==e)throw new Hse("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function uue(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Hse("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function cue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Yse(n>=0),Yse(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function lue(e,t){Array.isArray(e)?(s3(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return lue(e,"element ".concat(n+1," of ").concat(t))}))):s3(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(pue(e),".")}))}function pue(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return pue(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function hue(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var due=0;function fue(){return due++}var mue={};function vue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in mue||(mue[e]=0),mue[e]+=1,e+mue[e].toString()}var gue=["channelsFirst","channelsLast"],yue=["nearest","bilinear"],bue=["valid","same","causal"],xue=["max","avg"],kue=["sum","mul","concat","ave"],wue=new Map;function Iue(e){uue(gue,"DataFormat",e)}function Sue(e){uue(bue,"PaddingMode",e)}function Nue(e){uue(xue,"PoolMode",e)}var Tue=[],Cue="/";function Eue(e,t){Tue.push(e);try{var n=t();return Tue.pop(),n}catch(rGe){throw Tue.pop(),rGe}}function _ue(e){if(!Due(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Tue.length?"":Tue.join(Cue)+Cue)+e}function Aue(e){if(!Due(e))throw new Error("Not a valid tensor name: '"+e+"'");wue.has(e)||wue.set(e,0);var t=wue.get(e);if(wue.set(e,wue.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return wue.set(n,1),n}return e}var Rue,Fue=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Due(e){return!!e.match(Fue)}function Mue(e){return e===parseInt(e.toString(),10)}function Oue(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Lue(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function zue(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Pue(e,t){if(t<e)throw new Hse("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function Bue(){return null==Rue&&(Rue=d9.backend.epsilon()),Rue}function Wue(e,t){return z7(e,t)}function Vue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),gte(e,n)}function Uue(e,t,n){return U7((function(){switch(e.rank){case 1:return zne(e,t,n);case 2:return Pne(e,[t,0],[n,e.shape[1]]);case 3:return Bne(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Wne(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Lne(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Lne(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Hse("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function Gue(e,t,n){return U7((function(){switch(e.rank){case 1:return zne(e,t,n);case 2:return Pne(e,[0,t],[e.shape[0],n]);case 3:return Bne(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Wne(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Hse("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function Hue(e,t,n,r){return U7((function(){switch(e.rank){case 1:return zne(e,t,n);case 2:switch(r){case 1:return Uue(e,t,n);case 2:return Gue(e,t,n);default:throw new Hse("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return Uue(e,t,n);case 2:return Bne(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Gue(e,t,n);default:throw new Hse("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return Uue(e,t,n);case 2:return Wne(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Wne(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Gue(e,t,n);default:throw new Hse("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new Hse("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function jue(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Tte(e,n)}function que(e,t){switch(e.rank){case 1:return Cte([e,t]);case 2:return Ete([e,t],0);case 3:return _te([e,t],0);case 4:return Ate([e,t],0);default:throw new Hse("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function Kue(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Hse("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return Hte(e,t)}function Xue(e){return Ene(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function Yue(e,t,n,r){if(e.rank<2||t.rank<2)throw new jse("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new jse("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return mre({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Zue(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=gte(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Ie(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=gte($ne(t,l),[u,-1]);var p=[].concat(Ie(a),Ie(c));return gte(mre({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?Zue(e.rank,r,"channelsLast"):null,activation:n}),p)}function Jue(e,t,n){return U7((function(){return t=Array.isArray(t)?Kne(t,"int32"):z7(t,"int32"),Kte(e,t,n)}))}function Que(e){return Y7(e,e)}function Zue(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Hse("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?gte(t,[1,r[0],1,1,1]):gte(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?gte(t,[1,1,1,1,r[0]]):gte(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?gte(t,[1,r[0],1,1]):gte(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?gte(t,[1,1,1,r[0]]):gte(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?gte(t,[1,r[0],1]):gte(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?gte(t,[1,1,r[0]]):gte(t,[1].concat(r))}else if(e<3)return t;throw new Hse("Unsupported input rank by biasAdd: ".concat(t.rank))}function $ue(e,t,n){return U7((function(){return null==n&&(n="channelsLast"),Iue(n),q7(e,Zue(e.rank,t,n))}))}function ece(e,t,n,r){return U7((function(){return ere(e,t,n,r)}))}function tce(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var nce=["fanIn","fanOut","fanAvg"],rce=["normal","uniform","truncatedNormal"];var ace=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(tee),ice=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return xne(e,t)}}]),n}(ace);ice.className="Zeros",ree(ice);var oce=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return kne(e,t)}}]),n}(ace);oce.className="Ones",ree(oce);var sce=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this),"object"!==typeof e)throw new Hse("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new Hse("config must have value set but got ".concat(e));return r.value=e.value,r}return we(n,[{key:"apply",value:function(e,t){var n=this;return U7((function(){return Y7(eee(n.value),kne(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(ace);sce.className="Constant",ree(sce);var uce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){return _ne(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(ace);uce.className="RandomUniform",ree(uce);var cce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jse("randomNormal does not support dType ".concat(t,"."));return Xue(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(ace);cce.className="RandomNormal",ree(cce);var lce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jse("truncatedNormal does not support dType ".concat(t,"."));return Xne(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(ace);lce.className="TruncatedNormal",ree(lce);var pce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return we(n,[{key:"apply",value:function(e,t){var n=this;return U7((function(){if(2!==e.length||e[0]!==e[1])throw new Hse("Identity matrix initializer can only be used for 2D square matrices.");return Y7(n.gain,jte(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(ace);pce.className="Identity",ree(pce);var hce=function(e){ye(n,e);var t=be(n);function n(e){var r,a;if(xe(this,n),r=t.call(this),e.scale<0)throw new Hse("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,uue(nce,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){uue(rce,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Iue(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=Oue(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=Oue(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=Oue(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new jse("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Xne(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return _ne(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(ace);hce.className="VarianceScaling",ree(hce);var dce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);dce.className="GlorotUniform",ree(dce);var fce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);fce.className="GlorotNormal",ree(fce);var mce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);mce.className="HeNormal",ree(mce);var vce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);vce.className="HeUniform",ree(vce);var gce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);gce.className="LeCunNormal",ree(gce);var yce=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return we(n,[{key:"getClassName",value:function(){return hce.className}}]),n}(hce);yce.className="LeCunUniform",ree(yce);var bce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.ELEMENTS_WARN_SLOW=2e3,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,r}return we(n,[{key:"apply",value:function(e,t){var n=this;return U7((function(){if(e.length<2)throw new jse("Shape must be at least 2D.");if("int32"!==t&&"float32"!==t&&void 0!==t)throw new TypeError("Unsupported data type ".concat(t,"."));var r=l3(e.slice(0,-1)),a=e[e.length-1],i=r*a;i>n.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(n.ELEMENTS_WARN_SLOW," (").concat(i,") elements: ")+"Slowness may result.");var o=Xue([Math.max(a,r),Math.min(a,r)],0,1,t,n.seed),s=iae.qr(o,!1),u=s[0],c=s[1].flatten().stridedSlice([0],[Math.min(a,r)*Math.min(a,r)],[Math.min(a,r)+1]);return u=Y7(u,c.sign()),r<a&&(u=u.transpose()),Y7(eee(n.gain),u.reshape(e))}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(ace);bce.className="Orthogonal",ree(bce);var xce={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function kce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return aue(e,nee.getMap().classNameMap,t,"initializer")}function wce(e){return nue(e)}function Ice(e){if("string"===typeof e){var t=e in xce?xce[e]:e;if("GlorotNormal"===t)return new fce;if("GlorotUniform"===t)return new dce;if("HeNormal"===t)return new mce;if("HeUniform"===t)return new vce;if("LeCunNormal"===t)return new gce;if("LeCunUniform"===t)return new yce;var n={};return n.className=t,n.config={},kce(n)}return e instanceof ace?e:kce(e)}function Sce(e){return Array.isArray(e)&&Array.isArray(e[0])}function Nce(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Tce(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new Hse("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Cce(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new Hse("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Ece(e){var t,n=0,r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(aGe){r.e(aGe)}finally{r.f()}return n}var _ce="Variable",Ace=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_ce,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;xe(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=fue(),r=null==r?_ce:r,this.originalName=_ue(r),this.name=Aue(this.originalName),this.trainable_=a,this.constraint=i,this.val=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return d9.makeVariable(e,t,n,r)}(t,this.trainable_,this.name,this.dtype)}return we(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Rce(e){return e.map((function(e){return e.read()}))}function Fce(e){e.forEach((function(e){e[0].write(e[1])}))}var Dce=we((function e(t){xe(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),Mce=we((function e(t,n,r,a,i,o,s){xe(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=fue(),null!=o&&(this.originalName=_ue(o),this.name=Aue(this.originalName)),this.rank=n.length})),Oce=0,Lce=function(){function e(t,n){xe(this,e),this.callArgs=n,this.id=Oce++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=Se(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(aGe){a.e(aGe)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return we(e,[{key:"getConfig",value:function(){var e,t=[],n=Se(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(aGe){n.e(aGe)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),zce=0,Pce=function(e){ye(n,e);var t=be(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};xe(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=zce++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=$se(i)+"_"+vue(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return we(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new Gse("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Hse("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return Qse(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return Qse(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new Use("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new Use("Layer ".concat(this.name)+" is not connected, no input to return.");return Qse(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new Use("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Use("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Qse(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=Zse(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=Zse(this.inputSpec);if(e.length!==t.length)throw new Hse("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new Hse("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new Hse("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new Hse("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new Hse("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new Hse("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var h=a.shape[p],d=r.shape[p];if(null!=h&&null!=d&&h!==d)throw new Hse("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=Zse(e),i=!0,o=Se(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Mce)){i=!1;break}}}catch(aGe){o.e(aGe)}finally{o.f()}var s,u=!0,c=Se(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Mce){u=!1;break}}}catch(aGe){c.e(aGe)}finally{c.f()}if(i===u)throw new Hse("Arguments to apply() must be all SymbolicTensors or all Tensors");return Eue(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=Se(Zse(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(aGe){o.e(aGe)}finally{o.f()}n.build(Qse(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),p=[],h=Se(Zse(l));try{for(h.s();!(c=h.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),p.push(d)}}catch(aGe){h.e(aGe)}finally{h.f()}if(l=Qse(p),null!=n.activityRegularizer)throw new jse("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var f,m=function(e){e=Zse(e);var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(aGe){r.e(aGe)}finally{r.f()}return Qse(n)}(e),v=n.computeOutputShape(m),g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?m[0]:m),f=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,a){return new Mce(g,r,n,Zse(e),t,n.name,a)})):new Mce(g,v,n,Zse(e),t,n.name),n.addInboundNode(e,f,null,null,m,v,t),n._refCount++,null!=n.activityRegularizer)throw new jse("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return f}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new Use("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=Se(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(aGe){n.e(aGe)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new Use("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new Gse("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Ece(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return Rce(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;U7((function(){var n=t.weights;if(n.length!==e.length)throw new Hse('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=Rce(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!p3(o.shape,u.shape))throw new Hse("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}Fce(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new Hse("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Ice("zeros"));var u=r.apply(t,n),c=new Ace(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=Zse(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Ie(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=Zse(e);t=Zse(t),n=Zse(n),r=Zse(r),a=Nce(a),i=Nce(i);var u,c=[],l=[],p=[],h=Se(s);try{for(h.s();!(u=h.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),p.push(d.tensorIndex)}}catch(aGe){h.e(aGe)}finally{h.f()}new Lce({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(tee);function Bce(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=Se(Bce(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(aGe){s.e(aGe)}finally{s.f()}}return a}var Wce=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:vue("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Hse("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new Hse("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Hse("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Mce(r.dtype,r.batchInputShape,he(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Lce({outboundLayer:he(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return we(n,[{key:"apply",value:function(e,t){throw new Hse("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Pce);Wce.className="InputLayer",ree(Wce);var Vce=function(){function e(t){if(xe(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=Se(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(aGe){a.e(aGe)}finally{a.f()}}}return we(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new Hse("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return z7(t,e.dtype)}catch(aGe){throw new Hse("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Mce){if(null==this.id2Value[e.id])throw new Hse("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new Hse("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Mce){if(null==this.id2Value[e.id])throw new Hse("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new Hse("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&G7(this.id2Mask)}}]),e}(),Uce=new Kse,Gce=new Kse;function Hce(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=Se(u);try{for(p.s();!(a=p.n()).done;){var h=a.value;-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}}catch(aGe){p.e(aGe)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,f=u.join(",")+"|"+t.names().sort().join(","),m=Uce.get(f);if(null==m){var v=function(e,t){s3(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=qce(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=Se(e);try{for(s.s();!(i=s.n()).done;){var u,c=qce(i.value,t),l=c.sorted,p=c.recipientMap,h=Se(l);try{for(h.s();!(u=h.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch(aGe){h.e(aGe)}finally{h.f()}var f=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)f(m)}}catch(aGe){s.e(aGe)}finally{s.f()}}return{sorted:n,recipientCounts:jce(r)}}(s,t);m=v.sorted,d=v.recipientCounts,Uce.put(f,m),Gce.put(f,d)}d={},i||Object.assign(d,Gce.get(f));for(var g=new Vce(t),y=0;y<m.length;++y){if(null!=r){var b=V7().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=m[y],k=x.sourceLayer;if(!(k instanceof Wce)){var w,I=[],S=[],N=[],T=!1,C=Se(x.inputs);try{for(C.s();!(w=C.n()).done;){var E=w.value,_=g.getValue(E),A=g.getMask(E);I.push(_),S.push(A),null!=A&&(T=!0),i||(d[E.name]--,0!==d[E.name]||t.hasKey(E)||-1!==u.indexOf(E.name)||_.isDisposed||!0===E.sourceLayer.stateful||N.push(_))}}catch(aGe){C.e(aGe)}finally{C.f()}T&&((n=n||{}).mask=S[0]);var R=Zse(k.apply(I,n)),F=null;k.supportsMasking&&(F=k.computeMask(I,S));for(var D=Kce(x),M=Array.isArray(D)?D:[D],O=0;O<M.length;++O){g.hasKey(M[O])||g.add(M[O],R[O],Array.isArray(F)?F[0]:F);var L=u.indexOf(M[O].name);-1!==L&&(c[L]=R[O])}i||G7(N)}}return g.disposeMasks(),o?c:c[0]}function jce(e){var t={};for(var n in e)t[n]=e[n].size;return t}function qce(e,t){var n,r=new Set,a=[],i={},o=Se(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(aGe){o.e(aGe)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var h,d=Se(l.inputs);try{for(d.s();!(h=d.n()).done;){var f=h.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),r.has(f.name)||u.push(f)}}catch(aGe){d.e(aGe)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function Kce(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=Se(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(aGe){i.e(aGe)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function Xce(e,t){return U7((function(){return J7(ene(Y7(e,e),t,!0))}))}V3().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=Uce&&Uce.setMaxEntries(e),null!=Gce&&Gce.setMaxEntries(e)}));var Yce=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"getConfig",value:function(){return{}}}]),n}(tee),Jce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return U7((function(){var n=Xce(e,t.axis),r=Nte(n,0,t.maxValue);return Y7(e,X7(r,q7(Bue(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Yce);Jce.className="MaxNorm",ree(Jce);var Qce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return U7((function(){return X7(e,q7(Bue(),Xce(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Yce);Qce.className="UnitNorm",ree(Qce);var Zce=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Rne(e)}}]),n}(Yce);Zce.className="NonNeg",ree(Zce);var $ce=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return we(n,[{key:"apply",value:function(e){var t=this;return U7((function(){var n=Xce(e,t.axis),r=q7(Y7(t.rate,Nte(n,t.minValue,t.maxValue)),Y7(1-t.rate,n));return Y7(e,X7(r,q7(Bue(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Yce);$ce.className="MinMaxNorm",ree($ce);var ele,tle={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function nle(e){return nue(e)}function rle(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return aue(e,nee.getMap().classNameMap,t,"constraint")}function ale(e){return null==e?null:"string"===typeof e?rle({className:e in tle?tle[e]:e,config:{}}):e instanceof Yce?e:rle(e)}function ile(e){return ole.apply(this,arguments)}function ole(){return(ole=S(w().mark((function e(t){var n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];G7(a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sle(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(ele||(ele={}));var ule=function(){function e(){xe(this,e),this.validationData=null}return we(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),cle=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;xe(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return we(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=Se(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(aGe){n.e(aGe)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=Se(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(aGe){n.e(aGe)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=Se(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Se(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=Se(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),lle=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this)}return we(n,[{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=w().mark((function e(t){var a,i,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"===typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=U7((function(){return q7(o.totals[t],Y7(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=w().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=20;break}r=Se(this.params.metrics),e.prev=2,i=w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.value,null!=o.totals[t]){e.next=3;break}return e.abrupt("return","continue");case 3:"number"===typeof o.totals[t]?n[t]=o.totals[t]/o.seen:U7((function(){var e=Y7(X7(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),H7(n[t])}));case 4:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=12;break}return e.delegateYield(i(),"t0",7);case 7:if("continue"!==e.t0){e.next=10;break}return e.abrupt("continue",10);case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t1=e.catch(2),r.e(e.t1);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ule),ple=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ule),hle=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||cae,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return S3(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():C8();return function(){var i=null!=n?n():C8();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind(he(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return we(n,[{key:"maybeWait",value:function(){var e=S(w().mark((function e(t,n,r){var a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,ile(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,ile(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,ile(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,ile(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,ile(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):S3(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,ile(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,ile(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ule);function dle(e,t){return null==e&&(e={}),e instanceof ule?[e]:Array.isArray(e)&&e[0]instanceof ule?e:Zse(e).map((function(e){return new hle(e,t)}))}var fle=function(){function e(){xe(this,e)}return we(e,null,[{key:"registerCallbackConstructor",value:function(t,n){s3(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new Hse("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Ie(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function mle(e,t,n,r,a,i,o,s,u){var c=new ple,l=[new lle].concat(Ie(fle.createCallbacks(t)));null!=e&&l.push.apply(l,Ie(e)),l.push(c);var p=new cle(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function vle(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return aue(e,nee.getMap().classNameMap,t,"layer",n)}function gle(e,t){return U7((function(){"float32"!==e.dtype&&(e=z7(e,"float32"));var n=ene(Que(e),t,!0),r=oee(n.shape,Bue()),a=J7(mee(n,r));return X7(e,a)}))}function yle(e,t){return U7((function(){return one(Que(cee(t,e)),-1)}))}function ble(e,t){return U7((function(){return one(pee(cee(t,e)),-1)}))}function xle(e,t){return U7((function(){var n=cee(e,t),r=Nte(pee(e),Bue(),Number.MAX_VALUE),a=pee(X7(n,r));return Y7(100,one(a,-1))}))}function kle(e,t){return U7((function(){var n=Nte(t,Bue(),Number.MAX_VALUE),r=Qte(q7(1,n)),a=Nte(e,Bue(),Number.MAX_VALUE),i=Qte(q7(1,a));return one(Que(cee(r,i)),-1)}))}function wle(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return U7((function(){if(n)t=Vne(t);else{var r=ene(t,t.shape.length-1,!0);t=X7(t,r)}return t=Nte(t,Bue(),1-Bue()),gne(ene(Y7(z7(e,"float32"),Qte(t)),t.shape.length-1))}))}function Ile(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return U7((function(){var r=z7(qte(function(e){var t=[Oue(e.shape)];return gte(e,t)}(e)),"int32"),a=(t=Nte(t,Bue(),1-Bue())).shape;return wle(gte(bne(r,a[a.length-1]),a),t,n)}))}function Sle(e,t){return U7((function(){var n;return n=Nte(t,Bue(),1-Bue()),n=Qte(X7(n,cee(1,n))),one(function(e,t){if(!p3(e.shape,t.shape))throw new Hse("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return U7((function(){var n=Rne(t),r=gne(pee(t));return q7(cee(n,Y7(t,e)),Zte(Ute(r)))}))}(e,n),-1)}))}function Nle(e,t){return U7((function(){var n=Nte(e,Bue(),1),r=Nte(t,Bue(),1);return ene(Y7(e,Qte(X7(n,r))),-1)}))}function Tle(e,t){return U7((function(){var n=gle(e,-1),r=gle(t,-1),a=Y7(n,r);return gne(ene(a,-1))}))}fle.constructors={};var Cle={meanSquaredError:yle,meanAbsoluteError:ble,meanAbsolutePercentageError:xle,meanSquaredLogarithmicError:kle,squaredHinge:function(e,t){return U7((function(){var n=mee(0,cee(1,Y7(e,t)));return one(Que(n),-1)}))},hinge:function(e,t){return U7((function(){var n=mee(0,cee(1,Y7(e,t)));return one(n,-1)}))},categoricalHinge:function(e,t){return U7((function(){var n=ene(Y7(e,t),-1),r=$te(Y7(cee(1,e),t),-1);return mee(0,q7(1,cee(r,n)))}))},logcosh:function(e,t){return U7((function(){var n=Math.log(2),r=cee(t,e),a=cee(q7(r,Une(Y7(-2,r))),n);return one(a,-1)}))},categoricalCrossentropy:wle,sparseCategoricalCrossentropy:Ile,binaryCrossentropy:Sle,kullbackLeiblerDivergence:Nle,poisson:function(e,t){return U7((function(){var n=Qte(q7(Bue(),t));return one(cee(t,Y7(e,n)),-1)}))},cosineProximity:Tle};function Ele(e){if("string"===typeof e){if(e in Cle)return Cle[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new Hse(t)}return e}function _le(e,t){return U7((function(){var n=Y7(.5,wne(t)),r=Wue(Xte(t,n),e.dtype);return one(Vte(e,r),-1)}))}function Ale(e,t){return U7((function(){return Wue(Vte(tte(e,-1),tte(t,-1)),"float32")}))}function Rle(e,t){return U7((function(){return z7(ene(nne(Vte(e,1),Vte(t,1))),"float32")}))}function Fle(e,t){return Sle(e,t)}function Dle(e,t){return e.rank===t.rank&&(e=Hne(e,[e.rank-1])),(t=tte(t,-1)).dtype!==e.dtype&&(t=z7(t,e.dtype)),z7(Vte(e,t),"float32")}var Mle=wle,Ole=Ile,Lle={binaryAccuracy:_le,categoricalAccuracy:Ale,precision:function(e,t){return U7((function(){var n=Rle(e,t),r=function(e,t){return U7((function(){return z7(ene(nne(Vte(e,0),Vte(t,1))),"float32")}))}(e,t),a=q7(n,r);return z7(Jne(Xte(a,0),X7(n,a),0),"float32")}))},categoricalCrossentropy:Mle,sparseCategoricalCrossentropy:Ole,mse:yle,MSE:yle,mae:ble,MAE:ble,mape:xle,MAPE:xle,cosine:Tle};function zle(e){if(Yse(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(Cle);n<r.length;n++){var a=r[n];if(Cle[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(Lle);i<o.length;i++){var s=o[i];if(Lle[s]===e){t=s;break}}return void 0!==t?t:e.name}var Ple=1048576;function Ble(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Wle(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>Ple&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(Ple,"."))}}function Wle(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!Wle(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=Se(e);try{for(i.s();!(a=i.n()).done;){if(!Wle(a.value))return!1}}catch(aGe){i.e(aGe)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function Vle(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Ie(s))}if(t){var u,c=Se(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,h=!1,d=Se(p.inboundNodes);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(h){t=!1;break}h=!0}}}catch(aGe){d.e(aGe)}finally{d.f()}if(!t)break}}catch(aGe){c.e(aGe)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Ie(e.nodesByDepth[s]))}a("_".repeat(t)),Ule(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Gle(c[l],n,a):Hle(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=function(e){var t;t=null!=e.collectedTrainableWeights?Ece(e.collectedTrainableWeights):Ece(e.trainableWeights);return t}(e),h=Ece(e.nonTrainableWeights);a("Total params: ".concat(p+h)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(h)),a("_".repeat(t))}function Ule(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Gle(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(aGe){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(aGe){r="multiple"}var i=e.name,o=e.getClassName();Ule(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function Hle(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(aGe){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(aGe){a="multiple"}var o,s=[],u=Se(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,h=c.nodeIndices[l],d=c.tensorIndices[l];s.push("".concat(p,"[").concat(h,"][").concat(d,"]"))}}}catch(aGe){u.e(aGe)}finally{u.f()}var f=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Ule(["".concat(f," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)Ule(["","","","",s[g]],t,r)}function jle(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function qle(e,t){if(null===e)return null;if("string"===typeof e)return eue(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];jle(t,a,i)?n.push(i):n.push(qle(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var p=eue(c);o[p]=qle(l,p)}}return o}function Kle(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return $se(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];jle(t,a,i)?n.push(i):n.push(Kle(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=$se(c);o[p]="name"!==c&&"className"!==c||"string"!==typeof l?Kle(l,c):l}return o}var Xle="4.6.0",Yle=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=vue(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],oue(r.inputs).length!==r.inputs.length)throw new Hse("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));oue(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=Se(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(aGe){o.e(aGe)}finally{o.f()}var p,h=Se(r.inputs);try{for(h.s();!(p=h.n()).done;){var d=p.value,f=d.sourceLayer,m=d.nodeIndex,v=d.tensorIndex;Yse(0===m,"input layer has >1 nodes"),Yse(0===v,"input layer has >1 tensors"),r.inputLayers.push(f),r.inputLayersNodeIndices.push(m),r.inputLayersTensorIndices.push(v)}}catch(aGe){h.e(aGe)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof Wce))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=Se(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch(aGe){x.e(aGe)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,I={},S={},N={},T={},C={},E=[],_=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new Gse("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in C||(C[o.id]=Object.keys(C).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},A=[],R=[],F=Se(r.outputs);try{for(F.s();!(w=F.n()).done;){_(w.value,A,R)}}catch(aGe){F.e(aGe)}finally{F.f()}var D,M=Se(E.slice().reverse());try{for(M.s();!(D=M.n()).done;){var O=D.value;S[O.id]=O,O.id in I||(I[O.id]=0);var L=I[O.id],z=null==N[O.outboundLayer.id]?0:N[O.outboundLayer.id];L=Math.max(L,z),N[O.outboundLayer.id]=L,T[O.outboundLayer.id]=O.outboundLayer,I[O.id]=L;for(var P=0;P<O.inboundLayers.length;P++){var B=O.inboundLayers[P],W=O.nodeIndices[P],V=B.inboundNodes[W],U=null==I[V.id]?0:I[V.id];I[V.id]=Math.max(L+1,U),S[V.id]=V}}}catch(aGe){M.e(aGe)}finally{M.f()}var G={};for(var H in I){var j=I[H];j in G||(G[j]=[]),G[j].push(S[H])}var q={};for(var K in N){var X=N[K];X in q||(q[X]=[]),q[X].push(T[K])}var Y=Object.keys(q).map((function(e){return parseInt(e,10)})).sort(iue);r.layers=[];var J,Q=Se(Y);try{for(Q.s();!(J=Q.n()).done;){var Z=q[J.value];Z.sort((function(e,t){var n=C[e.id],r=C[t.id];return n<r?-1:n>r?1:0}));var $,ee=Se(Z);try{for(ee.s();!($=ee.n()).done;){var te=$.value;te instanceof n&&r.internalContainerRefs.push(te),r.layers.push(te)}}catch(aGe){ee.e(aGe)}finally{ee.f()}}}catch(aGe){Q.e(aGe)}finally{Q.f()}r.layersByDepth=q,Y=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(iue);var ne,re=r.inputs.slice(),ae=[],ie=Se(Y);try{for(ie.s();!(ne=ie.n()).done;){var oe,se=Se(G[ne.value]);try{for(se.s();!(oe=se.n()).done;){var ue=oe.value,ce=ue.outboundLayer;if(null!=ce){var le,pe=Se(ue.inputTensors);try{for(pe.s();!(le=pe.n()).done;){var de=le.value;if(-1===re.indexOf(de))throw new Gse("Graph disconnected: cannot obtain value for tensor ".concat(de)+' at layer "'.concat(ce.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ae))}}catch(aGe){pe.e(aGe)}finally{pe.f()}var fe,me=Se(ue.outputTensors);try{for(me.s();!(fe=me.n()).done;){var ve=fe.value;re.push(ve)}}catch(aGe){me.e(aGe)}finally{me.f()}ae.push(ce.name)}}}catch(aGe){se.e(aGe)}finally{se.f()}}}catch(aGe){ie.e(aGe)}finally{ie.f()}r.nodesByDepth=G;var ge,ye=r.layers.map((function(e){return e.name})),be=Se(ye);try{var ke=function(){var e=ge.value,t=ye.filter((function(t){return t===e})).length;if(1!==t)throw new Gse('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ye))};for(be.s();!(ge=be.n()).done;)ke()}catch(aGe){be.e(aGe)}finally{be.f()}return r.outboundNodes=[],r.inboundNodes=[],new Lce({outboundLayer:he(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return we(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=Se(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(aGe){n.e(aGe)}finally{n.f()}var a,i=Se(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(aGe){i.e(aGe)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new Hse("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(aGe){n.e(aGe)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.nonTrainableWeights))}}catch(aGe){n.e(aGe)}finally{n.f()}if(!this.trainable){var a,i=[],o=Se(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Ie(s.trainableWeights))}}catch(aGe){o.e(aGe)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=Se(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=Se(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new Hse("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch(aGe){s.e(aGe)}finally{s.f()}}}catch(aGe){i.e(aGe)}finally{i.f()}var c=[];for(var l in e){var p=l;if(null==r[l]){var h=l.split("/");p=h.slice(0,-2).concat([h[h.length-1]]).join("/")}if(null!=r[p])c.push([r[p],e[l]]);else if(n)throw new Hse("Provided weight data has no target variable: ".concat(l));delete r[p]}if(n){var d=[];for(var f in r)d.push(f);if(d.length>0)throw new Hse("".concat(d.length," of ").concat(a," weights are not set: ")+"".concat(d))}Fce(c)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(Xle),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Kle(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return U7((function(){e=Zse(e);for(var r=new Vce,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return Hce(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return U7((function(){var r;return e=Zse(e),r=null==t?Xse(null,e.length):Zse(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Nce(e);if(t.length!==this.inputLayers.length)throw new Hse("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(iue);if(o.length>1){var s,u=Se(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=Se(this.nodesByDepth[l]);try{for(p.s();!(c=p.n()).done;){var h=c.value,d=h.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(d.id)){for(var f=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.nodeIndices[m],y=h.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];f.push(b)}for(var x=Nce(d.computeOutputShape(Qse(f))),k=d.inboundNodes.indexOf(h),w=0;w<x.length;w++){n["".concat(d.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch(aGe){p.e(aGe)}finally{p.f()}}}catch(aGe){u.e(aGe)}finally{u.f()}}for(var I=[],S=[],N=0;N<this.outputLayers.length;N++){var T=this.outputLayers[N],C=this.outputLayersNodeIndices[N],E=this.outputLayersTensorIndices[N],_="".concat(T.name,"_").concat(C,"_").concat(E);S.push(_)}for(var A=0;A<S.length;A++){var R=S[A];Yse(R in n),I.push(n[R])}return Qse(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=Xse(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(iue),c=Se(u);try{for(c.s();!(s=c.n()).done;){var l,p=s.value,h=Se(this.nodesByDepth[p]);try{for(h.s();!(l=h.n()).done;){var d,f=l.value,m=f.outboundLayer,v=f.inputTensors,g=f.outputTensors,y=new Array,b=Se(v);try{for(b.s();!(d=b.n()).done;){var x=d.value;x.id in n&&y.push(n[x.id])}}catch(aGe){b.e(aGe)}finally{b.f()}if(y.length===v.length){var k={},w=void 0,I=void 0,S=void 0,N=void 0;if(null!=f.callArgs&&(k=f.callArgs),1===y.length){var T=C(y[0],2),E=T[0],_=T[1];null==k.mask&&(k.mask=_),S=Zse(m.call(E,k)),N=Zse(m.computeMask(E,_)),w=[E],I=[_]}else w=y.map((function(e){return e[0]})),I=y.map((function(e){return e[1]})),null==k.mask&&(k.mask=I),S=Zse(m.call(w,k)),N=Zse(m.computeMask(w,I));if(m.activityRegularizer)throw new jse("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<g.length;++A){var R=g[A],F=S[A],D=N[A];n[R.id]=[F,D]}}}}catch(aGe){h.e(aGe)}finally{h.f()}}}catch(aGe){c.e(aGe)}finally{c.f()}var M,O=[],L=[],z=[],P=Se(this.outputs);try{for(P.s();!(M=P.n()).done;){var B=M.value;Yse(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=C(n[B.id],2),V=W[0],U=W[1];z.push(V.shape),O.push(V),L.push(U)}}catch(aGe){P.e(aGe)}finally{P.f()}return[O,L,z]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=Se(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(aGe){i.e(aGe)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new Hse("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new Hse("Provide either a layer name or layer index");var n,r=Se(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(aGe){r.e(aGe)}finally{r.f()}throw new Hse("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return U7((function(){var t,r=[],a=Se(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Ie(i.calculateLosses()))}}catch(aGe){a.e(aGe)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=Se(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],h=n.nodeKey(o,l),d={};if(this.containerNodes.has(h)){if(p.callArgs)try{JSON.stringify(p.callArgs),d=p.callArgs}catch(aGe){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(p.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),d={}}if(p.inboundLayers.length>0){for(var f=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),f.push([v.name,b,y,d])}c.push(f)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(aGe){i.e(aGe)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var I=this.inputLayers[w],S=this.inputLayersNodeIndices[w],N=n.nodeKey(I,S);if(this.containerNodes.has(N)){var T=r[N];null!==T&&void 0!==T||(T=0);var C=this.inputLayersTensorIndices[w];k.push([I.name,T,C])}}t.inputLayers=k;for(var E=[],_=0;_<this.outputLayers.length;_++){var A=this.outputLayers[_],R=this.outputLayersNodeIndices[_],F=n.nodeKey(A,R);if(this.containerNodes.has(F)){var D=r[F];null!==D&&void 0!==D||(D=0);var M=this.outputLayersTensorIndices[_];E.push([A.name,D,M])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new Hse("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=Se(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(aGe){t.e(aGe)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;U7((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=Se(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var h=r[c];if(h.inboundNodes.length<=l)return void i(e,t);var d=h.inboundNodes[l];o.push(d.outputTensors[p])}}catch(aGe){s.e(aGe)}finally{s.f()}o.length>0&&e.apply(Qse(o),n)}function s(e){var a=e.name,o=vle(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new Hse("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=Se(l);try{for(p.s();!(u=p.n()).done;){s(u.value)}}catch(aGe){p.e(aGe)}finally{p.f()}for(;!sue(a);){var h,d=Se(l);try{for(d.s();!(h=d.n()).done;){var f=h.value,m=r[f.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,y=Se(v);try{for(y.s();!(g=y.n()).done;){o(m,g.value)}}catch(aGe){y.e(aGe)}finally{y.f()}}}}catch(aGe){d.e(aGe)}finally{d.f()}}var b,x=[],k=[],w=Se(t.inputLayers);try{for(w.s();!(b=w.n()).done;){var I=b.value,S=I[0],N=I[1],T=I[2];Yse(S in r);var C=r[S].inboundNodes[N].outputTensors;x.push(C[T])}}catch(aGe){w.e(aGe)}finally{w.f()}var E,_=Se(t.outputLayers);try{for(_.s();!(E=_.n()).done;){var A=E.value,R=A[0],F=A[1],D=A[2];Yse(R in r);var M=r[R].inboundNodes[F].outputTensors;k.push(M[D])}}catch(aGe){_.e(aGe)}finally{_.f()}return new e({inputs:x,outputs:k,name:c})}}]),n}(Pce);function Jle(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function Qle(e,t){return Jle(e,t,"classWeight")}function Zle(e,t,n,r){return $le.apply(this,arguments)}function $le(){return $le=S(w().mark((function e(t,n,r,a){var i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=U7((function(){if(1===t.shape.length)return P7(t);if(2===t.shape.length){if(t.shape[1]>1){return tte(t,1)}if(1===t.shape[1])return gte(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),G7(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",Kne(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)}))),$le.apply(this,arguments)}function epe(e,t){return Y7(e,t)}var tpe=32;function npe(e,t){var n,r,a=t;n=a.xs,r=a.ys,s3(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=rpe("input",e.inputNames,n),o=rpe("output",e.outputNames,r),s=i[0].shape[0];s3(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),s3(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){s3(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){s3(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function rpe(e,t,n){if(n instanceof j8)return[n];if(Array.isArray(n))return s3(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=Se(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new Hse("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(aGe){i.e(aGe)}finally{i.f()}return a}function ape(e){if(3===e.length)throw new jse("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function ipe(e,t,n){return ope.apply(this,arguments)}function ope(){return ope=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E,_,A,R,F,D,M,O,L,z;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,s3(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),s3(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),s3(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),s3(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),s3(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(upe(r.validationData)?s3(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(u=ape(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),h=dle(r.callbacks,r.yieldEvery),d=null==r.verbose?1:r.verbose,f=mle(h,d,r.epochs,null,null,spe(n,r),null,i,p),m=f.callbackList,v=f.history,m.setModel(t),t.history=v,e.next=22,m.onTrainBegin();case 22:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:y=e.sent;case 27:if(!(g<r.epochs)){e.next=98;break}return b={},e.next=31,m.onEpochBegin(g);case 31:if(x=0,k=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:y=e.sent;case 37:if(a&&!(x<r.batchesPerEpoch)){e.next=91;break}return e.next=40,y.next();case 40:if(I=e.sent,!a||!I.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(x," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==I.value){e.next=73;break}return S=npe(t,I.value),N=S.xs,T=S.ys,(C={}).batch=k,C.size=N[0].shape[0],e.next=51,m.onBatchBegin(k,C);case 51:if(E=[],null==r.classWeight){e.next=64;break}_=Qle(r.classWeight,t.outputNames),A=0;case 55:if(!(A<_.length)){e.next=64;break}return e.t0=E,e.next=59,Zle(T[A],null,_[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(R=N.concat(T).concat(E),F=c(R),G7(R),D=0;D<l.length;++D)M=l[D],O=F[D],C[M]=O,H7(O);return e.next=70,m.onBatchEnd(k,C);case 70:sle(C),k++,x++;case 73:if(!(a?x>=r.batchesPerEpoch:I.done)){e.next=87;break}if(!i){e.next=86;break}if(L=void 0,!upe(r.validationData)){e.next=84;break}return e.t2=Zse,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,L=(0,e.t2)(e.t3),e.next=85;break;case 84:L=Zse(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?tpe:r.validationBatchSize,verbose:0}));case 85:for(z=0;z<t.metricsNames.length;++z)b["val_".concat(t.metricsNames[z])]=L[z];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,m.onEpochEnd(g,b);case 93:if(g++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,m.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),ope.apply(this,arguments)}function spe(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function upe(e){return"function"===typeof e.iterator}function cpe(e,t,n){return lpe.apply(this,arguments)}function lpe(){return lpe=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new jse("Verbose mode is not implemented yet.");case 6:if(s3(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),"function"!==typeof n.next){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,u=0,c=0,l=w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=U7((function(){if(n.value){var e=npe(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=U7((function(){return i(s)}));if(G7(s),0===c)for(var p=0;p<l.length;++p)o.push(eee(0));for(var h=s[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=U7((function(){return q7(o[e],Y7(h,t))})),c>0&&G7(n)},f=0;f<l.length;++f)d(f);G7(l),u+=h,++c}return o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(l(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(p=0;p<o.length;++p)h=o[p],o[p]=X7(o[p],u),G7(h);return e.abrupt("return",Qse(o));case 27:case"end":return e.stop()}}),e)}))),lpe.apply(this,arguments)}function ppe(e){s3(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function hpe(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return Uue(e,t,n-t)})):Uue(e,t,n-t)}function dpe(e,t){return U7((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return dpe(e,t)})):Jue(e,"int32"===t.dtype?t:z7(t,"int32"))}))}function fpe(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function mpe(e){var t=[];e instanceof j8&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(Vue(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function vpe(e,t){if(null!=e){var n=[];if(t instanceof j8)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof j8)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function gpe(e){return Array.isArray(e)}function ype(e){return!function(e){return e instanceof j8}(e)&&!gpe(e)}function bpe(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(gpe(e)&&e.length>0)o=!0;else if(ype(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new Hse("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(ype(e)){r=[];var u,c=Se(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new Hse('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch(aGe){c.e(aGe)}finally{c.f()}}else if(gpe(e)){if(e.length!==t.length)throw new Hse("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new Hse("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=mpe(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var h=r[p];if(h.shape.length!==n[p].length)throw new Hse("Error when checking ".concat(i,": expected ").concat(t[p]," ")+"to have ".concat(n[p].length," dimension(s). but got array with ")+"shape ".concat(h.shape));for(var d=0;d<n[p].length;++d)if(0!==d||a){var f=h.shape[d],m=n[p][d];if(null!=m&&m>=0&&f!==m)throw new Hse("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[p].slice(1,n[p].length),"] ")+"(i.e.,tensor shape [*,".concat(n[p].slice(1,n[p].length),"])")+" but the ".concat(i," received an input with ").concat(h.shape[0])+" examples, each with shape [".concat(h.shape.slice(1,h.shape.length),"]")+" (tensor shape [".concat(h.shape,"])"))}}return r}function xpe(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Hse("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new Hse("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new Hse("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new Hse("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var kpe=function(t){ye(r,t);var n=be(r);function r(e){var t;return xe(this,r),(t=n.call(this,e)).isTraining=!1,t}return we(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Hse("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Vle(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return sae.adagrad(.01)},Adadelta:function(){return sae.adadelta(1,.95,Bue())},Adam:function(){return sae.adam(.001,.9,.999,Bue())},Adamax:function(){return sae.adamax(.002,.9,.999,Bue(),0)},RMSProp:function(){return sae.rmsprop(.001,.9,0,Bue())},SGD:function(){return sae.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Hse("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof aee))throw new Hse("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Hse("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return Ele(e)}))}else{var a=Ele(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new Hse('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=Se(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(Ele(e.loss[u]))}}catch(aGe){s.e(aGe)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c],p=this.outputNames[c];this.feedOutputNames.push(p),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var h=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Eue("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===h.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=Se(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(aGe){i.e(aGe)}finally{i.f()}return a}(e.metrics,this.outputNames);Eue("metric",(function(){for(var e=function(e){if(-1!==h.indexOf(e))return"continue";!function(n){var r,a,i,o,s=Se(n);try{var u=function(){var n,s=o.value;if("string"===typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Sle?-1!==["accuracy","acc"].indexOf(s)?a=_le:-1!==["crossentropy","ce"].indexOf(s)&&(a=Fle):t.lossFunctions[e]===Ile?-1!==["accuracy","acc"].indexOf(s)?a=Dle:-1!==["crossentropy","ce"].indexOf(s)&&(a=Ole):-1!==["accuracy","acc"].indexOf(s)?a=Ale:-1!==["crossentropy","ce"].indexOf(s)&&(a=Mle),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else{var l=function(e){if("string"===typeof e&&e in Lle)return Lle[e];if("string"!==typeof e&&null!=e)return e;throw new Hse("Unknown metric ".concat(e))}(s);i=l,r=""+zle(s)}Eue(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(aGe){s.e(aGe)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;ppe(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return Qse(this.testLoop(o,i,r,n.verbose,n.steps))}finally{vpe(a[0],e),vpe(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",cpe(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new Hse("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new Hse("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new Hse("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new Vce;if(e instanceof j8&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Hse("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=Se(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new Hse("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(aGe){u.e(aGe)}finally{u.f()}}var p=Hce(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=Xse(null,e.length),r=e.length,a=Se(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(aGe){a.e(aGe)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new Hse("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return U7((function(){var a=t.checkNumSamples(e);if(r)throw new jse("Verbose predictLoop() is not implemented yet.");for(var i=fpe(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){U7((function(){var r=i[n][0],a=i[n][1],o=hpe(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new Vce(s);return Hce(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return Qse(o.map((function(e){return Tte(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=mpe(e);xpe(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return ppe(r),this.predictLoop(n,r)}finally{vpe(n,e)}}},{key:"predictOnBatch",value:function(e){xpe(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new Gse("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===Ile?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=oue(e.map((function(e){return e.shape[0]})));r.sort();var a=oue(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new Hse("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new Hse("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!p3(r,a))throw new Hse("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}(e=bpe(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=bpe(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[yle,Sle,wle],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===wle&&1===i.shape[i.shape.length-1])throw new Hse("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],h=c[l];if(null!=h&&p!==h)throw new Hse("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new Hse("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(f.length>4&&void 0!==f[4])||f[4],o=f.length>5?f[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=C(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}h=Qle(a,this.outputNames),p=[],d=0;case 10:if(!(d<h.length)){e.next=19;break}return e.t0=p,e.next=14,Zle(l[d],null,h[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return U7((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new jse("Verbose mode is not implemented yet.");if(null!=i)throw new jse("steps mode in testLoop() is not implemented yet");for(var u=fpe(o,n),c=Kne(Pue(0,o)),l=0;l<u.length;++l){var p=u[l][0],h=u[l][1],d=Uue(c,p,h-p),f=dpe(t,d),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(eee(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=q7(s[g],Y7(h-p,y))}}for(var b=0;b<s.length;++b)s[b]=X7(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(Jse(e,r)>1){var i=Jse(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new Vce(t),l=Hce(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var h=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(h=epe(h,i[p]));var d=one(h);n.push(d),u=0===p?h:q7(u,h)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][0],g=e.metricsTensors[f][1];m=one(v(a[g],l[g]))}H7(m),o.push(m)}return u=one(u),e.calculateLosses().forEach((function(e){u=q7(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return U7((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new Vce(o),c=Hce(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],h=one(p(i[l],c[l]));n=0===l?h:q7(n,h),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var f=e.metricsTensors[d][0],m=e.metricsTensors[d][1],v=one(f(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=E.length>2&&void 0!==E[2]?E[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,ppe(d=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,d);case 10:if(f=e.sent,a=f[0],i=f[1],h=f[2],m=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=36;break}if(m=!0,2!==r.validationData.length){e.next=22;break}u=r.validationData[0],c=r.validationData[1],e.next=27;break;case 22:if(3!==r.validationData.length){e.next=26;break}throw new jse("validationData including sample weights is not supported yet.");case 26:throw new Hse("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(r.validationData," is invalid."));case 27:return!0,e.next=30,this.standardizeUserData(u,c,null,null,true,d);case 30:g=e.sent,l=g[0],p=g[1],v=l.concat(p),e.next=37;break;case 36:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(m=!0,y=Math.floor(a[0].shape[0]*(1-r.validationSplit)),b=a[0].shape[0],l=hpe(a,y,b),o=a,a=hpe(a,0,y),p=hpe(i,y,b),s=i,i=hpe(i,0,y),v=l.concat(p)):null!=r.validationSteps&&(m=!0);case 37:return x=a.concat(i).concat(h),this.checkTrainableWeightsConsistency(),k=this.makeTrainFunction(),I=this.getDedupedMetricsNames(),m?(this.makeTestFunction(),S=this.testFunction,N=I.slice().concat(I.map((function(e){return"val_"+e})))):(S=null,v=[],N=I.slice()),T=dle(r.callbacks,r.yieldEvery),e.next=45,this.fitLoop(k,x,I,d,r.epochs,r.verbose,T,S,v,r.shuffle,N,r.initialEpoch,null,null);case 45:return C=e.sent,e.abrupt("return",C);case 47:return e.prev=47,this.isTraining=!1,vpe(a,t),vpe(i,n),vpe(o,t),vpe(s,n),vpe(l,u),vpe(p,c),null!=h&&G7(h),e.finish(47);case 57:case"end":return e.stop()}}),e,this,[[4,,47,57]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=S(w().mark((function e(t,n,r,a,i,o,s,u,c,l,p,h,d,f){var m,v,g,y,b,x,k,I,S=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==h&&(h=0),m=!1,null!=u&&null!=c&&(m=!0),null==f){e.next=10;break}if(m=!0,null!=d){e.next=10;break}throw new Hse("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(v=this.checkNumSamples(n,a,d,"steps_per_epoch"))&&(g=Pue(0,v)),null==o&&(o=1),y=mle(s,o,i,h,v,d,a,m,p),b=y.callbackList,x=y.history,b.setModel(this),this.history=x,e.next=18,b.onTrainBegin();case 18:this.stopTraining_=!1,k=w().mark((function e(){var i,o,s,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.onEpochBegin(I);case 2:if(i={},null==d){e.next=7;break}throw new jse("stepsPerEpoch mode is not implemented yet.");case 7:if("batch"!==l){e.next=11;break}throw new jse("batch shuffling is not implemneted yet");case 11:l&&n3(g);case 12:o=Kne(g),s=fpe(v,a),p=w().mark((function e(l){var p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,b.onBatchBegin(l,p);case 3:return U7((function(){var e=s[l][0],h=s[l][1],d=Uue(o,e,h-e);p.batch=l,p.size=h-e;for(var f=dpe(n,d),v=t(f),g=0;g<r.length;++g){var y=r[g],b=v[g];p[y]=b,H7(b)}if(l===s.length-1&&m)for(var x=S.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],I=x[k];H7(I),i["val_"+w]=I}})),e.next=6,b.onBatchEnd(l,p);case 6:if(sle(p),!S.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 16:if(!(h<s.length)){e.next=24;break}return e.delegateYield(p(h),"t0",18);case 18:if("break"!==e.t0){e.next=21;break}return e.abrupt("break",24);case 21:++h,e.next=16;break;case 24:o.dispose();case 25:return e.next=27,b.onEpochEnd(I,i);case 27:if(!S.stopTraining_){e.next=29;break}return e.abrupt("return","break");case 29:case"end":return e.stop()}}),e)})),I=h;case 21:if(!(I<i)){e.next=29;break}return e.delegateYield(k(),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++I,e.next=21;break;case 29:return e.next=31,b.onTrainEnd();case 31:return e.next=33,this.history.syncData();case 33:return e.abrupt("return",this.history);case 34:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,p,h,d,f){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ipe(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),u=[],c=Se(s),e.prev=9,c.s();case 11:if((l=c.n()).done){e.next=19;break}return p=l.value,e.next=15,p.data();case 15:h=e.sent,u.push(h[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return G7(s),vpe(r[0],t),vpe(r[1],n),e.abrupt("return",Qse(u));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=pe(le(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=V7().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-V7().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=$se(this.loss);else if(Array.isArray(this.loss)){var t,n=Se(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(aGe){n.e(aGe)}finally{n.f()}e=this.loss.map((function(e){return $se(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=$se(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[$se(zle(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return $se(zle(e))}));var e={};for(var t in this.metrics)e[t]=$se(zle(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=vle(qle(e.optimizer_config));if("string"===typeof e.loss)t=eue(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return eue(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=eue(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return eue(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=eue(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var t=S(w().mark((function t(n,r){var a,i,o,s,u,c,l,p,h;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof n){t.next=9;break}if(0!==(a=J9(n)).length){t.next=6;break}throw new Hse("Cannot find any save handlers for URL '".concat(n,"'"));case 6:if(!(a.length>1)){t.next=8;break}throw new Hse("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(n,"'"));case 8:n=a[0];case 9:if(null!=n.save){t.next=11;break}throw new Hse("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return t.next=13,A9(this.getNamedWeights(r));case 13:if(i=t.sent,!1,null,o=this.toJSON(null,false),s={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(Xle),convertedBy:null},!(null!=r&&r.includeOptimizer)||null==this.optimizer){t.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",t.t0=e,t.next=25,this.optimizer.getWeights();case 25:return t.t1=t.sent,t.t2=c,t.next=29,t.t0.encodeWeights.call(t.t0,t.t1,t.t2);case 29:l=t.sent,p=l.data,h=l.specs,(u=i.specs).push.apply(u,Ie(h)),i.data=P9([i.data,p]);case 34:return null!=this.userDefinedMetadata&&(!0,Ble(this.userDefinedMetadata,this.name,true),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=i.data,s.weightSpecs=i.specs,t.abrupt("return",n.save(s));case 38:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){Ble(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(Yle);kpe.className="Model",ree(kpe);var wpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(kpe);wpe.className="Functional",ree(wpe);var Ipe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:vue("sequential_"),null!=e.layers){var a,i=Se(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(aGe){i.e(aGe)}finally{i.f()}}return r}return we(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new Hse("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof kpe;if(r){if(1!==(t=e).outputs.length)throw new Hse("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new Hse("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Hse("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Hse("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Wce({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new Hse("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new Hse("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Bce(this.outputs[0])}this.inboundNodes=[],new Lce({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Xse(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Cce(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new kpe({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),pe(le(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),pe(le(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new Gse("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Gse("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=S(w().mark((function e(t,n){var r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new Gse("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Gse("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new Hse("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new Hse("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=Se(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(aGe){n.e(aGe)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Hse("Legacy serialization format not supported yet.");r=t}else s3(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new jse("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=Se(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=vle(c,undefined,a);a&&l.setFastWeightInitDuringBuild(!0),o.add(l)}}catch(aGe){u.e(aGe)}finally{u.f()}return o}}]),n}(kpe);Ipe.className="Sequential",ree(Ipe);var Spe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"getConfig",value:function(){return{}}}]),n}(tee),Npe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new jse("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return Wte(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(Spe);Npe.className="elu",ree(Npe);var Tpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Dne(e)}}]),n}(Spe);Tpe.className="selu",ree(Tpe);var Cpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Rne(e)}}]),n}(Spe);Cpe.className="relu",ree(Cpe);var Epe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return U7((function(){return une(6,Rne(e))}))}}]),n}(Spe);Epe.className="relu6",ree(Epe);var _pe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return e}}]),n}(Spe);_pe.className="linear",ree(_pe);var Ape=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return One(e)}}]),n}(Spe);Ape.className="sigmoid",ree(Ape);var Rpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){return U7((function(){var t=q7(.5,Y7(.2,e));return Nte(t,0,1)}))}(e)}}]),n}(Spe);Rpe.className="hardSigmoid",ree(Rpe);var Fpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Une(e)}}]),n}(Spe);Fpe.className="softplus",ree(Fpe);var Dpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return function(e){return U7((function(){return X7(e,q7(pee(e),1))}))}(e)}}]),n}(Spe);Dpe.className="softsign",ree(Dpe);var Mpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return qne(e)}}]),n}(Spe);Mpe.className="tanh",ree(Mpe);var Ope=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return Vne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Spe);Ope.className="softmax",ree(Ope);var Lpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return tne(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Spe);Lpe.className="logSoftmax",ree(Lpe);var zpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return U7((function(){return Y7(One(Y7(e,t)),e)}))}}]),n}(Spe);zpe.className="swish",ree(zpe);var Ppe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e){return U7((function(){return Y7(e,qne(Une(e)))}))}}]),n}(Spe);function Bpe(e){return e.getClassName()}function Wpe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return aue(e,nee.getMap().classNameMap,t,"activation")}function Vpe(e){if(null==e){var t={className:"linear",config:{}};return Wpe(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},Wpe(n)}return e instanceof Spe?e:Wpe(e)}function Upe(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}Ppe.className="mish",ree(Ppe);var Gpe=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(tee),Hpe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this),Upe(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return we(n,[{key:"apply",value:function(e){var t=this;return U7((function(){var n=xne([1]);return t.hasL1&&(n=q7(n,ene(Y7(t.l1,pee(e))))),t.hasL2&&(n=q7(n,ene(Y7(t.l2,Que(e))))),gte(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(Gpe);Hpe.className="L1L2",ree(Hpe);var jpe={l1l2:"L1L2"};function qpe(e){return nue(e)}function Kpe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return aue(e,nee.getMap().classNameMap,t,"regularizer")}function Xpe(e){return null==e?null:"string"===typeof e?Kpe({className:e in jpe?jpe[e]:e,config:{}}):e instanceof Gpe?e:Kpe(e)}var Ype=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return we(n,[{key:"call",value:function(e,t){e=Tce(e);var n=Rne(e);return null!=this.maxValue&&(n=Nte(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Ype.className="ReLU",ree(Ype);var Jpe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return we(n,[{key:"call",value:function(e,t){var n=Tce(e);return Jte(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Jpe.className="LeakyReLU",ree(Jpe);var Qpe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Ice(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=Xpe(e.alphaRegularizer),r.alphaConstraint=ale(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new Hse("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return we(n,[{key:"build",value:function(e){var t=(e=Cce(e)).slice(1);if(null!=this.sharedAxes){var n,r=Se(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(aGe){r.e(aGe)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Dce({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Tce(e),Sne(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:wce(this.alphaInitializer),alphaRegularizer:qpe(this.alphaRegularizer),alphaConstraint:nle(this.alphaConstraint),sharedAxes:this.sharedAxes},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Qpe.className="PReLU",ree(Qpe);var Zpe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new jse("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return we(n,[{key:"call",value:function(e,t){var n=Tce(e);return Wte(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Zpe.className="ELU",ree(Zpe);var $pe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return we(n,[{key:"call",value:function(e,t){var n=Tce(e);return Y7(n,z7(Xte(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);$pe.className="ThresholdedReLU",ree($pe);var ehe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Ope).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return we(n,[{key:"call",value:function(e,t){var n=Tce(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);function the(e,t,n){if("number"===typeof e)return Xse(e,t);if(e.length!==t)throw new Hse("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!Mue(a))throw new Hse("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function nhe(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function rhe(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+zue([n-t,0]);else{if("same"!==r)throw new Hse("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function ahe(e,t){return U7((function(){return Iue(t),"channelsFirst"===t?$ne(e,[0,2,3,1]):e}))}function ihe(e,t){return U7((function(){return Iue(t),"channelsFirst"===t?$ne(e,[0,2,3,4,1]):e}))}function ohe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return U7((function(){if(null==i&&(i="channelsLast"),Iue(i),3!==e.shape.length)throw new Hse("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new Hse("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new Hse("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=$ne(e,[0,2,1])),"causal"===a)throw new jse("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Fte(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=$ue(s,n)),s}))}function she(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return U7((function(){if(null==i&&(i="channelsLast"),Iue(i),3!==e.rank&&4!==e.rank)throw new Hse("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Hse("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=ahe(e,i);if("causal"===a)throw new jse("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=hre({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=$ne(u,[0,3,1,2])),u}))}function uhe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return U7((function(){if(null==i&&(i="channelsLast"),Iue(i),4!==e.rank&&5!==e.rank)throw new Hse("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new Hse("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=ihe(e,i);if("causal"===a)throw new jse("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=Ote(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=$ue(s,n)),"channelsFirst"===i&&(s=$ne(s,[0,4,1,2,3])),s}))}ehe.className="Softmax",ree(ehe);var che=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,lue(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new jse("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=the(r.kernelSize,e,"kernelSize"),a.strides=the(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Sue(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Iue(a.dataFormat),a.activation=Vpe(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Ice(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=ale(r.biasConstraint),a.biasRegularizer=Xpe(r.biasRegularizer),a.activityRegularizer=Xpe(r.activityRegularizer),a.dilationRate=the(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new Hse("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new Hse("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new Hse("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return we(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Bpe(this.activation),useBias:this.useBias,biasInitializer:wce(this.biasInitializer),biasRegularizer:qpe(this.biasRegularizer),activityRegularizer:qpe(this.activityRegularizer),biasConstraint:nle(this.biasConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(Yse("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!cue(e.kernelSize,"number",1,3))throw new Hse("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Pce),lhe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,lue(a.filters,"filters"),a.kernelInitializer=Ice(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=ale(r.kernelConstraint),a.kernelRegularizer=Xpe(r.kernelRegularizer),a}return we(n,[{key:"build",value:function(e){e=Cce(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hse("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:oe({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t;e=Tce(e);var r=null==n.bias?null:n.bias.read(),a=hue(n.activation.getClassName());if(null!=a&&2===n.rank)t=she(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=ohe(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=she(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new jse("convolutions greater than 3D are not implemented yet.");t=uhe(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Cce(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=nhe(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:wce(this.kernelInitializer),kernelRegularizer:qpe(this.kernelRegularizer),kernelConstraint:nle(this.kernelConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new Hse("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(che),phe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!cue(e.kernelSize,"number",1,2))throw new Hse("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lhe);phe.className="Conv2D",ree(phe);var hhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Hse("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lhe);hhe.className="Conv3D",ree(hhe);var dhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).inputSpec=[new Dce({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new Hse("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return we(n,[{key:"build",value:function(e){if(4!==(e=Cce(e)).length)throw new Hse("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hse("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dce({ndim:4,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e);if(4!==t.shape.length)throw new Hse("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],h=n.strides[1],d=[o,rhe(s,p,c,n.padding),rhe(u,h,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=$ne(t,[0,2,3,1]));var f=Mte(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(f=$ne(f,[0,3,1,2])),null!=n.bias&&(f=$ue(f,n.bias.read(),n.dataFormat)),null!=n.activation&&(f=n.activation.apply(f)),f}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Cce(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=rhe(a[n],s,i,this.padding),a[r]=rhe(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(phe);dhe.className="Conv2DTranspose",ree(dhe);var fhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).inputSpec=[new Dce({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new Hse("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return we(n,[{key:"build",value:function(e){if(5!==(e=Cce(e)).length)throw new Hse("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hse("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dce({ndim:5,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e);if(5!==t.shape.length)throw new Hse("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],h=n.kernelSize[1],d=n.kernelSize[2],f=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,rhe(u,f,p,n.padding),rhe(c,m,h,n.padding),rhe(l,v,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=$ne(t,[0,2,3,4,1]));var y=zte(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=$ne(y,[0,4,1,2,3])),null!==n.bias&&(y=$ue(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Cce(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=rhe(i[n],c,o,this.padding),i[r]=rhe(i[r],l,s,this.padding),i[a]=rhe(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(hhe);fhe.className="Conv3DTranspose",ree(fhe);var mhe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;if(xe(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new Hse("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new Hse("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new Hse("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Ice(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=Xpe(r.depthwiseRegularizer),a.depthwiseConstraint=ale(r.depthwiseConstraint),a.pointwiseInitializer=Ice(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=Xpe(r.pointwiseRegularizer),a.pointwiseConstraint=ale(r.pointwiseConstraint),a}return we(n,[{key:"build",value:function(e){if((e=Cce(e)).length<this.rank+2)throw new Hse("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Hse("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Dce({ndim:this.rank+2,axes:oe({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t;if(e=Tce(e),1===n.rank)throw new jse("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=$ne(e,[0,2,3,1])),t=Mne(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=$ue(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=$ne(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=wce(this.depthwiseInitializer),e.pointwiseInitializer=wce(this.pointwiseInitializer),e.depthwiseRegularizer=qpe(this.depthwiseRegularizer),e.pointwiseRegularizer=qpe(this.pointwiseRegularizer),e.depthwiseConstraint=nle(this.depthwiseConstraint),e.pointwiseConstraint=nle(this.pointwiseConstraint),e}}]),n}(lhe);mhe.className="SeparableConv";var vhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,2,e)}return we(n)}(mhe);vhe.className="SeparableConv2D",ree(vhe);var ghe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return we(n,[{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!cue(e.kernelSize,"number",1,1))throw new Hse("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(lhe);ghe.className="Conv1D",ree(ghe);var yhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return we(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(e=Tce(e),"channelsLast"===n.dataFormat){var t=Hue(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return Hue(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=Hue(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return Hue(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);yhe.className="Cropping2D",ree(yhe);var bhe=function(e){ye(n,e);var t=be(n);function n(e){var r,a;return xe(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Iue(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,uue(yue,"InterpolationFormat",a),r}return we(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=$ne(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?aae.resizeNearestNeighbor(t,[a,i]):aae.resizeBilinear(t,[a,i]);return $ne(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?aae.resizeNearestNeighbor(t,[s,u]):aae.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);bhe.className="UpSampling2D",ree(bhe);var xhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Ice(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=ale(e.depthwiseConstraint),r.depthwiseRegularizer=Xpe(e.depthwiseRegularizer),r}return we(n,[{key:"build",value:function(e){if((e=Cce(e)).length<4)throw new Hse("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Hse("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return U7((function(){null==a&&(a="channelsLast"),Iue(a);var o=ahe(e,a);if(4!==e.rank)throw new Hse("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new Hse("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=Bte(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=$ne(o,[0,3,1,2])),o}))}(e=Tce(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=$ue(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Cce(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=nhe(t,this.kernelSize[0],this.padding,this.strides[0]),i=nhe(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=wce(this.depthwiseInitializer),e.depthwiseRegularizer=qpe(this.depthwiseRegularizer),e.depthwiseConstraint=nle(this.depthwiseRegularizer),e}}]),n}(che);function khe(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Hse("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function whe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return U7((function(){var u=t.shape.length;if(u<3)throw new Hse("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Pue(2,u));if(t=$ne(t,c),null!=i)throw new jse("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=z7(z7(a,"bool"),"float32")).rank===u-1&&(a=Gte(a,-1)),a=$ne(a,c)),r&&(t=Fne(t,0),null!=a&&(a=Fne(a,0)));var l,p,h=[],d=n,f=t.shape[0],m=Yne(t);null!=a&&(p=Yne(a));for(var v,g=function(t){var n=m[t],r=U7((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=U7((function(){var e=p[t],n=cee(wne(e),e);return{output:q7(Y7(r[0],e),Y7(d[0],n)),newStates:d.map((function(t,a){return q7(Y7(r[1][a],e),Y7(t,n))}))}}));l=i.output,d=i.newStates}s&&h.push(l)},y=0;y<f;++y)g(y);if(s){v=jne(h,1)}return[l,v,d]}))}xhe.className="DepthwiseConv2D",ree(xhe);var Ihe=function(e){ye(n,e);var t=be(n);function n(e){var r,a;if(xe(this,n),r=t.call(this,e),null==e.cell)throw new Hse("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new Rhe({cells:e.cell}):e.cell).stateSize)throw new Hse("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Dce({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return we(n,[{key:"getStates",value:function(){return null==this.states_?Pue(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Sce(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=Se(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(aGe){o.e(aGe)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return U7((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new jse("Constants support is not implemented in RNN yet.");Sce(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Dce({shape:[t,null].concat(Ie(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!p3(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new Hse("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Dce({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U7((function(){if(!t.stateful)throw new Use("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new Hse("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return xne([r,e])})):t.states_=[xne([r,t.cell.stateSize])];else if(null==e)G7(t.states_),null!=t.keptStates&&(G7(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return xne([r,e])})):t.states_[0]=xne([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Hse("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):G7(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!p3(i.shape,s))throw new Hse("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return H7(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=khe(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=Se(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Dce({shape:l.shape}))}}catch(aGe){c.e(aGe)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Mce){var p=[e].concat(o),h=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=h;var f=pe(le(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=d,f}return pe(le(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Tce(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new Hse("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=whe((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var h=n.returnSequences?l:c;return n.returnState?[h].concat(p):h}))}},{key:"getInitialState",value:function(e){var t=this;return U7((function(){var n=xne(e.shape);return n=Vue(n=ene(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Kue(n,[1,e]):n})):t.cell.stateSize>1?[Kue(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=vle(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(Pce);Ihe.className="RNN",ree(Ihe);var She=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n)}(Pce),Nhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,lue(r.units,"units"),r.activation=Vpe(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ice(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ice(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ice(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Xpe(e.kernelRegularizer),r.recurrentRegularizer=Xpe(e.recurrentRegularizer),r.biasRegularizer=Xpe(e.biasRegularizer),r.kernelConstraint=ale(e.kernelConstraint),r.recurrentConstraint=ale(e.recurrentConstraint),r.biasConstraint=ale(e.biasConstraint),r.dropout=Lue([1,zue([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lue([1,zue([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return we(n,[{key:"build",value:function(e){e=Cce(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(2!==e.length)throw new Hse("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Fhe({ones:function(){return wne(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Fhe({ones:function(){return wne(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=Yue(null!=o?Y7(e,o):e,n.kernel.read()),null!=n.bias&&(a=$ue(a,n.bias.read())),null!=s&&(r=Y7(r,s));var u=q7(a,Yue(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Bpe(this.activation),useBias:this.useBias,kernelInitializer:wce(this.kernelInitializer),recurrentInitializer:wce(this.recurrentInitializer),biasInitializer:wce(this.biasInitializer),kernelRegularizer:qpe(this.kernelRegularizer),recurrentRegularizer:qpe(this.recurrentRegularizer),biasRegularizer:qpe(this.biasRegularizer),activityRegularizer:qpe(this.activityRegularizer),kernelConstraint:nle(this.kernelConstraint),recurrentConstraint:nle(this.recurrentConstraint),biasConstraint:nle(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(She);Nhe.className="SimpleRNNCell",ree(Nhe);var The=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),e.cell=new Nhe(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return U7((function(){null!=r.cell.dropoutMask&&(G7(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(G7(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Ihe);The.className="SimpleRNN",ree(The);var Che=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Hse("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,lue(r.units,"units"),r.activation=Vpe(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Vpe(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ice(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ice(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ice(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=Xpe(e.kernelRegularizer),r.recurrentRegularizer=Xpe(e.recurrentRegularizer),r.biasRegularizer=Xpe(e.biasRegularizer),r.kernelConstraint=ale(e.kernelConstraint),r.recurrentConstraint=ale(e.recurrentConstraint),r.biasConstraint=ale(e.biasConstraint),r.dropout=Lue([1,zue([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lue([1,zue([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return we(n,[{key:"build",value:function(e){var t=(e=Cce(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(2!==e.length)throw new Hse("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Fhe({ones:function(){return wne(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Fhe({ones:function(){return wne(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Y7(e,u[0]));var l=Yue(e,n.kernel.read());n.useBias&&(l=$ue(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Y7(a,c[0]));var p=n.recurrentKernel.read(),h=C(Gne(p,[2*n.units,n.units],p.rank-1),2),d=h[0],f=h[1],m=Yue(a,d),v=C(Gne(l,3,l.rank-1),3),g=v[0],y=v[1],b=v[2],x=C(Gne(m,2,m.rank-1),2),k=x[0],w=x[1];i=n.recurrentActivation.apply(q7(g,k)),o=n.recurrentActivation.apply(q7(y,w));var I=Yue(Y7(o,a),f);s=n.activation.apply(q7(b,I));var S=q7(Y7(i,a),Y7(q7(1,gne(i)),s));return[S,S]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Bpe(this.activation),recurrentActivation:Bpe(this.recurrentActivation),useBias:this.useBias,kernelInitializer:wce(this.kernelInitializer),recurrentInitializer:wce(this.recurrentInitializer),biasInitializer:wce(this.biasInitializer),kernelRegularizer:qpe(this.kernelRegularizer),recurrentRegularizer:qpe(this.recurrentRegularizer),biasRegularizer:qpe(this.biasRegularizer),activityRegularizer:qpe(this.activityRegularizer),kernelConstraint:nle(this.kernelConstraint),recurrentConstraint:nle(this.recurrentConstraint),biasConstraint:nle(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(She);Che.className="GRUCell",ree(Che);var Ehe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Che(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return U7((function(){null!=r.cell.dropoutMask&&(G7(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(G7(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Ihe);Ehe.className="GRU",ree(Ehe);var _he=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,lue(r.units,"units"),r.activation=Vpe(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Vpe(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ice(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ice(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ice(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=Xpe(e.kernelRegularizer),r.recurrentRegularizer=Xpe(e.recurrentRegularizer),r.biasRegularizer=Xpe(e.biasRegularizer),r.kernelConstraint=ale(e.kernelConstraint),r.recurrentConstraint=ale(e.recurrentConstraint),r.biasConstraint=ale(e.biasConstraint),r.dropout=Lue([1,zue([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lue([1,zue([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return we(n,[{key:"build",value:function(e){var t,n,r=(e=Cce(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new oce).apply([i]),o=a.apply([2*i]);return que(que(n,r),o)}}]),n}(ace),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new Hse("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Fhe({ones:function(){return wne(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Fhe({ones:function(){return wne(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Y7(e,l[0]));var h=Yue(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Y7(a,p[0])),h=q7(h,Yue(a,n.recurrentKernel.read())),n.useBias&&(h=$ue(h,n.bias.read()));var d=C(Gne(h,4,h.rank-1),4),f=d[0],m=d[1],v=d[2],g=d[3];o=n.recurrentActivation.apply(f),s=n.recurrentActivation.apply(m),u=q7(Y7(s,i),Y7(o,n.activation.apply(v))),c=n.recurrentActivation.apply(g);var y=Y7(c,n.activation.apply(u));return[y,y,u]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Bpe(this.activation),recurrentActivation:Bpe(this.recurrentActivation),useBias:this.useBias,kernelInitializer:wce(this.kernelInitializer),recurrentInitializer:wce(this.recurrentInitializer),biasInitializer:wce(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:qpe(this.kernelRegularizer),recurrentRegularizer:qpe(this.recurrentRegularizer),biasRegularizer:qpe(this.biasRegularizer),activityRegularizer:qpe(this.activityRegularizer),kernelConstraint:nle(this.kernelConstraint),recurrentConstraint:nle(this.recurrentConstraint),biasConstraint:nle(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(She);_he.className="LSTMCell",ree(_he);var Ahe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new _he(e),t.call(this,e)}return we(n,[{key:"call",value:function(e,t){var r=this;return U7((function(){null!=r.cell.dropoutMask&&(G7(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(G7(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Ihe);Ahe.className="LSTM",ree(Ahe);var Rhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).cells=e.cells,r}return we(n,[{key:"stateSize",get:function(){var e,t=[],n=Se(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Ie(r.stateSize)):t.push(r.stateSize)}}catch(aGe){n.e(aGe)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r,a=e.slice(1),i=[],o=Se(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(aGe){o.e(aGe)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var h,d=Se(c.slice().reverse());try{for(d.s();!(h=d.n()).done;){var f,m=h.value;(f=a).push.apply(f,Ie(m))}}catch(aGe){d.e(aGe)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Sce(e)&&(e=e[0]),this.cells.forEach((function(n,r){Eue("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.trainableWeights))}}catch(aGe){n.e(aGe)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.nonTrainableWeights))}}catch(aGe){n.e(aGe)}finally{n.f()}if(!this.trainable){var a,i=[],o=Se(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Ie(s.trainableWeights))}}catch(aGe){o.e(aGe)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=Se(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Ie(r.weights))}}catch(aGe){n.e(aGe)}finally{n.f()}return Rce(t)}},{key:"setWeights",value:function(e){var t,n=[],r=Se(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(aGe){r.e(aGe)}finally{r.f()}Fce(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=Se(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(vle(o,r))}}catch(aGe){i.e(aGe)}finally{i.f()}return new e({cells:a})}}]),n}(She);function Fhe(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):ece(t(),n)},c=function(){return tce(u,t,a)};return!o||o<=1?H7(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return H7(e.clone())}))}Rhe.className="StackedRNNCells",ree(Rhe);var Dhe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Mhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),e.unroll)throw new jse("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new jse("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Dce({ndim:5})],r}return we(n,[{key:"call",value:function(e,t){var r=this;return U7((function(){if(null!=r.cell.dropoutMask&&(G7(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(G7(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new Hse("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return pe(le(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Ie(t.slice(2)))),this.returnState&&(t=[t].concat(Ie(Array(2).fill([e[0]].concat(Ie(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return U7((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=xne([a[0]].concat(Ie(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U7((function(){if(!t.stateful)throw new Use("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Ie(a.slice(2)));if(null==r[0])throw new Hse("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return xne(i)})):t.states_=[xne(i)];else if(null==e)G7(t.states_),null!=t.keptStates&&(G7(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return xne(i)})):t.states_[0]=xne(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Hse("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):G7(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!p3(s.shape,u))throw new Hse("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return H7(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=nhe(c,a[0],i,o[0],s[0]),h=nhe(l,a[1],i,o[1],s[1]);return[].concat(Ie(e.slice(0,2)),Ie(u?[r,p,h]:[p,h,r]))}}]),n}(Ihe);Mhe.className="ConvRNN2D";var Ohe=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,lue(r.filters,"filters"),r.kernelSize=the(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return lue(e,"kernelSize")})),r.strides=the(o||1,2,"strides"),r.strides.forEach((function(e){return lue(e,"strides")})),r.padding=s||"valid",Sue(r.padding),r.dataFormat=u||"channelsLast",Iue(r.dataFormat),r.dilationRate=the(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return lue(e,"dilationRate")})),r}return we(n,[{key:"build",value:function(e){var t;e=Cce(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Hse("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"apply",value:function(e,t){return jue([s.apply([u]),kne([u]),s.apply([2*u])])}}]),n}(ace),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(3!==e.length)throw new Hse("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Fhe({ones:function(){return wne(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Y7(t[n],e):e},c=u(a,s,0),l=u(a,s,1),p=u(a,s,2),h=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Fhe({ones:function(){return wne(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var d=n.recurrentDropoutMask,f=u(i,d,0),m=u(i,d,1),v=u(i,d,2),g=u(i,d,3),y=C(Gne(n.kernel.read(),4,3),4),b=y[0],x=y[1],k=y[2],w=y[3],I=C(n.useBias?Gne(n.bias.read(),4):[null,null,null,null],4),S=I[0],N=I[1],T=I[2],E=I[3];c=n.inputConv(c,b,S,n.padding),l=n.inputConv(l,x,N,n.padding),p=n.inputConv(p,k,T,n.padding),h=n.inputConv(h,w,E,n.padding);var _=C(Gne(n.recurrentKernel.read(),4,3),4),A=_[0],R=_[1],F=_[2],D=_[3];f=n.recurrentConv(f,A),m=n.recurrentConv(m,R),v=n.recurrentConv(v,F),g=n.recurrentConv(g,D);var M=n.recurrentActivation.apply(q7(c,f)),O=n.recurrentActivation.apply(q7(l,m)),L=q7(Y7(O,o),Y7(M,n.activation.apply(q7(p,v)))),z=Y7(n.recurrentActivation.apply(q7(h,g)),n.activation.apply(L));return[z,z,L]}))}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t=(e.units,Dhe(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=Rte(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?$ue(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Rte(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(_he);Ohe.className="ConvLSTM2DCell",ree(Ohe);var Lhe=function(e){ye(n,e);var t=be(n);function n(e){xe(this,n);var r=new Ohe(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return we(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Mhe);Lhe.className="ConvLSTM2D",ree(Lhe);var zhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return we(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return tce((function(){return ece(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return pe(le(n.prototype),"dispose",this).call(this)}}]),n}(Pce);zhe.className="Dropout",ree(zhe);var Phe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return we(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(zhe);Phe.className="SpatialDropout1D",ree(Phe);var Bhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,lue(r.units,"units"),r.activation=Vpe(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Ice(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Ice(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=ale(e.kernelConstraint),r.biasConstraint=ale(e.biasConstraint),r.kernelRegularizer=Xpe(e.kernelRegularizer),r.biasRegularizer=Xpe(e.biasRegularizer),r.activityRegularizer=Xpe(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return we(n,[{key:"build",value:function(e){var t=(e=Cce(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:oe({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Cce(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r,a=Tce(e),i=hue(n.activation.getClassName());return null!=i?r=Yue(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=Yue(a,n.kernel.read()),null!=n.bias&&(r=$ue(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:Bpe(this.activation),useBias:this.useBias,kernelInitializer:wce(this.kernelInitializer),biasInitializer:wce(this.biasInitializer),kernelRegularizer:qpe(this.kernelRegularizer),biasRegularizer:qpe(this.biasRegularizer),activityRegularizer:qpe(this.activityRegularizer),kernelConstraint:nle(this.kernelConstraint),biasConstraint:nle(this.biasConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Bhe.className="Dense",ree(Bhe);var Whe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return we(n,[{key:"computeOutputShape",value:function(e){var t,n=Se((e=Cce(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new Hse('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(aGe){n.e(aGe)}finally{n.f()}return[e[0],Oue(e,1)]}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=$ne(r,a)}return function(e){if(e.rank<=1)throw new Hse("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],Oue(e.shape,1)];return gte(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Whe.className="Flatten",ree(Whe);var Vhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=Vpe(e.activation),r}return we(n,[{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:Bpe(this.activation)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Vhe.className="Activation",ree(Vhe);var Uhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return we(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){return function(e,t){return U7((function(){if(2!==e.shape.length)throw new Hse("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return Kue(Vue(e,1),[1,t,1])}))}(e=Tce(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Uhe.className="RepeatVector",ree(Uhe);var Ghe=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return we(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new Hse("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=Oue(e);if(null!==i){if(0===a||u%a!==0)throw new Hse(n);r[i]=u/a}else if(u!==a)throw new Hse(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return gte(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Ghe.className="Reshape",ree(Ghe);var Hhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=Pue(1,e.dims.length+1);if(!p3(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Dce({ndim:r.dims.length+1})],r}return we(n,[{key:"computeOutputShape",value:function(e){var t=(e=Cce(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return $ne(Tce(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Hhe.className="Permute",ree(Hhe);var jhe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Tce(e);return ete(yne(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e),a=ete(yne(r,n.maskValue),-1,!0);return Y7(r,z7(a,r.dtype))}))}}]),n}(Pce);jhe.className="Masking",ree(jhe);var qhe=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(Zse(e.inputLength))}return r.inputDim=e.inputDim,lue(r.inputDim,"inputDim"),r.outputDim=e.outputDim,lue(r.outputDim,"outputDim"),r.embeddingsInitializer=Ice(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=Xpe(e.embeddingsRegularizer),r.activityRegularizer=Xpe(e.activityRegularizer),r.embeddingsConstraint=ale(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return we(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return U7((function(){return n.maskZero?(e=Tce(e),yne(e,Z7(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Cce(e),null==this.inputLength)return[].concat(Ie(e),[this.outputDim]);var t=Zse(this.inputLength);if(t.length!==e.length-1)throw new Hse('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new Hse('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Ie(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);"int32"!==r.dtype&&(r=Wue(r,"int32"));var a=Jue(n.embeddings.read(),gte(r,[r.size]));return gte(a,Cce(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:wce(this.embeddingsInitializer),embeddingsRegularizer:qpe(this.embeddingsRegularizer),activityRegularizer:qpe(this.activityRegularizer),embeddingsConstraint:nle(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);qhe.className="Embedding",ree(qhe);var Khe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return we(n,[{key:"mergeFunction",value:function(e){throw new jse}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new Hse("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Cce(e)]),e.length<2)throw new Hse("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=Se(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(aGe){r.e(aGe)}finally{r.f()}if((n=oue(n)).length>1)throw new Hse("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===oue(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=zue(r),o=Se(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=Vue(s,1);t.push(s)}}catch(aGe){o.e(aGe)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,h=Se(e);try{for(h.s();!(l=h.n()).done;){var d=l.value,f=d.rank;if(null==f){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),y=gte(d,[v].concat(Oue(m.slice(1))));y=$ne(y,[1,0]),y=gte(y,g),t.push(y),p=!0}else if(f>1){var b=Pue(1,f).concat([0]);t.push($ne(d,b)),p=!0}else t.push(d)}}catch(aGe){h.e(aGe)}finally{h.f()}var x=n.mergeFunction(t),k=x.rank;if(p)if(null==k){var w=x.shape,I=w[w.length-1],S=[I].concat(w.slice(0,w.length-1));x=gte($ne(gte(x,[-1,I]),[1,0]),S)}else if(k>1){var N=[k-1].concat(Pue(0,k-1));x=$ne(x,N)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=Se(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(aGe){o.e(aGe)}finally{o.f()}return t=1===(i=oue(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return U7((function(){if(null==t)return null;if(!Array.isArray(t))throw new Hse("`mask` should be an Array");if(!Array.isArray(e))throw new Hse("`inputs` should be an Array");if(t.length!==e.length)throw new Hse("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:Gte(e,0)})))[0],r=1;r<t.length-1;++r)n=nne(n,t[r]);return n}))}}]),n}(Pce),Xhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return U7((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=q7(t,e[n]);return t}))}}]),n}(Khe);Xhe.className="Add",ree(Xhe);var Yhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return U7((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Y7(t,e[n]);return t}))}}]),n}(Khe);Yhe.className="Multiply",ree(Yhe);var Jhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return U7((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=q7(t,e[n]);return Y7(1/e.length,t)}))}}]),n}(Khe);Jhe.className="Average",ree(Jhe);var Qhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return U7((function(){for(var t=e[0],n=1;n<e.length;++n)t=mee(t,e[n]);return t}))}}]),n}(Khe);Qhe.className="Maximum",ree(Qhe);var Zhe=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"mergeFunction",value:function(e){return U7((function(){for(var t=e[0],n=1;n<e.length;++n)t=une(t,e[n]);return t}))}}]),n}(Khe);Zhe.className="Minimum",ree(Zhe);var $he=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return we(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Hse("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=Se(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(aGe){r.e(aGe)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=Se(a);try{for(c.s();!(s=c.n()).done;){if(p3(s.value,o)){u=!0;break}}}catch(aGe){c.e(aGe)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new Hse("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return U7((function(){return jue(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Hse("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=Se(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(aGe){i.e(aGe)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new Hse("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Hse("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Hse("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return U7((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(z7(wne(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Gte(t[i],-1)):a.push(t[i]);var o=Tte(a,n.axis);return $ee(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Khe);function ede(e,t){for(;e<0;)e+=t;return e}$he.className="Concatenate",ree($he);var tde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return we(n,[{key:"build",value:function(e){s3(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new jse("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new Hse("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new Hse("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return ede(t,e[n].shape.length)})):[ede(this.axes,n.shape.length),ede(this.axes,r.shape.length)],this.normalize&&(n=gle(n,t[0]),r=gle(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new jse("batchDot is not implemented for tensors of 4D or higher rank yet");if(s3(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),s3(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new jse("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return U7((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=gte(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=gte(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?ene(Y7(e,t),i[0]):ene(Y7($ne(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,h=i[1]===t.shape.length-1;o=rne(e,t,p,h)}if(n>0){for(var d,f=[],m=d=r>a?r+a-3:r-1;m<d+n;++m)f.push(m);o=Hne(o,f)}return 1===o.shape.length&&(o=Gte(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[ede(this.axes,e.length),ede(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){s3(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new jse("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Khe);tde.className="Dot",ree(tde);var nde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);return tce((function(){return q7(Xue(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Pce);nde.className="GaussianNoise",ree(nde);var rde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return we(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t);var r=Tce(e);if(n.rate>0&&n.rate<1){return tce((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Y7(r,Xue(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(Pce);rde.className="GaussianDropout",ree(rde);var ade=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return we(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Tce(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=pe(le(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return U7((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return tce((function(){var t=Tce(e),a=-1.7580993408473766,i=Yte(_ne(r),n.rate);i=Wue(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=q7(Y7(t,i),Y7(q7(i,-1),a));return q7(Y7(u,o),s)}),(function(){return Tce(e)}),t.training||!1)}return e}))}}]),n}(Pce);function ide(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=kte(e,t,n,r,a,o);else if(3===e.rank)i=wte(e,t,n,r,a,o);else{if(4!==e.rank)throw new jse("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=Ite(e,t,n,r,a,o)}return i}function ode(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return p3(r.slice().sort(),Pue(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return U7((function(){var i=vne(e,r),o=i.mean,s=i.variance;return[ide(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return U7((function(){var i,o=vne(e,r),s=o.mean,u=o.variance,c=[],l=Se(Pue(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch(aGe){l.e(aGe)}finally{l.f()}var h=gte(s,c),d=gte(u,c),f=null==t?null:gte(t,c),m=null==n?null:gte(n,c);return[ide(e,h,d,m,f,a),s,u]}))}(e,t,n,r,a)}ade.className="AlphaDropout",ree(ade);var sde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ice(e.betaInitializer||"zeros"),r.gammaInitializer=Ice(e.gammaInitializer||"ones"),r.movingMeanInitializer=Ice(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Ice(e.movingVarianceInitializer||"ones"),r.betaConstraint=ale(e.betaConstraint),r.gammaConstraint=ale(e.gammaConstraint),r.betaRegularizer=Xpe(e.betaRegularizer),r.gammaRegularizer=Xpe(e.gammaRegularizer),r}return we(n,[{key:"build",value:function(e){e=Cce(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Hse("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new Dce({ndim:e.length,axes:oe({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r=null!=t.training&&t.training,a=Tce(e),i=a.shape,o=i.length,s=Pue(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=Xse(1,o);c[u]=i[u];var l=s.slice();l.sort();var p=!p3(l,Pue(0,o).slice(0,o-1));if(!r)return function(){if(p){var e=gte(n.movingMean.read(),c),t=gte(n.movingVariance.read(),c),r=n.center?gte(n.beta.read(),c):null,i=n.scale?gte(n.gamma.read(),c):null;return ide(a,e,t,r,i,n.epsilon)}return ide(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var h=C(ode(a,n.gamma.read(),n.beta.read(),s,n.epsilon),3),d=h[0],f=h[1],m=h[2],v=function(e,t,n){U7((function(){var r=1-n,a=e.read(),i=Y7(cee(a,t),r);e.write(cee(a,i))}))};return v(n.movingMean,f,n.momentum),v(n.movingVariance,m,n.momentum),d}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:wce(this.betaInitializer),gammaInitializer:wce(this.gammaInitializer),movingMeanInitializer:wce(this.movingMeanInitializer),movingVarianceInitializer:wce(this.movingVarianceInitializer),betaRegularizer:qpe(this.betaRegularizer),gammaRegularizer:qpe(this.gammaRegularizer),betaConstraint:nle(this.betaConstraint),gammaConstraint:nle(this.gammaConstraint)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);sde.className="BatchNormalization",ree(sde);var ude=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=Se(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(aGe){i.e(aGe)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ice(e.betaInitializer||"zeros"),r.gammaInitializer=Ice(e.gammaInitializer||"ones"),r.betaRegularizer=Xpe(e.betaRegularizer),r.gammaRegularizer=Xpe(e.gammaRegularizer),r.supportsMasking=!0,r}return we(n,[{key:"build",value:function(e){var t=(e=Cce(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=Se(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(aGe){a.e(aGe)}finally{a.f()}if(this.axis.length!==oue(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Tce(e),a=r.shape,i=a.length;return U7((function(){var e,t=vne(r,n.axis,!0),o=t.mean,s=t.variance,u=Xse(1,i),c=Se(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(aGe){c.e(aGe)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?gte(e,u):e},h=n.scale?p(n.gamma.read()):null,d=n.center?p(n.beta.read()):null,f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=Hte(o,f),s=Hte(s,f),null!=h&&(h=Hte(h,m)),null!=d&&(d=Hte(d,m)),ide(r,o,s,d,h,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:wce(this.betaInitializer),gammaInitializer:wce(this.gammaInitializer),betaRegularizer:qpe(this.betaRegularizer),gammaRegularizer:qpe(this.gammaRegularizer)},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);ude.className="LayerNormalization",ree(ude);var cde=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Hse("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Hse("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new Hse("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Dce({ndim:4})],r}return we(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Cce(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return U7((function(){return function(e,t,n){return U7((function(){if(4!==e.rank)throw new Hse("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new Hse("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new Hse("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Ine(e,r)}))}(Tce(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);function lde(e,t,n,r,a,i){return U7((function(){var o;Iue(a),Nue(i),Sue(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=ahe(e,a);var s="same"===r?"same":"valid";return o="max"===i?ane(e,t,n,s):yte(e,t,n,s),"channelsFirst"===a&&(o=$ne(o,[0,3,1,2])),o}))}function pde(e,t,n,r,a,i){return U7((function(){var o;Iue(a),Nue(i),Sue(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=ihe(e,a);var s="same"===r?"same":"valid";return o="max"===i?ine(e,t,n,s):bte(e,t,n,s),"channelsFirst"===a&&(o=$ne(o,[0,4,1,2,3])),o}))}cde.className="ZeroPadding2D",ree(cde);var hde=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new Hse("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(lue(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new Hse("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return lue(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Sue(r.padding),r.inputSpec=[new Dce({ndim:3})],r}return we(n,[{key:"computeOutputShape",value:function(e){var t=nhe((e=Cce(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){n.invokeCallHook(e,t),e=Vue(Tce(e),2);var r=n.poolingFunction(Tce(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Hne(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce),dde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),lde(e,t,n,r,a,"max")}}]),n}(hde);dde.className="MaxPooling1D",ree(dde);var fde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),lde(e,t,n,r,a,"avg")}}]),n}(hde);fde.className="AveragePooling1D",ree(fde);var mde=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Hse("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return lue(r.poolSize,"poolSize"),lue(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Iue(r.dataFormat),Sue(r.padding),r.inputSpec=[new Dce({ndim:4})],r}return we(n,[{key:"computeOutputShape",value:function(e){e=Cce(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=nhe(t,this.poolSize[0],this.padding,this.strides[0]),n=nhe(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){return n.invokeCallHook(e,t),n.poolingFunction(Tce(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce),vde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),lde(e,t,n,r,a,"max")}}]),n}(mde);vde.className="MaxPooling2D",ree(vde);var gde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),lde(e,t,n,r,a,"avg")}}]),n}(mde);gde.className="AveragePooling2D",ree(gde);var yde=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Hse("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return lue(r.poolSize,"poolSize"),lue(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Iue(r.dataFormat),Sue(r.padding),r.inputSpec=[new Dce({ndim:5})],r}return we(n,[{key:"computeOutputShape",value:function(e){e=Cce(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=nhe(t,this.poolSize[0],this.padding,this.strides[0]),n=nhe(n,this.poolSize[1],this.padding,this.strides[1]),r=nhe(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return U7((function(){return n.invokeCallHook(e,t),n.poolingFunction(Tce(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce),bde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),pde(e,t,n,r,a,"max")}}]),n}(yde);bde.className="MaxPooling3D",ree(bde);var xde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e)}return we(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Iue(a),Sue(r),pde(e,t,n,r,a,"avg")}}]),n}(yde);xde.className="AveragePooling3D",ree(xde);var kde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).inputSpec=[new Dce({ndim:3})],r}return we(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new jse}}]),n}(Pce),wde=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e||{})}return we(n,[{key:"call",value:function(e,t){return U7((function(){var t=Tce(e);return one(t,1)}))}}]),n}(kde);wde.className="GlobalAveragePooling1D",ree(wde);var Ide=function(e){ye(n,e);var t=be(n);function n(e){return xe(this,n),t.call(this,e||{})}return we(n,[{key:"call",value:function(e,t){return U7((function(){var t=Tce(e);return $te(t,1)}))}}]),n}(kde);Ide.className="GlobalMaxPooling1D",ree(Ide);var Sde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Iue(r.dataFormat),r.inputSpec=[new Dce({ndim:4})],r}return we(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new jse}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce),Nde=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e);return"channelsLast"===n.dataFormat?one(t,[1,2]):one(t,[2,3])}))}}]),n}(Sde);Nde.className="GlobalAveragePooling2D",ree(Nde);var Tde=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.apply(this,arguments)}return we(n,[{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e);return"channelsLast"===n.dataFormat?$te(t,[1,2]):$te(t,[2,3])}))}}]),n}(Sde);Tde.className="GlobalMaxPooling2D",ree(Tde);var Cde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).layer=e.layer,r}return we(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=vle(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(Pce),Ede=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return we(n,[{key:"build",value:function(e){if((e=Cce(e)).length<3)throw new Hse("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),pe(le(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Cce(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return U7((function(){return whe((function(e,r){return[Tce(n.layer.call(e,t)),[]]}),e=Tce(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(Cde);Ede.className="TimeDistributed",ree(Ede);var _de=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=vle(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=vle(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,uue(kue,"BidirectionalMergeMode",o),e.weights)throw new jse("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return we(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):Qse(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=khe(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return pe(le(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new Hse("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Ie(r));var c=r.map((function(e){return new Dce({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Ie(c))}if(null!=a)throw new jse("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Mce,p=0,h=o;p<h.length;p++){if(h[p]instanceof Mce!==l)throw new Hse("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),f=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=f;var v=pe(le(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return pe(le(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=Fne(a,1)),"concat"===n.mergeMode?o=jue([r,a]):"sum"===n.mergeMode?o=q7(r,a):"ave"===n.mergeMode?o=Y7(.5,q7(r,a)):"mul"===n.mergeMode?o=Y7(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Eue(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Eue(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){pe(le(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=vle(t.layer);if(delete t.layer,null!=t.numConstants)throw new jse("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(Cde);_de.className="Bidirectional",ree(_de);var Ade=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return we(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return U7((function(){return"float32"!==(e=Tce(e)).dtype&&(e=Wue(e,"float32")),q7(Y7(e,n.scale),n.offset)}))}}]),n}(Pce);Ade.className="Rescaling",ree(Ade);var Rde=aae.resizeBilinear,Fde=aae.cropAndResize,Dde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return we(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return U7((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],p=[];3===e.rank?(c=!0,u=jne([e])):u=e;for(var h=0;h<u.shape[0];h++)p.push(l);var d=T9(p,[p.length,4]),f=Ane(0,p.length,1,"int32"),m=Fde(u,d,f,[r,a],"nearest");return Wue(c?Tce(Yne(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return U7((function(){return Wue(Rde(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&0===(u=Math.floor((o-n.width)/2))&&(u=1),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Cce(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(Pce);Dde.className="CenterCrop",ree(Dde);var Mde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return we(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=Cce(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return U7((function(){var r;if("int32"!==(e=Tce(e)).dtype&&(e=Wue(e,"int32")),"undefined"!==typeof t.countWeights){if("count"!==n.outputMode)throw new Hse("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=Tce(t.countWeights)}var a=$te(e),i=sne(e),o=Xte(n.numTokens,a).bufferSync().get(0),s=Yte(i,0).bufferSync().get(0);if(!o||!s)throw new Hse("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=Tce(e);if("int32"!==a.dtype&&(a=Wue(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=Gte(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Gte(a,-1)),a.rank>2)throw new Hse("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(t," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=Pte(u,"undefined"!==typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return Y7(o,r);throw new Hse("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(Pce);Mde.className="CategoryEncoding",ree(Mde);var Ode=new Set(["bilinear","nearest"]),Lde=function(e){ye(n,e);var t=be(n);function n(e){var r;if(xe(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!Ode.has(e.interpolation))throw new Hse("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(e.cropToAspectRatio),r}return we(n,[{key:"computeOutputShape",value:function(e){var t=(e=Cce(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return aae.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return aae.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat(Ie(Ode)," are supported"))}))}}]),n}(Pce);Lde.className="Resizing",ree(Lde);var zde=function(){function e(t){xe(this,e),this.seed=t}return we(e,[{key:"next",value:function(){if(void 0!==this.seed)return this.seed++}}]),e}();zde.className="RandomSeed";var Pde=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this,e)).randomGenerator=new zde(e.seed),r}return we(n,[{key:"getConfig",value:function(){var e={seed:this.randomGenerator.seed},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Pce);Pde.className="BaseRandomLayer";var Bde=new Set(["bilinear","nearest"]),Wde=function(e){ye(n,e);var t=be(n);function n(e){var r;xe(this,n),r=t.call(this,e);var a=e.factor,i=e.interpolation,o=void 0===i?"bilinear":i;if(r.factor=a,Array.isArray(r.factor)&&2===r.factor.length)r.widthLower=r.factor[0],r.widthUpper=r.factor[1];else{if(Array.isArray(r.factor)||!(r.factor>0))throw new Hse("Invalid factor: ".concat(r.factor,". Must be positive number or tuple of 2 numbers"));r.widthLower=-r.factor,r.widthUpper=r.factor}if(r.widthLower<-1||r.widthUpper<-1)throw new Hse("factor must have values larger than -1. Got: ".concat(r.factor));if(r.widthUpper<r.widthLower)throw new Hse("factor cannot have upper bound less than lower bound.\n        Got upper bound: ".concat(r.widthUpper,".\n        Got lower bound: ").concat(r.widthLower,"\n      "));if(o){if(!Bde.has(o))throw new Hse("Invalid interpolation parameter: ".concat(o," is not implemented"));r.interpolation=o}return r}return we(n,[{key:"getConfig",value:function(){var e={factor:this.factor,interpolation:this.interpolation},t=pe(le(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Cce(e))[2];return[this.imgHeight,-1,t]}},{key:"call",value:function(e,t){var n=this;return U7((function(){var t=Tce(e);n.imgHeight=t.shape[t.shape.length-3];var r=t.shape[t.shape.length-2];n.widthFactor=_ne([1],1+n.widthLower,1+n.widthUpper,"float32",n.randomGenerator.next());var a=n.widthFactor.dataSync()[0]*r;a=Math.round(a);var i=[n.imgHeight,a];switch(n.interpolation){case"bilinear":return aae.resizeBilinear(e,i);case"nearest":return aae.resizeNearestNeighbor(e,i);default:throw new Error("Interpolation is ".concat(n.interpolation,"\n          but only ").concat(Ie(Bde)," are supported"))}}))}}]),n}(Pde);Wde.className="RandomWidth",ree(Wde);var Vde,Ude;V3().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(Vde||(Vde={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(Ude||(Ude={}));new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Gde(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(Kde(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=Gde(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function Hde(e){return jde(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:qde)}function jde(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(Kde(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=e.map((function(e){return e[r]})),o=jde(a,t,n);i[r]=o};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function qde(e){return null===e?null:Kde(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function Kde(e){var t=!1;V3().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(401).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof j8)&&!(e instanceof Promise)&&!t)}function Xde(e){return function(e,t){return Gde(e,t)}(e,Yde)}function Yde(e){return e instanceof j8?{value:e.clone(),recurse:!1}:Kde(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var Jde=function(){function e(t){if(xe(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return we(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=Se(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(aGe){n.e(aGe)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),Qde=function(e){ye(n,e);var t=be(n);function n(){return xe(this,n),t.call(this,n.INITIAL_CAPACITY)}return we(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){pe(le(n.prototype),"isFull",this).call(this)&&this.expand(),pe(le(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){pe(le(n.prototype),"isFull",this).call(this)&&this.expand(),pe(le(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(Jde);function Zde(e){return new rfe(e)}function $de(e,t){return new ffe(e,t)}Qde.INITIAL_CAPACITY=32;var efe,tfe=function(){function e(){xe(this,e)}return we(e,[{key:"toArray",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new lfe(this,e)}},{key:"filter",value:function(e){return new ufe(this,e)}},{key:"map",value:function(e){return new cfe(this,e)}},{key:"mapAsync",value:function(e){return new pfe(this,e)}},{key:"serialMapAsync",value:function(e){return new pfe(this,e).serial()}},{key:"flatmap",value:function(e){return new dfe(this,e)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new sfe(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qde;return this.rowMajorBatch(e,t).map((function(e){return Hde(e,n)}))}},{key:"concatenate",value:function(e,t){return new ffe(new nfe([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new ofe(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new ife(this,e)}},{key:"prefetch",value:function(e){return new mfe(this,e)}},{key:"shuffle",value:function(e,t){return new vfe(this,e,t)}},{key:"serial",value:function(){return new afe(this)}}]),e}(),nfe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).items=e,r.trav=0,r}return we(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:Xde(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),rfe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).nextFn=e,r}return we(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),afe=function(e){ye(n,e);var t=be(n);function n(e){var r;return xe(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),ife=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:G7(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),ofe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),sfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return xe(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),ufe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:G7(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),cfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=o9(t.value),r=this.transform(t.value),a=o9(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)i9(s=o.value,a)||s.dispose()}catch(aGe){i.e(aGe)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),lfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),pfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=o9(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=o9(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)i9(s=o.value,a)||s.dispose()}catch(aGe){i.e(aGe)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),hfe=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.call(this)).outputQueue=new Qde,e.lastRead=Promise.resolve({value:null,done:!1}),e}return we(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tfe),dfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=o9(t.value),r=this.transform(t.value),a=o9(r),this.outputQueue.pushAll(r),i=Se(n);try{for(i.s();!(o=i.n()).done;)i9(s=o.value,a)||s.dispose()}catch(aGe){i.e(aGe)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(hfe),ffe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return we(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(tfe);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(efe||(efe={}));var mfe=function(e){ye(n,e);var t=be(n);function n(e,r){var a;return xe(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new Jde(r),a}return we(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(tfe),vfe=function(e){ye(n,e);var t=be(n);function n(e,r,a){var i;return xe(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=Nne.alea(a||C8().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return we(n,[{key:"next",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(mfe),gfe=function(){function e(){xe(this,e),this.size=null}return we(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return s3(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),yfe(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,bfe));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,yfe(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,yfe(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return U7((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return yfe(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return U7((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return yfe(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return yfe(S(w().mark((function n(){return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,yfe(S(w().mark((function t(){var r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Zde(S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",$de(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,yfe(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=Nne.alea(t||C8().toString());return yfe(S(w().mark((function t(){var i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,yfe(S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function yfe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){ye(a,n);var r=be(a);function a(){var e;return xe(this,a),(e=r.apply(this,arguments)).size=t,e}return we(a,[{key:"iterator",value:function(){var t=S(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(gfe))}function bfe(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof j8||A8(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof j8?jne(e):T9(e)}(e),recurse:!1}:{value:null,recurse:!0}}gfe.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function xfe(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&s3("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var kfe=Jae,wfe=function(e){ye(n,e);var t=be(n);function n(){var e;return xe(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new $2(he(e),W7()),e}return we(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,V3().get("IS_NODE")&&t8("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&I3(n[0])){var a=n.map((function(e){return E8(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?Aae(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):function(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return _8(e)}));return L7(e.shape,e.dtype,n)}catch(Ru){throw new Error("Failed to decode encoded string bytes into utf-8")}return L7(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return W7().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=C8(),t(),r=C8()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){xfe([e],"where");var t=this.readSync(e.dataId);return kfe(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return pe(le(n.prototype),"epsilon",this).call(this)}}]),n}(e3);wfe.nextDataId=0;function Ife(e){return function(t,n,r){for(var a=x3(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function Sfe(e,t,n){return Nfe(e,Ife(t),n)}function Nfe(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;xfe(s,e);var u,c=o,l=c.data.get(s.dataId).values;if("string"===s.dtype){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=Yae(l)}else u=l;var p=n||s.dtype,h=t(u,p,i);return c.makeTensorInfo(s.shape,p,h)}}j7("cpu",(function(){return new wfe}),1);var Tfe=Sfe(G4,(function(e){return e>=0?e:Math.exp(e)-1})),Cfe={kernelName:G4,backendName:"cpu",kernelFunc:Tfe};function Efe(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var _fe={kernelName:o5,backendName:"cpu",kernelFunc:Efe};function Afe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;xfe([a],"leakyRelu");for(var o=l3(a.shape),s=n.data.get(a.dataId).values,u=b3("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var Rfe={kernelName:h5,backendName:"cpu",kernelFunc:Afe};function Ffe(e){return function(t,n,r,a,i){var o=fee(t,n),s=o.length,u=E3(o),c=b3(i,l3(o)),l=t.length,p=n.length,h=E3(t),d=E3(n),f=hee(t,o),m=hee(n,o);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=e(r[v%r.length],a[v%a.length]);else for(var g=function(){var t=L3(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var i=O3(n,l,h),o=t.slice(-p);m.forEach((function(e){return o[e]=0}));var v=O3(o,p,d);c[y]=e(r[i],a[v])},y=0;y<c.length;++y)g();return[c,o]}}var Dfe=Ffe((function(e,t){return e<0?t*e:e}));function Mfe(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;xfe([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=C(Dfe(r.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return n.makeTensorInfo(c,"float32",u)}var Ofe={kernelName:K5,backendName:"cpu",kernelFunc:Mfe},Lfe=Sfe(t6,(function(e){return Math.max(0,e)})),zfe={kernelName:t6,backendName:"cpu",kernelFunc:Lfe},Pfe=Sfe(s6,(function(e){return Math.min(Math.max(0,e),6)})),Bfe={kernelName:s6,backendName:"cpu",kernelFunc:Pfe},Wfe=Ife((function(e){return 1/(1+Math.exp(-e))})),Vfe=Sfe(x6,(function(e){return 1/(1+Math.exp(-e))})),Ufe={kernelName:x6,backendName:"cpu",kernelFunc:Vfe};function Gfe(e,t,n,r,a){if("linear"===n)return Efe({inputs:{x:t},backend:e});if("relu"===n)return Lfe({inputs:{x:t},backend:e});if("elu"===n)return Tfe({inputs:{x:t},backend:e});if("relu6"===n)return Pfe({inputs:{x:t},backend:e});if("prelu"===n)return Mfe({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return Afe({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return Vfe({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function Hfe(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var jfe={kernelName:y4,backendName:"cpu",kernelFunc:Hfe};function qfe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return Hfe({inputs:{real:qfe(e,t,"float32"),imag:qfe(e,t,"float32")},backend:e});var r=F3(l3(t),n);return e.makeTensorInfo(t,n,r)}function Kfe(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Xfe={kernelName:$5,backendName:"cpu",kernelFunc:Kfe};function Yfe(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=T8([0],n),i=Ffe((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=C(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function Jfe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return Efe({inputs:{x:a},backend:n});var o=qfe(n,a.shape,a.dtype),s=Jfe({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=Hfe({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=Kfe({inputs:{input:a},backend:n}),l=Jfe({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!k3(a.dtype,i)){var p=Efe({inputs:{x:a},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:i}}var h=C(Yfe(n.data.get(a.dataId).values,a.shape,a.dtype,i),3),d=h[0],f=h[1],m=h[2];return n.makeTensorInfo(d,f,m)}var Qfe={kernelName:m4,backendName:"cpu",kernelFunc:Jfe};function Zfe(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;xfe([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,p="string"===o.dtype?Yae(c):c,h="string"===o.dtype?Yae(l):l,d=r||o.dtype,f=C(t(o.shape,s.shape,p,h,d),2),m=f[0],v=f[1];return u.makeTensorInfo(v,d,m)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=Jfe({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),p=l.complexTensorInfos.real,h=l.complexTensorInfos.imag,d=u.data.get(p.dataId).values,f=u.data.get(h.dataId).values,m=Jfe({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),v=u.data.get(m.dataId),g=v.complexTensorInfos.real,y=v.complexTensorInfos.imag,b=u.data.get(g.dataId).values,x=u.data.get(y.dataId).values,k=C(n(o.shape,s.shape,d,f,b,x),3),w=k[0],I=k[1],S=k[2],N=u.makeTensorInfo(S,"float32",w),T=u.makeTensorInfo(S,"float32",I),E=Hfe({inputs:{real:N,imag:T},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(N),u.disposeIntermediateTensorInfo(T),E}var _=u.data.get(o.dataId).values,A=u.data.get(s.dataId).values,R=r||o.dtype,F=C(t(o.shape,s.shape,_,A,R),2),D=F[0],M=F[1];return u.makeTensorInfo(M,R,D)}}function $fe(e){return function(t,n,r,a,i,o){var s=fee(t,n),u=l3(s),c=s.length,l=E3(s),p=b3("float32",u),h=b3("float32",u),d=hee(t,s),f=hee(n,s),m=Aae(r,a),v=Aae(i,o),g=t.length,y=E3(t),b=n.length,x=E3(n);if(d.length+f.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,I=k%v.length,S=e(m[2*w],m[2*w+1],v[2*I],v[2*I+1]);p[k]=S.real,h[k]=S.imag}else for(var N=function(){var t=L3(T,c,l),n=t.slice(-g);d.forEach((function(e){return n[e]=0}));var r=O3(n,g,y),a=t.slice(-b);f.forEach((function(e){return a[e]=0}));var i=O3(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);p[T]=o.real,h[T]=o.imag},T=0;T<p.length;T++)N();return[p,h,s]}}var eme=Ffe((function(e,t){return e+t})),tme=$fe((function(e,t,n,r){return{real:e+n,imag:t+r}})),nme=Zfe(Y3,eme,tme),rme={kernelName:Y3,backendName:"cpu",kernelFunc:nme};function ame(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=l3(a.shape),s=v3(i,o),u=l3(s);s3(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var ime={kernelName:n6,backendName:"cpu",kernelFunc:ame};function ome(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;xfe([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=l3(f),g=l3(m),y=fee(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,d]);s3(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(p,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var b=s?[g,d,p]:[g,p,d],x=ame({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,h]:[v,h,l]}}),k=ame({inputs:{x:i},backend:n,attrs:{shape:b}}),w=o?x.shape[1]:x.shape[2],I=o?x.shape[2]:x.shape[1],S=s?k.shape[1]:k.shape[2],N=Math.max(v,g),T=n.data.get(x.dataId).values,E=n.data.get(k.dataId).values,_=E3(x.shape),A=E3(k.shape),R=C(o?[_[0],1,_[1]]:[_[0],_[1],1],3),F=R[0],D=R[1],M=R[2],O=C(s?[1,A[1],A[0]]:[A[1],1,A[0]],3),L=O[0],z=O[1],P=O[2],B=I*S,W=L7([N,I,S],x.dtype),V=W.values,U=n.blockSize,G=0;G<N;G++)for(var H=G%v,j=G%g,q=0;q<I;q+=U)for(var K=Math.min(q+U,I),X=0;X<S;X+=U)for(var Y=Math.min(X+U,S),J=0;J<w;J+=U)for(var Q=Math.min(J+U,w),Z=q;Z<K;Z++)for(var $=X;$<Y;$++){for(var ee=0,te=J;te<Q;te++){ee+=T[H*F+Z*D+te*M]*E[te*L+$*z+j*P]}V[G*B+(Z*S+$)]+=ee}return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(y,W.dtype,W.values)}var sme={kernelName:l4,backendName:"cpu",kernelFunc:ome};var ume={kernelName:Z6,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,h=o.transposeB,d=o.activation,f=o.leakyreluAlpha,m=[];t=ome({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:h},backend:i}),c&&(n=nme({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),d&&(r=Gfe(i,t,d,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}};function cme(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var lme={kernelName:q3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;xfe(t,"abs");var r=new Float32Array(l3(t.shape));return r=cme(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},pme=Sfe(K3,(function(e){return Math.acos(e)})),hme={kernelName:K3,backendName:"cpu",kernelFunc:pme},dme=Sfe(X3,(function(e){return Math.acosh(e)})),fme={kernelName:X3,backendName:"cpu",kernelFunc:dme};var mme={kernelName:J3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;xfe(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=L7(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function vme(e,t,n,r,a){for(var i=t.length,o=l3(t),s=E3(t),u=E3(a),c=b3(n,l3(a)),l=0;l<o;++l){for(var p=L3(l,i,s),h=new Array(p.length),d=0;d<h.length;d++)h[d]=p[r[d]];c[O3(h,i,u)]=e[l]}return c}function gme(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;xfe(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=vme(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var yme={kernelName:j6,backendName:"cpu",kernelFunc:gme};var bme={kernelName:Q3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;xfe(a,"all");var s=g3(i,a.shape),u=s,c=dne(u,a.shape.length),l=a;null!=c&&(l=gme({inputs:{x:a},backend:n,attrs:{perm:c}}),u=mne(u.length,a.shape.length)),hne("all",u,l.shape.length);for(var p=C(lne(l.shape,u),2),h=p[0],d=l3(p[1]),f=F3(l3(h),l.dtype),m=n.data.get(l.dataId).values,v=0;v<f.length;++v){for(var g=v*d,y=m[g],b=0;b<d;++b){var x=m[g+b];y=y&&x}f[v]=y}null!=c&&n.disposeIntermediateTensorInfo(l);var k=n.makeTensorInfo(h,l.dtype,f);if(o){var w=ame({inputs:{x:k},backend:n,attrs:{shape:pne(h,s)}});return n.disposeIntermediateTensorInfo(k),w}return k}};var xme={kernelName:Z3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;xfe(a,"any");var s=g3(i,a.shape),u=s,c=dne(u,a.shape.length),l=a;null!=c&&(l=gme({inputs:{x:a},backend:n,attrs:{perm:c}}),u=mne(u.length,a.shape.length)),hne("any",u,l.shape.length);for(var p=C(lne(l.shape,u),2),h=p[0],d=l3(p[1]),f=F3(l3(h),l.dtype),m=n.data.get(l.dataId).values,v=0;v<f.length;++v){for(var g=v*d,y=m[g],b=0;b<d;++b){var x=m[g+b];y=y||x}f[v]=y}null!=c&&n.disposeIntermediateTensorInfo(l);var k=n.makeTensorInfo(h,l.dtype,f);if(o){var w=ame({inputs:{x:k},backend:n,attrs:{shape:pne(h,s)}});return n.disposeIntermediateTensorInfo(k),w}return k}};var kme={kernelName:$3,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;xfe(a,"argMax");var o=g3(i,a.shape),s=dne(o,a.shape.length),u=a,c=[];null!=s&&(u=gme({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=mne(o.length,u.shape.length)),hne("argMax",o=[o[0]],u.shape.length);for(var l=C(lne(u.shape,o),2),p=l[0],h=l[1],d=F3(l3(p),"int32"),f=l3(h),m=n.data.get(u.dataId).values,v=0;v<d.length;++v){for(var g=v*f,y=m[g],b=0,x=0;x<f;++x){var k=m[g+x];k>y&&(y=k,b=x)}d[v]=b}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",d)}};var wme={kernelName:e4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;xfe(a,"argMin");var o=g3(i,a.shape),s=dne(o,a.shape.length),u=a,c=[];null!=s&&(u=gme({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=mne(o.length,u.shape.length)),hne("argMin",o=[o[0]],u.shape.length);for(var l=C(lne(u.shape,o),2),p=l[0],h=l[1],d=F3(l3(p),"int32"),f=l3(h),m=n.data.get(u.dataId).values,v=0;v<d.length;++v){for(var g=v*f,y=m[g],b=0,x=0;x<f;++x){var k=m[g+x];k<y&&(y=k,b=x)}d[v]=b}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(p,"int32",d)}},Ime=Sfe(t4,(function(e){return Math.asin(e)})),Sme={kernelName:t4,backendName:"cpu",kernelFunc:Ime},Nme=Sfe(n4,(function(e){return Math.asinh(e)})),Tme={kernelName:n4,backendName:"cpu",kernelFunc:Nme},Cme=Sfe(r4,(function(e){return Math.atan(e)})),Eme={kernelName:r4,backendName:"cpu",kernelFunc:Cme},_me=Ffe((function(e,t){return Math.atan2(e,t)})),Ame=Zfe(i4,_me),Rme={kernelName:i4,backendName:"cpu",kernelFunc:Ame},Fme=Sfe(a4,(function(e){return Math.atanh(e)})),Dme={kernelName:a4,backendName:"cpu",kernelFunc:Fme};function Mme(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,h=a.padInfo.top,d=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=L7(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],I=0;I<a.inChannels;++I)for(var S=0;S<a.outHeight;++S)for(var N=S*o-h,T=Math.max(0,N),C=Math.min(a.inHeight,l+N),E=k+S*y,_=0;_<a.outWidth;++_){for(var A=_*s-d,R=Math.max(0,A),F=Math.min(a.inWidth,p+A),D=f,M=0,O=0,L=T;L<C;L+=u){for(var z=w+L*r[1],P=R;P<F;P+=c){var B=e[z+P*r[2]+I];"max"===i&&B>D?D=B:"avg"===i&&(M+=B,O++)}if(isNaN(D))break}v[E+_*b+I]="avg"===i?M/O:D}return m}function Ome(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=L7(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,m=L7(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var I=w*u-f,S=I;S<0;)S+=l;for(var N=Math.min(r.inWidth,h+I),T=Number.NEGATIVE_INFINITY,C=-1,E=x;E<k;E+=c)for(var _=E-b,A=S;A<N;A+=l){var R=A-I,F=m.get(v,E,A,g);F>T&&(T=F,C=a?i?((v*r.inHeight+E)*r.inWidth+A)*r.inChannels+g:(E*r.inWidth+A)*r.inChannels+g:_*h+R)}o.set(C,v,y,w,g)}}return o}function Lme(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=L7(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],S=a.outShape[4],N=0;N<a.batchSize;++N)for(var T=N*k,C=N*r[0],E=0;E<a.inChannels;++E)for(var _=0;_<a.outDepth;++_){for(var A=_*o-m,R=A;R<0;)R+=c;for(var F=Math.min(a.inDepth,h+A),D=T+_*w,M=0;M<a.outHeight;++M){for(var O=M*s-v,L=O;L<0;)L+=l;for(var z=Math.min(a.inHeight,d+O),P=D+M*I,B=0;B<a.outWidth;++B){for(var W=B*u-g,V=W;V<0;)V+=p;for(var U=Math.min(a.inWidth,f+W),G=P+B*S,H=y,j=0,q=0,K=R;K<F;K+=c){for(var X=C+K*r[1],Y=L;Y<z;Y+=l){for(var J=X+Y*r[2],Q=V;Q<U;Q+=p){var Z=e[J+Q*r[3]+E];if("max"===i&&Z>H?H=Z:"avg"===i&&(j+=Z,q++),isNaN(H))break}if(isNaN(H))break}if(isNaN(H))break}x[G+E]="avg"===i?j/Math.max(q,1):H}}}return b}var zme={kernelName:o4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;xfe(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;s3(dte(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=rte(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&p3(l.inShape,l.outShape))c=Efe({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=E3(a.shape),d=Mme(p,a.shape,a.dtype,h,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var Pme={kernelName:u4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;xfe(a,"avgPool3d");var l=ate(a.shape,i,o,1,s,u,c),p=Lme(n.data.get(a.dataId).values,a.shape,a.dtype,E3(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var Bme={kernelName:c4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;xfe([a,i],"avgPool3DGrad");for(var l=ate(i.shape,o,s,1,u,c),p=l.strideDepth,h=l.strideHeight,d=l.strideWidth,f=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,I=x-1-l.padInfo.front,S=w-1-l.padInfo.left,N=k-1-l.padInfo.top,T=L7(i.shape,"float32"),C=1/(f*m*v),E=n.bufferSync(a),_=0;_<l.batchSize;++_)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var F=0;F<l.inHeight;++F)for(var D=0;D<l.inWidth;++D){for(var M=R-I,O=F-N,L=D-S,z=0,P=0;P<x;P+=g){var B=(M+P)/p;if(!(B<0||B>=l.outDepth||Math.floor(B)!==B))for(var W=0;W<k;W+=y){var V=(O+W)/h;if(!(V<0||V>=l.outHeight||Math.floor(V)!==V))for(var U=0;U<w;U+=b){var G=(L+U)/d;if(!(G<0||G>=l.outWidth||Math.floor(G)!==G))z+=E.get(_,B,V,G,A)}}}T.set(z*C,_,R,F,D,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var Wme={kernelName:s4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;xfe([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=rte(o.shape,s,u,1,c),p=l.strideHeight,h=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=L7(o.shape,"float32"),w=1/(d*f),I=n.data.get(a.dataId).values,S=L7(a.shape,"float32",I),N=0;N<l.batchSize;++N)for(var T=0;T<l.inChannels;++T)for(var C=0;C<l.inHeight;++C)for(var E=0;E<l.inWidth;++E){for(var _=C-x,A=E-b,R=0,F=0;F<g;F+=m){var D=(_+F)/p;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var M=0;M<y;M+=v){var O=(A+M)/h;if(!(O<0||O>=l.outWidth||Math.floor(O)!==O))R+=S.get(N,D,O,T)}}k.set(R*w,N,C,E,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var Vme={kernelName:t5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;s3(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),s3(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),s3(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),xfe([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,h=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=f.length,g=d.length,y=h.length,b=p.length,x=0,k=0,w=0,I=0,S=0;S<l.length;++S)m[S]=f[x++]+(l[S]-p[k++])*d[w++]/Math.sqrt(h[I++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),I>=y&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};function Ume(e,t,n,r,a){var i=Xee(r,t,n),o=l3(n),s=E3(r);if(i){var u=Yee(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=L7(r,a,"string"===a?Yae(e):e),l=L7(n,a),p=0;p<l.size;++p){var h=l.indexToLoc(p),d=h.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Ie(d))].concat(Ie(h)))}return"string"===a?l.values.map((function(e){return E8(e)})):l.values}function Gme(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;xfe(a,"slice");var s=C(Jee(a,i,o),2),u=s[0],c=s[1];qee(a,u,c);var l=Ume(n.data.get(a.dataId).values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}var Hme={kernelName:v6,backendName:"cpu",kernelFunc:Gme};var jme={kernelName:p4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;xfe([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=mae(a.shape,i,s),c=vae(u.length,i.length),l=gae(a.shape,i,s),p=yae(o,i.length),h=bae(l,o,i.length),d=ame({inputs:{x:a},backend:n,attrs:{shape:u}}),f=gme({inputs:{x:d},backend:n,attrs:{perm:c}}),m=ame({inputs:{x:f},backend:n,attrs:{shape:l}}),v=Gme({inputs:{x:m},backend:n,attrs:{begin:p,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};function qme(e,t,n,r,a){for(var i=l3(r),o=F3(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function Kme(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=L7([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var Xme={kernelName:h4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=qme(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}},Yme=Ffe((function(e,t){return e&t})),Jme={kernelName:d4,backendName:"cpu",kernelFunc:Zfe(d4,Yme)};var Qme={kernelName:f4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=fee(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},Zme=Ife((function(e){return Math.ceil(e)})),$me=Nfe(v4,Zme),eve={kernelName:v4,backendName:"cpu",kernelFunc:$me},tve=Sfe(g4,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),nve={kernelName:g4,backendName:"cpu",kernelFunc:tve},rve={kernelName:b4,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(l3(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function ave(e,t,n,r){var a=x3(n,l3(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=l3(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Yae(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function ive(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var ove={kernelName:u5,backendName:"cpu",kernelFunc:ive};function sve(e){var t=e.inputs,n=e.backend,r=g3(e.attrs.axis,t[0].shape)[0];lae(t.map((function(e){return e.shape})),r);var a=pae(t.map((function(e){return e.shape})),r);if(0===l3(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return l3(e.shape)>0}));if(1===i.length)return Efe({inputs:{x:i[0]},backend:n});if("complex64"===i[0].dtype){var o=i.map((function(e){return Kfe({inputs:{input:e},backend:n})})),s=i.map((function(e){return ive({inputs:{input:e},backend:n})})),u=sve({inputs:o,backend:n,attrs:{axis:r}}),c=sve({inputs:s,backend:n,attrs:{axis:r}}),l=Hfe({inputs:{real:u,imag:c},backend:n});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}var p=i.map((function(e){var t=l3(e.shape.slice(r));return ame({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),h=p.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=pae(p.map((function(e){return e.shape})),1);var d=1===p[0].shape[0],f=ave(h,a,t[0].dtype,d),m=pae(i.map((function(e){return e.shape})),r),v=n.makeTensorInfo(m,t[0].dtype,f);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var uve={kernelName:x4,backendName:"cpu",kernelFunc:sve};function cve(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;xfe([a,i],"conv2d");for(var p=mte(u),h=ite(a.shape,i.shape,o,c,s,l,!1,p),d=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new U8(h.outShape,a.dtype),k=E3(a.shape),w=E3(i.shape),I=k[0],S=b?k[1]:k[2],N=b?k[2]:1,T=b?1:k[1],C=x.strides[0],E=b?x.strides[1]:x.strides[2],_=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values,M=0;M<h.batchSize;++M)for(var O=M*I,L=M*C,z=0;z<h.outHeight;++z)for(var P=L+z*E,B=z*h.strideHeight-y,W=0;W<d;++W){var V=B+W*m;if(!(V<0||V>=h.inHeight))for(var U=W*w[0],G=O+V*S,H=0;H<h.outWidth;++H)for(var j=P+H*_,q=H*h.strideWidth-g,K=0;K<f;++K){var X=q+K*v;if(!(X<0||X>=h.inWidth))for(var Y=G+X*N,J=U+K*w[1],Q=0;Q<h.inChannels;++Q){for(var Z=R[Y+Q*T],$=0;$<h.outChannels;++$)D[j+$*A]+=Z*F[J+$];J+=h.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var lve={kernelName:k4,backendName:"cpu",kernelFunc:cve};var pve={kernelName:w4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;xfe([a,i],"conv2dBackpropFilter");for(var p=mte(u),h=ite(a.shape,l,o,1,s,c,!1,p),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g="channelsLast"===h.dataFormat,y=new U8(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=new U8(a.shape,a.dtype,k),S=new U8(i.shape,i.dtype,w),N=0;N<m;++N)for(var T=Math.max(0,Math.ceil((x-N)/d)),C=Math.min(h.outHeight,(h.inHeight+x-N)/d),E=0;E<v;++E)for(var _=Math.max(0,Math.ceil((b-E)/f)),A=Math.min(h.outWidth,(h.inWidth+b-E)/f),R=0;R<h.inChannels;++R)for(var F=0;F<h.outChannels;++F){for(var D=0,M=0;M<h.batchSize;++M)for(var O=T;O<C;++O)for(var L=N+O*d-x,z=_;z<A;++z){var P=E+z*f-b;D+=g?I.get(M,L,P,R)*S.get(M,O,z,F):I.get(M,R,L,P)*S.get(M,F,O,z)}y.set(D,N,E,R,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var hve={kernelName:I4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;xfe([a,i],"conv2dBackpropInput");var p=E3(i.shape),h=E3(a.shape),d=mte(c),f=ite(o,i.shape,s,1,u,l,!1,d),m=new U8(f.inShape,"float32"),v=m.values,g=n.data.get(a.dataId).values,y=n.data.get(i.dataId).values,b=C(p,3),x=b[0],k=b[1],w=b[2],I=f.batchSize,S=f.filterHeight,N=f.filterWidth,T=f.inChannels,E=f.inHeight,_=f.inWidth,A=f.outChannels,R=f.outHeight,F=f.outWidth,D=f.strideHeight,M=f.strideWidth;d=f.dataFormat;for(var O=S-1-f.padInfo.top,L=N-1-f.padInfo.left,z="channelsLast"===d,P=m.strides[0],B=z?m.strides[1]:m.strides[2],W=z?m.strides[2]:1,V=z?1:m.strides[1],U=h[0],G=z?h[1]:h[2],H=z?h[2]:1,j=z?1:h[1],q=0;q<I;++q)for(var K=0;K<T;++K)for(var X=0;X<E;++X)for(var Y=X-O,J=Math.max(0,Math.ceil(Y/D)),Q=Math.min(R,(S+Y)/D),Z=0;Z<_;++Z){for(var $=Z-L,ee=Math.max(0,Math.ceil($/M)),te=Math.min(F,(N+$)/M),ne=0,re=J;re<Q;++re)for(var ae=re*D-Y,ie=ee;ie<te;++ie)for(var oe=U*q+G*re+H*ie,se=x*(S-1-ae)+k*(N-1-(ie*M-$))+w*K,ue=0;ue<A;++ue){ne+=g[oe+j*ue]*y[se+ue]}v[P*q+B*X+W*Z+V*K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var dve={kernelName:S4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;xfe([a,i],"conv3d");for(var c=ote(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,h=c.filterWidth,d=c.dilationDepth,f=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new U8(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=x.values,S=E3(a.shape),N=E3(i.shape),T=0;T<c.batchSize;++T)for(var C=T*S[0],E=T*x.strides[0],_=0;_<c.outDepth;++_)for(var A=E+_*x.strides[1],R=_*c.strideDepth-g,F=0;F<l;++F){var D=R+F*d;if(!(D<0||D>=c.inDepth))for(var M=F*N[0],O=C+D*S[1],L=0;L<c.outHeight;++L)for(var z=A+L*x.strides[2],P=L*c.strideHeight-b,B=0;B<p;++B){var W=P+B*f;if(!(W<0||W>=c.inHeight))for(var V=M+B*N[1],U=O+W*S[2],G=0;G<c.outWidth;++G)for(var H=z+G*c.outChannels,j=G*c.strideWidth-y,q=0;q<h;++q){var K=j+q*m;if(!(K<0||K>=c.inWidth))for(var X=V+q*N[2],Y=U+K*c.inChannels,J=X,Q=0;Q<c.inChannels;++Q){for(var Z=k[Y+Q],$=0;$<c.outChannels;++$)I[H+$]+=Z*w[J+$];J+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var fve={kernelName:N4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;xfe([a,i],"conv3dBackpropFilterV2");for(var c=E3(a.shape),l=E3(i.shape),p=ote(a.shape,u,o,1,s),h=p.strideDepth,d=p.strideHeight,f=p.strideWidth,m=p.filterDepth,v=p.filterHeight,g=p.filterWidth,y=new U8(p.filterShape,"float32"),b=y.values,x=C(y.strides,4),k=x[0],w=x[1],I=x[2],S=x[3],N=n.data.get(i.dataId).values,T=C(l,4),E=T[0],_=T[1],A=T[2],R=T[3],F=n.data.get(a.dataId).values,D=C(c,4),M=D[0],O=D[1],L=D[2],z=D[3],P=p.padInfo.front,B=p.padInfo.left,W=p.padInfo.top,V=0;V<m;++V)for(var U=Math.max(0,Math.ceil((P-V)/h)),G=Math.min(p.outDepth,(p.inDepth+P-V)/h),H=V*k,j=0;j<v;++j)for(var q=Math.max(0,Math.ceil((W-j)/d)),K=Math.min(p.outHeight,(p.inHeight+W-j)/d),X=j*w+H,Y=0;Y<g;++Y)for(var J=Math.max(0,Math.ceil((B-Y)/f)),Q=Math.min(p.outWidth,(p.inWidth+B-Y)/f),Z=Y*I+X,$=0;$<p.inChannels;++$)for(var ee=$*S+Z,te=0;te<p.outChannels;++te){for(var ne=0,re=0;re<p.batchSize;++re)for(var ae=re*M,ie=re*E,oe=U;oe<G;++oe)for(var se=(V+oe*h-P)*O+ae,ue=oe*_+ie,ce=q;ce<K;++ce)for(var le=(j+ce*d-W)*L+se,pe=ce*A+ue,he=J;he<Q;++he){var de=he*R+pe;ne+=F[(Y+he*f-B)*z+le+$]*N[de+te]}b[ee+te]=ne}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var mve={kernelName:T4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;xfe([a],"conv3dBackpropInputV2");for(var c=E3(a.shape),l=E3(i.shape),p=ote(u,i.shape,s,1,o),h=new U8(p.inShape,"float32"),d=h.values,f=C(h.strides,4),m=f[0],v=f[1],g=f[2],y=f[3],b=n.data.get(a.dataId).values,x=C(c,4),k=x[0],w=x[1],I=x[2],S=x[3],N=n.data.get(i.dataId).values,T=C(l,4),E=T[0],_=T[1],A=T[2],R=T[3],F=p.batchSize,D=p.filterDepth,M=p.filterHeight,O=p.filterWidth,L=p.inChannels,z=p.inDepth,P=p.inHeight,B=p.inWidth,W=p.outChannels,V=p.outDepth,U=p.outHeight,G=p.outWidth,H=p.strideDepth,j=p.strideHeight,q=p.strideWidth,K=D-1-p.padInfo.front,X=M-1-p.padInfo.top,Y=O-1-p.padInfo.left,J=0;J<F;++J)for(var Q=0;Q<L;++Q)for(var Z=0;Z<z;++Z)for(var $=Z-K,ee=Math.max(0,Math.ceil($/H)),te=Math.min(V,(D+$)/H),ne=0;ne<P;++ne)for(var re=ne-X,ae=Math.max(0,Math.ceil(re/j)),ie=Math.min(U,(M+re)/j),oe=0;oe<B;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/q)),ce=Math.min(G,(O+se)/q),le=0,pe=ee;pe<te;++pe)for(var he=pe*H-$,de=ae;de<ie;++de)for(var fe=de*j-re,me=ue;me<ce;++me)for(var ve=k*J+w*pe+I*de+S*me,ge=E*(D-1-he)+_*(M-1-fe)+A*(O-1-(me*q-se))+R*Q,ye=0;ye<W;++ye){le+=b[ve+ye]*N[ge+ye]}d[m*J+v*Z+g*ne+y*oe+Q]=le}return n.makeTensorInfo(h.shape,h.dtype,h.values)}},vve=Sfe(C4,(function(e){return Math.cos(e)})),gve={kernelName:C4,backendName:"cpu",kernelFunc:vve},yve=Sfe(E4,(function(e){return Math.cosh(e)})),bve={kernelName:E4,backendName:"cpu",kernelFunc:yve};var xve={kernelName:R4,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=i.shape[0],v=C(s,2),g=v[0],y=v[1],b=L7([m,g,y,f],"float32"),x=n.data.get(i.dataId).values,k=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,I=E3(a.shape),S=E3(b.shape),N=0;N<m;N++){var T=4*N,E=x[T],_=x[T+1],A=x[T+2],R=x[T+3],F=k[N];if(!(F>=p))for(var D=g>1?(A-E)*(h-1)/(g-1):0,M=y>1?(R-_)*(d-1)/(y-1):0,O=0;O<g;O++){var L=g>1?E*(h-1)+O*D:.5*(E+A)*(h-1);if(L<0||L>h-1)for(var z=0;z<y;z++)for(var P=0;P<f;P++){var B=P+z*S[2]+O*S[1]+N*S[0];b.values[B]=c}else if("bilinear"===u)for(var W=Math.floor(L),V=Math.ceil(L),U=L-W,G=0;G<y;G++){var H=y>1?_*(d-1)+G*M:.5*(_+R)*(d-1);if(H<0||H>d-1)for(var j=0;j<f;j++){var q=j+G*S[2]+O*S[1]+N*S[0];b.values[q]=c}else for(var K=Math.floor(H),X=Math.ceil(H),Y=H-K,J=0;J<f;J++){var Q=J+K*I[2]+W*I[1]+F*I[0],Z=w[Q],$=w[Q=J+X*I[2]+W*I[1]+F*I[0]],ee=w[Q=J+K*I[2]+V*I[1]+F*I[0]],te=Z+($-Z)*Y,ne=ee+(w[Q=J+X*I[2]+V*I[1]+F*I[0]]-ee)*Y;Q=J+G*S[2]+O*S[1]+N*S[0],b.values[Q]=te+(ne-te)*U}}else for(var re=0;re<y;++re){var ae=y>1?_*(d-1)+re*M:.5*(_+R)*(d-1);if(ae<0||ae>d-1)for(var ie=0;ie<f;ie++){var oe=ie+re*S[2]+O*S[1]+N*S[0];b.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(L),ce=0;ce<f;ce++){var le=ce+se*I[2]+ue*I[1]+F*I[0],pe=ce+re*S[2]+O*S[1]+N*S[0];b.values[pe]=w[le]}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var kve={kernelName:_4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;xfe(a,"cumprod");var u=dne([i],a.shape.length),c=a;null!=u&&(c=gme({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=mne(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=e9(c.dtype,"int32"),h=R3(l3(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?1:d[y];else{var b=m(v,g-1);h[y]=o?d[b]*h[b]:d[y]*h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=gme({inputs:{x:x},backend:n,attrs:{perm:fne(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var wve={kernelName:A4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;xfe(a,"cumsum");var u=dne([i],a.shape.length),c=a;null!=u&&(c=gme({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=mne(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=e9(c.dtype,"int32"),h=F3(l3(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?0:d[y];else{var b=m(v,g-1);h[y]=o?d[b]+h[b]:d[y]+h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=gme({inputs:{x:x},backend:n,attrs:{perm:fne(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var Ive={kernelName:F4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=qme(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=Kme(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var Sve={kernelName:D4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;s3("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,h=c*i,d=l/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(s*p*h*d),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<h;++k)for(var w=Math.floor(k/i),I=(x*i+k%i)*d,S=0;S<d;++S){var N=S+I+l*(w+c*(b+u*g));m[v++]=f[N]}return n.makeTensorInfo([s,p,h,d],a.dtype,m)}};function Nve(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;xfe([a,i],"depthwiseConv2DNative");var l=E3(a.shape),p=E3(i.shape),h=u;null==h&&(h=[1,1]),s3(dte(o,h),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")}));for(var d=ite(a.shape,i.shape,o,h,s,c,!0),f=d.filterHeight,m=d.filterWidth,v=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,x=y.top,k=d.outChannels/d.inChannels,w=new U8(d.outShape,a.dtype),I=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,N=w.values,T=0;T<d.batchSize;++T)for(var C=T*l[0],E=T*w.strides[0],_=0;_<d.outHeight;++_)for(var A=E+_*w.strides[1],R=_*d.strideHeight-x,F=0;F<f;++F){var D=R+F*v;if(!(D<0||D>=d.inHeight))for(var M=F*p[0],O=C+D*l[1],L=0;L<d.outWidth;++L)for(var z=A+L*w.strides[2],P=L*d.strideWidth-b,B=0;B<m;++B){var W=P+B*g;if(!(W<0||W>=d.inWidth))for(var V=M+B*p[1],U=O+W*d.inChannels,G=z,H=V,j=0;j<d.inChannels;++j){for(var q=I[U+j],K=0;K<k;++K)N[G+K]+=q*S[H+K];G+=k,H+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var Tve={kernelName:M4,backendName:"cpu",kernelFunc:Nve};var Cve={kernelName:O4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;xfe([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=ite(a.shape,l,o,s,u,c,!0),h=p.strideHeight,d=p.strideWidth,f=p.filterHeight,m=p.filterWidth,v=new U8(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new U8(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,I=new U8(i.shape,i.dtype,w),S=0;S<f;++S)for(var N=Math.max(0,Math.ceil((y-S)/h)),T=Math.min(p.outHeight,(p.inHeight+y-S)/h),C=0;C<m;++C)for(var E=Math.max(0,Math.ceil((g-C)/d)),_=Math.min(p.outWidth,(p.inWidth+g-C)/d),A=0;A<p.outChannels;++A){for(var R=Math.trunc(A/b),F=A%b,D=0,M=0;M<p.batchSize;++M)for(var O=N;O<T;++O)for(var L=S+O*h-y,z=E;z<_;++z){var P=C+z*d-g;D+=k.get(M,L,P,R)*I.get(M,O,z,A)}v.set(D,S,C,R,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var Eve={kernelName:L4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;xfe([a,i],"depthwiseConv2DNativeBackpropInput");for(var p=E3(a.shape),h=E3(i.shape),d=ite(l,i.shape,o,s,u,c,!0),f=new U8(d.inShape,"float32"),m=f.values,v=C(f.strides,3),g=v[0],y=v[1],b=v[2],x=n.data.get(a.dataId).values,k=C(p,3),w=k[0],I=k[1],S=k[2],N=n.data.get(i.dataId).values,T=C(h,3),E=T[0],_=T[1],A=T[2],R=d.batchSize,F=d.filterHeight,D=d.filterWidth,M=d.inChannels,O=d.inHeight,L=d.inWidth,z=d.outChannels,P=d.outHeight,B=d.outWidth,W=d.strideHeight,V=d.strideWidth,U=F-1-d.padInfo.top,G=D-1-d.padInfo.left,H=z/M,j=0;j<R;++j)for(var q=0;q<M;++q)for(var K=0;K<O;++K)for(var X=K-U,Y=Math.max(0,Math.ceil(X/W)),J=Math.min(P,(F+X)/W),Q=0;Q<L;++Q){for(var Z=Q-G,$=Math.max(0,Math.ceil(Z/V)),ee=Math.min(B,(D+Z)/V),te=0,ne=Y;ne<J;++ne)for(var re=ne*W-X,ae=$;ae<ee;++ae)for(var ie=w*j+I*ne+S*ae,oe=E*(F-1-re)+_*(D-1-(ae*V-Z))+A*q,se=0;se<H;++se){te+=x[ie+(q*H+se)]*N[oe+se]}m[g*j+y*K+b*Q+q]=te}return n.makeTensorInfo(f.shape,f.dtype,f.values)}};var _ve={kernelName:z4,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=l3(r.shape),i=n.data.get(r.dataId).values,o=L7([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Ie(r.shape),Ie(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},Ave={kernelName:P4,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,h=c.data.get(i.dataId).values,d=i.shape.length,f=nte(a.shape,i.shape,o,s,"NHWC",u),m=f.batchSize,v=f.inHeight,g=f.inWidth,y=f.inChannels,b=f.outHeight,x=f.outWidth,k=f.padInfo,w=f.strideHeight,I=f.strideWidth,S=f.filterHeight,N=f.filterWidth,T=f.dilationHeight,C=f.dilationWidth,E=f.outShape,_=l3(E),A=E.length,R=x3(a.dtype,_),F=0;F<m;++F)for(var D=0;D<b;++D)for(var M=D*w-k.top,O=0;O<x;++O)for(var L=O*I-k.left,z=0;z<y;++z){for(var P=Number.MIN_SAFE_INTEGER,B=0;B<S;++B){var W=M+B*T;if(W>=0&&W<v)for(var V=0;V<N;++V){var U=L+V*C;if(U>=0&&U<g){var G=O3([F,W,U,z],p,E3(a.shape)),H=O3([B,V,z],d,E3(i.shape)),j=l[G]+h[H];j>P&&(P=j)}}}R[O3([F,D,O,z],A,E3(E))]=P}return{dataId:c.write(T8(R,a.dtype),E,a.dtype),shape:E,dtype:a.dtype}}},Rve={kernelName:W4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=A3(a.shape,l.data.get(a.dataId).values),h=A3(i.shape,l.data.get(i.dataId).values),d=nte(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;s3(o.rank===C.length,(function(){return"Error in ".concat(W4,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(o.rank)}));for(var E=A3(C,l.data.get(o.dataId).values),_=D3(i.shape,i.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,z=0,P=0,B=0;B<I;++B){var W=F+B*N;if(W>=0&&W<m)for(var V=0;V<S;++V){var U=M+V*T;if(U>=0&&U<v){var G=p[A][W][U][O]+h[B][V][O];G>L&&(L=G,z=B,P=V)}}}_[z][P][O]+=E[A][R][D][O]}return{dataId:l.write(T8(_,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},Fve={kernelName:B4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=A3(a.shape,l.data.get(a.dataId).values),h=A3(i.shape,l.data.get(i.dataId).values),d=nte(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;s3(o.rank===C.length,(function(){return"Error in ".concat(B4,", dy ")+"must have the same rank as output ".concat(C.length,", but got ")+"".concat(o.rank)}));for(var E=A3(C,l.data.get(o.dataId).values),_=D3(a.shape,a.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,z=F<0?0:F,P=M<0?0:M,B=0;B<I;++B){var W=F+B*N;if(W>=0&&W<m)for(var V=0;V<S;++V){var U=M+V*T;if(U>=0&&U<v){var G=p[A][W][U][O]+h[B][V][O];G>L&&(L=G,z=W,P=U)}}}_[A][z][P][O]+=E[A][R][D][O]}return{dataId:l.write(T8(_,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};var Dve={kernelName:"Draw",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.canvas,o=r.options||{},s=o.contextOptions,u=o.imageOptions,c=(null===u||void 0===u?void 0:u.alpha)||1,l=(null===s||void 0===s?void 0:s.contextType)||"2d";if("2d"!==l)throw new Error("Context type ".concat(s.contextType," is not supported by the CPU backend."));var p=i.getContext(l,(null===s||void 0===s?void 0:s.contextAttributes)||{});if(null==p)throw new Error("Could not get the context with ".concat(l," type."));for(var h=C(a.shape.slice(0,2),2),d=h[0],f=h[1],m=2===a.shape.length?1:a.shape[2],v=n.data.get(a.dataId).values,g="float32"===a.dtype?255:1,y=new Uint8ClampedArray(f*d*4),b=0;b<d*f;++b){for(var x=[0,0,0,255*c],k=0;k<m;k++){var w=v[b*m+k];if("float32"===a.dtype){if(w<0||w>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(w,"."))}else if("int32"===a.dtype&&(w<0||w>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(w,"."));1===m?(x[0]=w*g,x[1]=w*g,x[2]=w*g):x[k]=w*g}var I=4*b;y[I+0]=Math.round(x[0]),y[I+1]=Math.round(x[1]),y[I+2]=Math.round(x[2]),y[I+3]=Math.round(x[3])}i.width=f,i.height=d;var S=new ImageData(y,f,d);return p.putImageData(S,0,0),a}},Mve=Ffe((function(e,t){return e*t})),Ove=$fe((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),Lve=Zfe(L5,Mve,Ove),zve={kernelName:L5,backendName:"cpu",kernelFunc:Lve};function Pve(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;xfe(i,"sum");var u=(t="bool"===i.dtype?Jfe({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):Efe({inputs:{x:i},backend:r})).shape.length,c=g3(o,t.shape),l=dne(c,u),p=c,h=t;null!=l&&(h=gme({inputs:{x:t},backend:r,attrs:{perm:l}}),p=mne(p.length,u)),hne("sum",p,h.shape.length);for(var d=C(lne(h.shape,p),2),f=d[0],m=d[1],v=qfe(r,f,e9(h.dtype,"int32")),g=l3(m),y=r.data.get(v.dataId).values,b=r.data.get(h.dataId).values,x=0;x<y.length;++x){for(var k=x*g,w=0,I=0;I<g;++I)w+=b[k+I];y[x]=w}if(s){var S=v;v=ame({inputs:{x:v},backend:r,attrs:{shape:pne(v.shape,c)}}),r.disposeIntermediateTensorInfo(S)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(h),v}var Bve={kernelName:I6,backendName:"cpu",kernelFunc:Pve};var Wve={kernelName:U4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Pae(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;Wae(i.length,s,r);for(var u=Vae(o,s),c=u.path,l=u.steps,p=l.length,h=null,d=i.length,f=[],m=0;m<p;++m){var v,g=Se(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Bae(d,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;Uae(x)?w=r[y]:(w=gme({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),f.push(w));for(var I=w.shape.slice(),S=0;S<k.length;++S)I.splice(k[S],0,1);p3(w.shape,I)||(w=ame({inputs:{x:w},backend:n,attrs:{shape:I}}),f.push(w)),null===h?h=w:(h=Lve({inputs:{a:w,b:h},backend:n}),f.push(h))}}catch(aGe){g.e(aGe)}finally{g.f()}m<p-1&&(c[m]>=0&&(h=Pve({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-d),keepDims:!1}}),f.push(h)),d--)}for(var N=0,T=f;N<T.length;N++){var C=T[N];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}};var Vve={kernelName:H4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;xfe([r,a],"eluGrad");for(var i=new Float32Array(l3(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=0?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},Uve=Ffe((function(e,t){return e===t?1:0})),Gve=Zfe(q4,Uve,null,"bool"),Hve={kernelName:q4,backendName:"cpu",kernelFunc:Gve},jve=Sfe(j4,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),qve={kernelName:j4,backendName:"cpu",kernelFunc:jve},Kve=Ife((function(e){return Math.exp(e)})),Xve=Nfe(K4,Kve,"float32"),Yve={kernelName:K4,backendName:"cpu",kernelFunc:Xve};function Jve(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(s3(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),ame({inputs:{x:a},backend:n,attrs:{shape:s}})}var Qve={kernelName:X4,backendName:"cpu",kernelFunc:Jve},Zve=Ife((function(e){return Math.expm1(e)})),$ve=Nfe(Y4,Zve),ege={kernelName:Y4,backendName:"cpu",kernelFunc:$ve},tge=Ffe((function(e,t){return e/t})),nge=Zfe(V4,tge),rge={kernelName:V4,backendName:"cpu",kernelFunc:nge},age=Ffe((function(e,t){return e-t})),ige=$fe((function(e,t,n,r){return{real:e-n,imag:t-r}})),oge=Zfe(B6,age,ige),sge={kernelName:B6,backendName:"cpu",kernelFunc:oge};function uge(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=l3(c),p=b3("float32",l),h=b3("float32",l),d=0;d<a;d++){for(var f=Gme({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=Gme({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=Hfe({inputs:{real:f,imag:m},backend:n}),g=cge(v,t,n),y=Aae(g.real,g.imag),b=0;b<i;b++){var x=Rae(y,b);p[d*i+b]=x.real,h[d*i+b]=x.imag}n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var k=n.makeTensorInfo(c,"float32",p),w=n.makeTensorInfo(c,"float32",h),I=Hfe({inputs:{real:k,imag:w},backend:n});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),I}function cge(e,t,n){var r=l3(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=lge(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",N8(r,"float32")),h=Efe({inputs:{x:p},backend:n}),d=rge.kernelFunc({inputs:{a:c,b:p},backend:n}),f=rge.kernelFunc({inputs:{a:l,b:h},backend:n}),m=n.data.get(d.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=Dae(a*s,t,n),c=Rae(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),Fae(r,i,o,a)}return r}(Aae(i,o),r,t);return function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(y)}function lge(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=Aae(e,t),o=n/2,s=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),d=Hfe({inputs:{real:p,imag:h},backend:a}),f=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),m=f.real,v=f.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=Hfe({inputs:{real:y,imag:b},backend:a}),k=lge(u,c,o,r,a),w=k.real,I=k.imag,S=[w.length],N=a.makeTensorInfo(S,"float32",w),T=a.makeTensorInfo(S,"float32",I),C=Hfe({inputs:{real:N,imag:T},backend:a}),E=lge(m,v,o,r,a),_=E.real,A=E.imag,R=[_.length],F=a.makeTensorInfo(R,"float32",_),D=a.makeTensorInfo(R,"float32",A),M=Hfe({inputs:{real:F,imag:D},backend:a}),O=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(n,r),L=[O.real.length],z=a.makeTensorInfo(L,"float32",O.real),P=a.makeTensorInfo(L,"float32",O.imag),B=Hfe({inputs:{real:z,imag:P},backend:a}),W=Lve({inputs:{a:B,b:M},backend:a}),V=nme({inputs:{a:C,b:W},backend:a}),U=oge({inputs:{a:C,b:W},backend:a}),G=Kfe({inputs:{input:V},backend:a}),H=Kfe({inputs:{input:U},backend:a}),j=ive({inputs:{input:V},backend:a}),q=ive({inputs:{input:U},backend:a}),K=sve({inputs:[G,H],backend:a,attrs:{axis:0}}),X=sve({inputs:[j,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,J=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:J}}var pge={kernelName:J4,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=l3(r.shape),i=r.shape[r.shape.length-1],o=ame({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=uge(o,!1,n),u=ame({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function hge(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||N3(a),o=x3(i,l3(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var dge={kernelName:Q4,backendName:"cpu",kernelFunc:hge};var fge={kernelName:Z4,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=b3(r.dtype,l3(r.shape)),o=C(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],p=a.data.get(r.dataId).values,h=0;h<s;h++)for(var d=h*c*u*l,f=0;f<u;f++)for(var m=f*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var b=Math.round(c-v-1),x=d+m+g+y,k=p[x];if(b>=0&&b<c)k=p[d+m+b*l+y];i[x]=k}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},mge=Ife((function(e){return Math.floor(e)})),vge=Nfe($4,mge),gge={kernelName:$4,backendName:"cpu",kernelFunc:vge},yge=Ffe((function(e,t){return Math.floor(e/t)})),bge=Zfe(e5,yge,null,"int32"),xge={kernelName:e5,backendName:"cpu",kernelFunc:bge};var kge={kernelName:$6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=cve({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=ame({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=nme({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=nme({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(d){var y=m;if("NCHW"===l&&"prelu"===d&&1===s.shape.length&&1!==s.shape[0]){var b=ame({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=Gfe(n,m,d,b,f),n.disposeIntermediateTensorInfo(b)}else m=Gfe(n,m,d,s,f);n.disposeIntermediateTensorInfo(y)}return m}};var wge={kernelName:e8,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=Nve({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;m=nme({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=Gfe(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}};function Ige(e,t,n,r,a,i,o,s,u){for(var c=L7([r,i],n),l=0;l<r;l++){for(var p=[],h=0,d=0;d<a;d++){var f=e[l*a+d];h+=f*o[d],p.push(f)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,Ie(t.indexToLoc(h*i+m)))}return c}var Sge={kernelName:r5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=l3(r.shape),o=a.shape,s=o[o.length-1],u=C(xae(r,a),4),c=u[0],l=u[1],p=u[2],h=u[3];if(0===l)return n.makeTensorInfo(c,r.dtype,[]);var d=Ige(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,l,s,p,h,r.shape,i);return n.makeTensorInfo(c,r.dtype,d.values)}};function Nge(e,t,n){for(var r=L7(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var Tge={kernelName:n5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;xfe([a,i],"gatherV2");for(var u=g3(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(){var e=c[h];s3(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=s;null==s&&(d=0);var f=l3(i.shape),m=Xae(a,i,u,d),v=ame({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=ame({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),y=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=Nge(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}},Cge=Ffe((function(e,t){return e>t?1:0})),Ege=Zfe(a5,Cge,null,"bool"),_ge={kernelName:a5,backendName:"cpu",kernelFunc:Ege},Age=Ffe((function(e,t){return e>=t?1:0})),Rge=Zfe(i5,Age,null,"bool"),Fge={kernelName:i5,backendName:"cpu",kernelFunc:Rge};var Dge={kernelName:s5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=l3(r.shape),i=r.shape[r.shape.length-1],o=ame({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=uge(o,!0,n),u=ame({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},Mge=Sfe(c5,(function(e){return Number.isFinite(e)?1:0}),"bool"),Oge={kernelName:c5,backendName:"cpu",kernelFunc:Mge},Lge=Sfe(l5,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),zge={kernelName:l5,backendName:"cpu",kernelFunc:Lge},Pge=Sfe(p5,(function(e){return Number.isNaN(e)?1:0}),"bool"),Bge={kernelName:p5,backendName:"cpu",kernelFunc:Pge},Wge=Ffe((function(e,t){return e<t?1:0})),Vge=Zfe(d5,Wge,null,"bool"),Uge={kernelName:d5,backendName:"cpu",kernelFunc:Vge},Gge=Ffe((function(e,t){return e<=t?1:0})),Hge=Zfe(f5,Gge,null,"bool"),jge={kernelName:f5,backendName:"cpu",kernelFunc:Hge};function qge(e,t,n){var r=(t-e)/(n-1),a=F3(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var Kge={kernelName:m5,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=qge(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},Xge=Ife((function(e){return Math.log(e)})),Yge=Nfe(v5,Xge),Jge={kernelName:v5,backendName:"cpu",kernelFunc:Yge},Qge=Sfe(g5,(function(e){return Math.log1p(e)})),Zge={kernelName:g5,backendName:"cpu",kernelFunc:Qge},$ge=Ffe((function(e,t){return e&&t})),eye=Zfe(y5,$ge,null,"bool"),tye={kernelName:y5,backendName:"cpu",kernelFunc:eye},nye=Sfe(b5,(function(e){return e?0:1}),"bool"),rye={kernelName:b5,backendName:"cpu",kernelFunc:nye},aye=Ffe((function(e,t){return e||t})),iye=Zfe(x5,aye,null,"bool"),oye={kernelName:x5,backendName:"cpu",kernelFunc:iye};var sye={kernelName:k5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;xfe(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,h=l3(a.shape),d=new Float32Array(h);function f(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<h;m++){var v=f(m),g=p[m]*Math.pow(o+s*v,-u);d[m]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var uye={kernelName:w5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;xfe(o,"LRNGrad");for(var p=l3(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%h,x=y-b+Math.max(0,b-s),k=y-b+Math.min(h,b+s+1),w=0,I=x;I<k;I++)w+=Math.pow(f[I],2);w=c*w+u;for(var S=x;S<k;S++){var N=-2*c*l*f[S]*m[y]/w;y===S&&(N+=Math.pow(w,-l)),N*=d[y],v[S]+=N}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function cye(e,t,n,r){for(var a=b3(r,l3(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}function lye(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=g3(i,u),p=l,h=dne(p,c),d=s.data.get(a.dataId).values;if(null!=h){for(var f=new Array(c),m=0;m<f.length;m++)f[m]=u[h[m]];d=vme(d,u,a.dtype,h,f),p=mne(p.length,c),u=f}xfe(a,"max"),hne("max",p,c);var v=C(lne(u,p),2),g=v[0],y=cye(d,l3(v[1]),g,a.dtype),b=s.write(y,g,a.dtype),x=g;o&&(x=pne(g,l));return{dataId:b,shape:x,dtype:a.dtype}}var pye={kernelName:I5,backendName:"cpu",kernelFunc:lye},hye=Ffe((function(e,t){return Math.max(e,t)})),dye=Zfe(S5,hye),fye={kernelName:S5,backendName:"cpu",kernelFunc:dye};var mye={kernelName:N5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;xfe(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;s3(dte(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=rte(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&p3(l.inShape,l.outShape))c=Efe({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=E3(a.shape),d=Mme(p,a.shape,a.dtype,h,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var vye={kernelName:C5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;xfe(a,"maxPool3d");var l=ate(a.shape,i,o,1,s,u,c),p=Lme(n.data.get(a.dataId).values,a.shape,a.dtype,E3(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var gye={kernelName:E5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;xfe([a,i],"maxPool3DGrad");for(var l=ate(i.shape,o,s,1,u,c),p=function(e,t){for(var n=L7(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-d,I=w;I<0;)I+=s;for(var S=Math.min(t.inHeight,l+w),N=0;N<t.outWidth;++N){for(var T=N*i-f,C=T;C<0;)C+=u;for(var E=Math.min(t.inWidth,p+T),_=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var F=R-y,D=I;D<S;D+=s)for(var M=D-w,O=C;O<E;O+=u){var L=O-T,z=e.get(m,R,D,O,v);z>=_&&(_=z,A=F*l*p+M*l+L)}n.set(A,m,g,k,N,v)}}}return n}(n.bufferSync(i),l),h=l.strideDepth,d=l.strideHeight,f=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,I=b-1-l.padInfo.top,S=L7(i.shape,"float32"),N=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var C=0;C<l.inChannels;++C)for(var E=0;E<l.inDepth;++E)for(var _=0;_<l.inHeight;++_)for(var A=0;A<l.inWidth;++A){for(var R=E-k,F=_-I,D=A-w,M=0,O=0;O<y;O+=m){var L=(R+O)/h;if(!(L<0||L>=l.outDepth||Math.floor(L)!==L))for(var z=0;z<b;z+=v){var P=(F+z)/d;if(!(P<0||P>=l.outHeight||Math.floor(P)!==P))for(var B=0;B<x;B+=g){var W=(D+B)/f;if(!(W<0||W>=l.outWidth||Math.floor(W)!==W)){var V=y*b*x-1-p.get(T,L,P,W,C)===O*b*x+z*x+B?1:0;if(0!==V)M+=N.get(T,L,P,W,C)*V}}}}S.set(M,T,E,_,A,C)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};var yye={kernelName:T5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;xfe([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=rte(o.shape,s,u,1,c,l),h=n.data.get(o.dataId).values,d=L7(p.outShape,o.dtype,Ome(h,o.shape,o.dtype,p).values),f=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=L7(o.shape,"float32"),I=n.data.get(a.dataId).values,S=L7(a.shape,"float32",I),N=0;N<p.batchSize;++N)for(var T=0;T<p.inChannels;++T)for(var C=0;C<p.inHeight;++C)for(var E=0;E<p.inWidth;++E){for(var _=C-k,A=E-x,R=0,F=0;F<y;F+=v){var D=(_+F)/f;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var M=0;M<b;M+=g){var O=(A+M)/m;if(!(O<0||O>=p.outWidth||Math.floor(O)!==O)){var L=y*b-1-d.get(N,D,O,T)===F*b+M?1:0;if(0!==L)R+=S.get(N,D,O,T)*L}}}w.set(R,N,C,E,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var bye={kernelName:_5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;xfe(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,p=rte(a.shape,i,o,[1,1],s),h=function(e,t,n,r,a){var i=Mme(e,0,n,E3(t),a,"max"),o=Ome(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,p),d=C(h,2),f=d[0],m=d[1],v=c.write(f,p.outShape,a.dtype),g=c.write(m,p.outShape,a.dtype);return[{dataId:v,shape:p.outShape,dtype:a.dtype},{dataId:g,shape:p.outShape,dtype:"int32"}]}};var xye={kernelName:A5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=g3(i,a.shape),u=l3(lne(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var p=Jfe({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(p);var h=nge({inputs:{a:p,b:l},backend:n});c.push(h);var d=Pve({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}};var kye={kernelName:R5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;xfe(a,"min");var s=g3(i,a.shape),u=s,c=dne(u,a.shape.length),l=a;null!=c&&(l=gme({inputs:{x:a},backend:n,attrs:{perm:c}}),u=mne(u.length,a.shape.length)),hne("min",u,l.shape.length);for(var p=C(lne(l.shape,u),2),h=p[0],d=l3(p[1]),f=F3(l3(h),l.dtype),m=n.data.get(l.dataId).values,v=0;v<f.length;++v){for(var g=v*d,y=m[g],b=0;b<d;++b){var x=m[g+b];(Number.isNaN(x)||x<y)&&(y=x)}f[v]=y}null!=c&&n.disposeIntermediateTensorInfo(l);var k=n.makeTensorInfo(h,l.dtype,f);if(o){var w=ame({inputs:{x:k},backend:n,attrs:{shape:pne(h,s)}});return n.disposeIntermediateTensorInfo(k),w}return k}},wye=Ffe((function(e,t){return Math.min(e,t)})),Iye=Zfe(F5,wye),Sye={kernelName:F5,backendName:"cpu",kernelFunc:Iye};var Nye={kernelName:D5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;xfe(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,h=a.shape.length,d=E3(a.shape),f=l3(s),m=s.length,v=E3(s),g=b3(a.dtype,f),y=0;y<f;y++){for(var b=L3(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=O3(b,h,d);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},Tye=Ffe((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),Cye=Zfe(M5,Tye),Eye={kernelName:M5,backendName:"cpu",kernelFunc:Cye};function _ye(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=g3([s],a.shape),c=lye({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=pne(c.shape,u),p=ame({inputs:{x:c},backend:n,attrs:{shape:l}}),h=oge({inputs:{a:a,b:p},backend:n}),d=Xve({inputs:{x:h},backend:n}),f=Pve({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=ame({inputs:{x:f},backend:n,attrs:{shape:l}}),v=nge({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}var Aye={kernelName:T6,backendName:"cpu",kernelFunc:_ye};var Rye={kernelName:O5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;xfe(a,"multinomial");for(var u=s?a:_ye({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,h=[c,i],d=F3(l3(h),"int32"),f=0;f<c;++f){var m=f*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=Nne.alea(o.toString()),b=f*i,x=0;x<i;++x){var k=y();d[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){d[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}};function Fye(e,t,n){var r=N8(-1,n);return Mve([],t,r,e,n)}var Dye={kernelName:z5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;xfe(r,"neg");var a=C(Fye(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],o=a[1];return n.makeTensorInfo(o,r.dtype,i)}},Mye=Nre;var Oye={kernelName:B5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;xfe(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=Mye(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},Lye=Tre;var zye={kernelName:W5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;xfe(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=Lye(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},Pye=Cre;var Bye={kernelName:V5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;xfe(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=Pye(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},Wye=Ffe((function(e,t){return e!==t?1:0})),Vye=Zfe(P5,Wye,null,"bool"),Uye={kernelName:P5,backendName:"cpu",kernelFunc:Vye};var Gye={kernelName:G5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;xfe(a,"oneHot");var c=l3(a.shape),l=new Float32Array(c*o);l.fill(u);for(var p=n.data.get(a.dataId).values,h=0;h<c;++h)p[h]>=0&&p[h]<o&&(l[h*o+p[h]]=s);return n.makeTensorInfo([].concat(Ie(a.shape),[o]),i,l)}};function Hye(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=Kfe({inputs:{input:r},backend:n}),i=Hye({inputs:{x:a},backend:n}),o=ive({inputs:{input:r},backend:n}),s=Hye({inputs:{x:o},backend:n}),u=Hfe({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return hge({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var jye={kernelName:Y6,backendName:"cpu",kernelFunc:Hye};var qye={kernelName:U5,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=Kfe({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=ive({inputs:{input:a},backend:r}),u=Hye({inputs:{x:s},backend:r}),c=Hfe({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return hge({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function Kye(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Jve({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){u3(a,e.shape,"All tensors passed to stack must have matching shapes"),s3(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=sve({inputs:t.map((function(e){var t=Jve({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var Xye={kernelName:H5,backendName:"cpu",kernelFunc:Kye};var Yye={kernelName:j5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;xfe(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=l3(a.shape),p=a.shape.length,h=E3(a.shape),d=l3(s),f=s.length,m=E3(s),v=b3(a.dtype,d);0!==o&&v.fill(o);for(var g=0;g<l;g++){v[O3(L3(g,p,h).map((function(e,t){return e+u[t]})),f,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},Jye=Ffe((function(e,t){return Math.pow(e,t)})),Qye=Zfe(q5,Jye),Zye={kernelName:q5,backendName:"cpu",kernelFunc:Qye};function $ye(e,t,n,r){for(var a=C(lne(e,r),2),i=a[0],o=a[1],s=e9(t,"int32"),u=F3(l3(i),s),c=l3(o),l=0;l<u.length;++l){for(var p=l*c,h=1,d=0;d<c;++d)h*=n[p+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}var ebe={kernelName:X5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;xfe(a,"prod");var s=a.shape.length,u=g3(i,a.shape),c=dne(u,s),l=u,p=a,h=[];null!=c&&(p=gme({inputs:{x:a},backend:n,attrs:{perm:c}}),h.push(p),l=mne(l.length,s));var d=n.data.get(p.dataId).values,f=$ye(p.shape,p.dtype,d,l),m=f.outVals,v=f.outShape,g=f.outDtype,y=v;return o&&(y=pne(v,u)),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function tbe(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],p=1;p<u+1;++p)s[c].push(p*l)}for(var h=0;h<e.length;++h){for(var d=e[h],f=e[h]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[d],x=d;x<f;++x)s[g].push(v[x+1]+b);d=v[d],f=v[f]}f!==d&&(a.push([d,f]),i+=f-d)}return{outSplits:s,valueSlices:a,numValues:i}}function nbe(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function rbe(e,t,n,r,a){var i=t.slice();i[0]=a;var o=x3(n,l3(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=nbe(t,2)[1],u=nbe(i,2)[1],c=0,l=Se(n);try{for(l.s();!(o=l.n()).done;)for(var p=o.value,h=p[0];h<p[1];++h){for(var d=0;d<r;++d)a[c*u+d]=e[h*s+d];++c}}catch(aGe){l.e(aGe)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function abe(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=L3(r,t.length,E3(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=tbe(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,p=u.numValues,h=function(e){for(var t=[],n=function(){var n=x3("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(c),d=rbe(n,r,a,l,p);return[h,d[0],d[1]]}var ibe={kernelName:Y5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,p=C(abe(s,u,c,i.shape,i.dtype,l,o.shape),3),h=p[0],d=p[1],f=p[2],m=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),v=n.makeTensorInfo(f,i.dtype,d);return m.concat([v])}},obe=2147483647;function sbe(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var p=1;p<l.length;++p)if(l[p]!==l[p-1])throw new Error("starts, limits, and deltas must have the same shape");var h=0===l.length?1:l[0],d=x3("int32",h+1);d[0]=0;for(var f=0;f<h;++f){var m=s?e[0]:e[f],v=u?r[0]:r[f],g=c?i[0]:i[f];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>obe)throw new Error("Requires ((limit - start) / delta) <= ".concat(obe));d[f+1]=d[f]+y}for(var b=x3(n,d[h]),x=0,k=0;k<h;++k)for(var w=d[k+1]-d[k],I=s?e[0]:e[k],S=c?i[0]:i[k],N=0;N<w;++N)b[x++]=I,I+=S;return[d,b]}var ube={kernelName:J5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(sbe(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],p=c[1];return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([p.length],r.dtype,p)]}},cbe=rae,lbe=function(){function e(t,n,r,a,i,o,s,u,c,l){var p;xe(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=function(e){var t,n={FIRST_DIM_SIZE:rae.FIRST_DIM_SIZE,VALUE_ROWIDS:rae.VALUE_ROWIDS,ROW_LENGTHS:rae.ROW_LENGTHS,ROW_SPLITS:rae.ROW_SPLITS,ROW_LIMITS:rae.ROW_LIMITS,ROW_STARTS:rae.ROW_STARTS},r=[],a=Se(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(aGe){a.e(aGe)}finally{a.f()}return r}(l),this.raggedRank=0===(p=this.rowPartitionTypes).length?0:p[0]===rae.FIRST_DIM_SIZE?p.length-1:p.length}return we(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===cbe.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===cbe.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case cbe.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case cbe.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(cbe[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return hbe(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;!function(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=function(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}(this.raggedRank,n,t),a=r;a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return s3(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var p=0;p<s-u;++p)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case cbe.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case cbe.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(cbe[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case cbe.FIRST_DIM_SIZE:return e[0];case cbe.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case cbe.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(cbe[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=hbe(t,!1),i=x3(this.valuesDType,l3(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s){o=this.calculateOutputIndex(s-1,o,n[s],t[s])}this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=l3(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;U7((function(){var e=gte(c,l),t=Ste(e,o);c=t.dataSync()}))}for(var p=0,h=0,d=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==d){if(h<d){var v=a.subarray(p*s);pbe(i.subarray(h*s),v,(d-h)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>d)if(1===this.defaultValue.length)i.subarray(d*s,m*s).fill(this.defaultValue[0]),d=m;else for(;m>d;){pbe(i.slice(d*s),c,s),++d}m<0?(p=f+1,h=d):(p=f,d=(h=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function pbe(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function hbe(e,t){var n,r=[],a=Se(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(aGe){a.e(aGe)}finally{a.f()}return r}function dbe(e,t,n,r,a,i,o,s,u,c){return new lbe(e,t,n,r,a,i,o,s,u,c).compute()}var fbe={kernelName:Q5,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=n.data.get(o.dataId).values,h=s.map((function(e){return n.data.get(e.dataId).values})),d=s.map((function(e){return e.shape})),f=C(dbe(c,a.shape,l,i.shape,i.dtype,p,o.shape,h,d,u),2),m=f[0],v=f[1];return n.makeTensorInfo(m,i.dtype,v)}};function mbe(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return F3(0,r);var a=F3(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var vbe={kernelName:Z5,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=mbe(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},gbe=Sfe(e6,(function(e){return 1/e})),ybe={kernelName:e6,backendName:"cpu",kernelFunc:gbe};var bbe={kernelName:i6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;xfe(a,"resizeBilinear");for(var u=E3(a.shape),c=C(s,2),l=c[0],p=c[1],h=C(a.shape,4),d=h[0],f=h[1],m=h[2],v=h[3],g=n.data.get(a.dataId).values,y=new Float32Array(l3([d,l,p,v])),b=[i&&l>1?f-1:f,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=0,w=b[0]/x[0],I=b[1]/x[1],S=0;S<d;S++)for(var N=0;N<l;N++){var T=void 0;T=o?w*(N+.5)-.5:w*N;for(var E=Math.max(0,Math.floor(T)),_=T-E,A=Math.min(f-1,Math.ceil(T)),R=S*u[0]+E*u[1],F=S*u[0]+A*u[1],D=0;D<p;D++){var M=void 0;M=o?I*(D+.5)-.5:I*D;for(var O=Math.max(0,Math.floor(M)),L=M-O,z=Math.min(m-1,Math.ceil(M)),P=R+O*u[2],B=F+O*u[2],W=R+z*u[2],V=F+z*u[2],U=0;U<v;U++){var G=g[P+U],H=g[B+U],j=G+(g[W+U]-G)*L,q=j+(H+(g[V+U]-H)*L-j)*_;y[k++]=q}}}return n.makeTensorInfo([d,l,p,v],"float32",y)}};var xbe={kernelName:o6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;xfe([i,a],"resizeBilinearGrad");for(var s=E3(a.shape),u=C(a.shape,4),c=u[0],l=u[1],p=u[2],h=u[3],d=C(i.shape,3),f=d[1],m=d[2],v=new Float32Array(c*l*p*h),g=[o&&f>1?l-1:l,o&&m>1?p-1:p],y=[o&&f>1?f-1:f,o&&m>1?m-1:m],b=g[0]/y[0],x=g[1]/y[1],k=n.data.get(i.dataId).values,w=0,I=0;I<c;I++)for(var S=I*s[0],N=0;N<f;N++)for(var T=N*b,E=Math.floor(T),_=Math.min(Math.ceil(T),l-1),A=S+E*s[1],R=S+_*s[1],F=T-E,D=1-F,M=0;M<m;M++)for(var O=M*x,L=Math.floor(O),z=Math.min(Math.ceil(O),p-1),P=O-L,B=1-P,W=A+L*s[2],V=A+z*s[2],U=R+L*s[2],G=R+z*s[2],H=D*B,j=D*P,q=F*B,K=F*P,X=0;X<h;X++){var Y=k[w++];v[W+X]+=Y*H,v[V+X]+=Y*j,v[U+X]+=Y*q,v[G+X]+=Y*K}return n.makeTensorInfo([c,p,l,h],"float32",v)}};var kbe={kernelName:r6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;xfe(a,"resizeNearestNeighbor");for(var u=E3(a.shape),c=C(s,2),l=c[0],p=c[1],h=C(a.shape,4),d=h[0],f=h[1],m=h[2],v=h[3],g=n.data.get(a.dataId).values,y=new Float32Array(d*l*p*v),b=[i&&l>1?f-1:f,i&&p>1?m-1:m],x=[i&&l>1?l-1:l,i&&p>1?p-1:p],k=b[0]/x[0],w=b[1]/x[1],I=0,S=0;S<d;S++)for(var N=S*u[0],T=0;T<l;T++){var E=o?k*(T+.5):k*T,_=Math.min(f-1,i?Math.round(E):Math.floor(E));o&&(_=Math.max(0,_));for(var A=N+_*u[1],R=0;R<p;R++){var F=o?w*(R+.5):w*R,D=Math.min(m-1,i?Math.round(F):Math.floor(F));o&&(D=Math.max(0,D));for(var M=A+D*u[2],O=0;O<v;O++){var L=g[M+O];y[I++]=L}}}return n.makeTensorInfo([d,l,p,v],a.dtype,y)}};var wbe={kernelName:a6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;xfe([i,a],"resizeNearestNeighborGrad");for(var s=E3(a.shape),u=E3(i.shape),c=C(a.shape,4),l=c[0],p=c[1],h=c[2],d=c[3],f=C(i.shape,3),m=f[1],v=f[2],g=new Float32Array(l*p*h*d),y=n.data.get(i.dataId).values,b=[o&&m>1?p-1:p,o&&v>1?h-1:h],x=[o&&m>1?m-1:m,o&&v>1?v-1:v],k=b[0]/x[0],w=b[1]/x[1],I=1/k,S=1/w,N=2*Math.ceil(I)+2,T=2*Math.ceil(S)+2,E=0;E<l;E++)for(var _=E*s[0],A=0;A<p;A++)for(var R=_+A*s[1],F=Math.floor(A*I),D=Math.floor(F-N/2),M=0;M<h;M++)for(var O=R+M*s[2],L=Math.floor(M*S),z=Math.floor(L-T/2),P=0;P<d;P++){for(var B=0,W=0;W<N;W++){var V=W+D;if(!(V<0||V>=m)){var U=_+V*u[1],G=V*k;if(A===Math.min(p-1,o?Math.round(G):Math.floor(G)))for(var H=0;H<T;H++){var j=H+z;if(!(j<0||j>=v)){var q=U+j*u[2],K=j*w;M===Math.min(h-1,o?Math.round(K):Math.floor(K))&&(B+=y[q+P])}}}}g[O+P]=B}return n.makeTensorInfo(a.shape,a.dtype,g)}};var Ibe={kernelName:u6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;xfe(a,"reverse");var o=a.shape.length,s=g3(i,a.shape);if(0===o)return Efe({inputs:{x:a},backend:n});for(var u=new U8(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(p),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,Ie(t))].concat(Ie(e)))},p=0;p<u.size;p++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},Sbe={kernelName:Q6,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=b3(a.dtype,l3(a.shape)),l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(fae(s,h,d),2),v=m[0],g=m[1],y=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,k=0;k<p;k++)for(var w=k*d*h*f,I=0;I<h;I++)for(var S=I*(d*f),N=0;N<d;N++)for(var T=N*f,E=0;E<f;E++){var _=[p,I,N,E],A=_[2],R=_[1],F=(A-v)*b-(R-g)*y,D=(A-v)*y+(R-g)*b;F=Math.round(F+v),D=Math.round(D+g);var M=o;if("number"!==typeof o&&(M=3===E?255:o[E]),F>=0&&F<d&&D>=0&&D<h)M=x[w+D*(d*f)+F*f+E];c[w+S+T+E]=M}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Nbe=Sfe(c6,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),Tbe={kernelName:c6,backendName:"cpu",kernelFunc:Nbe},Cbe=Ife((function(e){return 1/Math.sqrt(e)})),Ebe=Nfe(l6,Cbe),_be={kernelName:l6,backendName:"cpu",kernelFunc:Ebe};function Abe(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,h=t.values;if(0===r)return L7(n,t.dtype);var d=u instanceof U8?u:L7(l,t.dtype);"string"===typeof u||"number"===typeof u?d.values.fill(u):"boolean"===typeof u&&d.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=p[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=h[f*a+b]:d.values[v*a+b]=0===t.rank?h[0]:h[f*a+b]}return d}var Rbe={kernelName:p6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=kae(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=Abe(n.bufferSync(a),n.bufferSync(i),o,h,l,c,u,p,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function Fbe(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function Dbe(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var Mbe={kernelName:d6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=x3("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?Fbe(u,t[l+c]):Dbe(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var Obe={kernelName:f6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;xfe([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=e9(a.dtype,i.dtype),p=F3(l3(a.shape),l),h=0,d=0===o||o>1||1===a.shape.length?1:l3(a.shape.slice(1)),f=0;f<s.length;f++)for(var m=0;m<d;m++)1===s[f]?p[h++]=u[f]:p[h++]=c[f];return n.makeTensorInfo(a.shape,l,p)}},Lbe=Sfe(m6,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),zbe={kernelName:m6,backendName:"cpu",kernelFunc:Lbe},Pbe=Sfe(b6,(function(e){return e<0?-1:e>0?1:0})),Bbe={kernelName:b6,backendName:"cpu",kernelFunc:Pbe},Wbe=Sfe(g6,(function(e){return Math.sin(e)})),Vbe={kernelName:g6,backendName:"cpu",kernelFunc:Wbe},Ube=Sfe(y6,(function(e){return Math.sinh(e)})),Gbe={kernelName:y6,backendName:"cpu",kernelFunc:Ube},Hbe=Math.log(1.1920928955078125e-7)+2,jbe=Sfe(k6,(function(e){var t=e>-Hbe,n=e<Hbe,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),qbe={kernelName:k6,backendName:"cpu",kernelFunc:jbe};var Kbe={kernelName:S6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;xfe([a],"spaceToBatchND");var s=l3(i),u=[[0,0]];u.push.apply(u,Ie(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=Yye.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=mae(l.shape,i,s,!1),h=vae(p.length,i.length,!1),d=gae(l.shape,i,s,!1),f=ame({inputs:{x:l},backend:n,attrs:{shape:p}}),m=gme({inputs:{x:f},backend:n,attrs:{perm:h}}),v=ame({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};function Xbe(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error("Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(s));return[x3(n,0),[0,p],x3(a,0),c,l]}for(var h,d=!0,f=0,m=new Array(u).fill(0),v=0;v<s;++v){var g=e[v*p];if(g<0)throw new Error((h=g,"indices(".concat(v,", 0) is invalid: ").concat(h," < 0")));if(g>=u)throw new Error(jae(v,g,u));++m[g],d=d&&g>=f,f=g}for(var y=!0,b=0;b<u;++b){var x=0===m[b];c[b]=x,y=y&&!x,m[b]=Math.max(m[b],1),b>0&&(m[b]+=m[b-1])}if(y&&d){for(var k=e,w=r,I=0;I<s;++I)l[I]=I;return[k,[s,p],w,c,l]}for(var S=m[u-1],N=x3(n,S*p),T=x3(a,S),C=new Array(u).fill(0),E=0;E<s;++E){var _=e[E*p],A=C[_],R=(0===_?0:m[_-1])+A;C[_]++;for(var F=0;F<p;++F)N[R*p+F]=e[E*p+F];T[R]=r[E],l[E]=R}for(var D=0;D<u;++D){if(0===C[D]){var M=0===D?0:m[D-1];N[M*p+0]=D;for(var O=1;O<p;++O)N[M*p+O]=0;T[M]=o}}return[N,[S,p],T,c,l]}var Ybe={kernelName:C6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],p=C(Xbe(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=p[0],d=p[1],f=p[2],m=p[3],v=p[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((function(e){return Number(e)})))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}};function Jbe(e,t,n,r,a){for(var i,o,s=l3(r),u=t[0],c=a.length,l=[],p=1,h=-1,d=0;d<c;++d){var f=a[d];if(-1===f){if(-1!==h)throw new Error((o=d,"only one output dimension may be -1, not both ".concat(h," and ").concat(o)));h=d,l.push(1)}else{if(f<0)throw new Error((i=f,"size ".concat(d," must be non-negative, not ").concat(i)));p*=f,l.push(f)}}if(-1!==h){if(p<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var m=Math.trunc(s/p);if(p*m!==s)throw new Error(function(e,t){var n=l3(e),r=l3(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}(r,l));l[h]=m}if(l3(l)!==s)throw new Error(function(e,t){var n=l3(e),r=l3(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}(r,l));var v=r.length,g=[];if(v>0){g[v-1]=1;for(var y=v-2;y>=0;--y)g[y]=g[y+1]*r[y+1]}var b=[];if(c>0){b[c-1]=1;for(var x=c-2;x>=0;--x)b[x]=b[x+1]*l[x+1]}for(var k=x3(n,u*c),w=0;w<u;++w){for(var I=0,S=0;S<v;++S)I+=e[w*v+S]*g[S];for(var N=0;N<c;++N)k[w*c+N]=Math.trunc(I/b[N]),I%=b[N]}return[k,[u,c],l]}var Qbe={kernelName:E6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=C(Jbe(s,r.shape,r.dtype,o,u),3),l=c[0],p=c[1],h=c[2];return[n.makeTensorInfo(p,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};function Zbe(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var p=t.slice();p[0]=l;var h=x3(n,p.reduce((function(e,t){return e*t}),1));if(0===s)return l>0&&h.fill(o),[h,p];if(l<=0)throw new Error("segment ids must be >= 0");for(var d=0,f=1,m=0,v=a[d];;){var g=0;if(f<s){if(v===(g=a[f])){++f;continue}if(v>=g)throw new Error("segment ids are not increasing")}if(v<0||v>=l)throw new Error(qae(v,l));v>m&&h.fill(o,m*c,v*c);for(var y=d;y<f;++y){var b=r[y];if(b<0||b>=u[0])throw new Error(Kae(y,r[y],u[0]));for(var x=0;x<c;x++)h[v*c+x]+=e[b*c+x]}if(i)for(var k=0;k<c;k++)h[v*c+k]/=f-d;if(d=f,m=v+1,v=g,++f>s)break}return m<l&&h.fill(o,m*c,l*c),[h,p]}var $be={kernelName:_6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(Zbe(o,r.shape,r.dtype,s,u,!0),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var exe={kernelName:A6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=C(Zbe(o,r.shape,r.dtype,s,u),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var txe={kernelName:R6,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=kae(0,i,u),l=c.sliceRank,p=c.numUpdates,h=c.sliceSize,d=c.strides,f=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=Abe(v,r.bufferSync(o),u,f,h,p,l,d,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=Abe(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"int32":t=Abe(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"string":t=Abe(v,r.bufferSync(o),u,f,h,p,l,d,_8(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var nxe={kernelName:N6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=g3(r.axis,a.shape)[0],s=Hae(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=Ie(c);t[o]=e;var r=Gme({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},rxe=Ife((function(e){return Math.sqrt(e)})),axe=Sfe(w6,(function(e){return Math.sqrt(e)})),ixe={kernelName:w6,backendName:"cpu",kernelFunc:axe},oxe={kernelName:D6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;xfe(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},sxe=Ffe((function(e,t){var n=e-t;return n*n})),uxe=Zfe(F6,sxe),cxe={kernelName:F6,backendName:"cpu",kernelFunc:uxe},lxe=Ife((function(e,t){var n=t.pattern,r=t.replaceGlobal,a=t.rewrite;return e.replace(new RegExp(n,r?"g":""),a)})),pxe=Nfe(M6,lxe),hxe={kernelName:M6,backendName:"cpu",kernelFunc:pxe},dxe=Sfe(J6,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),fxe={kernelName:J6,backendName:"cpu",kernelFunc:dxe};function mxe(e,t,n,r){for(var a=L7(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Ie(o)))}return a}var vxe={kernelName:O6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,h=r.shrinkAxisMask;xfe(a,"stridedSlice");var d,f=Qee(a.shape,i,o,s,u,c,l,p,h),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)d=ame({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){s3(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var I=Kee(x,k,w),S=Gme({inputs:{x:a},backend:n,attrs:{begin:x,size:I}});d=ame({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(S)}else{var N=mxe(m,n.bufferSync(a),w,x);d=n.makeTensorInfo(v,N.dtype,N.values)}return d}},gxe=function(){function e(t,n,r,a,i,o){xe(this,e),this.separator=E8(t),this.nGramWidths=n,this.leftPad=E8(r),this.rightPad=E8(a),this.padWidth=i,this.preserveShort=o}return we(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),p=i-(c+l),h=t+(c>0?0:u-s),d=0;d+=c*o.leftPad.length;for(var f=0;f<p;++f)d+=e[h+f].length;d+=l*o.rightPad.length,d+=(c+l+p-1)*o.separator.length,n[r+u]=new Uint8Array(d);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[h+b]),g(o.separator);if(p>0){g(e[h+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=x3("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var h=function(){var e=t[d]-t[d-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[d]=c[d-1]+r},d=1;d<=u;++d)h();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function yxe(e,t,n,r,a,i,o,s){return new gxe(n,r,a,i,o,s).compute(e,t)}var bxe={kernelName:L6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,h=C(yxe(n.data.get(l.dataId).values,n.data.get(p.dataId).values,a,i,o,s,u,c),2),d=h[0],f=h[1];return[n.makeTensorInfo([d.length],"string",d),n.makeTensorInfo(p.shape,"int32",f)]}};function xxe(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function kxe(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;xxe(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=x3("int32",2*i),h=new Array(i),d=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*f]=m,p[2*f+1]=v,h[f]=a[f],++f;return[p,h,d]}var wxe={kernelName:z6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=C(kxe(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),3),s=o[0],u=o[1],c=o[2],l=u.length;return[n.makeTensorInfo([l,2],"int32",s),n.makeTensorInfo([l],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(c))]}};function Ixe(e,t){for(var n=x3("int32",e.length),r=0;r<e.length;++r)n[r]=S8(e[r]).modulo(t).getLowBitsUnsigned();return n}var Sxe={kernelName:P6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=Ixe(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},Nxe=Sfe(W6,(function(e){return Math.tan(e)})),Txe={kernelName:W6,backendName:"cpu",kernelFunc:Nxe},Cxe=Sfe(V6,(function(e){return Math.tanh(e)}));var Exe={kernelName:h6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.tensor,a=t.indices,i=t.updates,o=kae(0,a,r.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,p=o.outputSize,h=n.bufferSync(a),d=n.bufferSync(i),f=n.bufferSync(r),m=Abe(h,d,r.shape,p,c,u,s,l,f,!1);return n.makeTensorInfo(r.shape,m.dtype,m.values)}};function _xe(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=L7(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var Axe={kernelName:U6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;xfe(a,"tile");var o=_xe(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},Rxe=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function Fxe(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);Fxe(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,p=r;for(i3(e,n,t),Rxe(e[r],c)>0&&i3(e,n,r);l<p;){for(i3(e,l,p),l++,p--;Rxe(e[l],c)<0;)l+=1;for(;Rxe(e[p],c)>0;)p-=1}0===Rxe(e[n],c)?i3(e,n,p):i3(e,p+=1,r),p<=t&&(n=p+1),t<=p&&(r=p-1)}}function Dxe(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=b3(n,o*r),c=b3("int32",o*r),l=function(){var t=p*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(Fxe(i,r),i=i.slice(0,r)),a&&i.sort(Rxe);for(var o=p*r,l=u.subarray(o,o+r),h=c.subarray(o,o+r),d=0;d<r;d++)l[d]=i[d].value,h[d]=i[d].index},p=0;p<o;p++)l();var h=t.slice();return h[h.length-1]=r,[L7(h,n,u),L7(h,"int32",c)]}var Mxe={kernelName:G6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;xfe(a,"topk");var s=C(Dxe(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),2),u=s[0],c=s[1];return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}};var Oxe={kernelName:H6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(null!=c?c:[h,d],2),v=m[0],g=m[1],y=[p,v,g,f],b=E3(a.shape),x=b[0],k=b[1],w=b[2],I=E3(y),S=I[0],N=I[1],T=I[2],E=b3(a.dtype,l3(y));E.fill(u);for(var _=r.data.get(a.dataId).values,A=r.data.get(i.dataId).values,R=0;R<p;++R){for(var F=1===i.shape[0]?A:A.subarray(8*R,8*R+8),D=0;D<v;++D)for(var M=0;M<g;++M)for(var O=0;O<f;++O){var L=void 0,z=F[6]*M+F[7]*D+1;if(0!==z){var P=(F[0]*M+F[1]*D+F[2])/z,B=(F[3]*M+F[4]*D+F[5])/z,W=Lxe(P,d,s),V=Lxe(B,h,s);switch(o){case"nearest":L=Pxe(_,h,d,x,k,w,R,V,W,O,u);break;case"bilinear":L=Bxe(_,h,d,x,k,w,R,V,W,O,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}E[R*S+D*N+M*T+O]=L}}return r.makeTensorInfo(y,a.dtype,E)}return{dataId:r.write(E,y,a.dtype),shape:a.shape,dtype:a.dtype}}};function Lxe(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return r3(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return r3(0,n,t-1)}(e,t);case"nearest":return function(e,t){return r3(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function zxe(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function Pxe(e,t,n,r,a,i,o,s,u,c,l){return zxe(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function Bxe(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),h=Math.floor(u),d=p+1,f=h+1;return(d-s)*((f-u)*zxe(e,t,n,r,a,i,o,p,h,c,l)+(u-h)*zxe(e,t,n,r,a,i,o,p,f,c,l))+(s-p)*((f-u)*zxe(e,t,n,r,a,i,o,d,h,c,l)+(u-h)*zxe(e,t,n,r,a,i,o,d,f,c,l))}function Wxe(e,t,n,r){for(var a=g3(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u=new Map,c=new Int32Array(n[a]),l=new U8(i,r,e),p=[],h=1===i[0]&&1===i[2],d=0;d<n[a];d++){var f=void 0;if(h)f=e[d].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,d,g));f=m.join(",")}var y=u.get(f);if(null!=y)c[d]=y;else{var b=u.size;u.set(f,b),c[d]=b,p.push(d)}}var x=i.slice();x[1]=u.size;var k=new U8(x,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=x[1],{outputValues:k.values,outputShape:w,indices:c}}var Vxe={kernelName:q6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;xfe(i,"unique");var o=Wxe(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var Uxe={kernelName:K6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var d=new Array(s),f=0;f<d.length;f++){p[i]=f;var m=Gme({inputs:{x:a},backend:n,attrs:{begin:p,size:h}});d[f]=ame({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return d}};for(var Gxe={kernelName:X6,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;xfe(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var h=Jve({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=h,u.push(h)}for(var d=0;d<o;++d){var f=N8(d,"int32"),m=n.makeTensorInfo([],"int32",f),v=Gve({inputs:{a:m,b:l},backend:n}),g=Jfe({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=Lve({inputs:{a:g,b:a},backend:n}),b=Pve({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=Kye({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},Hxe=0,jxe=[ume,lme,hme,fme,rme,mme,bme,xme,kme,wme,Sme,Tme,Eme,Rme,Dme,zme,Pme,Bme,Wme,sme,Vme,jme,Xme,Jme,Qme,Qfe,eve,nve,jfe,rve,uve,lve,pve,hve,dve,fve,mve,gve,bve,xve,kve,wve,Ive,Sve,Tve,Cve,Eve,_ve,Ave,Rve,Fve,Dve,Wve,Cfe,Vve,Hve,qve,Yve,Qve,ege,pge,dge,fge,gge,xge,kge,wge,Sge,Tge,_ge,Fge,_fe,Dge,ove,Oge,zge,Bge,Rfe,Uge,jge,Kge,Jge,Zge,tye,rye,oye,sye,uye,pye,fye,mye,vye,gye,yye,bye,xye,kye,Sye,Nye,Eye,Rye,zve,Dye,Oye,zye,Bye,Uye,Gye,qye,Xye,Yye,Zye,Ofe,ebe,ibe,ube,fbe,vbe,Xfe,rge,ybe,zfe,Bfe,ime,bbe,xbe,kbe,wbe,Ibe,Sbe,Tbe,_be,Rbe,Mbe,Obe,zbe,Ufe,Bbe,Vbe,Gbe,Hme,Aye,qbe,Kbe,Ybe,Qbe,$be,exe,txe,nxe,ixe,oxe,cxe,hxe,fxe,vxe,bxe,wxe,Sxe,sge,Bve,Txe,{kernelName:V6,backendName:"cpu",kernelFunc:Cxe},Exe,Axe,Mxe,Oxe,yme,Vxe,Uxe,Gxe,jye];Hxe<jxe.length;Hxe++){s8(jxe[Hxe])}var qxe,Kxe,Xxe,Yxe={},Jxe={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Qxe(e,t){if(!(e in Yxe)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if(V3().getBool("IS_SAFARI")||"undefined"===typeof OffscreenCanvas||2!==e){if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}return new OffscreenCanvas(300,150)}(e):t;n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Yxe[e]}),!1),V3().getBool("SOFTWARE_WEBGL_ENABLED")&&(Jxe.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",Jxe)||n.getContext("experimental-webgl",Jxe);return n.getContext("webgl2",Jxe)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;Yxe[e]=n}var r=Yxe[e];return null==r||r.isContextLost()?(delete Yxe[e],Qxe(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),Yxe[e])}function Zxe(e,t){return[t,e]}function $xe(e){var t=l3(e);return d3(Math.ceil(t/4))}function eke(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function tke(e,t){var n,r,a,i,o,s,u,c,l,p,h=e;return 2===V3().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,u=4,c=1,l=h.HALF_FLOAT,p=h.FLOAT,s=h.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function nke(e,t){var n=t();return V3().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(qxe||(qxe={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Kxe||(Kxe={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Xxe||(Xxe={}));function rke(e){return!!(V3().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function ake(e,t){return mke(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var ike,oke,ske=/ERROR: [0-9]+:([0-9]+):/g;function uke(e,t){var n=ske.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return f3((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(f3(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function cke(e,t){if(nke(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function lke(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(nke(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),nke(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),nke(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function pke(e,t,n,r){nke(e,(function(){return function(e,t,n){vke(e,n),nke(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),nke(e,(function(){return e.uniform1i(n,r)}))}function hke(e,t,n){nke(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),nke(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function dke(e,t){nke(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),nke(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function fke(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function mke(e,t,n){var r=nke(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function vke(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function gke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return l3(e.slice(0,e.length-t))}function yke(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function bke(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[gke(e)].concat(Ie(yke(e)))),t}function xke(e){return e%2===0}function kke(e,t){if(p3(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e[e.length-1],r=t[t.length-1];if(n===r)return!0;if(xke(n)&&xke(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&xke(e[0])&&xke(t[0])}function wke(e,t){return null!=e.getExtension(t)}function Ike(e){try{if(null!=Qxe(e))return!0}catch(rGe){return console.log("Error when getting WebGL context: ",rGe),!1}return!1}function Ske(e){if(0===e)return!1;var t=Qxe(e);if(1!==e){if(wke(t,"EXT_color_buffer_float"))return Nke(t);var n="EXT_color_buffer_half_float";if(wke(t,n)){var r=t.getExtension(n);return function(e,t){var n=tke(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!wke(t,"OES_texture_float")&&(!!wke(t,"WEBGL_color_buffer_float")&&Nke(t))}function Nke(e){var t=tke(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Tke(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&s3("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var Cke=V3();function Eke(){var e,t,n,r,a,i,o,s,u,c;return 2===V3().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=V3().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function _ke(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=E3(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function Ake(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=E3(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function Rke(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(e.map((function(e,t){return t})),t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(r[a]),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(r[a]):"index -= ".concat(e[a]," * ").concat(r[a]);return"".concat(i,"; ").concat(o,";")})).join("")}function Fke(e){var t=E3(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}Cke.registerFlag("HAS_WEBGL",(function(){return Cke.getNumber("WEBGL_VERSION")>0})),Cke.registerFlag("WEBGL_VERSION",(function(){return Ike(2)?2:Ike(1)?1:0})),Cke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),Cke.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Cke.get("WEBGL_VERSION")})),Cke.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Cke.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Cke.registerFlag("WEBGL_PACK",(function(){return Cke.getBool("HAS_WEBGL")})),Cke.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_CLIP",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_PACK_REDUCE",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_CONV_IM2COL",(function(){return Cke.getBool("WEBGL_PACK")})),Cke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==ike){var t=Qxe(e);ike=t.getParameter(t.MAX_TEXTURE_SIZE)}return ike}(Cke.getNumber("WEBGL_VERSION"))})),Cke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==oke){var t=Qxe(e);oke=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,oke)}(Cke.getNumber("WEBGL_VERSION"))})),Cke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Cke.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=Qxe(e);return wke(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:wke(t,"EXT_disjoint_timer_query")?1:0}(e)})),Cke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Cke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!m9()})),Cke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=Qxe(e);if(1===e){if(!wke(t,"OES_texture_float"))return!1}else if(!wke(t,"EXT_color_buffer_float"))return!1;return Nke(t)}(Cke.getNumber("WEBGL_VERSION"))})),Cke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Cke.getBool("WEBGL_FORCE_F16_TEXTURES")&&Cke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Cke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Ske(Cke.getNumber("WEBGL_VERSION"))})),Cke.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=Cke.getNumber("WEBGL_VERSION"))&&null!=Qxe(e).fenceSync;var e})),Cke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Cke.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Cke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),Cke.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return m9()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),Cke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),Cke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),Cke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),Cke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),Cke.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),Cke.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return Cke.getBool("IS_TEST")})),Cke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),Cke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),Cke.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),Cke.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var Dke="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",Mke=hee;function Oke(e,t,n){var r=[];if(e.forEach((function(e){var t=l3(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(jke(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?zke(e,r):Lke(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Mke(e.shapeInfo.logicalShape,t.logicalShape),c=Hke(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var h="";h=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var d="return outputValue;",f=1===l3(e.shapeInfo.logicalShape),m=l3(t.logicalShape),v=1===m;if(1!==o||f||v){if(f&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=o-2,y=o-1;u.indexOf(g)>-1&&u.indexOf(y)>-1?d="return vec4(outputValue.x);":u.indexOf(g)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(y)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(h,");\n      ").concat(d,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&p3(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=Hke(u),p=Mke(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(d[e+h]," = 0;")})).join("\n");var f="";f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+h])})).join(", ");return"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=Eke(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){var t="".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Pke,"\n    ").concat(Bke,"\n    ").concat(Wke,"\n  ");return t}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(p3(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(p3(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=Ake(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=_ke(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=Ake(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=_ke(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=_ke(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=_ke(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=Vke),[p,l,i,o,a,s,n.userCode].join("\n")}function Lke(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=C(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Uke(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=C(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(Gke(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Uke(n);if(1===o)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(1===i)return t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(t)return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&p3(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=y3(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){var h=qke(e,p),d=["row","col"];return"\n      ".concat(Lke(h,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(Kke(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Gke(e),"\n      }\n    ");var f=i[0],m=i[1],v=Uke(r);if(1===m)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(1===f)return t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");if(t)return"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");return"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=y3(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=qke(e,l),h=["row","col","depth"];return"\n        ".concat(Lke(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(Kke(h,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(Gke(e),"\n      }\n    ");var d=e.shapeInfo.texShape,f=d[0],m=d[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=Uke(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    ");return"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=y3(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=qke(e,c),h=["row","col","depth","depth2"];return"\n      ".concat(Lke(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(Kke(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(Gke(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=Uke(r);if(t)return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");return"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=y3(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=qke(e,c),h=["row","col","depth","depth2","depth3"];return"\n      ".concat(Lke(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Kke(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Gke(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1];if(v===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Uke(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=y3(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=qke(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(Lke(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Kke(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,p=t[3]*l,h=t[2]*p,d=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(h,", ").concat(p,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(Gke(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===d&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=Uke(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(h," + depth * ").concat(p," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function zke(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Eke();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=Eke();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=Eke();if(null!=i&&p3(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=qke(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(zke(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Kke(c,s),");\n        }\n      ")}var l=Eke();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],h=o[1],d=Math.ceil(n[2]/2),f=d*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(h,", ").concat(f,", ").concat(d,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Eke();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),h=p*Math.ceil(i[o-2]/2),d="int b, int row, int col",f="b * ".concat(h," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)d="int b".concat(m,", ")+d,h*=i[o-m-1],f="b".concat(m," * ").concat(h," + ")+f;return"\n    vec4 ".concat(r,"(").concat(d,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var Pke="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Bke="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Wke="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Vke="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Uke(e){return"offset".concat(e)}function Gke(e){var t=e.name,n=l3(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Hke(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function jke(e,t,n){var r=y3(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!p3(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function qke(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Kke(e,t){return t.map((function(t){return e[t]})).join(", ")}function Xke(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=Oke(a,o,t),u=function(e,t){var n=mke(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(nke(e,(function(){return e.shaderSource(n,t)})),nke(e,(function(){return e.compileShader(n)})),V3().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw uke(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return V3().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(c),Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Yke(e,t,c)))}function Yke(e,t,n){var r,a,i,o,s=[],u=[],c=null;o=e.getUniformLocation(n,"NAN",!1),1===V3().getNumber("WEBGL_VERSION")&&(c=e.getUniformLocation(n,"INFINITY",!1));var l,p=!1,h=Se(t.variableNames);try{for(h.s();!(l=h.n()).done;){var d=l.value,f={name:d,uniform:e.getUniformLocation(n,d,p),offset:e.getUniformLocation(n,"offset".concat(d),p)};t.enableShapeUniforms&&(f.shape=e.getUniformLocation(n,"".concat(d,"Shape"),p),f.texShape=e.getUniformLocation(n,"".concat(d,"TexShape"),p)),s.push(f)}}catch(aGe){h.e(aGe)}finally{h.f()}if(t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",p),i=e.getUniformLocation(n,"outShapeStrides",p),a=e.getUniformLocation(n,"outTexShape",p)),t.customUniforms){var m,v=Se(t.customUniforms);try{for(v.s();!(m=v.n()).done;){var g=m.value;u.push(e.getUniformLocation(n,g.name,p))}}catch(aGe){v.e(aGe)}finally{v.f()}}return{variablesLocations:s,customUniformLocations:u,infLoc:c,nanLoc:o,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function Jke(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!p3(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!p3(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Qke(e){return V3().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Zke=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=qxe.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Eke();this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Ake(["r","c","d"],t):_ke(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),$ke=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=qxe.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Eke();this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?Ake(["r","c","d"],t):_ke(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),ewe=we((function e(t){xe(this,e),this.variableNames=["A"],this.outTexUsage=Kxe.DOWNLOAD;var n=Eke();this.outputShape=t,this.userCode="\n      ".concat(Dke,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),twe=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Kxe.DOWNLOAD;var n=Eke();this.outputShape=t,this.userCode="\n      ".concat(Dke,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),nwe={R:0,G:1,B:2,A:3},rwe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";xe(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=Eke();this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(nwe[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fke(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),awe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=Eke();this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fke(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function iwe(e){var t=Eke();return function(e,t){var n=mke(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(nke(e,(function(){return e.shaderSource(n,t)})),nke(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function owe(e){return function(e,t){var n=mke(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nke(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),nke(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function swe(e){return function(e,t){var n=mke(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return nke(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),nke(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function uwe(e,t,n,r,a,i){!function(e,t){var n=V3().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return mke(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return nke(e,(function(){return e.bindTexture(s,o)})),nke(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),nke(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),nke(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),nke(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===V3().getNumber("WEBGL_VERSION")?nke(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):nke(e,(function(){return e.texStorage2D(s,1,r,t,n)})),nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function cwe(e){return e.internalFormatFloat}function lwe(e){return e.internalFormatHalfFloat}function pwe(e){return e.downloadTextureFormat}function hwe(e){return e.internalFormatPackedFloat}function dwe(e){return e.internalFormatPackedHalfFloat}function fwe(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=C(eke(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var mwe=function(){function e(t){xe(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=V3().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,function(e,t){Yxe[e]=t}(n,t)):this.gl=Qxe(n),t=this.gl,2===V3().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return nke(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return nke(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return nke(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return nke(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return nke(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return nke(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return nke(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return nke(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===V3().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=ake(this.gl,"OES_texture_float"),wke(this.gl,s))this.textureHalfFloatExtension=ake(this.gl,s);else if(V3().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),wke(this.gl,o))this.colorBufferHalfFloatExtension=ake(this.gl,o);else if(V3().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",wke(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!wke(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=owe(this.gl),this.indexBuffer=swe(this.gl),this.framebuffer=function(e){return mke(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=tke(this.gl,this.textureHalfFloatExtension)}return we(e,[{key:"debug",get:function(){return V3().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;nke(t,(function(){return t.finish()})),nke(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),nke(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),nke(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),nke(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),nke(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=C(Zxe(t,n),2);return uwe(e,a[0],a[1],cwe(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=C(Zxe(t,n),2);return uwe(e,a[0],a[1],lwe(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=C(Zxe(t,n),2);return uwe(e,a[0],a[1],pwe(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===V3().getNumber("WEBGL_VERSION")?nke(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):nke(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===V3().getNumber("WEBGL_VERSION")?nke(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):nke(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===V3().getNumber("WEBGL_VERSION")?nke(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):nke(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),nke(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=C(eke(t,n),2);return uwe(e,a[0],a[1],dwe(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=C(eke(t,n),2);return uwe(e,a[0],a[1],hwe(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(dke(this.gl,this.framebuffer),this.outputTexture=null),nke(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=C(Zxe(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return nke(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return fwe(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();nke(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return nke(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),nke(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),nke(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(V3().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return nke(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=iwe(n));var r=function(e){return mke(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);nke(n,(function(){return n.attachShader(r,t.vertexShader)})),nke(n,(function(){return n.attachShader(r,e)})),function(e,t){if(nke(e,(function(){return e.linkProgram(t)})),!V3().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r);var a=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&cke(n,a),a}},{key:"buildVao",value:function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;nke(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),function(e,t,n){nke(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),lke(e,t,"clipSpacePos",n,3,20,0)&&lke(e,t,"uv",n,2,20,12)}(n,e,this.vertexBuffer)}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(nke(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&cke(this.gl,this.program),nke(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return mke(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),nke(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),pke(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=C(eke(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&cke(this.gl,this.program),fke(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}nke(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),nke(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=ake(this.gl,2===V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m3((function(){return n.disposed||n.isQueryAvailable(t,V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var r=void 0;"setTimeoutCustom"in V3().platform&&(r=V3().platform.setTimeoutCustom.bind(V3().platform)),m3((function(){return n.pollItems(),0===n.itemsToPoll.length}),(function(){return 0}),null,r)}}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),hke(this.gl,e,this.framebuffer),this.debug&&fke(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(hke(this.gl,this.outputTexture,this.framebuffer),this.debug&&fke(this.gl)):dke(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;hke(r,e,this.framebuffer),this.debug&&fke(r),this.outputTexture=e,nke(r,(function(){return r.viewport(0,0,t,n)})),nke(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),nke(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var vwe=eme,gwe=qme,ywe=Kme,bwe=Yme,xwe=Yfe,kwe=Zme,wwe=ave,Iwe=Uve,Swe=Kve,Nwe=Zve,Twe=mge,Cwe=Ige,Ewe=Nge,_we=Cge,Awe=Age,Rwe=Wge,Fwe=Gge,Dwe=qge,Mwe=Xge,Owe=cye,Lwe=hye,zwe=wye,Pwe=Mve,Bwe=Fye,Wwe=Wye,Vwe=$ye,Uwe=abe,Gwe=sbe,Hwe=dbe,jwe=mbe,qwe=Cbe,Kwe=Abe,Xwe=Wfe,Ywe=cme,Jwe=Ume,Qwe=Xbe,Zwe=Jbe,$we=Zbe,eIe=rxe,tIe=lxe,nIe=mxe,rIe=yxe,aIe=kxe,iIe=Ixe,oIe=age,sIe=_xe,uIe=Dxe,cIe=vme,lIe=Wxe;function pIe(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function hIe(e,t){return 1===t?[e]:pIe(e,t)}var dIe=function(){function e(t){if(xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Qke(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=hIe("rc",this.rank),r=Hke(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return we(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),fIe=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?Rke(["r","c","d"],"inputShape"):_ke(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":Fke(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var mIe=function(){function e(t){xe(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return we(e,[{key:"acquireTexture",value:function(e,t,n){var r=gIe(t,n),a=yIe(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=vIe(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].pop();return this.usedTextures[a].push(s),s}return r===Xxe.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Xxe.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Xxe.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Xxe.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Xxe.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=gIe(n,r),i=yIe(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=vIe(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=V3().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u&&u.indexOf(e);if(null==c||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function vIe(e,t,n,r,a){var i,o=function(e,t){switch(e){case Xxe.PACKED_2X2_FLOAT32:return hwe(t);case Xxe.PACKED_2X2_FLOAT16:return dwe(t);case Xxe.UNPACKED_FLOAT32:return cwe(t);case Xxe.UNPACKED_FLOAT16:return lwe(t);case Xxe.PACKED_4X1_UNSIGNED_BYTE:return pwe(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=C(eke(e[0],e[1]),2);i=s[0]*s[1]}else{var u=C(Zxe(e[0],e[1]),2);i=u[0]*u[1]}var c=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*c}function gIe(e,t){if(e===Kxe.UPLOAD)return Xxe.PACKED_2X2_FLOAT32;if(e===Kxe.RENDER||null==e)return function(e){return V3().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Xxe.PACKED_2X2_FLOAT32:Xxe.UNPACKED_FLOAT32:e?Xxe.PACKED_2X2_FLOAT16:Xxe.UNPACKED_FLOAT16}(t);if(e===Kxe.DOWNLOAD||e===Kxe.PIXELS)return Xxe.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function yIe(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var bIe=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),xIe="if (isnan(x)) return x;",kIe="return x;",wIe="return abs(x);";var IIe="return (x >= 0.0) ? x : (exp(x) - 1.0);",SIe=xIe+"\n  return (x < 0.0) ? 0.0 : x;\n",NIe=xIe+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",TIe="return x;",CIe="return 1.0 / (1.0 + exp(-1.0 * x));",EIe="return x;",_Ie="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",AIe="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",RIe="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",FIe="return 1.0 / (1.0 + exp(-1.0 * x));",DIe=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),MIe=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length);var n=t.length,r=hIe("rc",n),a=Hke(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),OIe=Jae,LIe={};var zIe=V3().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var PIe=function(e){ye(n,e);var t=be(n);function n(e){var r,a,i;if(xe(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!V3().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof mwe)a=e;else{var o=Qxe(V3().getNumber("WEBGL_VERSION"),e);a=new mwe(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=Qxe(V3().getNumber("WEBGL_VERSION"));a=new mwe(s),r.binaryCache=((i=V3().getNumber("WEBGL_VERSION"))in LIe||(LIe[i]={}),LIe[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new mIe(r.gpgpu),r.numMBBeforeWarning=null==V3().global.screen?1024:V3().global.screen.height*V3().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new $2(he(r),W7()),r}return we(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=bke(t),c=new rwe(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((V3().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||V3().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Kxe.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(V3().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Kxe.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new DIe(o,TIe):new bIe(o,TIe);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,h,d=null!=this.activeTimers;(d&&(p=C8()),"complex64"===r)?h=Aae(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):h=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=C8()-p),this.convertAndCacheOnCPU(e,h)}},{key:"read",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return l=c?new DIe(i,TIe):new bIe(i,TIe),p=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),h=this.read(p.dataId),this.disposeIntermediateTensorInfo(p),e.abrupt("return",h);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!V3().getBool("DEBUG")){e.next=16;break}if(V3().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==V3().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(d=null,"complex64"!==s&&V3().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),v=this.texData.get(f.dataId),d=(m=this.gpgpu).createBufferFromTexture.apply(m,[v.texture.texture].concat(Ie($xe(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==s){e.next=31;break}return e.next=25,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 25:y=e.sent,b=y[0],x=y[1],g=Aae(b,x),e.next=32;break;case 31:null==d?g=this.getValuesFromTexture(t):(k=l3(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k));case 32:return null!=f&&this.disposeIntermediateTensorInfo(f),null!=d&&nke(I=this.gpgpu.gl,(function(){return I.deleteBuffer(d)})),S=this.convertAndCacheOnCPU(t,g),N=this.pendingRead.get(t),this.pendingRead.delete(t),N.forEach((function(e){return e(S)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&W7().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",S);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new DIe(a,TIe):new bIe(a,TIe);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var h=this.decode(e,t.customTexShape),d=W7().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return _8(e)}));return L7(e.shape,e.dtype,n)}catch(Ru){throw new Error("Failed to decode encoded string bytes into utf-8")}return L7(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!rke(n)){if(V3().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=l3(n);if(V3().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(Ie($xe(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=V3().getBool("WEBGL_PACK")&&!0===a,p=l?bke(n):n,h=l?new twe(p):new ewe(p),d=this.runWebGLProgram(h,[{shape:p,dtype:r,dataId:e}],"float32"),f=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),m}},{key:"timerAvailable",value:function(){return V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=R8(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=R8(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return S(w().mark((function e(){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=o3(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",s);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:C8(),endMs:null}}},{key:"endTimer",value:function(e){return V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=C8(),e)}},{key:"getQueryTime",value:function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(V3().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zIe;return V3().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&l3(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){t8("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return OIe(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new DIe(e.shape,t),a=this.compileAndRun(r,[e],n);return W7().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=Ywe(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(V3().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wIe,e.dtype);var n=new bIe(e.shape,wIe),r=this.compileAndRun(n,[e]);return W7().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&I3(n[0])){var a=n.map((function(e){return E8(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return W7().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new MIe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new dIe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[gke(e.shape)].concat(Ie(yke(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[gke(t)].concat(Ie(yke(t))),i=new fIe(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&s3(l3(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=bke(a);o=r?new $ke(s):new Zke(s);var u=[null!=t?t:$xe(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===qxe.DENSE){var c=null!=o?o:$xe(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===l3(s.shape))return u.values=b3(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&l3(t.shape)<=V3().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!kke(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var h,d={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=jke(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",h="";if(1===u.length&&e.packedInputs){var d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(d[0]>1,"_").concat(d[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=E3(u);h="".concat(f[0]===i[1],"_").concat(f[f.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&p3(t.shape,i),g=1===l3(t.shape),y=hee(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&p3(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(h,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(V3().getNumber("WEBGL_VERSION"))}(e,p,d),m=this.getAndSaveBinary(f,(function(){return Xke(a.gpgpu,e,p,d)})),v=null!=this.activeTimers;v&&(h=this.startTimer()),V3().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(Jke(t.inShapeInfos,n),Jke([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),1===V3().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN);for(var s=0;s<n.length;++s){var u=n[s],c=t.variablesLocations[s],l=c.uniform,p=c.offset,h=c.shape,d=c.texShape;if(h){var f=jke(t.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(f.length){case 1:e.gl.uniform1iv(h,new Int32Array(f));break;case 2:e.gl.uniform2iv(h,new Int32Array(f));break;case 3:e.gl.uniform3iv(h,new Int32Array(f));break;case 4:e.gl.uniform4iv(h,new Int32Array(f))}}if(d&&e.gl.uniform2i(d,u.texData.texShape[0],u.texData.texShape[1]),null!=l)if(u.isUniform)if(l3(u.shape)<2)e.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),e.gl.uniform1fv(l,m)}else null!=u.texData.slice&&null!=p&&e.gl.uniform1i(p,u.texData.slice.flatOffset),e.setInputMatrixTexture(u.texData.texture.texture,l,s)}var v=t.outShapeLocation;if(v)switch(r.shape.length){case 1:e.gl.uniform1iv(v,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(v,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(v,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(v,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var g=E3(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(g));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(g));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(g))}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(var y=0;y<t.program.customUniforms.length;++y){var b=t.program.customUniforms[y],x=t.customUniformLocations[y],k=a[y];if("float"===b.type)e.gl.uniform1fv(x,k);else if("vec2"===b.type)e.gl.uniform2fv(x,k);else if("vec3"===b.type)e.gl.uniform3fv(x,k);else if("vec4"===b.type)e.gl.uniform4fv(x,k);else if("int"===b.type)e.gl.uniform1iv(x,k);else if("ivec2"===b.type)e.gl.uniform2iv(x,k);else if("ivec3"===b.type)e.gl.uniform3iv(x,k);else{if("ivec4"!==b.type)throw Error("uniform type ".concat(b.type," is not supported yet."));e.gl.uniform4iv(x,k)}}e.executeProgram()}(this.gpgpu,m,p,d,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var g=V3().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=C8();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!V3().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!V3().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=U7((function(){if(!V3().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=V3().getBool("DEBUG");V3().set("DEBUG",!1);var n=e.abs(eee(1e-8)).dataSync()[0];if(V3().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=C8());var l=t.texShape;if(null==l&&(l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=V3().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=V3().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&V3().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?a3(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=y3(e);e=a.newShape}var i=l3(e),o=null;e.length<=1&&i<=n?o=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?o=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?o=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?o=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?o=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(o=[e[0],e[1]*e[2]*e[3]]);var s=null!=o&&Math.max.apply(Math,Ie(o))>r&&Math.min.apply(Math,Ie(o))<=(t?2:1)&&Math.min.apply(Math,Ie(o))>0;if(null==o||s)if(t){var u=gke(e),c=2,l=2;if(e.length){var p=C(yke(e),2);c=p[0],l=p[1]}o=d3(i=u*(c/2)*(l/2)).map((function(e){return 2*e}))}else o=d3(i);return o}(n,s),t.texShape=l),null!=a){var p,h=bke(n),d=l[1],f=l[0],m=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!m){var v=C(eke(l[0],l[1]),2);d=v[0],f=v[1]}p=s?new awe(h,m):new rwe(h,m);var g=m?[f,d]:l,y=this.makeTensorInfo(g,r),b=this.texData.get(y.dataId);b.usage=m?Kxe.PIXELS:Kxe.UPLOAD,b.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),d,f,a);var x=[[f,d]],k=this.runWebGLProgram(p,[y],r,x,!0),w=this.texData.get(k.dataId);t.texShape=w.texShape,t.isPacked=w.isPacked,t.usage=w.usage,V3().get("ENGINE_COMPILE_ONLY")?this.disposeData(k.dataId):(t.texture=w.texture,t.values=null,this.texData.delete(k.dataId)),this.disposeIntermediateTensorInfo(y),c&&(this.uploadWaitMs+=C8()-u)}else{var I=this.acquireTexture(l,o,r,s);t.texture=I}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*w3(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=C(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=C(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:o=w().mark((function e(){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=C(u[s],2),r=n[1],a=new Promise((function(e){try{c.checkCompletion_(r),e(!0)}catch(t){throw t}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),s=0,u=Object.entries(this.binaryCache);case 8:if(!(s<u.length)){e.next=13;break}return e.delegateYield(o(),"t0",10);case 10:s++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,cae();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw uke(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.values(this.binaryCache);e<t.length;e++){var n=t[e];this.gpgpu.buildVao(n.webGLProgram);var r=Yke(this.gpgpu,n.program,n.webGLProgram),a=r.variablesLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.outShapeLocation,c=r.outShapeStridesLocation,l=r.outTexShapeLocation;n.variablesLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.outShapeLocation=u,n.outShapeStridesLocation=c,n.outTexShapeLocation=l}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=W7().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return W7().makeTensorFromDataId(u,t,n,s)}}]),n}(e3);PIe.nextDataId=0;v9()&&j7("webgl",(function(){return new PIe}),2);var BIe="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",WIe=we((function e(t,n,r){xe(this,e),this.variableNames=["A","B"],this.outputShape=fee(n,r),this.enableShapeUniforms=Qke(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),VIe="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",UIe=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];xe(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=fee(n,r);var i=this.outputShape.length;this.enableShapeUniforms=Qke(i);var o="";if(a)if(0===i||1===l3(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=Hke(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=hIe("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function GIe(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var HIe={kernelName:o5,backendName:"webgl",kernelFunc:GIe};function jIe(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=GIe({inputs:{x:r},backend:n}),u=GIe({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var qIe={kernelName:y4,backendName:"webgl",kernelFunc:jIe},KIe="return (a < 0.) ? b * a : a;",XIe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var YIe={kernelName:h5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",N8(i,"float32")),s=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new UIe(XIe,a.shape,o.shape):new WIe(KIe,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},JIe="return (a < 0.) ? b * a : a;",QIe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var ZIe={kernelName:K5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new UIe(QIe,r.shape,a.shape):new WIe(JIe,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},$Ie="if (isnan(x)) return x;";function eSe(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),h=r(p.values,l);return c.makeTensorInfo(u.shape,l,h)}return i=V3().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new DIe(u.shape,n):new bIe(u.shape,t),c.runWebGLProgram(i,[u],l)}}function tSe(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,p=i;if(o&&"complex64"===c.dtype){var h=p.texData.get(c.dataId),d=p.texData.get(l.dataId),f=[[h.complexTensorInfos.real,d.complexTensorInfos.real],[h.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=C(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new WIe(t,c.shape,l.shape);return p.runWebGLProgram(s,[i,o],e9(r.dtype,a.dtype))})),m=C(f,2),v=m[0],g=m[1],y=jIe({inputs:{real:v,imag:g},backend:p});return p.disposeIntermediateTensorInfo(v),p.disposeIntermediateTensorInfo(g),y}var b,x=u||e9(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||p.shouldExecuteOnCPU([c,l]))&&null!=s){var k=p.texData.get(c.dataId).values,w=p.texData.get(l.dataId).values,I="string"===c.dtype?Yae(k):k,S="string"===c.dtype?Yae(w):w,N=C(s(c.shape,l.shape,I,S,x),2),T=N[0],E=N[1],_=p.makeTensorInfo(E,x);return p.texData.get(_.dataId).values=T,_}return b=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new UIe(n,c.shape,l.shape,a):new WIe(t,c.shape,l.shape),p.runWebGLProgram(b,[c,l],x)}}function nSe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?EIe:kIe;if("relu"===e)return t?AIe:SIe;if("elu"===e)return t?_Ie:IIe;if("relu6"===e)return t?RIe:NIe;if("prelu"===e)return t?QIe:JIe;if("leakyrelu"===e)return t?XIe:KIe;if("sigmoid"===e)return t?FIe:CIe;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var rSe=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];xe(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Qke(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(x="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(b,";\n        int batchB = ").concat(x,";\n        for (int i = 0; i < ").concat(p,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(m[0],");\n          result += (").concat(f[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),aSe={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},iSe=we((function e(t,n,r){xe(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=fee(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),oSe="return a * b;";function sSe(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=e9(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new iSe(aSe.REAL,a.shape,i.shape),l=new iSe(aSe.IMAG,a.shape,i.shape),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=r.runWebGLProgram(c,p,"float32"),d=r.runWebGLProgram(l,p,"float32"),f=jIe({inputs:{real:h,imag:d},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(d),f}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),v=r.texData.get(i.dataId),g=C(Pwe(a.shape,i.shape,m.values,v.values,o),2),y=g[0],b=g[1],x=r.makeTensorInfo(b,o);return r.texData.get(x.dataId).values=y,x}return t=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new UIe(oSe,a.shape,i.shape):new WIe(oSe,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var uSe={kernelName:L5,backendName:"webgl",kernelFunc:sSe};function cSe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=l3(a.shape),u=v3(i,s),c=l3(u);s3(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||kke(a.shape,u)||null!==l.texture&&kke(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[gke(e.shape)].concat(Ie(yke(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[gke(t)].concat(Ie(yke(t))),o=new fIe(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var lSe={kernelName:n6,backendName:"webgl",kernelFunc:cSe},pSe=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(h3(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),hSe=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,h="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===n?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function dSe(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=dae(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,h=void 0;h="mean"===n?0===o?new pSe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new pSe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new hSe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(h,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var fSe=we((function e(t,n){xe(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=Hke(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var mSe=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Hke(this.rank),o=pIe("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function vSe(e,t,n){var r=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mSe(e.shape,t):new fSe(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function gSe(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=g3(a,e.shape),s=o,u=dne(s,i),c=null!=u,l=e;c&&(l=vSe(e,u,r),s=mne(s.length,i)),hne("sum",s,i);var p=C(lne(l.shape,s),2),h=p[0],d=p[1],f=h;n&&(f=pne(h,o));var m=l3(d),v=cSe({inputs:{x:l},attrs:{shape:[l3(e.shape)/m,m]},backend:r}),g=dSe(v,t9(e.dtype),"sum",r),y=cSe({inputs:{x:g},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(g),c&&r.disposeIntermediateTensorInfo(l),y}(t.x,r.axis,r.keepDims,n)}var ySe={kernelName:I6,backendName:"webgl",kernelFunc:gSe};function bSe(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,h=cIe(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=h}else t=vSe(i,o,s);return t}var xSe={kernelName:j6,backendName:"webgl",kernelFunc:bSe},kSe=1e3;function wSe(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=l3(x),I=l3(k),S=fee(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);s3(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var N,T=r?[w,v,y]:[w,y,v],C=a?[I,b,g]:[I,g,b],E=cSe({inputs:{x:t},backend:i,attrs:{shape:T}}),_=cSe({inputs:{x:n},backend:i,attrs:{shape:C}}),A=[E,_],R=Math.max(w,I),F=r?E.shape[1]:E.shape[2],D=null!=s,M=null!=c,O="leakyrelu"===d,L=null!=d?nSe(d,!0):null;if((1===y||1===b)&&F>kSe&&!1===(D||M||O||null!=L)){var z=E,P=_;r&&(z=bSe({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(z)),a&&(P=bSe({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),A.push(P));var B=1===b,W=z;1!==b&&(W=cSe({inputs:{x:z},backend:i,attrs:{shape:[R,F,1]}}),A.push(W));var V=1===b?2:1,U=P;B&&(U=cSe({inputs:{x:P},backend:i,attrs:{shape:[R,1,F]}}),A.push(U));var G=sSe({inputs:{a:W,b:U},backend:i});N=gSe({inputs:{x:G},backend:i,attrs:{axis:V,keepDims:!0}}),A.push(G)}else{var H=e9(t.dtype,n.dtype),j=new rSe(T,C,[R,y,b],r,a,D,L,M,O),q=[E,_];if(null!=s&&q.push(s),M&&q.push(c),O){var K=i.makeTensorInfo([],"float32",N8(p,"float32"));q.push(K),A.push(K)}N=i.runWebGLProgram(j,q,H)}var X=cSe({inputs:{x:N},backend:i,attrs:{shape:S}});A.push(N);for(var Y=0,J=A;Y<J.length;Y++){var Q=J[Y];i.disposeIntermediateTensorInfo(Q)}return X}var ISe={kernelName:Z6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return wSe({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},SSe="return abs(x);";var NSe={kernelName:q3,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=Ywe(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=V3().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DIe(a.shape,SSe):new bIe(a.shape,SSe),r.runWebGLProgram(t,[a],a.dtype)}},TSe=eSe({opSnippet:xIe+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),CSe={kernelName:K3,backendName:"webgl",kernelFunc:TSe},ESe=eSe({opSnippet:xIe+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),_Se={kernelName:X3,backendName:"webgl",kernelFunc:ESe},ASe="return a + b;",RSe=tSe({opSnippet:ASe,packedOpSnippet:ASe,supportsComplex:!0,cpuKernelImpl:vwe}),FSe={kernelName:Y3,backendName:"webgl",kernelFunc:RSe},DSe=we((function e(t,n){xe(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),MSe=we((function e(t,n){xe(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var OSe={kernelName:J3,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return GIe({inputs:{x:a[0]},backend:r});if(a.length>V3().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return e9(e,t)})),c=a.map((function(e){return e.shape})),l=V3().getBool("WEBGL_PACK")?new MSe(a[0].shape,c):new DSe(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var LSe={kernelName:Q3,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=g3(i,a.shape),c=u,l=dne(c,s),p=a;null!=l&&(p=bSe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=mne(c.length,s)),hne("all",c,s);var h,d=C(lne(p.shape,c),2),f=d[0],m=cSe({inputs:{x:p},backend:n,attrs:{shape:[-1,l3(d[1])]}}),v=dSe(m,m.dtype,"all",n);return h=cSe(o?{inputs:{x:v},backend:n,attrs:{shape:pne(f,u)}}:{inputs:{x:v},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),null!=l&&n.disposeIntermediateTensorInfo(p),h}};var zSe={kernelName:Z3,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=g3(i,a.shape),c=u,l=dne(c,s),p=a;null!=l&&(p=bSe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=mne(c.length,s)),hne("any",c,s);var h,d=C(lne(p.shape,c),2),f=d[0],m=cSe({inputs:{x:p},backend:n,attrs:{shape:[-1,l3(d[1])]}}),v=dSe(m,m.dtype,"any",n);return h=cSe(o?{inputs:{x:v},backend:n,attrs:{shape:pne(f,u)}}:{inputs:{x:v},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),null!=l&&n.disposeIntermediateTensorInfo(p),h}},PSe=we((function e(t,n,r){xe(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),BSe=we((function e(t,n,r,a){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,s3(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=Hke(l),h=hIe("coords",l);if(1===o){var d=Hke(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(h[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(h[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(h[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(h[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),m="."+f[u-1],v=f.map((function(e){return"int "+e})),g=hIe("sourceLocR",u-1).concat("inIdx.r"),y=hIe("sourceLocG",u-1).concat("inIdx.g"),b=hIe("sourceLocB",u-1).concat("inIdx.b"),x=hIe("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),I="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(h[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function WSe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=dae(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new PSe(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=WSe(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function VSe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=dae(a[a.length-1]),o=new BSe(a,i,n,null==r),s=null==r?[t]:[t,r],u=e.runWebGLProgram(o,s,"int32");if(u.shape.length===t.shape.length){var c=VSe(e,t,n,u);return e.disposeIntermediateTensorInfo(u),c}return u}function USe(e,t,n,r){var a=[n];if(hne("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!V3().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=C(lne(s.shape,a),2),c=u[0],l=l3(u[1]),p=cSe({inputs:{x:s},backend:e,attrs:{shape:[-1,l]}});i.push(p);var h=WSe(e,p,r);i.push(h);var d=cSe({inputs:{x:h},backend:e,attrs:{shape:c}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),d}return VSe(e,t,r)}var GSe={kernelName:$3,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=g3(r.axis,a.shape),o=dne(i,a.shape.length),s=a,u=[];null!=o&&(s=bSe({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=mne(i.length,s.shape.length)),hne("argMax",[i[0]],s.shape.length);var c=USe(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var HSe={kernelName:e4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=g3(r.axis,a.shape),o=dne(i,a.shape.length),s=a,u=[];null!=o&&(s=bSe({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=mne(i.length,s.shape.length)),hne("argMin",[i[0]],s.shape.length);var c=USe(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},jSe=eSe({opSnippet:xIe+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),qSe={kernelName:t4,backendName:"webgl",kernelFunc:jSe},KSe=eSe({opSnippet:xIe+"return log(x + sqrt(x * x + 1.0));"}),XSe={kernelName:n4,backendName:"webgl",kernelFunc:KSe},YSe=eSe({opSnippet:xIe+"\n  return atan(x);\n"}),JSe={kernelName:r4,backendName:"webgl",kernelFunc:YSe},QSe=tSe({opSnippet:BIe+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+VIe+"\n  return result;\n"}),ZSe={kernelName:i4,backendName:"webgl",kernelFunc:QSe},$Se=eSe({opSnippet:xIe+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),eNe={kernelName:a4,backendName:"webgl",kernelFunc:$Se},tNe=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?v:g:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var b="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(b="avgValue / max(count, 1.0)");var x=4*Math.floor(o/4),k=o%4,w="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(x,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(w,"\n          }\n\n          int xC = xCCorner + ").concat(x,";\n          if (").concat(1===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(2===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(w,"\n          } else if (").concat(3===k,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(w,"\n          }\n        }\n        setOutput(").concat(b,");\n      }\n    ")}})),nNe=we((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(xe(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / max(count, 1.0)");var w=4*Math.floor(o/4),I=o%4,S="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(S,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(2===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(S,"\n            } else if (").concat(3===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(S,"\n            }\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}}));var rNe={kernelName:o4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Tke(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;s3(dte(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=rte(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&p3(c.inShape,c.outShape))return GIe({inputs:{x:a},backend:n});var l=new tNe(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var aNe={kernelName:u4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=ate(a.shape,i,o,[1,1,1],s,u,c),p=new nNe(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},iNe=we((function e(t){xe(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,h=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),oNe=we((function e(t){xe(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=p-1-t.padInfo.front,m=h-1-t.padInfo.top,v=d-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(m,", ").concat(v,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var sNe={kernelName:c4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=ate(i.shape,o,s,[1,1,1],u,c),p=new oNe(l);return n.runWebGLProgram(p,[a],i.dtype)}};var uNe={kernelName:s4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Tke([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=rte(o.shape,s,u,1,c),p=new iNe(l);return n.runWebGLProgram(p,[a],o.dtype)}};var cNe={kernelName:l4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return wSe({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},lNe=we((function e(t,n,r,a,i,o){xe(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],fee(t,n),fee(t,r);var s="0.0";null!=a&&(fee(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(fee(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),pNe=we((function e(t,n,r,a,i,o){xe(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],fee(t,n),fee(t,r);var s="vec4(0.0)";null!=a&&(fee(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(fee(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),hNe={kernelName:t5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;s3(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),s3(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),s3(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var h=null;null!=u&&(h=u.shape,l.push(u));var d=V3().getBool("WEBGL_PACK_NORMALIZATION")?new pNe(a.shape,i.shape,o.shape,p,h,c):new lNe(a.shape,i.shape,o.shape,p,h,c);return n.runWebGLProgram(d,l,l[0].dtype)}},dNe=we((function e(t){xe(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Hke(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return fNe.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(fNe[t]," = start[").concat(t,"] + coords.").concat(fNe[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),fNe=["x","y","z","w","u","v"];var mNe=we((function e(t){xe(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=Hke(this.rank),r=hIe("coords",this.rank),a=hIe("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function vNe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=C(Jee(a,r.begin,r.size),2),o=i[0],s=i[1];if(qee(a,o,s),0===l3(s))return n.makeTensorInfo(s,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var u=n.texData.get(a.dataId),c=Jwe(u.values,o,s,a.shape,a.dtype);return n.makeTensorInfo(s,a.dtype,c)}var l=n.texData.get(a.dataId).isPacked,p=Xee(a.shape,o,s);if(l||!p){var h=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mNe(s):new dNe(s),d=[o];return n.runWebGLProgram(h,[a],a.dtype,d)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=Yee(t,E3(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,o,s,n)}var gNe={kernelName:v6,backendName:"webgl",kernelFunc:vNe},yNe={kernelName:p4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;s3(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=mae(a.shape,i,s),c=vae(u.length,i.length),l=gae(a.shape,i,s),p=yae(o,i.length),h=bae(l,o,i.length),d=[],f=cSe({inputs:{x:a},backend:n,attrs:{shape:u}}),m=bSe({inputs:{x:f},backend:n,attrs:{perm:c}}),v=cSe({inputs:{x:m},backend:n,attrs:{shape:l}}),g=vNe({inputs:{x:v},backend:n,attrs:{begin:p,size:h}});return d.push(f),d.push(m),d.push(v),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var bNe={kernelName:h4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=gwe(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var xNe={kernelName:d4,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=V3().getNumber("WEBGL_VERSION");if(r.shouldExecuteOnCPU([a,i])||1===s){var u=r.texData.get(a.dataId).values,c=r.texData.get(i.dataId).values,l=C(bwe(a.shape,i.shape,u,c,a.dtype),2),p=l[0],h=l[1],d=r.makeTensorInfo(h,a.dtype);return r.texData.get(d.dataId).values=p,d}return t=o?new UIe("\n  int r = int(a.r) & int(b.r);\n  int g = int(a.g) & int(b.g);\n  int rb = int(a.b) & int(b.b);\n  int ra = int(a.a) & int(b.a);\n  return vec4(r, g, rb, ra);\n",a.shape,i.shape,!1):new WIe("\n  return float(int(a.r) & int(b.r));\n",a.shape,i.shape),r.runWebGLProgram(t,[a,i],a.dtype)}};var kNe={kernelName:f4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=fee(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},wNe=tSe({opSnippet:"return float(a != b);",cpuKernelImpl:Wwe,dtype:"bool"}),INe={kernelName:P5,backendName:"webgl",kernelFunc:wNe};function SNe(e){var t=e.inputs,n=e.backend,r=t.input;return GIe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var NNe={kernelName:$5,backendName:"webgl",kernelFunc:SNe},TNe="return float(int(x));";var CNe={kernelName:m4,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return GIe({inputs:{x:i},backend:r});var s=xne(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=jIe({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=SNe({inputs:{input:i},backend:r}),p=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),p}if(!k3(i.dtype,o)){var h=GIe({inputs:{x:i},backend:r});return{dataId:h.dataId,shape:h.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var d=r.texData.get(i.dataId).values,f=C(xwe(d,i.shape,i.dtype,o),3),m=f[0],v=f[1],g=f[2];return r.makeTensorInfo(m,v,g)}if("int32"===o)return function(e,t){var n=new bIe(e.shape,TNe),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var y=r.makeTensorInfo([],"bool",b3("bool",1)),b=wNe({inputs:{a:i,b:y},backend:r});return r.disposeIntermediateTensorInfo(y),b}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},ENe="return ceil(x);",_Ne=eSe({opSnippet:ENe,packedOpSnippet:ENe,cpuKernelImpl:kwe}),ANe={kernelName:v4,backendName:"webgl",kernelFunc:_Ne},RNe=we((function e(t){xe(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),FNe=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var DNe={kernelName:g4,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=V3().getBool("WEBGL_PACK_CLIP")?new FNe(i.shape):new RNe(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},MNe=we((function e(t){xe(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function ONe(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var LNe={kernelName:b4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new MNe(r.shape),o=[ONe(r,a.complexTensorInfos.real),ONe(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},zNe=we((function e(t){xe(this,e),this.outputShape=[],this.outputShape=pae(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),PNe=we((function e(t,n){xe(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=pae(t,n);var r=this.outputShape,a=r.length,i=Hke(a),o=hIe("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),h=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(h,"), vec2(").concat(p.join(),"));\n        }"),f=1;f<u.length;f++){var m=u[f-1];d+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(BNe(s,l,m),"),\n            vec2(").concat(BNe(p,l,m),"));\n        }")}var v=u.length,g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(v,"(").concat(BNe(s,l,g),"),\n          vec2(").concat(BNe(p,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function BNe(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function WNe(e){var t=e.inputs,n=e.backend,r=t.input;return GIe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var VNe={kernelName:u5,backendName:"webgl",kernelFunc:WNe};function UNe(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return SNe({inputs:{input:e},backend:n})})),i=e.map((function(e){return WNe({inputs:{input:e},backend:n})})),o=UNe(a,t,n),s=UNe(i,t,n),u=jIe({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=l3(e.shape.slice(t));return cSe({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),h=pae(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],f=wwe(p,h,r,d),m=pae(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=e.filter((function(e){return l3(e.shape)>0})),y=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new bIe(e[0].shape,TIe):new DIe(e[0].shape,TIe);return n.runWebGLProgram(b,e,r)}var x=V3().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var k=[],w=0;w<g.length;w+=x){var I=g.slice(w,w+x);k.push(UNe(I,t,n))}for(var S=UNe(k,t,n),N=0,T=k;N<T.length;N++){var C=T[N];n.disposeIntermediateTensorInfo(C)}return S}if(y){var E=new PNe(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(E,g,r)}var _=function(e,t,n){var r=pae(e.map((function(e){return e.shape})),t),a=e.map((function(e){return cSe({inputs:{x:e},attrs:{shape:[-1,l3(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}(g,t,n),A=_.tensors2D,R=_.outShape,F=new zNe(A.map((function(e){return e.shape}))),D=n.runWebGLProgram(F,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var M=cSe({inputs:{x:D},attrs:{shape:R},backend:n});return n.disposeIntermediateTensorInfo(D),M}function GNe(e){var t=e.inputs,n=e.backend,r=g3(e.attrs.axis,t[0].shape)[0];lae(t.map((function(e){return e.shape})),r);var a=pae(t.map((function(e){return e.shape})),r);if(0===l3(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return l3(e.shape)>0}));return 1===i.length?GIe({inputs:{x:i[0]},backend:n}):UNe(i,r,n)}var HNe={kernelName:x4,backendName:"webgl",kernelFunc:GNe},jNe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4,v="channelsLast"===t.dataFormat,g=v?1:2,y=v?2:3,b=v?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),qNe=we((function e(t){xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),KNe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qke(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,p=l,h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",d=0;d<l;d++)h+="\n           vec4 xTexelC".concat(2*d,";\n           int xTexelC").concat(2*d,"Ready;\n           vec4 xTexelC").concat(2*d+1,";\n           int xTexelC").concat(2*d+1,"Ready;\n           vec4 xC").concat(d,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var f=0;f<l;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(p+1)/2;m++){var v=2*m;if(h+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),h+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<l)){var g=o%2===0?a3(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(g,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),h+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):h+=1===g?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(g,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<l&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<l&&(h+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<l&&(h+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<l&&(h+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";var y="",b="";r&&(y=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),b="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(y,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(x,"\n         ").concat(b,"\n         setOutput(result);\n       }\n     ")})),XNe=we((function e(t,n){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Qke(this.outputShape.length);for(var r=n.dataFormat,a=Eke(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function YNe(e,t){var n=e.length;return n>=3?[].concat(Ie(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function JNe(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=YNe(c.shape,b);null!=k&&(c=cSe({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=YNe(s.shape,b);null!=w&&(s=cSe({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if(!((1===g||1===y)&&v>kSe)&&m.isPacked&&b&&null!=m.texture&&f[2]%2!==0&&p3(m.shape.slice(-3),f.slice(-3))){var I=f[0]*f[1]*(f[2]+1),S={dataId:n.dataId,shape:[1,I,a.inChannels],dtype:n.dtype},N=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,s3(kke(m.shape,S.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(S.shape," isn't free")}));var T=cSe({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var C=wSe({a:S,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p}),E=i.texData.get(C.dataId);s3(E.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=N,E.shape=a.outShape,(t=GIe({inputs:{x:C},backend:i})).shape=a.outShape,x.push(C)}else{var _=a.outHeight*a.outWidth,A=cSe({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,_,a.inChannels]:[a.batchSize,a.inChannels,_]}}),R=cSe({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),F=wSe({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p});t=cSe({inputs:{x:F},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(F)}for(var D=0,M=x;D<M.length;D++){var O=M[D];i.disposeIntermediateTensorInfo(O)}return t}function QNe(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,h=void 0===p?null:p,d=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*f*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var I=YNe(u.shape,y);null!=I&&(u=cSe({inputs:{x:u},backend:a,attrs:{shape:I}}),w.push(u))}if(null!=o){var S=YNe(o.shape,y);null!=S&&(o=cSe({inputs:{x:o},backend:a,attrs:{shape:S}}),w.push(o))}var N=cSe({inputs:{x:n},backend:a,attrs:{shape:[1,b,l3(n.shape)/b]}});w.push(N);var T=new XNe(k,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],E=a.runWebGLProgram(T,[t],"float32",C),_=cSe({inputs:{x:E},backend:a,attrs:{shape:k}});w.push(E),w.push(_);var A=null!=o,R=null!=u,F="leakyrelu"===h,D=h?nSe(h,!0):null,M=new rSe(y?_.shape:N.shape,y?N.shape:_.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,D,R,F),O=y?[_,N]:[N,_];if(o&&O.push(o),R&&O.push(u),F){var L=a.makeTensorInfo([],"float32",N8(l,"float32"));O.push(L),w.push(L)}var z=a.runWebGLProgram(M,O,"float32"),P=cSe({inputs:{x:z},backend:a,attrs:{shape:r.outShape}});w.push(z);for(var B=0,W=w;B<W.length;B++){var V=W[B];a.disposeIntermediateTensorInfo(V)}return P}var ZNe={kernelName:k4,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,h=mte(c),d=ite(i.shape,o.shape,s,l,u,p,!1,h);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&V3().getBool("WEBGL_EXP_CONV")){var f=new KNe(d),m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];t=r.runWebGLProgram(f,[i,o],"float32",m)}else if(V3().getBool("WEBGL_CONV_IM2COL"))t=QNe({x:i,filter:o,convInfo:d,backend:r});else{var v=new jNe(d);t=r.runWebGLProgram(v,[i,o],"float32")}else t=JNe({x:i,filter:o,convInfo:d,backend:r});var g=cSe({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),g}},$Ne=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              ").concat(o?"float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);":"float dyValue = getDy(b, d2, yR, yC);\n              float xValue = getX(b, d1, xR, xC);\n              dotProd += (xValue * dyValue);","\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),eTe=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),tTe=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),nTe=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var rTe={kernelName:w4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=mte(u),h=ite(a.shape,l,o,1,s,c,!1,p),d=new $Ne(h);return n.runWebGLProgram(d,[a,i],"float32")}},aTe=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Qke(this.outputShape.length);var n=t.filterHeight,r=t.filterWidth,a=n-1-t.padInfo.top,i=r-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2(".concat(a,", ").concat(i,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        vec4 result = vec4(0.);\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / strides[0];\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            float dyC = float(dyCCorner + wC) / strides[1];\n            bool idyCVal = (dyC >= 0.0) && (dyC < ").concat(t.outWidth,".0)\n              && (fract(dyC) == 0.0);\n            int idyC = int(dyC);\n\n            float dyC2 = float(dyCCorner + wC + 1) / strides[1];\n            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ").concat(t.outWidth,".0)\n              && (fract(dyC2) == 0.0);\n            int idyC2 = int(dyC2);\n\n            if (idyCVal && idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?\n                  dySample : getDy(batch, idyR, idyC2, d2);\n\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n\n                dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample2.xy : dySample2.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC, d2);\n                vec2 dyValue = mod(float(idyC), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.xy += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            } else if (idyCVal2) {\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2 += 2) {\n                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);\n                vec4 dySample = getDy(batch, idyR, idyC2, d2);\n                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?\n                  dySample.xy : dySample.zw;\n                result.zw += vec2(dot(dyValue, wValue.xy),\n                  dot(dyValue, wValue.zw));\n              }\n            }\n          }\n        }\n        setOutput(result);\n      }\n    ")}));var iTe={kernelName:I4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=mte(c),h=ite(o,i.shape,s,1,u,l,!1,p);if(V3().getBool("WEBGL_PACK")&&"channelsLast"===p){var d=[[h.strideHeight,h.strideWidth]],f=new aTe(h);return n.runWebGLProgram(f,[a,i],"float32",d)}var m=new eTe(h);return n.runWebGLProgram(m,[a,i],"float32")}};var oTe={kernelName:S4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=ote(a.shape,i.shape,o,u,s),l=new qNe(c);return n.runWebGLProgram(l,[a,i],"float32")}};var sTe={kernelName:N4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=ote(a.shape,u,o,1,s),l=new tTe(c);return n.runWebGLProgram(l,[a,i],"float32")}};var uTe,cTe={kernelName:T4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=ote(r.inputShape,i.shape,s,1,o),c=new nTe(u);return n.runWebGLProgram(c,[a,i],"float32")}},lTe=eSe({opSnippet:$Ie+"\n  return cos(x);\n",packedOpSnippet:"\n  vec4 result = cos(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(VIe,"\n  return result;\n")}),pTe={kernelName:C4,backendName:"webgl",kernelFunc:lTe},hTe=eSe({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),dTe={kernelName:E4,backendName:"webgl",kernelFunc:hTe},fTe=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3],p=C(n,1)[0],h=C(r,2),d=h[0],f=h[1];this.outputShape=[p,d,f,l];var m="bilinear"===a?1:0,v="".concat(u-1,".0"),g="".concat(c-1,".0"),y=C(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(v)],3),b=y[0],x=y[1],k=y[2],w=C(f>1?["".concat((c-1)/(f-1)),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(g)],3),I=w[0],S=w[1],N=w[2];this.userCode="\n      const float height_ratio = float(".concat(b,");\n      const float width_ratio = float(").concat(I,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(x,";\n        float width_scale = ").concat(S,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(N,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),mTe={kernelName:R4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new fTe(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(uTe||(uTe={}));var vTe=we((function e(t,n,r,a){xe(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===uTe.Prod?"1.0":"0.0",s=r?o:"getX(".concat(gTe(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(Hke(i)," coords = getOutputCoords();\n        int end = ").concat(yTe(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(yTe(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(gTe(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function gTe(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function yTe(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function bTe(e,t,n,r,a,i){var o=t.shape.length,s=dne([r],o),u=t;null!=s&&(u=bSe({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=mne(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],p=GIe({inputs:{x:u},backend:n}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var d=new vTe(e,u.shape,!1,i),f=[[h]],m=p;p=n.runWebGLProgram(d,[p],p.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var v=new vTe(e,u.shape,a,i),g=p;p=n.runWebGLProgram(v,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=bSe({inputs:{x:p},backend:n,attrs:{perm:fne(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var xTe={kernelName:_4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return bTe(uTe.Prod,a,n,i,o,s)}};var kTe={kernelName:A4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return bTe(uTe.Sum,a,n,i,o,s)}};var wTe={kernelName:F4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=gwe(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),h=n.bufferSync(i),d=ywe(p,h,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},ITe=function(){function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return we(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var STe={kernelName:D4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new ITe("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},NTe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qke(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),TTe=we((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];xe(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Qke(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,h=p,d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",f=0;f<p;f++)d+="\n          vec4 xTexelC".concat(2*f,";\n          int xTexelC").concat(2*f,"Ready;\n          vec4 xTexelC").concat(2*f+1,";\n          int xTexelC").concat(2*f+1,"Ready;\n          vec4 xC").concat(f,";");d+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<p;m++)d+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(h+1)/2;v++){var g=2*v;if(d+="\n          xC = xCCorner + ".concat(g*c,";\n          "),1===u){if(g<p&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n              "),d+=1===c&&g>0?"\n                xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                  } else {\n                    xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xC").concat(g," = xTexelC").concat(g,";\n                "),g+1<p)){var y=s%2===0?a3(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                    xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(g+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(g+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                    } else {\n                     xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                    }\n                    "):"\n                    xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                    ")):d+=1===y?"\n                    xC".concat(g+1," = xTexelC").concat(g,";\n                    "):"\n                    xCOffset = xC + ".concat(y,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                      xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(g+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(g+1,"Ready = 1;\n                    }\n\n                    xC").concat(g+1," = xTexelC").concat(g+1,";\n                    ")}}else g<p&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n              "),g+1<p&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                  xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(g,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(g,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                  xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(g+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(g+1,"Ready = 1;\n                }\n\n                xC").concat(g," = vec4(\n                  xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n              "),g+1<p&&(d+="\n                  xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                "))));g<p&&(d+="\n            wTexel = getW(r, ".concat(g,", d1, q);\n            dotProd += xC").concat(g," * vec4(wTexel.xz, wTexel.xz);\n          "),g+1<p&&(d+="\n              wTexel = getW(r, ".concat(g+1,", d1, q);\n              dotProd += xC").concat(g+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(b,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")}));var CTe={kernelName:M4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),s3(dte(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,h=ite(a.shape,i.shape,o,l,s,c,!0);p=V3().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new TTe(h):new NTe(h);var d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",d)}},ETe=we((function e(t){xe(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),_Te=we((function e(t){xe(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var ATe={kernelName:O4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=ite(a.shape,l,o,s,u,c,!0),h=new ETe(p);return n.runWebGLProgram(h,[a,i],"float32")}};var RTe={kernelName:L4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=ite(r.inputShape,i.shape,o,s,u,c,!0),p=new _Te(l);return n.runWebGLProgram(p,[a,i],"float32")}},FTe=we((function e(t){xe(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var DTe={kernelName:z4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Ie(r.shape),Ie(r.shape)),i=l3(r.shape),o=cSe({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new FTe(i),u=n.runWebGLProgram(s,[o],o.dtype),c=cSe({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},MTe=we((function e(t){xe(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,h=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var OTe={kernelName:P4,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=nte(i.shape,o.shape,s,u,"NHWC",c),p=new MTe(l),h=cSe({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),h}};var LTe={kernelName:U4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=Pae(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;Wae(i.length,s,r);for(var u=Vae(o,s),c=u.path,l=u.steps,p=l.length,h=null,d=i.length,f=[],m=0;m<p;++m){var v,g=Se(l[m]);try{for(g.s();!(v=g.n()).done;){var y=v.value,b=Bae(d,s[y]),x=b.permutationIndices,k=b.expandDims,w=void 0;Uae(x)?w=r[y]:(w=bSe({inputs:{x:r[y]},backend:n,attrs:{perm:x}}),f.push(w));for(var I=w.shape.slice(),S=0;S<k.length;++S)I.splice(k[S],0,1);p3(w.shape,I)||(w=cSe({inputs:{x:w},backend:n,attrs:{shape:I}}),f.push(w)),null===h?h=w:(h=sSe({inputs:{a:w,b:h},backend:n}),f.push(h))}}catch(aGe){g.e(aGe)}finally{g.f()}m<p-1&&(c[m]>=0&&(h=gSe({inputs:{x:h},backend:n,attrs:{axis:c[m]-(i.length-d),keepDims:!1}}),f.push(h)),d--)}for(var N=0,T=f;N<T.length;N++){var C=T[N];C!==h&&n.disposeIntermediateTensorInfo(C)}return h}},zTe=eSe({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),PTe={kernelName:G4,backendName:"webgl",kernelFunc:zTe},BTe={kernelName:H4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=V3().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new UIe("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new WIe("return (b >= 0.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},WTe=tSe({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:Iwe}),VTe={kernelName:q4,backendName:"webgl",kernelFunc:WTe},UTe=eSe({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Sae,";\n  float a1 = ").concat(Nae,";\n  float a2 = ").concat(Tae,";\n  float a3 = ").concat(Cae,";\n  float a4 = ").concat(Eae,";\n  float a5 = ").concat(_ae,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),GTe={kernelName:j4,backendName:"webgl",kernelFunc:UTe},HTe=eSe({opSnippet:$Ie+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Swe,dtype:"float32"}),jTe={kernelName:K4,backendName:"webgl",kernelFunc:HTe};function qTe(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(s3(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),cSe({inputs:{x:i},backend:r,attrs:{shape:s}})}var KTe={kernelName:X4,backendName:"webgl",kernelFunc:qTe},XTe="return exp(x) - 1.0;",YTe=eSe({opSnippet:XTe,packedOpSnippet:XTe,cpuKernelImpl:Nwe}),JTe={kernelName:Y4,backendName:"webgl",kernelFunc:YTe},QTe=we((function e(t,n,r){xe(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function ZTe(e,t,n){var r=n.texData.get(e.dataId),a=l3(e.shape),i=e.shape[e.shape.length-1],o=cSe({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new QTe("real",s,t),c=new QTe("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),d=jIe({inputs:{real:p,imag:h},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h);var f=cSe({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),f}var $Te={kernelName:J4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return ZTe(t.input,!1,n)}},eCe=we((function e(t,n){xe(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function tCe(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||N3(a))){var o=x3(i,l3(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new eCe(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var nCe,rCe={kernelName:Q4,backendName:"webgl",kernelFunc:tCe},aCe=we((function e(t){xe(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),iCe={kernelName:Z4,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new aCe(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},oCe="return floor(x);",sCe=eSe({opSnippet:oCe,packedOpSnippet:oCe,cpuKernelImpl:Twe}),uCe={kernelName:$4,backendName:"webgl",kernelFunc:sCe},cCe=tSe({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),lCe={kernelName:e5,backendName:"webgl",kernelFunc:cCe},pCe=we((function e(t){xe(this,e),this.variableNames=["A"];var n=Eke(),r=C(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),hCe=we((function e(t){xe(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Eke(),r=C(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),dCe={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=C(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],p=[l,c],h=[l,c,i];if(s||o){var d=V3().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=nCe&&d===fCe||(fCe=d,nCe=document.createElement("canvas").getContext("2d",{willReadFrequently:fCe})),nCe.canvas.width=c,nCe.canvas.height=l,nCe.drawImage(a,0,0,c,l),a=nCe.canvas}var f=n.makeTensorInfo(p,"int32");n.texData.get(f.dataId).usage=Kxe.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),a);var m=V3().getBool("WEBGL_PACK")?new hCe(h):new pCe(h),v=n.runWebGLProgram(m,[f],"int32");return n.disposeData(f.dataId),v}},fCe=V3().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var mCe={kernelName:$6,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,h=a.dilations,d=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,v=mte(p),g=ite(i.shape,o.shape,c,h,l,d,!1,v),y=[],b=null!=s,x=null!=u,k="leakyrelu"===f,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=cSe({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,p)),x&&e.push(t(u,p)),k){var n=r.makeTensorInfo([],"float32",N8(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&V3().getBool("WEBGL_EXP_CONV")){var I=f?nSe(f,!0):null,S=new KNe(g,b,I,x,k),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=w();t=r.runWebGLProgram(S,T,"float32",N)}else if(V3().getBool("WEBGL_CONV_IM2COL"))t=QNe({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var C=f?nSe(f,!1):null,E=new jNe(g,b,C,x,k),_=w();t=r.runWebGLProgram(E,_,"float32")}else t=JNe({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var A=cSe({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var vCe={kernelName:e8,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),s3(dte(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=ite(a.shape,i.shape,u,m,c,p,!0),y=V3().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?nSe(h,y):null,x=[a,i],k=null!=o,w=null!=s,I="leakyrelu"===h;if(k&&x.push(o),w&&x.push(s),I){var S=n.makeTensorInfo([],"float32",N8(d,"float32"));x.push(S),f.push(S)}v=y?new TTe(g,k,b,w,I):new NTe(g,k,b,w,I);var N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",N);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},gCe=we((function e(t,n,r,a){xe(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Hke(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var yCe={kernelName:r5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=l3(r.shape),u=C(xae(r,a),4),c=u[0],l=u[1],p=u[2],h=u[3],d=cSe({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),f=cSe({inputs:{x:r},backend:n,attrs:{shape:[l3(r.shape)/p,p]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var m=n.readSync(a.dataId),v=n.bufferSync(r),g=Cwe(m,v,r.dtype,l,o,p,h,r.shape,s);return n.makeTensorInfo(c,r.dtype,g.values)}var y=new gCe(o,h,[l,p],r.shape),b=n.runWebGLProgram(y,[f,d],f.dtype),x=cSe({inputs:{x:b},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(b),x}},bCe=we((function e(t,n){xe(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=Hke(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function xCe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=g3(o,a.shape)[0];if(V3().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[h];s3(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=Xae(a,i,u,s),f=l3(i.shape),m=[],v=cSe({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=cSe({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}});m.push(v),m.push(g);var y=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),k=Ewe(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d.outputShape,k.dtype,k.values)}var w=new bCe(v.shape,y),I=n.runWebGLProgram(w,[v,g],v.dtype);m.push(I);var S=cSe({inputs:{x:I},backend:n,attrs:{shape:d.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),S}var kCe={kernelName:n5,backendName:"webgl",kernelFunc:xCe},wCe=tSe({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:_we,dtype:"bool"}),ICe={kernelName:a5,backendName:"webgl",kernelFunc:wCe},SCe=tSe({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Awe}),NCe={kernelName:i5,backendName:"webgl",kernelFunc:SCe};var TCe={kernelName:s5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return ZTe(t.input,!0,n)}},CCe=eSe({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),ECe={kernelName:c5,backendName:"webgl",kernelFunc:CCe},_Ce=eSe({opSnippet:"return float(isinf(x));",dtype:"bool"}),ACe={kernelName:l5,backendName:"webgl",kernelFunc:_Ce},RCe=eSe({opSnippet:"return float(isnan(x));",dtype:"bool"}),FCe={kernelName:p5,backendName:"webgl",kernelFunc:RCe},DCe=tSe({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Rwe,dtype:"bool"}),MCe={kernelName:d5,backendName:"webgl",kernelFunc:DCe},OCe=tSe({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:Fwe,dtype:"bool"}),LCe={kernelName:f5,backendName:"webgl",kernelFunc:OCe};var zCe={kernelName:m5,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=Dwe(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},PCe=eSe({opSnippet:$Ie+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:Mwe}),BCe={kernelName:v5,backendName:"webgl",kernelFunc:PCe},WCe=eSe({opSnippet:$Ie+"\n  return log(1.0 + x);\n"}),VCe={kernelName:g5,backendName:"webgl",kernelFunc:WCe},UCe=tSe({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),GCe={kernelName:y5,backendName:"webgl",kernelFunc:UCe},HCe=eSe({opSnippet:"return float(!(x >= 1.0));"}),jCe={kernelName:b5,backendName:"webgl",kernelFunc:HCe},qCe=tSe({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),KCe={kernelName:x5,backendName:"webgl",kernelFunc:qCe},XCe=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),YCe=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),JCe={kernelName:k5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=V3().getBool("WEBGL_PACK_NORMALIZATION")?new YCe(a.shape,i,o,s,u):new XCe(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},QCe=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),ZCe={kernelName:w5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new QCe(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function $Ce(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=g3(i,a.shape),c=u,l=dne(c,s),p=null!=l,h=n.shouldExecuteOnCPU([a]),d=a;if(p){if(h){for(var f=n.texData.get(d.dataId).values,m=new Array(s),v=0;v<m.length;v++)m[v]=a.shape[l[v]];var g=cIe(f,a.shape,a.dtype,l,m);d=n.makeTensorInfo(m,a.dtype),n.texData.get(d.dataId).values=g}else d=vSe(a,l,n);c=mne(c.length,s)}hne("max",c,s);var y,b=C(lne(d.shape,c),2),x=b[0],k=b[1],w=x;if(o&&(w=pne(x,u)),h){var I=n.texData.get(d.dataId).values,S=Owe(I,l3(k),w,a.dtype);y=n.makeTensorInfo(w,a.dtype),n.texData.get(y.dataId).values=S}else y=function(e,t,n,r){var a=l3(t),i=cSe({inputs:{x:e},attrs:{shape:[l3(e.shape)/a,a]},backend:r}),o=dSe(i,e.dtype,"max",r),s=cSe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(d,k,w,n);return p&&n.disposeIntermediateTensorInfo(d),y}var eEe={kernelName:I5,backendName:"webgl",kernelFunc:$Ce},tEe=tSe({opSnippet:BIe+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+VIe+"\n  return result;\n",cpuKernelImpl:Lwe}),nEe={kernelName:S5,backendName:"webgl",kernelFunc:tEe};var rEe={kernelName:N5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;Tke(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;s3(dte(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=rte(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&p3(c.inShape,c.outShape))return GIe({inputs:{x:a},backend:n});var l=new tNe(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var aEe={kernelName:C5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=ate(a.shape,i,o,[1,1,1],s,c,u),p=new nNe(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},iEe=we((function e(t){xe(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),oEe=we((function e(t){xe(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,h=c-1-t.padInfo.top,d=l-1-t.padInfo.left,f=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var sEe={kernelName:E5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=ate(i.shape,o,s,[1,1,1],u,c),p=new nNe(l,"max",!0),h=n.runWebGLProgram(p,[i],i.dtype),d=new oEe(l),f=n.runWebGLProgram(d,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),f}};var uEe={kernelName:T5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Tke([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=rte(o.shape,s,u,1,c,l),h=new tNe(p,"max",!0),d=n.runWebGLProgram(h,[o],o.dtype),f=new iEe(p),m=n.runWebGLProgram(f,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}};var cEe={kernelName:_5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;s3(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];s3(dte(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")}));var p=rte(a.shape,i,o,l,s),h=function(e,t,n,r){var a=new tNe(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new tNe(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,p,c),d=C(h,2);return[d[0],d[1]]}};var lEe={kernelName:A5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=g3(o,a.shape),l=c,p=dne(l,u),h=null!=p,d=s.shouldExecuteOnCPU([a]),f=[],m=a;if(h){if(d){for(var v=s.texData.get(m.dataId).values,g=new Array(u),y=0;y<g.length;y++)g[y]=a.shape[p[y]];var b=cIe(v,a.shape,a.dtype,p,g);m=s.makeTensorInfo(g,a.dtype),s.texData.get(m.dataId).values=b}else m=vSe(a,p,s);f.push(m),l=mne(l.length,u)}hne("sum",l,u);var x=C(lne(m.shape,l),2),k=x[0],w=x[1],I=k;i&&(I=pne(k,c));for(var S=function(e,t,n,r){var a=l3(t),i=cSe({inputs:{x:e},attrs:{shape:[l3(e.shape)/a,a]},backend:r}),o=dSe(i,"float32","mean",r),s=cSe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,w,I,s),N=0,T=f;N<T.length;N++){var E=T[N];s.disposeIntermediateTensorInfo(E)}return S}};var pEe={kernelName:R5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=g3(i,a.shape),c=u,l=dne(c,s),p=a;null!=l&&(p=bSe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=mne(c.length,a.shape.length)),hne("min",c,s);var h,d=C(lne(p.shape,c),2),f=d[0],m=cSe({inputs:{x:p},backend:n,attrs:{shape:[-1,l3(d[1])]}}),v=dSe(m,m.dtype,"min",n);return h=cSe(o?{inputs:{x:v},backend:n,attrs:{shape:pne(f,u)}}:{inputs:{x:v},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),null!=l&&n.disposeIntermediateTensorInfo(p),h}},hEe=tSe({opSnippet:BIe+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+VIe+"\n  return result;\n",cpuKernelImpl:zwe}),dEe={kernelName:F5,backendName:"webgl",kernelFunc:hEe},fEe=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Hke(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),mEe=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Hke(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=hIe("rc",a),c=hIe("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===r?0:1,d="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),vEe={kernelName:D5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mEe(a.shape,i,o):new fEe(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},gEe=tSe({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+VIe+"\n  return result;\n"}),yEe={kernelName:M5,backendName:"webgl",kernelFunc:gEe},bEe=we((function e(t,n,r){xe(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),xEe=tSe({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),kEe={kernelName:V4,backendName:"webgl",kernelFunc:xEe},wEe="return a - b;",IEe=tSe({opSnippet:wEe,packedOpSnippet:wEe,supportsComplex:!0,cpuKernelImpl:oIe}),SEe={kernelName:B6,backendName:"webgl",kernelFunc:IEe};function NEe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=g3([r.dim],a.shape),o=$Ce({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=pne(o.shape,i),u=cSe({inputs:{x:o},backend:n,attrs:{shape:s}}),c=IEe({inputs:{a:a,b:u},backend:n}),l=HTe({inputs:{x:c},backend:n}),p=gSe({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),h=cSe({inputs:{x:p},backend:n,attrs:{shape:s}}),d=xEe({inputs:{a:l,b:h},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),d}var TEe={kernelName:T6,backendName:"webgl",kernelFunc:NEe};var CEe={kernelName:O5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:NEe({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new bEe(c,l,i),h=[[o]],d=n.runWebGLProgram(p,[u],"int32",h);return s||n.disposeIntermediateTensorInfo(u),d}},EEe=xIe+"\n  return -x;\n";var _Ee={kernelName:z5,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=C(Bwe(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=V3().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new DIe(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new bIe(a.shape,EEe),r.runWebGLProgram(t,[a],a.dtype)}},AEe=Nre;var REe={kernelName:B5,backendName:"webgl",kernelFunc:function(e){t8("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=AEe(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},FEe=Tre;var DEe={kernelName:W5,backendName:"webgl",kernelFunc:function(e){t8("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=FEe(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},MEe=Cre;var OEe={kernelName:V5,backendName:"webgl",kernelFunc:function(e){t8("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=MEe(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},LEe=we((function e(t,n,r,a){xe(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),zEe={kernelName:G5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=l3(a.shape),l=new LEe(c,o,s,u),p=cSe({inputs:{x:a},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(l,[p],i);n.disposeIntermediateTensorInfo(p);var d=cSe({inputs:{x:h},backend:n,attrs:{shape:[].concat(Ie(a.shape),[o])}});return n.disposeIntermediateTensorInfo(h),d}};function PEe(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=SNe({inputs:{input:r},backend:n}),i=PEe({inputs:{x:a},backend:n}),o=WNe({inputs:{input:r},backend:n}),s=PEe({inputs:{x:o},backend:n}),u=jIe({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return tCe({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var BEe={kernelName:Y6,backendName:"webgl",kernelFunc:PEe};var WEe={kernelName:U5,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=SNe({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=WNe({inputs:{input:a},backend:r}),u=PEe({inputs:{x:s},backend:r}),c=jIe({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return tCe({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var VEe={kernelName:H5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return qTe({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){u3(a,e.shape,"All tensors passed to stack must have matching shapes"),s3(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=GNe({inputs:t.map((function(e){var t=qTe({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},UEe=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=Hke(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),GEe=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=Hke(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=hIe("rc",a),c=hIe("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",m=0,v=1===a?2:4;m<v;m++)f+="\n        ".concat(h[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),HEe=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===l3(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return tCe({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GEe(a.shape,i,o):new UEe(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},jEe={kernelName:j5,backendName:"webgl",kernelFunc:HEe},qEe=tSe({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+VIe+"\n  return result;\n"}),KEe={kernelName:q5,backendName:"webgl",kernelFunc:qEe};var XEe={kernelName:X5,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=g3(o,i.shape),p=l,h=dne(p,u),d=i;if(null!=h&&(d=bSe({inputs:{x:i},backend:r,attrs:{perm:h}}),p=mne(p.length,u),c.push(d)),hne("prod",p,u),r.shouldExecuteOnCPU([d])){var f=r.texData.get(d.dataId).values,m=Vwe(d.shape,d.dtype,f,p),v=m.outVals,g=m.outShape,y=m.outDtype;t=r.makeTensorInfo(g,y,v)}else{var b=C(lne(d.shape,p),2),x=b[0],k=l3(b[1]),w=cSe({inputs:{x:d},backend:r,attrs:{shape:[-1,k]}}),I=dSe(w,t9(i.dtype),"prod",r);t=cSe({inputs:{x:I},backend:r,attrs:{shape:x}}),c.push(w),c.push(I)}if(s){c.push(t);var S=pne(t.shape,l);t=cSe({inputs:{x:t},backend:r,attrs:{shape:S}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var YEe={kernelName:Y5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),c=a.map((function(e){return e.shape})),l=n.readSync(i.dataId),p=n.readSync(o.dataId),h=C(Uwe(u,c,l,i.shape,i.dtype,p,o.shape,s),3),d=h[0],f=h[1],m=h[2],v=d.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(m,i.dtype,f);return v.concat([g])}};var JEe={kernelName:J5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C(Gwe(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],p=c[1];return[n.makeTensorInfo([l.length],"int32",l),n.makeTensorInfo([p.length],r.dtype,p)]}};var QEe={kernelName:Q5,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=n.readSync(o.dataId),h=s.map((function(e){return n.readSync(e.dataId)})),d=s.map((function(e){return e.shape})),f=C(Hwe(c,a.shape,l,i.shape,i.dtype,p,o.shape,h,d,u),2),m=f[0],v=f[1];return n.makeTensorInfo(m,i.dtype,v)}},ZEe=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=jwe(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},$Ee={kernelName:Z5,backendName:"webgl",kernelFunc:ZEe},e_e=eSe({opSnippet:"return 1.0 / x;"}),t_e={kernelName:e6,backendName:"webgl",kernelFunc:e_e},n_e=eSe({opSnippet:xIe+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),r_e={kernelName:t6,backendName:"webgl",kernelFunc:n_e},a_e=eSe({opSnippet:xIe+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),i_e={kernelName:s6,backendName:"webgl",kernelFunc:a_e},o_e=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),s_e=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],",\n          ").concat(h[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var u_e={kernelName:i6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=C(r.size,2),u=s[0],c=s[1],l=V3().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new s_e(a.shape,u,c,i,o):new o_e(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],"float32")}},c_e=we((function e(t,n,r){xe(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=C(n,3),i=a[1],o=a[2],s=C(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/p[0],d=l[1]/p[1],f=1/h,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(h,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var l_e={kernelName:o6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new c_e(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},p_e=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),h_e=we((function e(t,n,r,a,i){xe(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=C(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,h=[a&&n>1?u-1:u,a&&r>1?c-1:c],d=[a&&n>1?n-1:n,a&&r>1?r-1:r],f=a?"0.5":"0.0";p=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(h[0]/d[0],",\n          ").concat(h[1]/d[1],",\n          ").concat(h[1]/d[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(f,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var d_e={kernelName:r6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=C(r.size,2),u=s[0],c=s[1],l=V3().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new h_e(a.shape,u,c,i,o):new p_e(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],a.dtype)}},f_e=we((function e(t,n,r){xe(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=C(n,3),i=a[1],o=a[2],s=C(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/p[0],d=l[1]/p[1],f=1/h,m=1/d,v=2*Math.ceil(f)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(h,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(f,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var m_e={kernelName:a6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new f_e(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},v_e=we((function e(t,n){xe(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=Hke(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),g_e=we((function e(t,n){xe(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=hIe("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Hke(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var y_e={kernelName:u6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=g3(i,a.shape);if(0===o)return GIe({inputs:{x:a},backend:n});var u=V3().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new g_e(a.shape,s):new v_e(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},b_e=we((function e(t,n){xe(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),x_e={kernelName:Q6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new b_e(a.shape,o),l=C(fae(s,a.shape[1],a.shape[2]),2),p=[[l[0],l[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,p)}},k_e=eSe({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),w_e={kernelName:c6,backendName:"webgl",kernelFunc:k_e},I_e=eSe({opSnippet:"return inversesqrt(x);",cpuKernelImpl:qwe}),S_e={kernelName:l6,backendName:"webgl",kernelFunc:I_e},N_e=we((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];xe(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Hke(i.length),c=Hke(o.length),l="";1===r?l="i":2===r&&(l="i, j");var p="getIndices(".concat(l,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(p,");\n              flattenedIndex += index * ").concat(v,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(").concat(m,", sum, float(found)));\n        }\n      ")})),T_e=we((function e(t,n,r,a,i,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];xe(this,e),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var u=Hke(i.length),c=Hke(o.length),l="";1===r?l="i":2===r&&(l="i, j");var p="getIndices(".concat(l,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),f="";s&&(f="coords[0], coords[1]");var m="getDefaultValue(".concat(f,")"),v=n>1?"strides[j]":"strides",g=n>1?"strides[j + 1]":"strides";this.userCode="\n        ".concat(u," strides = ").concat(u,"(").concat(i,");\n\n        void main() {\n          ").concat(c," coords = getOutputCoords();\n          vec4 sum = vec4(0.);\n          vec4 found = vec4(0.);\n          for (int i = 0; i < ").concat(t,"; i+=2) {\n            ivec2 flattenedIndex = ivec2(0);\n            for (int j = 0; j < ").concat(n,"; j+=2) {\n              ivec4 index = round(").concat(p,");\n              flattenedIndex += index.xz * ").concat(v,";\n              if (j + 1 < ").concat(n,") {\n                flattenedIndex += index.yw * ").concat(g,";\n              }\n            }\n            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||\n                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {\n              vec4 updVals = ").concat(d,";\n              if (flattenedIndex[0] == coords[0]) {\n                sum.xy += updVals.xy;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[0] == coords[0] + 1) {\n                sum.zw += updVals.xy;\n                found.zw = vec2(1.);\n              }\n              if (flattenedIndex[1] == coords[0]) {\n                sum.xy += updVals.zw;\n                found.xy = vec2(1.);\n              } else if (flattenedIndex[1] == coords[0] + 1) {\n                sum.zw += updVals.zw;\n                found.zw = vec2(1.);\n              }\n            }\n          }\n          setOutput(mix(").concat(m,", sum, found));\n        }\n      ")}));var C_e={kernelName:p6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=kae(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=[h/l,l];if(0===h)return n.makeTensorInfo(o,a.dtype);var f,m=cSe({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=cSe({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));f=V3().getBool("WEBGL_PACK")?new T_e(c,u,m.shape.length,v.shape.length,p,d):new N_e(c,u,m.shape.length,v.shape.length,p,d);var y=n.runWebGLProgram(f,[v,m,g],v.dtype),b=cSe({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},E_e=we((function e(t,n,r,a){xe(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===V3().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var __e={kernelName:d6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new E_e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},A_e=we((function e(t,n,r){var a,i;if(xe(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Hke(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var R_e={kernelName:f6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new A_e(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],e9(a.dtype,i.dtype))}},F_e=eSe({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(wae,";\n  float scale = ").concat(Iae,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),D_e={kernelName:m6,backendName:"webgl",kernelFunc:F_e},M_e=eSe({opSnippet:$Ie+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Xwe}),O_e={kernelName:x6,backendName:"webgl",kernelFunc:M_e},L_e=eSe({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),z_e={kernelName:b6,backendName:"webgl",kernelFunc:L_e},P_e=eSe({opSnippet:$Ie+"\n  return sin(x);\n",packedOpSnippet:"\n  vec4 result = sin(x);\n  bvec4 isNaN = isnan(x);\n  ".concat(VIe,"\n  return result;\n")}),B_e={kernelName:g6,backendName:"webgl",kernelFunc:P_e},W_e=eSe({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),V_e={kernelName:y6,backendName:"webgl",kernelFunc:W_e},U_e=eSe({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),G_e={kernelName:k6,backendName:"webgl",kernelFunc:U_e},H_e={kernelName:S6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;s3(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Ie(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=HEe({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=mae(p.shape,i,s,!1),d=vae(h.length,i.length,!1),f=gae(p.shape,i,s,!1),m=cSe({inputs:{x:p},backend:n,attrs:{shape:h}}),v=bSe({inputs:{x:m},backend:n,attrs:{perm:d}}),g=cSe({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(p),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var j_e={kernelName:C6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],p=C(Qwe(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=p[0],d=p[1],f=p[2],m=p[3],v=p[4];return[n.makeTensorInfo(d,r.dtype,h),n.makeTensorInfo([d[0]],a.dtype,f),n.makeTensorInfo([m.length],"bool",new Uint8Array(m.map((function(e){return Number(e)})))),n.makeTensorInfo([v.length],r.dtype,new Int32Array(v))]}};var q_e={kernelName:E6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=C(Zwe(s,r.shape,r.dtype,o,u),3),l=c[0],p=c[1],h=c[2];return[n.makeTensorInfo(p,r.dtype,l),n.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}};var K_e={kernelName:_6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C($we(o,r.shape,r.dtype,s,u,!0),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var X_e={kernelName:A6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=C($we(o,r.shape,r.dtype,s,u),2),l=c[0],p=c[1];return n.makeTensorInfo(p,r.dtype,l)}};var Y_e={kernelName:R6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=kae(0,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=_8(n.readSync(o.dataId)[0]),g=Kwe(f,m,s,d,p,l,c,h,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new N_e(l,c,a.shape.length,i.shape.length,h,[d,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=cSe({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var J_e={kernelName:N6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=g3(r.axis,a.shape)[0],s=Hae(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=Ie(l);t[o]=e;var r=vNe({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},Q_e="return sqrt(x);",Z_e=eSe({opSnippet:Q_e,packedOpSnippet:Q_e,cpuKernelImpl:eIe}),$_e={kernelName:w6,backendName:"webgl",kernelFunc:Z_e},eAe={kernelName:D6,backendName:"webgl",kernelFunc:eSe({opSnippet:"return x * x;"})},tAe="return (a - b) * (a - b);",nAe=tSe({opSnippet:tAe,packedOpSnippet:tAe}),rAe={kernelName:F6,backendName:"webgl",kernelFunc:nAe};var aAe={kernelName:M6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;if("string"!==a.dtype)throw new Error("Input must be of datatype string");var i=Yae(n.readSync(a.dataId)),o=tIe(i,"string",r);return n.makeTensorInfo(a.shape,"string",o)}};var iAe={kernelName:J6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=xIe+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new bIe(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},oAe=we((function e(t,n,r){xe(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Hke(r.length),o=Hke(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var sAe={kernelName:O6,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,h=a.newAxisMask,d=a.shrinkAxisMask,f=Qee(i.shape,o,s,u,c,l,p,h,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=cSe({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){s3(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=Kee(x,k,w),S=vNe({inputs:{x:i},backend:r,attrs:{begin:x,size:I}});t=cSe({inputs:{x:S},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(S)}else{if(r.shouldExecuteOnCPU([i])){var N=r.readSync(i.dataId),T=L7(i.shape,i.dtype,N),C=nIe(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var E=new oAe(x,w,m);t=r.runWebGLProgram(E,[i],i.dtype)}}var _=cSe({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),_}};var uAe={kernelName:L6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,h=n.readSync(l.dataId),d=n.readSync(p.dataId),f=C(rIe(h,d,a,i,o,s,u,c),2),m=f[0],v=f[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(p.shape,"int32",v)]}};var cAe={kernelName:z6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=C(aIe(o,s,r),3),c=u[0],l=u[1],p=u[2],h=l.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",l),n.makeTensorInfo([2],"int32",new Int32Array(p))]}};var lAe={kernelName:P6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=iIe(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},pAe=eSe({opSnippet:"return tan(x);"}),hAe={kernelName:W6,backendName:"webgl",kernelFunc:pAe},dAe=eSe({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),fAe={kernelName:V6,backendName:"webgl",kernelFunc:dAe};var mAe={kernelName:h6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.tensor,i=t.indices,o=t.updates;ce(r);var s=kae(0,i,a.shape),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=[h/l,l];if(0===h)return n.makeTensorInfo(a.shape,i.dtype);var f=cSe({inputs:{x:i},backend:n,attrs:{shape:[c,u]}}),m=cSe({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),v=cSe({inputs:{x:a},backend:n,attrs:{shape:d}}),g=new N_e(c,u,f.shape.length,m.shape.length,p,d,!1,!0),y=n.runWebGLProgram(g,[m,f,v],v.dtype),b=cSe({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),b}},vAe=we((function e(t,n){xe(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=Hke(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function gAe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return _8(e)})):o,u=L7(a.shape,a.dtype,s),c=sIe(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new vAe(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var yAe={kernelName:U6,backendName:"webgl",kernelFunc:gAe},bAe=we((function e(t){xe(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),xAe=we((function e(t){xe(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function kAe(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function wAe(e){for(var t=1;t<e;)t*=2;return t}var IAe={kernelName:G6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=V3().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=V3().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var p=n.readSync(a.dataId),h=C(uIe(p,c,a.dtype,i,o),2),d=h[0],f=h[1];return[n.makeTensorInfo(d.shape,d.dtype,d.values),n.makeTensorInfo(f.shape,f.dtype,f.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,tCe({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var m=n.texData.get(a.dataId),v=null!==m&&m.isPacked,g=v?n.unpackTensor(a):a,y=l3(c)/l,b=cSe({inputs:{x:g},attrs:{shape:[y,l]},backend:n});v&&kAe(n,g);for(var x=wAe(i),k=wAe(l),w=null,I=function(){return null===w?[b,b]:[b,w]},S=function(e,t,r){var a=I(),i=new bAe(r),o=[[l],[null===w?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=w;w=n.runWebGLProgram(i,a,"int32",o),kAe(n,s)},N=1;N<x;N*=2)for(var T=2*N,E=N;E>=1;E/=2)S(T,E,[y,k]);for(var _=k;_>x;_/=2){var A=I(),R=new xAe([y,_/2]),F=[[l],[null===w?1:0],[x]],D=w;w=n.runWebGLProgram(R,A,"int32",F),kAe(n,D);for(var M=x/2,O=2*M,L=M;L>=1;L/=2)S(O,L,w.shape)}var z=w;w=vNe({inputs:{x:w},backend:n,attrs:{begin:0,size:[y,i]}}),kAe(n,z);var P=xCe({inputs:{x:b,indices:w},backend:n,attrs:{axis:1,batchDims:1}});kAe(n,b);var B=c.slice(0,-1);B.push(i),z=w,w=cSe({inputs:{x:w},attrs:{shape:B},backend:n}),kAe(n,z);var W=P;return P=cSe({inputs:{x:P},attrs:{shape:B},backend:n}),kAe(n,W),[P,w]}},SAe=we((function e(t,n,r,a,i,o){xe(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var NAe={kernelName:H6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=C(a.shape,4),p=l[0],h=l[1],d=l[2],f=l[3],m=C(null!=c?c:[h,d],2),v=m[0],g=m[1],y=new SAe(h,d,o,s,u,[p,v,g,f]);return n.runWebGLProgram(y,[a,i],"float32")}};var TAe={kernelName:q6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Tke(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=lIe(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var CAe={kernelName:K6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var h=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=vNe({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=cSe({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,h.push(g)}return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},EAe=we((function e(t,n){xe(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var _Ae={kernelName:X6,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=dne([c],s),p=a;null!=l&&(p=bSe({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=mne(1,s)[0]);var h=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(p.shape,c,o),d=l3([p.shape[c]]),f=cSe({inputs:{x:p},backend:n,attrs:{shape:[-1,d]}});u.push(f);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=function(e,t){var n,r=!1;for(e<=hae?(n=e,r=!0):n=C3(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=C3(e,n+1);return n}(c,o),p=new EAe({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),h=n.compileAndRun(p,[t,a],i);if(u.push(h),h.shape[1]===o)return h;var d=ZEe({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=gAe({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(f),e(h,r,f,i,o)}(f,"unsortedSegmentSum",i,t9(a.dtype),o),v=cSe({inputs:{x:m},backend:n,attrs:{shape:h}}),g=v;if(null!=l){u.push(v);var y=fne(l);g=bSe({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},AAe=0,RAe=[ISe,NSe,CSe,_Se,FSe,OSe,LSe,zSe,GSe,HSe,qSe,XSe,JSe,ZSe,eNe,rNe,aNe,sNe,uNe,cNe,hNe,yNe,bNe,xNe,kNe,CNe,ANe,DNe,qIe,LNe,HNe,ZNe,rTe,iTe,oTe,sTe,cTe,pTe,dTe,mTe,xTe,kTe,wTe,STe,CTe,ATe,RTe,DTe,OTe,LTe,PTe,BTe,VTe,GTe,jTe,KTe,JTe,$Te,rCe,iCe,uCe,lCe,dCe,mCe,vCe,yCe,kCe,ICe,NCe,HIe,TCe,VNe,ECe,ACe,FCe,YIe,MCe,LCe,zCe,BCe,VCe,GCe,jCe,KCe,JCe,ZCe,eEe,nEe,rEe,aEe,sEe,uEe,cEe,lEe,pEe,dEe,vEe,yEe,CEe,uSe,_Ee,REe,DEe,OEe,INe,zEe,WEe,VEe,jEe,KEe,ZIe,XEe,YEe,JEe,QEe,$Ee,NNe,kEe,t_e,r_e,i_e,lSe,u_e,l_e,d_e,m_e,y_e,x_e,w_e,S_e,C_e,__e,R_e,D_e,O_e,z_e,B_e,V_e,gNe,TEe,G_e,H_e,j_e,q_e,K_e,X_e,Y_e,J_e,$_e,eAe,rAe,aAe,iAe,sAe,uAe,cAe,lAe,SEe,ySe,hAe,fAe,mAe,yAe,IAe,NAe,xSe,TAe,CAe,_Ae,BEe];AAe<RAe.length;AAe++){s8(RAe[AAe])}var FAe,DAe=0,MAe=0,OAe=function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof n.current||null===n.current||4!==n.current.video.readyState){e.next=13;break}return a=n.current.video,i=n.current.video.videoWidth,o=n.current.video.videoHeight,n.current.video.width=i,n.current.video.height=o,r.current.width=i,r.current.height=o,e.next=10,t.estimateFaces(a);case 10:s=e.sent,r.current.getContext("2d"),F(s,0,a);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),LAe=function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"===typeof t.current||null===t.current||4!==t.current.video.readyState){e.next=9;break}return n=t.current.video,r={width:800,height:600},e.next=5,Q2(n,new R2).withFaceLandmarks().withFaceExpressions().withAgeAndGender();case 5:a=e.sent,console.log(a),i=Z2(a,r),R(i);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),zAe=function(e,t,n,r){if(0===DAe&&(console.log(MAe),OAe(e,t,n),6===++MAe)){var a=function(){var e=ae(D),t=ae(M),n=ae(O),r=ae(L),a=ae(z),i=ae(P),o=ae(B),s=ae(W),u=ae(V),c=ae(U),l=ae(G),p=(ae(H),ae(j),ae(q)),h=(ae(K),ae(X),ae(Y),ae(J),ae(Q)),d=(ae(Z),ae($),ae(ee),ae(te)),f=(ae(ne),20);return o>n*f/100&&s>e*f/100&&u>e*f/100&&c>e*f/100&&o-u<o*f/100&&s-c<c*f/100&&a>n*f/100&&i>n*f/100?{shape:"circle",color:A}:o>n*f/100&&s>e*f/100&&u>e*f/100&&c>e*f/100&&a>n*f/100&&i>n*f/100?{shape:"oval",color:A}:t-e<e*f/100&&t>r?{shape:"triangle",color:A}:t-e>e*f/100&&t<r&&a>n*f/100&&i>n*f/100?{shape:"heart",color:A}:(console.log("{ ".concat(a,"<").concat(n*f/100,"}")),Math.abs(e-n)<n*f/100&&a<n*f/100&&i<n*f/100&&o<e*f/100&&s<e*f/100?{shape:"square",color:A}:e>t&&e>r&&l-p<p*f/100&&h-d>p*f/100?{shape:"diamond",color:A}:e<n&&o<e*f/100&&s<e*f/100?{shape:"oblong",color:A}:void 0)}();FAe=a.shape,a.color,document.getElementById("decision").textContent="shape: ".concat(a.shape,", color: ").concat(a.color),console.log(a),console.log("ended 1"),DAe=1,MAe=0}if(1===DAe&&(console.log("progress flag 2 begins"),LAe(t),6===++MAe)){var i=function(){var e=ae(E),t=ae(_);return{age:e,gender:1==Math.round(t)?"male":"female"}}();i.age,i.gender,document.getElementById("genderAge").textContent="age: ".concat(i.age,", gender: ").concat(i.gender),console.log(i),console.log("ended 2"),DAe=2,MAe=0}if(2===DAe){DAe=3,document.getElementById("txt_recom").removeAttribute("hidden"),document.getElementById("webcam").setAttribute("hidden",""),document.getElementById("canvas").setAttribute("hidden","");var o=function(e,t,n,r){var a,i,o=["rectangle","square","oversized","round","browline","aviator","geometric","oval","cat-eye"],s=o.slice(),u=o.slice();switch(e){case"round":i=[2,3,4,5,6,7,8],(a=[3,5,7]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"oval":i=[4,5,6,7,8],(a=[]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"oblong":i=[0,1,3,6,7,8],(a=[6]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"square":i=[0,1,2,4,5,6],(a=[0,1,6]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"triangle":i=[0,1,2,3,4,5,6],(a=[1,2]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"heart":i=[0,1,2,3,4,6,7],(a=[0,2,4]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}));break;case"diamond":i=[0,1,2,3,4,5],(a=[1,5]).sort((function(e,t){return t-e})),i.sort((function(e,t){return t-e})),i.forEach((function(e){s.splice(e,1)})),a.forEach((function(e){u.splice(e,1)}))}return console.log(s),{rec:s,all:u}}(FAe),s=document.getElementById("cardContainer"),u=o.rec,c=o.all;Array.isArray(u)&&u.forEach((function(e){var t=document.createElement("div");t.classList.add("card"),t.classList.add("mb-md-4"),t.classList.add("mb-sm-2"),t.classList.add("mx-md-4"),t.classList.add("mx-sm-4"),t.classList.add("col-lg-3"),t.classList.add("col-md-4"),t.classList.add("col-sm-12"),t.innerHTML='\n       <div class="card-body">\n         <h5 class="card-title">'.concat(e,'</h5>\n         <h6 class="card-title" style="color: blue">Recommend</h6>\n         <p class="card-text">Some card content related to ').concat(e,"</p>\n       </div>\n     "),s.childElementCount<c.length&&s.appendChild(t)})),c&&c.forEach((function(e){var t=document.createElement("div");t.classList.add("card"),t.classList.add("mb-md-4"),t.classList.add("mb-sm-2"),t.classList.add("mx-md-4"),t.classList.add("mx-sm-4"),t.classList.add("col-lg-3"),t.classList.add("col-md-4"),t.classList.add("col-sm-12"),t.innerHTML='\n      <div class="card-body">\n        <h5 class="card-title">'.concat(e,'</h5>\n        <p class="card-text">Some card content related to ').concat(e,"</p>\n      </div>\n    ");for(var n=!1,a=0;a<s.length;a++){if(s[a].querySelector(".card-title").innerText===e){n=!0;break}}s.childElementCount<c.length&&!n&&s.appendChild(t),document.getElementById("info").textContent="Your face has been scanned successfully!\n You are in Shop #".concat(r,".")}))}},PAe=function(){function e(){xe(this,e)}return we(e,[{key:"decComplexRef",value:function(e){}},{key:"time",value:function(e){return BAe("time")}},{key:"read",value:function(e){return BAe("read")}},{key:"readSync",value:function(e){return BAe("readSync")}},{key:"numDataIds",value:function(){return BAe("numDataIds")}},{key:"disposeData",value:function(e){return BAe("disposeData")}},{key:"write",value:function(e,t,n){return BAe("write")}},{key:"move",value:function(e,t,n,r){return BAe("move")}},{key:"memory",value:function(){return BAe("memory")}},{key:"floatPrecision",value:function(){return BAe("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return BAe("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights;return BAe("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return BAe("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return BAe("stridedSlice")}},{key:"unstack",value:function(e,t){return BAe("unstack")}},{key:"reverse",value:function(e,t){return BAe("reverse")}},{key:"concat",value:function(e,t){return BAe("concat")}},{key:"neg",value:function(e){return BAe("neg")}},{key:"add",value:function(e,t){return BAe("add")}},{key:"addN",value:function(e){return BAe("addN")}},{key:"subtract",value:function(e,t){return BAe("subtract")}},{key:"multiply",value:function(e,t){return BAe("multiply")}},{key:"realDivide",value:function(e,t){return BAe("realDivide")}},{key:"floorDiv",value:function(e,t){return BAe("floorDiv")}},{key:"sum",value:function(e,t){return BAe("sum")}},{key:"prod",value:function(e,t){return BAe("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return BAe("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return BAe("argMin")}},{key:"argMax",value:function(e,t){return BAe("argMax")}},{key:"equal",value:function(e,t){return BAe("equal")}},{key:"notEqual",value:function(e,t){return BAe("notEqual")}},{key:"less",value:function(e,t){return BAe("less")}},{key:"lessEqual",value:function(e,t){return BAe("lessEqual")}},{key:"greater",value:function(e,t){return BAe("greater")}},{key:"greaterEqual",value:function(e,t){return BAe("greaterEqual")}},{key:"logicalNot",value:function(e){return BAe("logicalNot")}},{key:"logicalAnd",value:function(e,t){return BAe("logicalAnd")}},{key:"logicalOr",value:function(e,t){return BAe("logicalOr")}},{key:"where",value:function(e){return BAe("where")}},{key:"select",value:function(e,t,n){return BAe("select")}},{key:"topk",value:function(e,t,n){return BAe("topk")}},{key:"min",value:function(e,t){return BAe("min")}},{key:"minimum",value:function(e,t){return BAe("minimum")}},{key:"mod",value:function(e,t){return BAe("mod")}},{key:"max",value:function(e,t){return BAe("max")}},{key:"maximum",value:function(e,t){return BAe("maximum")}},{key:"all",value:function(e,t){return BAe("all")}},{key:"any",value:function(e,t){return BAe("any")}},{key:"squaredDifference",value:function(e,t){return BAe("squaredDifference")}},{key:"ceil",value:function(e){return BAe("ceil")}},{key:"floor",value:function(e){return BAe("floor")}},{key:"round",value:function(e){return BAe("round")}},{key:"sign",value:function(e){return BAe("sign")}},{key:"isNaN",value:function(e){return BAe("isNaN")}},{key:"isInf",value:function(e){return BAe("isInf")}},{key:"isFinite",value:function(e){return BAe("isFinite")}},{key:"pow",value:function(e,t){return BAe("pow")}},{key:"exp",value:function(e){return BAe("exp")}},{key:"expm1",value:function(e){return BAe("expm1")}},{key:"softmax",value:function(e,t){return BAe("softmax")}},{key:"log",value:function(e){return BAe("log")}},{key:"log1p",value:function(e){return BAe("log1p")}},{key:"sqrt",value:function(e){return BAe("sqrt")}},{key:"rsqrt",value:function(e){return BAe("rsqrt")}},{key:"square",value:function(e){return BAe("square")}},{key:"reciprocal",value:function(e){return BAe("reciprocal")}},{key:"relu",value:function(e){return BAe("relu")}},{key:"relu6",value:function(e){return BAe("relu6")}},{key:"prelu",value:function(e,t){return BAe("prelu")}},{key:"elu",value:function(e){return BAe("elu")}},{key:"eluDer",value:function(e,t){return BAe("eluDer")}},{key:"selu",value:function(e){return BAe("selu")}},{key:"int",value:function(e){return BAe("int")}},{key:"clip",value:function(e,t,n){return BAe("clip")}},{key:"abs",value:function(e){return BAe("abs")}},{key:"complexAbs",value:function(e){return BAe("complexAbs")}},{key:"sigmoid",value:function(e){return BAe("sigmoid")}},{key:"softplus",value:function(e){return BAe("softplus")}},{key:"sin",value:function(e){return BAe("sin")}},{key:"cos",value:function(e){return BAe("cos")}},{key:"tan",value:function(e){return BAe("tan")}},{key:"asin",value:function(e){return BAe("asin")}},{key:"acos",value:function(e){return BAe("acos")}},{key:"atan",value:function(e){return BAe("atan")}},{key:"atan2",value:function(e,t){return BAe("atan2")}},{key:"sinh",value:function(e){return BAe("sinh")}},{key:"cosh",value:function(e){return BAe("cosh")}},{key:"tanh",value:function(e){return BAe("tanh")}},{key:"asinh",value:function(e){return BAe("asinh")}},{key:"acosh",value:function(e){return BAe("acosh")}},{key:"atanh",value:function(e){return BAe("atanh")}},{key:"erf",value:function(e){return BAe("erf")}},{key:"step",value:function(e,t){return BAe("step")}},{key:"fusedConv2d",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return BAe("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return BAe("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return BAe("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return BAe("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return BAe("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return BAe("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return BAe("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return BAe("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return BAe("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return BAe("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return BAe("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return BAe("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return BAe("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return BAe("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return BAe("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return BAe("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return BAe("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return BAe("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return BAe("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return BAe("reshape")}},{key:"cast",value:function(e,t){return BAe("cast")}},{key:"tile",value:function(e,t){return BAe("tile")}},{key:"pad",value:function(e,t,n){return BAe("pad")}},{key:"transpose",value:function(e,t){return BAe("transpose")}},{key:"gather",value:function(e,t,n){return BAe("gather")}},{key:"gatherND",value:function(e,t){return BAe("gatherND")}},{key:"scatterND",value:function(e,t,n){return BAe("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return BAe("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return BAe("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r,a){return BAe("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return BAe("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r,a){return BAe("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return BAe("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return BAe("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return BAe("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return BAe("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return BAe("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return BAe("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return BAe("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return BAe("nonMaxSuppression")}},{key:"fft",value:function(e){return BAe("fft")}},{key:"ifft",value:function(e){return BAe("ifft")}},{key:"complex",value:function(e,t){return BAe("complex")}},{key:"real",value:function(e){return BAe("real")}},{key:"imag",value:function(e){return BAe("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return BAe("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return BAe("depthToSpace")}},{key:"split",value:function(e,t,n){return BAe("split")}},{key:"sparseToDense",value:function(e,t,n,r){return BAe("sparseToDense")}},{key:"diag",value:function(e){return BAe("diag")}},{key:"fill",value:function(e,t,n){return BAe("fill")}},{key:"onesLike",value:function(e){return BAe("onesLike")}},{key:"zerosLike",value:function(e){return BAe("zerosLike")}},{key:"linspace",value:function(e,t,n){return BAe("linspace")}},{key:"dispose",value:function(){return BAe("dispose")}}]),e}();function BAe(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function WAe(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function VAe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";WAe(jAe(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function UAe(e){WAe(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function GAe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||YAe(e)&&!n)for(var r=0;r<e.length;++r)GAe(e[r],t,n);else t.push(e);return t}function HAe(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function jAe(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function qAe(e){return e%1===0}function KAe(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function XAe(e,t){var n=t.length;return WAe((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),WAe(e.every((function(e){return qAe(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function YAe(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function JAe(e){return"string"===typeof e||e instanceof String}function QAe(e){return Array.isArray(e)?QAe(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":"number"===typeof e?"float32":JAe(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function ZAe(e){return!!(e&&e.constructor&&e.call&&e.apply)}function $Ae(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function eRe(e,t,n){var r=new Array;if(1===t.length)for(var a=t[0],i=0;i<a;i++)r[i]=n[e+i];else for(var o=t[0],s=t.slice(1),u=s.reduce((function(e,t){return e*t})),c=0;c<o;c++)r[c]=eRe(e+c*u,s,n);return r}function tRe(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return eRe(0,e,t)}function nRe(e,t){for(var n=rRe(e,t),r=0;r<n.length;r++)n[r]=1;return n}function rRe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function aRe(e){e.forEach((function(t){WAe(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function iRe(e){return e&&e.then&&"function"===typeof e.then}var oRe="tfjsflags",sRe=function(){function e(t){xe(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return we(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(iRe(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}(this.global.location.search);if(oRe in t)t[oRe].split(",").forEach((function(t){var n=C(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function uRe(){return lRe}var cRe,lRe=null;function pRe(){if(null==cRe){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}cRe=e}return cRe}function hRe(e,t){var n=function(){var e=pRe();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var dRe="Acos",fRe="Acosh",mRe="Add",vRe="AddN",gRe="ArgMax",yRe="ArgMin",bRe="Asin",xRe="Asinh",kRe="Atan",wRe="Atanh",IRe="Atan2",SRe="AvgPool",NRe="AvgPool3D",TRe="BatchMatMul",CRe="BatchToSpaceND",ERe="Cast",_Re="Ceil",ARe="ClipByValue",RRe="ComplexAbs",FRe="Concat",DRe="Conv2D",MRe="Conv2DBackpropInput",ORe="Conv3D",LRe="Cosh",zRe="Cumsum",PRe="DepthwiseConv2dNative",BRe="Dilation2D",WRe="RealDiv",VRe="ExpandDims",URe="Expm1",GRe="Fill",HRe="Floor",jRe="FloorDiv",qRe="FusedBatchNorm",KRe="GatherV2",XRe="GreaterEqual",YRe="Identity",JRe="IsFinite",QRe="IsInf",ZRe="IsNan",$Re="LeakyRelu",eFe="Log1p",tFe="Maximum",nFe="MaxPool",rFe="MaxPool3D",aFe="Mean",iFe="Minimum",oFe="MirrorPad",sFe="Multiply",uFe="OnesLike",cFe="OneHot",lFe="Pack",pFe="PadV2",hFe="Prelu",dFe="Range",fFe="Reciprocal",mFe="Relu",vFe="Reshape",gFe="ResizeNearestNeighbor",yFe="ResizeBilinear",bFe="Relu6",xFe="Reverse",kFe="Round",wFe="Rsqrt",IFe="Select",SFe="Selu",NFe="Slice",TFe="Sinh",CFe="Sign",EFe="Sigmoid",_Fe="Softplus",AFe="Sqrt",RFe="SpaceToBatchND",FFe="SplitV",DFe="Softmax",MFe="SquaredDifference",OFe="Tanh",LFe="Tile",zFe="Transpose",PFe="Unpack",BFe="UnsortedSegmentSum",WFe="ZerosLike",VFe="Step",UFe="FromPixels",GFe="_FusedMatMul",HFe="FusedConv2D",jFe="FusedDepthwiseConv2D",qFe=hRe("kernelRegistry",(function(){return new Map})),KFe=hRe("gradRegistry",(function(){return new Map}));function XFe(e,t){var n=ZFe(e,t);return qFe.get(n)}function YFe(e){return KFe.get(e)}function JFe(e){for(var t=qFe.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=C(i,2),s=o[0],u=o[1];C(s.split("_"),1)[0]===e&&n.push(u)}return n}function QFe(e){var t=e.kernelName;KFe.has(t)&&uRe().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),KFe.set(t,e)}function ZFe(e,t){return"".concat(t,"_").concat(e)}var $Fe=function(){function e(t,n){xe(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new eDe)}return we(e,[{key:"profileKernel",value:function(e,t,n){var r,a=this.backendTimer.time((function(){r=n()}));if(uRe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var i=function(){var t=r[o];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},o=0;o<r.length;o++)i();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var eDe=function(){function e(){xe(this,e)}return we(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?KAe("".concat(r,"ms"),9):r.error,s=KAe(e,25),u=t.rank,c=t.size,l=KAe(t.shape.toString(),14),p="";for(var h in a){var d=a[h];if(null!=d){var f=d.shape||t.shape,m=f.length;p+="".concat(h,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var tDe=20,nDe=3,rDe=7;function aDe(e,t,n,r){var a=$Ae(t),i=function(e,t,n,r){var a=HAe(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?uDe(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],iDe(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=sDe(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function iDe(e,t,n){return KAe(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(rDe))," + ")+"".concat(parseFloat(e[1].toFixed(rDe)),"j"):JAe(e)?"'".concat(e,"'"):"bool"===n?oDe(e):parseFloat(e.toFixed(rDe)).toString(),t)}function oDe(e){return 0===e?"false":"true"}function sDe(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[iDe(uDe(e)[0],0,n)]:"bool"===n?[oDe(e[0])]:[e[0].toString()];if(1===u){if(s>tDe){var c=nDe*o,l=Array.from(e.slice(0,c)),p=Array.from(e.slice((s-nDe)*o,s*o));return"complex64"===n&&(l=uDe(l),p=uDe(p)),["["+l.map((function(e,t){return iDe(e,a[t],n)})).join(", ")+", ..., "+p.map((function(e,t){return iDe(e,a[s-nDe+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?uDe(e):Array.from(e)).map((function(e,t){return iDe(e,a[t],n)})).join(", ")+"]"]}var h=t.slice(1),d=r.slice(1),f=r[0]*o,m=[];if(s>tDe){for(var v=0;v<nDe;v++){var g=v*f,y=g+f;m.push.apply(m,Ie(sDe(e.slice(g,y),h,n,d,a,!1)))}m.push("...");for(var b=s-nDe;b<s;b++){var x=b*f,k=x+f;m.push.apply(m,Ie(sDe(e.slice(x,k),h,n,d,a,b===s-1)))}}else for(var w=0;w<s;w++){var I=w*f,S=I+f;m.push.apply(m,Ie(sDe(e.slice(I,S),h,n,d,a,w===s-1)))}var N=2===u?",":"";m[0]="["+m[0]+N;for(var T=1;T<m.length-1;T++)m[T]=" "+m[T]+N;for(var C=",\n",E=2;E<u;E++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":C),m}function uDe(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function cDe(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=GAe(e)),uRe().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function lDe(){return uRe().platform.now()}function pDe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",uRe().platform.encode(e,t)}function hDe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",uRe().platform.decode(e,t)}var dDe=function(){function e(t,n,r){var a=this;if(xe(this,e),this.dtype=n,this.shape=t.slice(),this.size=HAe(t),null!=r){var i=r.length;WAe(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||function(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}(n,this.size),this.strides=$Ae(t)}return we(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),WAe(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return fDe().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),fDe=null,mDe=null;var vDe=function(){function e(t,n,r,a){xe(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=HAe(t),this.strides=$Ae(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return we(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",mDe.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return mDe.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",tRe(this.shape,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return tRe(this.shape,this.dataSync())}},{key:"data",value:function(){var e=S(w().mark((function e(){var t,n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=fDe().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return hDe(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataSync",value:function(){this.throwIfDisposed();var e=fDe().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return hDe(e)}))}catch(Ru){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,fDe().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(fDe().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return mDe.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),mDe.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return aDe(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),mDe.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),fDe().makeVariable(this,e,t,n)}}]),e}();Object.defineProperty(vDe,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var gDe,yDe,bDe,xDe,kDe,wDe=function(e){ye(n,e);var t=be(n);function n(e,r,a,i){var o;return xe(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return we(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!jAe(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));fDe().disposeTensor(this),this.dataId=e.dataId,fDe().incRef(this,null)}},{key:"dispose",value:function(){fDe().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(vDe);Object.defineProperty(wDe,Symbol.hasInstance,{value:function(e){return e instanceof vDe&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(gDe||(gDe={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(yDe||(yDe={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(bDe||(bDe={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(xDe||(xDe={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(kDe||(kDe={}));var IDe={float32:xDe,int32:yDe,bool:bDe,complex64:kDe};function SDe(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return IDe[e][t]}function NDe(e,t){if(e.dtype===t.dtype)return[e,t];var n=SDe(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function TDe(e){var t=[];return CDe(e,t,new Set),t}function CDe(e,t,n){if(null!=e)if(e instanceof vDe)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),CDe(o,t,n))}}}var EDe=function(){function e(){xe(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return we(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),_De=function(){function e(t){xe(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EDe}return we(e,[{key:"ready",value:function(){var e=S(w().mark((function e(){var t,n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new $Fe(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;JFe(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;JFe(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof PAe||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(aGe){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(aGe.stack||aGe.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(Mx){throw t(),Mx}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t="float32",n={x:e},r={dtype:t};return RDe.runKernelFunc((function(n){return n.cast(e,t)}),n,null,ERe,r)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var p,h=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var f,m,v=XFe(r,this.backendName);if(null!=v)p=function(){var e=u.backend.numDataIds();f=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(f)?f:[f];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var p=u.getTensorsForGradient(r,t,s);if(null==p){null==o&&(o=[]);var h=s.filter((function(e,t){return o[t]}));p=(i||[]).slice().concat(h)}c=u.saveTensorsForBackwardMode(p)}return s};else{if(null==e)throw new Error("Error running ".concat(r,": Neither modular kernel nor forward func passed"));var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};p=function(){var t=u.backend.numDataIds();f=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(f)?f:[f];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){u.ENV.getBool("DEBUG")||u.state.profiling?(m=u.profiler.profileKernel(r,t,(function(){return p()})),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(m),s=m.outputs):s=p()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:s.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(f)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=YFe(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(WAe(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&JAe(e[0])&&(a=e.map((function(e){return pDe(e)})));var i=r.write(a,t,n),o=new vDe(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new vDe(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new wDe(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*function(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof wDe||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):(t.backend.decComplexRef(e.dataId),this.state.tensorInfo.get(e.dataId).refCount--)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Ie(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=Se(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=YFe(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=rRe(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=TDe(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(WAe(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));WAe(i instanceof vDe,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,h=0;h<t.length;h++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&f[w.id]){var I={};for(var S in w.inputs){var N=w.inputs[S];r[N.id]&&(I[S]=N)}var T=Object.assign({},w);T.inputs=I,T.outputs=w.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=nRe(HAe(e),"float32");return RDe.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!jAe(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(i.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),FDe);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=Se(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(aGe){n.e(aGe)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return WAe(ZAe(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;WAe(r.every((function(e){return e instanceof vDe})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return WAe((i=e.apply(void 0,[].concat(r,[n]))).value instanceof vDe,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),WAe(ZAe(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];WAe(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),WAe(a.every((function(e){return e instanceof vDe})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lDe(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=lDe()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EDe,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function ADe(){var e=pRe();if(null==e._tfengine){var t=new sRe(e);e._tfengine=new _De(t)}return function(e){lRe=e}(e._tfengine.ENV),function(e){fDe=e}((function(){return e._tfengine})),e._tfengine}_De.nextTensorId=0,_De.nextVariableId=0;var RDe=ADe();function FDe(e,t){var n={a:e,b:t};return RDe.runKernel(mRe,n)}var DDe=uRe();function MDe(e,t){var n=e;if(YAe(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||YAe(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&uRe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&ODe(e,r,[]),r}function ODe(e,t,n){if(n=n||[],Array.isArray(e)||YAe(e)){WAe(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),WAe(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)ODe(e[a],r,n.concat(a))}else WAe(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function LDe(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function zDe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof vDe)return LDe(r,e.dtype,t,n),e;var a=QAe(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),LDe(r,a,t,n),null==e||!YAe(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=MDe(e,a);YAe(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?cDe(e,a):GAe(e,[],!0);return RDe.makeTensor(s,o,a)}function PDe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");return e.map((function(e,a){return zDe(e,"".concat(t,"[").concat(a,"]"),n,r)}))}DDe.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),DDe.registerFlag("IS_BROWSER",(function(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope})),DDe.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),DDe.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),DDe.registerFlag("PROD",(function(){return!1})),DDe.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return DDe.getBool("DEBUG")})),DDe.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),DDe.registerFlag("IS_TEST",(function(){return!1})),DDe.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0}));function BDe(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){RDe.startScope(n);try{var e=r.apply(void 0,arguments);return iRe(e)&&console.error("Cannot return a Promise inside of tidy."),RDe.endScope(e),e}catch(Mx){throw RDe.endScope(null),Mx}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var WDe=BDe({complex_:function(e,t){var n=zDe(e,"real","complex"),r=zDe(t,"imag","complex");VAe(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return RDe.runKernel("Complex",a)}});function VDe(e,t,n,r){if(null==r&&(r=QAe(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!YAe(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){aRe(t);var a=HAe(t),i=HAe(n);WAe(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==HAe(t.slice(o));WAe(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return YAe(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?cDe(e,r):GAe(e,[],!0),RDe.makeTensor(e,t,r)}function UDe(e,t,n){return VDe(e,t,MDe(e,n),n)}var GDe={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},HDe=4;function jDe(e,t){var n,r,a={},i=0,o=Se(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=HAe(l),h=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(d.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," ")+"which only supports weights of type float32 not ".concat(c,"."))}var f=GDe[d.dtype],m=e.slice(i,i+p*f),v="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){h=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];h[g]=y*d.scale+d.min}}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type float32.");void 0===n&&(n=ZDe()),h=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type int32.");h=new Int32Array(v.length);for(var b=0;b<v.length;b++){var x=v[b];h[b]=Math.round(x*d.scale+d.min)}}i+=p*f}else if("string"===c){var k=HAe(s.shape);h=[];for(var w=0;w<k;w++){var I=new Uint32Array(e.slice(i,i+HDe))[0];i+=HDe;var S=new Uint8Array(e.slice(i,i+I));h.push(S),i+=I}}else{var N=GDe[c],T=e.slice(i,i+p*N);if("float32"===c)h=new Float32Array(T);else if("int32"===c)h=new Int32Array(T);else if("bool"===c)h=new Uint8Array(T);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));h=new Float32Array(T);for(var C=new Float32Array(h.length/2),E=new Float32Array(h.length/2),_=0;_<C.length;_++)C[_]=h[2*_],E[_]=h[2*_+1];var A=UDe(C,l,"float32"),R=UDe(E,l,"float32");a[u]=WDe(A,R),A.dispose(),R.dispose()}i+=p*N}"complex64"!==c&&(a[u]=UDe(h,l,c))}}catch(aGe){o.e(aGe)}finally{o.f()}return a}var qDe="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function KDe(e){return qDe?Buffer.byteLength(e):new Blob([e]).size}function XDe(e){if(qDe)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function YDe(e){if(qDe){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function JDe(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function QDe(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:KDe(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:KDe(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function ZDe(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var $De=function(){function e(){xe(this,e),this.saveRouters=[],this.loadRouters=[]}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),eMe="tensorflowjs",tMe="models_store",nMe="model_info_store";function rMe(){if(!uRe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function aMe(e){var t=e.result;t.createObjectStore(tMe,{keyPath:"modelPath"}),t.createObjectStore(nMe,{keyPath:"modelPath"})}var iMe=function(){function e(t){if(xe(this,e),this.indexedDB=rMe(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(eMe,1);a.onupgradeneeded=function(){return aMe(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(tMe,"readonly"),s=o.objectStore(tMe).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=QDe(t),l=i.transaction(nMe,"readwrite"),p=l.objectStore(nMe),h=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var a=(u=i.transaction(tMe,"readwrite")).objectStore(tMe).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(nMe)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},h.onerror=function(e){return i.close(),r(h.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();iMe.URL_SCHEME="indexeddb://";var oMe=function(e){return uRe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(iMe.URL_SCHEME)?(t=e.slice(iMe.URL_SCHEME.length),new iMe(t)):null;var t};$De.registerSaveRouter(oMe),$De.registerLoadRouter(oMe);var sMe=function(){function e(){xe(this,e),this.indexedDB=rMe()}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(eMe,1);r.onupgradeneeded=function(){return aMe(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(nMe,"readonly"),i=a.objectStore(nMe).getAll();i.onsuccess=function(){var t,n={},r=Se(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(aGe){r.e(aGe)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(iMe.URL_SCHEME)?r.slice(iMe.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(eMe,1);a.onupgradeneeded=function(){return aMe(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(nMe,"readwrite"),s=o.objectStore(nMe),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(tMe,"readwrite")).objectStore(tMe).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),uMe="/",cMe="tensorflowjs_models",lMe="info",pMe="model_topology",hMe="weight_specs",dMe="weight_data",fMe="model_metadata";function mMe(e){return{info:[cMe,e,lMe].join(uMe),topology:[cMe,e,pMe].join(uMe),weightSpecs:[cMe,e,hMe].join(uMe),weightData:[cMe,e,dMe].join(uMe),modelMetadata:[cMe,e,fMe].join(uMe)}}function vMe(e){var t=e.split(uMe);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(uMe)}var gMe=function(){function e(t){if(xe(this,e),!uRe().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=mMe(this.modelPath)}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=QDe(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,XDe(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 20:throw e.prev=20,e.t0=e.catch(7),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 28:case"end":return e.stop()}}),e,this,[[7,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=YDe(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();gMe.URL_SCHEME="localstorage://";var yMe=function(e){return uRe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(gMe.URL_SCHEME)?(t=e.slice(gMe.URL_SCHEME.length),new gMe(t)):null;var t};$De.registerSaveRouter(yMe),$De.registerLoadRouter(yMe);var bMe=function(){function e(){xe(this,e),WAe(uRe().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),WAe("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return we(e,[{key:"listModels",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=cMe+uMe,r=uMe+lMe,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=vMe(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=S(w().mark((function e(t){var n,r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(gMe.URL_SCHEME)?a.slice(gMe.URL_SCHEME.length):a,n=mMe(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),e.abrupt("return",r);case 10:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),xMe="://",kMe=function(){function e(){xe(this,e),this.managers={}}return we(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){WAe(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(xMe)&&(t=t.slice(0,t.indexOf(xMe))),WAe(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();WAe(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();var wMe=function(){function e(){xe(this,e)}return we(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(uRe().get("IS_BROWSER")){uRe().setPlatform("browser",new wMe);try{kMe.registerManager(gMe.URL_SCHEME,new bMe)}catch(aGe){}try{kMe.registerManager(iMe.URL_SCHEME,new sMe)}catch(aGe){}}var IMe,SMe=function(){return n(410)};var NMe=function(){function e(){xe(this,e),this.util=n(628),this.textEncoder=new this.util.TextEncoder}return we(e,[{key:"fetch",value:function(e,t){return null!=uRe().global.fetch?uRe().global.fetch(e,t):(null==IMe&&(IMe=SMe()),IMe(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function TMe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",aRe(e),new dDe(e,t,n)}uRe().get("IS_NODE")&&uRe().setPlatform("node",new NMe);var CMe=BDe({cast_:function(e,t){var n=zDe(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return RDe.runKernel(ERe,r,a)}});var EMe=BDe({clone_:function(e){var t={x:zDe(e,"x","clone","string_or_numeric")};return RDe.runKernel(YRe,t)}});ADe();var _Me={buffer:TMe,cast:CMe,clone:EMe,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};!function(e){mDe=e}(_Me);function AMe(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var RMe=function(){function e(t){if(xe(this,e),!uRe().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,e.next=18,AMe((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 18:if(null==t.weightData){e.next=24;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=24,AMe((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 24:return e.abrupt("return",{modelArtifactsInfo:QDe(t)});case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();RMe.URL_SCHEME="downloads://";function FMe(e,t,n,r){!function(e){WAe(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){WAe(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),WAe(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),WAe(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function DMe(e,t){return MMe.apply(this,arguments)}function MMe(){return(MMe=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?uRe().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,FMe(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,FMe(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return p=e.t1,e.abrupt("return",p);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}$De.registerSaveRouter((function(e){return uRe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(RMe.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new RMe(e)}(e.slice(RMe.URL_SCHEME.length)):null}));var OMe=function(){function e(t,n){if(xe(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(WAe("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=uRe().platform.fetch,WAe(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&WAe(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return we(e,[{key:"save",value:function(){var e=S(w().mark((function e(t){var n,r,a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=13,this.fetch(this.path,n);case 13:if(!(i=e.sent).ok){e.next=18;break}return e.abrupt("return",{modelArtifactsInfo:QDe(t),responses:[i]});case 18:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c,l,p,h,d,f,m,v;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.signature,l=n.userDefinedMetadata,null!=a||null!=i){e.next=25;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 25:if(null==i){e.next=32;break}return e.next=28,this.loadWeights(i);case 28:d=e.sent,f=C(d,2),p=f[0],h=f[1];case 32:return m={modelTopology:a,weightSpecs:p,weightData:h,generatedBy:o,convertedBy:s,format:u},null!=c&&(m.signature=c),null!=l&&(m.userDefinedMetadata=l),(v=n.modelInitializer)&&(m.modelInitializer=v),e.abrupt("return",m);case 38:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=LMe(n),a=C(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=Se(t);try{for(c.s();!(l=c.n()).done;)p=l.value,u.push.apply(u,Ie(p.weights))}catch(aGe){c.e(aGe)}finally{c.f()}h=[],d=[],f=Se(t);try{for(f.s();!(m=f.n()).done;){v=m.value,g=Se(v.paths);try{for(g.s();!(y=g.n()).done;)b=y.value,null!=this.weightUrlConverter?d.push(this.weightUrlConverter(b)):h.push(s+b+o)}catch(aGe){g.e(aGe)}finally{g.f()}}}catch(aGe){f.e(aGe)}finally{f.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=h.push,e.t1=h,e.t2=Ie,e.next=16,Promise.all(d);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,DMe(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return x=e.sent,e.abrupt("return",[u,JDe(x)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function LMe(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function zMe(e){return null!=e.match(OMe.URL_SCHEME_REGEX)}OMe.URL_SCHEME_REGEX=/^https?:\/\//;var PMe=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return zMe(e)})):zMe(e))?BMe(e,t):null};function BMe(e,t){return new OMe(e,t)}function WMe(e,t){return BMe(e,t)}$De.registerSaveRouter(PMe),$De.registerLoadRouter(PMe);var VMe;var UMe=BDe({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}if(a){if(a&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=XFe(UFe,RDe.backendName)){var u={pixels:e},c={numChannels:t};return RDe.runKernel(UFe,u,c)}var l,p,h=C(a?[e.videoWidth,e.videoHeight]:[e.width,e.height],2),d=h[0],f=h[1];if(o?l=e.getContext("2d").getImageData(0,0,d,f).data:r||n?l=e.data:(i||a||s)&&(null==VMe&&(VMe=document.createElement("canvas").getContext("2d")),VMe.canvas.width=d,VMe.canvas.height=f,VMe.drawImage(e,0,0,d,f),l=VMe.getImageData(0,0,d,f).data),4===t)p=new Int32Array(l);else{var m=d*f;p=new Int32Array(m*t);for(var v=0;v<m;v++)for(var g=0;g<t;++g)p[v*t+g]=l[4*v+g]}return function(e,t,n){if(UAe(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=MDe(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return VDe(e,t,r,n)}(p,[f,d,t],"int32")}});var GMe=BDe({add_:function(e,t){var n=zDe(e,"a","add"),r=zDe(t,"b","add"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel(mRe,i)}});var HMe=BDe({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;WAe(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=PDe(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return EMe(n[0]);var r=n,a={axis:t};return RDe.runKernel(FRe,r,a)}});var jMe=BDe({concat2d_:function(e,t){return HMe(e,t)}});var qMe=BDe({floorDiv_:function(e,t){var n=zDe(e,"a","floorDiv"),r=zDe(t,"b","floorDiv"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel(jRe,i)}});var KMe=BDe({div_:function(e,t){var n=zDe(e,"a","div"),r=zDe(t,"b","div"),a=C(NDe(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return qMe(n,r);var i={a:n,b:r};return RDe.runKernel(WRe,i,{})}});var XMe=BDe({mul_:function(e,t){var n=zDe(e,"a","mul"),r=zDe(t,"b","mul"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel(sFe,i)}});var YMe=BDe({reshape_:function(e,t){var n={x:zDe(e,"x","reshape","string_or_numeric")},r={shape:t};return RDe.runKernel(vFe,n,r)}});function JMe(e,t){if((YAe(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&YAe(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return VDe(e,[],[],t)}var QMe=BDe({sigmoid_:function(e){var t={x:zDe(e,"x","sigmoid")};return RDe.runKernel(EFe,t)}});var ZMe=BDe({slice_:function(e,t,n){var r=zDe(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return RDe.runKernel(NFe,a,i)}});var $Me=BDe({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=PDe(e,"tensors","stack","string_or_numeric");WAe(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&WAe(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return RDe.runKernel(lFe,r,a)}});var eOe=BDe({sub_:function(e,t){var n=zDe(e,"a","sub"),r=zDe(t,"b","sub"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel("Sub",i)}});function tOe(e,t){UAe(e);var n=MDe(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return VDe(e,null,n,t)}function nOe(e,t,n){if(UAe(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=MDe(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return VDe(e,t,r,n)}var rOe=BDe({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=zDe(e,"x","unstack","string_or_numeric");WAe(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return RDe.runKernel(PFe,r,a)}});var aOe=BDe({imag_:function(e){var t={input:zDe(e,"input","imag")};return RDe.runKernel("Imag",t)}});var iOe=BDe({real_:function(e){var t={input:zDe(e,"input","real")};return RDe.runKernel("Real",t)}});var oOe=BDe({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:zDe(e,"x","split")},a={numOrSizeSplits:t,axis:n};return RDe.runKernel(FFe,r,a)}});function sOe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=sOe(e,"float32"),r=sOe(e,"float32");return WDe(n,r)}var a=rRe(HAe(e),t);return RDe.makeTensor(a,e,t)}var uOe=BDe({zerosLike_:function(e){var t={x:zDe(e,"x","zerosLike")};return RDe.runKernel(WFe,t)}});var cOe=BDe({fft_:function(e){WAe("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return RDe.runKernel("FFT",t)}});var lOe=BDe({rfft_:function(e,t){WAe("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=ZMe(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=HMe([e,sOe(s)],e.shape.length-1),r=t}else n=e;var u=uOe(n),c=YMe(WDe(n,u),[a,r]),l=cOe(c),p=Math.floor(r/2)+1,h=iOe(l),d=aOe(l),f=oOe(h,[p,r-p],h.shape.length-1),m=oOe(d,[p,r-p],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,YMe(WDe(f[0],m[0]),v)}});var pOe=BDe({ifft_:function(e){WAe("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return RDe.runKernel("IFFT",t)}});var hOe=BDe({reverse_:function(e,t){var n={x:zDe(e,"x","reverse")},r={dims:t};return RDe.runKernel(xFe,n,r)}});var dOe=BDe({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=YMe(e,[r,n]);t=pOe(a)}else{var i=[r,2*(n-1)],o=YMe(iOe(e),[r,n]),s=YMe(aOe(e),[r,n]),u=hOe(ZMe(o,[0,1],[r,n-2]),1),c=XMe(hOe(ZMe(s,[0,1],[r,n-2]),1),JMe(-1)),l=HMe([o,u],1),p=HMe([s,c],1),h=YMe(WDe(l,p),[i[0],i[1]]);t=pOe(h)}if(t=iOe(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=YMe(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}});function fOe(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return tOe(a,"float32")}BDe({hammingWindow_:function(e){return fOe(e,.54,.46)}});var mOe=BDe({hannWindow_:function(e){return fOe(e,.5,.5)}});function vOe(e,t,n){var r={shape:e,value:t,dtype:n};return RDe.runKernel(GRe,{},r)}var gOe=BDe({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(ZMe(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=HMe([ZMe(e,i,t-s),vOe([s],a)]);o.push(u),i+=n}return 0===o.length?nOe([],[0,t]):YMe(HMe(o),[o.length,t])}});BDe({stft_:function(e,t,n,r){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mOe;null==r&&(a=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var o=gOe(e,t,n),s=XMe(o,i(t)),u=[],c=0;c<o.shape[0];c++)u.push(lOe(ZMe(s,[c,0],[1,t]),r));return HMe(u)}});var yOe=BDe({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=zDe(e,"image","cropAndResize"),s=zDe(t,"boxes","cropAndResize","float32"),u=zDe(n,"boxInd","cropAndResize","int32"),c=s.shape[0];WAe(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),WAe(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),WAe(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),WAe(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),WAe(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),WAe("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return RDe.runKernel("CropAndResize",l,p)}});var bOe=BDe({flipLeftRight_:function(e){var t=zDe(e,"image","flipLeftRight","float32");WAe(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return RDe.runKernel("FlipLeftRight",n,{})}});var xOe=BDe({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=zDe(e,"image","rotateWithOffset","float32");WAe(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return RDe.runKernel("RotateWithOffset",i,o)}});function kOe(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),WAe(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),WAe(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),WAe(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),WAe(1===t.rank,(function(){return"scores must be a 1D tensor"})),WAe(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),WAe(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var wOe=BDe({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=zDe(e,"boxes","nonMaxSuppression"),o=zDe(t,"scores","nonMaxSuppression"),s=kOe(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return RDe.runKernel("NonMaxSuppressionV3",{boxes:i,scores:o},u)}});function IOe(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||SOe)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function SOe(e,t){return e>t?1:e<t?-1:0}function NOe(e,t,n,r,a){return EOe(e,t,n,r,a,0)}function TOe(e,t,n,r,a,i){return EOe(e,t,n,r,a,0,!1,i,!0)}function COe(e,t,n,r,a,i){return EOe(e,t,n,r,a,i,!0)}function EOe(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(ROe);for(var p=i>0?-.5/i:0,h=[],d=[];h.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,g=f.suppressBeginIndex;if(m<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var x=_Oe(e,v,h[b]);if(x>=r){y=!0;break}if(f.score=f.score*AOe(r,p,x),f.score<=a)break}f.suppressBeginIndex=h.length,y||(f.score===m?(h.push(v),d.push(f.score)):f.score>a&&IOe(c,f,ROe))}var k=h.length,w=n-k;s&&w>0&&(h.push.apply(h,Ie(new Array(w).fill(0))),d.push.apply(d,Ie(new Array(w).fill(0))));var I={selectedIndices:h};return o&&(I.selectedScores=d),u&&(I.validOutputs=k),I}function _Oe(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(p-c)*(h-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function AOe(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function ROe(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function FOe(){return FOe=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=zDe(t,"boxes","nonMaxSuppressionAsync"),s=zDe(n,"scores","nonMaxSuppressionAsync"),u=kOe(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=10,Promise.all([o.data(),s.data()]);case 10:return c=e.sent,l=c[0],p=c[1],h=NOe(l,p,r,a,i),d=h.selectedIndices,o!==t&&o.dispose(),s!==n&&s.dispose(),e.abrupt("return",tOe(d,"int32"));case 17:case"end":return e.stop()}}),e)}))),FOe.apply(this,arguments)}var DOe=function(e,t,n){return FOe.apply(this,arguments)};var MOe=BDe({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=zDe(e,"boxes","nonMaxSuppression"),s=zDe(t,"scores","nonMaxSuppression"),u=kOe(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=RDe.runKernel("NonMaxSuppressionV5",c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function OOe(){return OOe=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=v.length>5&&void 0!==v[5]?v[5]:0,s=zDe(t,"boxes","nonMaxSuppressionAsync"),u=zDe(n,"scores","nonMaxSuppressionAsync"),c=kOe(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=12,Promise.all([s.data(),u.data()]);case 12:return l=e.sent,p=l[0],h=l[1],d=COe(p,h,r,a,i,o),f=d.selectedIndices,m=d.selectedScores,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:tOe(f,"int32"),selectedScores:tOe(m)});case 19:case"end":return e.stop()}}),e)}))),OOe.apply(this,arguments)}var LOe=function(e,t,n){return OOe.apply(this,arguments)};var zOe=BDe({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=zDe(e,"boxes","nonMaxSuppression"),s=zDe(t,"scores","nonMaxSuppression"),u=kOe(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},p=RDe.runKernel("NonMaxSuppressionV4",c,l);return{selectedIndices:p[0],validOutputs:p[1]}}});function POe(){return POe=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],s=zDe(t,"boxes","nonMaxSuppressionAsync"),u=zDe(n,"scores","nonMaxSuppressionAsync"),c=kOe(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,h=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,f=C(d,2),m=f[0],v=f[1],g=TOe(m,v,l,p,h,o),y=g.selectedIndices,b=g.validOutputs,s!==t&&s.dispose(),u!==n&&u.dispose(),e.abrupt("return",{selectedIndices:tOe(y,"int32"),validOutputs:JMe(b,"int32")});case 19:case"end":return e.stop()}}),e)}))),POe.apply(this,arguments)}var BOe=function(e,t,n){return POe.apply(this,arguments)};var WOe=BDe({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=zDe(e,"images","resizeBilinear");WAe(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),WAe(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),WAe(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=YMe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=RDe.runKernel(yFe,s,u);return o?YMe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var VOe=BDe({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=zDe(e,"images","resizeNearestNeighbor");WAe(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),WAe(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),WAe("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),WAe(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=YMe(a,[1,a.shape[0],a.shape[1],a.shape[2]])),C(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=RDe.runKernel(gFe,s,u);return o?YMe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});function UOe(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function GOe(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}var HOe=BDe({greaterEqual_:function(e,t){var n=zDe(e,"a","greaterEqual"),r=zDe(t,"b","greaterEqual"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel(XRe,i)}});var jOe=BDe({lessEqual_:function(e,t){var n=zDe(e,"a","lessEqual"),r=zDe(t,"b","lessEqual"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel("LessEqual",i)}});var qOe=BDe({logicalAnd_:function(e,t){var n=zDe(e,"a","logicalAnd","bool"),r=zDe(t,"b","logicalAnd","bool");GOe(n.shape,r.shape);var a={a:n,b:r};return RDe.runKernel("LogicalAnd",a)}});function KOe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return RDe.runKernel(dFe,{},a)}var XOe=BDe({broadcastTo_:function(e,t){var n=zDe(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=YMe(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return EMe(n);var c={x:n},l={reps:o};return RDe.runKernel(LFe,c,l)}});var YOe=BDe({where_:function(e,t,n){var r=zDe(t,"a","where"),a=zDe(n,"b","where"),i=zDe(e,"condition","where","bool"),o=GOe(r.shape,a.shape),s=XOe(r,o),u=XOe(a,o);1===i.rank&&WAe(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&VAe(i.shape,u.shape,"Error in where: ");var c={condition:i,t:s,e:u};return RDe.runKernel(IFe,c)}});BDe({bandPart_:function(e,t,n){WAe(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),WAe(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=zDe(e,"a","bandPart");WAe(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=C(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=YMe(KOe(0,o,1,"int32"),[-1,1]),c=KOe(0,s,1,"int32"),l=eOe(u,c),p=qOe(jOe(l,JMe(+t,"int32")),HOe(l,JMe(-n,"int32"))),h=sOe([o,s],r.dtype);return YMe($Me(rOe(YMe(r,[-1,o,s])).map((function(e){return YOe(p,e,h)}))),a)}});var JOe=BDe({abs_:function(e){var t=zDe(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return RDe.runKernel(RRe,n)}var r={x:t};return RDe.runKernel("Abs",r)}});function QOe(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ZOe(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function $Oe(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}var eLe=BDe({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:zDe(e,"x","max")},a={reductionIndices:t,keepDims:n};return RDe.runKernel("Max",r,a)}});var tLe=BDe({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:zDe(e,"x","min")},a={axis:t,keepDims:n};return RDe.runKernel("Min",r,a)}});var nLe=BDe({pow_:function(e,t){var n=zDe(e,"base","pow"),r=zDe(t,"exp","pow"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel("Pow",i)}});var rLe=BDe({sqrt_:function(e){var t={x:zDe(e,"x","sqrt")};return RDe.runKernel(AFe,t)}});var aLe=BDe({square_:function(e){var t=zDe(e,"x","square");return RDe.runKernel("Square",{x:t},{})}});var iLe=BDe({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=zDe(e,"x","sum");"bool"===r.dtype&&(r=CMe(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return RDe.runKernel("Sum",a,i)}});function oLe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return JOe(e);if(1!==e.rank&&null===n)return oLe(YMe(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return iLe(JOe(e),n);if(t===1/0)return eLe(JOe(e),n);if(t===-1/0)return tLe(JOe(e),n);if("euclidean"===t||2===t)return rLe(iLe(nLe(JOe(e),JMe(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return eLe(iLe(JOe(e),n[0]),n[1]-1);if(t===1/0)return eLe(iLe(JOe(e),n[1]),n[0]);if(t===-1/0)return tLe(iLe(JOe(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return rLe(iLe(aLe(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var sLe=BDe({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=oLe(e=zDe(e,"x","norm"),t,n),i=a.shape;if(r){var o=XAe(n,e.shape);i=ZOe(a.shape,o)}return YMe(a,i)}});var uLe=BDe({squeeze_:function(e,t){var n=zDe(e,"x","squeeze");return YMe(n,function(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:XAe(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}(n.shape,t).newShape)}});BDe({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,WAe(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){WAe(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=oOe(e,e.shape[0],0).map((function(e){return uLe(e,[0])}));WAe(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(RDe.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=XMe(iLe(XMe(i[n],t)),i[n]);t=eOe(t,r)}return KMe(t,sLe(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?$Me(i,0):i}});function cLe(e){uRe().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lLe(e,t){return RDe.tidy(e,t)}function pLe(e){return RDe.keep(e)}!function(e){e}(cLe);var hLe=BDe({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=zDe(e,"x","expandDims","string_or_numeric");WAe(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return RDe.runKernel(VRe,r,a)}});var dLe=BDe({tile_:function(e,t){var n=zDe(e,"x","tile","string_or_numeric");WAe(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return RDe.runKernel(LFe,r,a)}});var fLe=BDe({eye_:function(e,t,n){null==t&&(t=e);for(var r=TMe([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=YMe(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return dLe(hLe(o,0),[n[0],1,1]);if(2===n.length)return dLe(hLe(hLe(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return dLe(hLe(hLe(hLe(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var mLe=BDe({greater_:function(e,t){var n=zDe(e,"a","greater"),r=zDe(t,"b","greater"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel("Greater",i)}});var vLe=BDe({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=zDe(e,"a","matMul"),i=zDe(t,"b","matMul"),o=C(NDe(a,i),2),s={a:a=o[0],b:i=o[1]},u={transposeA:n,transposeB:r};return RDe.runKernel(TRe,s,u)}});var gLe=BDe({neg_:function(e){var t={x:zDe(e,"x","neg")};return RDe.runKernel("Neg",t)}});var yLe=BDe({transpose_:function(e,t){var n=zDe(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),WAe(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){WAe(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1)return n.clone();var r={x:n},a={perm:t};return RDe.runKernel(zFe,r,a)}});function bLe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return RDe.tidy((function(){WAe(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=fLe(n),i=EMe(e),o=nOe([[1]],[1,1]),s=EMe(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=RDe.tidy((function(){var t=ZMe(i,[e,e],[n-e,1]),u=sLe(t),c=ZMe(i,[e,e],[1,1]),l=YOe(mLe(c,0),nOe([[-1]]),nOe([[1]])),p=eOe(c,XMe(l,u)),h=KMe(t,p);s=1===h.shape[0]?EMe(o):HMe([o,ZMe(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);var d=gLe(KMe(vLe(l,p),u)),f=ZMe(i,[e,0],[n-e,r]),m=XMe(d,s),v=yLe(s);if(0===e)i=eOe(f,vLe(m,vLe(v,f)));else{var g=eOe(f,vLe(m,vLe(v,f)));i=HMe([ZMe(i,[0,0],[e,r]),g],0)}var y=yLe(m),b=ZMe(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=eOe(b,vLe(vLe(b,s),y));else{var x=eOe(b,vLe(vLe(b,s),y));a=HMe([ZMe(a,[0,0],[n,e]),x],1)}return[s,i,a]})),p=C(l,3);s=p[0],i=p[1],a=p[2],TDe([t,u,c]).forEach((function(e){return e.dispose()}))},l=0;l<u;++l)c(l);return!t&&n>r&&(a=ZMe(a,[0,0],[n,r]),i=ZMe(i,[0,0],[r,r])),[a,i]}))}var xLe;BDe({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(WAe(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return bLe(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=rOe(YMe(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=C(bLe(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[YMe($Me(a,0),e.shape),YMe($Me(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xLe||(xLe={}));var kLe=BDe({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:zDe(e,"x","mean")},a={axis:t,keepDims:n};return RDe.runKernel(aFe,r,a)}});var wLe=BDe({notEqual_:function(e,t){var n=zDe(e,"a","notEqual"),r=zDe(t,"b","notEqual"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel("NotEqual",i)}});function ILe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=ILe(e,"float32"),r=sOe(e,"float32");return WDe(n,r)}var a=nRe(HAe(e),t);return RDe.makeTensor(a,e,t)}var SLe=BDe({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xLe.SUM_BY_NONZERO_WEIGHTS,r=zDe(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=zDe(t,"weights","computeWeightedLoss"));var i=null==a?r:XMe(r,a);if(n===xLe.NONE)return i;if(n===xLe.SUM)return iLe(i);if(n===xLe.MEAN){if(null==a)return kLe(i);var o=r.size/a.size,s=KMe(iLe(i),iLe(a));return o>1?KMe(s,JMe(o)):s}if(n===xLe.SUM_BY_NONZERO_WEIGHTS){if(null==a)return KMe(iLe(i),JMe(r.size));var u=XMe(a,ILe(r.shape)),c=CMe(iLe(wLe(u,JMe(0))),"float32");return KMe(iLe(i),c)}throw Error("Unknown reduction: ".concat(n))}});BDe({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xLe.SUM_BY_NONZERO_WEIGHTS,a=zDe(e,"labels","absoluteDifference"),i=zDe(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=zDe(n,"weights","absoluteDifference")),VAe(a.shape,i.shape,"Error in absoluteDifference: ");var s=JOe(eOe(a,i));return SLe(s,o,r)}});BDe({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xLe.SUM_BY_NONZERO_WEIGHTS,i=zDe(e,"labels","cosineDistance"),o=zDe(t,"predictions","cosineDistance"),s=null;null!=r&&(s=zDe(r,"weights","cosineDistance")),VAe(i.shape,o.shape,"Error in cosineDistance: ");var u=JMe(1),c=eOe(u,iLe(XMe(i,o),n,!0));return SLe(c,s,a)}});var NLe=BDe({relu_:function(e){var t={x:zDe(e,"x","relu")};return RDe.runKernel(mFe,t)}});BDe({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xLe.SUM_BY_NONZERO_WEIGHTS,a=zDe(e,"labels","hingeLoss"),i=zDe(t,"predictions","hingeLoss"),o=null;null!=n&&(o=zDe(n,"weights","hingeLoss")),VAe(a.shape,i.shape,"Error in hingeLoss: ");var s=JMe(1);a=eOe(XMe(JMe(2),a),s);var u=NLe(eOe(s,XMe(a,i)));return SLe(u,o,r)}});var TLe=BDe({minimum_:function(e,t){var n=zDe(e,"a","minimum"),r=zDe(t,"b","minimum"),a=C(NDe(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=CMe(n,"int32"),r=CMe(r,"int32")),GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel(iFe,i)}});BDe({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xLe.SUM_BY_NONZERO_WEIGHTS,i=zDe(e,"labels","huberLoss"),o=zDe(t,"predictions","huberLoss"),s=null;null!=n&&(s=zDe(n,"weights","huberLoss")),VAe(i.shape,o.shape,"Error in huberLoss: ");var u=JMe(r),c=JOe(eOe(o,i)),l=TLe(c,u),p=eOe(c,l),h=GMe(XMe(JMe(.5),aLe(l)),XMe(u,p));return SLe(h,s,a)}});var CLe=BDe({log_:function(e){var t={x:zDe(e,"x","log")};return RDe.runKernel("Log",t)}});BDe({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xLe.SUM_BY_NONZERO_WEIGHTS,i=zDe(e,"labels","logLoss"),o=zDe(t,"predictions","logLoss"),s=null;null!=n&&(s=zDe(n,"weights","logLoss")),VAe(i.shape,o.shape,"Error in logLoss: ");var u=JMe(1),c=JMe(r),l=gLe(XMe(i,CLe(GMe(o,c)))),p=XMe(eOe(u,i),CLe(GMe(eOe(u,o),c))),h=eOe(l,p);return SLe(h,s,a)}});var ELe=BDe({squaredDifference_:function(e,t){var n=zDe(e,"a","squaredDifference"),r=zDe(t,"b","squaredDifference"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel(MFe,i,{})}});BDe({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xLe.SUM_BY_NONZERO_WEIGHTS,a=zDe(e,"labels","meanSquaredError"),i=zDe(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=zDe(n,"weights","meanSquaredError")),VAe(a.shape,i.shape,"Error in meanSquaredError: ");var s=ELe(a,i);return SLe(s,o,r)}});var _Le=BDe({exp_:function(e){var t={x:zDe(e,"x","exp")};return RDe.runKernel("Exp",t)}});var ALe=BDe({log1p_:function(e){var t={x:zDe(e,"x","log1p")};return RDe.runKernel(eFe,t)}});BDe({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xLe.SUM_BY_NONZERO_WEIGHTS,i=zDe(e,"multiClassLabels","sigmoidCrossEntropy"),o=zDe(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=zDe(n,"weights","sigmoidCrossEntropy")),VAe(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=JMe(r),c=JMe(1),l=JMe(.5);i=GMe(XMe(i,eOe(c,u)),XMe(l,u))}var p=function(e,t){var n=zDe(e,"labels","sigmoidCrossEntropyWithLogits"),r=zDe(t,"logits","sigmoidCrossEntropyWithLogits");VAe(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=NLe(r),i=XMe(r,n),o=ALe(_Le(gLe(JOe(r))));return GMe(eOe(a,i),o)}(i,o);return SLe(p,s,a)}});function RLe(e){return RDe.customGrad(e)}var FLe=BDe({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=zDe(e,"x","logSumExp"),a=XAe(t,r.shape),i=eLe(r,a,!0),o=eOe(r,i),s=_Le(o),u=iLe(s,a),c=CLe(u),l=GMe(YMe(i,c.shape),c);if(n){var p=ZOe(l.shape,a);return YMe(l,p)}return l}});BDe({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xLe.SUM_BY_NONZERO_WEIGHTS,i=zDe(e,"onehotLabels","softmaxCrossEntropy"),o=zDe(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=zDe(n,"weights","softmaxCrossEntropy")),VAe(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=JMe(r),c=JMe(1),l=JMe(i.shape[1]);i=GMe(XMe(i,eOe(c,u)),KMe(u,l))}var p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=RLe((function(e,t,r){var a=FLe(t,[n],!0),i=eOe(CMe(t,"float32"),a);r([e,i]);var o=gLe(XMe(i,e));return{value:iLe(o,[n]),gradFunc:function(e,t){var r=C(t,2),a=r[0],i=r[1],o=ZOe(e.shape,[n]);return[XMe(YMe(e,o),eOe(CMe(a,"float32"),_Le(i))),XMe(YMe(e,o),eOe(_Le(i),CMe(a,"float32")))]}}}));return r(e,t)}(i,o);return SLe(p,s,a)}});var DLe={flipLeftRight:bOe,resizeNearestNeighbor:VOe,resizeBilinear:WOe,rotateWithOffset:xOe,cropAndResize:yOe,nonMaxSuppression:wOe,nonMaxSuppressionAsync:DOe,nonMaxSuppressionWithScore:MOe,nonMaxSuppressionWithScoreAsync:LOe,nonMaxSuppressionPadded:zOe,nonMaxSuppressionPaddedAsync:BOe};var MLe=BDe({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:zDe(e,"x","step")},r={alpha:t};return RDe.runKernel(VFe,n,r)}}),OLe={kernelName:"Abs",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,MLe(CMe(n,"float32"),-1))}}}},LLe={kernelName:dRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=aLe(CMe(n,"float32")),r=rLe(eOe(JMe(1),t));return gLe(KMe(e,r))}}}},zLe={kernelName:fRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=rLe(eOe(aLe(CMe(n,"float32")),1));return KMe(e,t)}}}},PLe={kernelName:mRe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=e,n=UOe(r.shape,i);return n.length>0&&(t=iLe(t,n)),YMe(t,r.shape)},b:function(){var t=e,n=UOe(a.shape,i);return n.length>0&&(t=iLe(t,n)),YMe(t,a.shape)}}}},BLe={kernelName:vRe,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},WLe={kernelName:gRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return uOe(n)}}}},VLe={kernelName:yRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return uOe(n)}}}},ULe={kernelName:bRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,rLe(eOe(JMe(1),aLe(CMe(n,"float32")))))}}}},GLe={kernelName:xRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=rLe(GMe(JMe(1),aLe(CMe(n,"float32"))));return KMe(e,t)}}}},HLe={kernelName:IRe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=GMe(aLe(r),aLe(a)),n=XMe(e,KMe(a,t)),o=UOe(r.shape,i);return o.length>0&&(n=iLe(n,o)),YMe(n,r.shape)},b:function(){var t=GMe(aLe(r),aLe(a)),n=gLe(XMe(e,KMe(r,t))),o=UOe(a.shape,i);return o.length>0&&(n=iLe(n,o)),YMe(n,a.shape)}}}},jLe={kernelName:kRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,GMe(aLe(CMe(n,"float32")),1))}}}},qLe={kernelName:wRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,eOe(JMe(1),aLe(CMe(n,"float32"))))}}}};function KLe(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var h=C(e,4);u=h[0],c=h[1],l=h[2],p=h[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var d=C(e,4);u=d[0],p=d[1],c=d[2],l=d[3]}var f,m=C(t,4),v=m[0],g=m[1],y=m[3],b=C(YLe(n),2),x=b[0],k=b[1],w=C(YLe(r),2),I=w[0],S=w[1],N=JLe(v,I),T=JLe(g,S),E=function(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=XLe(e,t,n));var i=e[0],o=e[1],s=QLe((i-t+2*r)/n+1,a),u=QLe((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=h[0],p=h[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(p-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=QLe((t-i+y+b)/r+1,s),p=QLe((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,c,l,x,k,N,T,i,s),_=E.padInfo,A=E.outHeight,R=E.outWidth,F=o?y*p:y;return"channelsFirst"===s?f=[u,F,A,R]:"channelsLast"===s&&(f=[u,A,R,F]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:A,outWidth:R,outChannels:F,padInfo:_,strideHeight:x,strideWidth:k,filterHeight:v,filterWidth:g,effectiveFilterHeight:N,effectiveFilterWidth:T,dilationHeight:I,dilationWidth:S,inShape:e,outShape:f,filterShape:t}}function XLe(e,t,n){var r=JLe(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function YLe(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function JLe(e,t){return t<=1?e:e+(e-1)*(t-1)}function QLe(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function ZLe(e){var t=C(YLe(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function $Le(e,t){return ZLe(e)||ZLe(t)}var eze=BDe({avgPool3dGrad_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=zDe(e,"dy","avgPool3dGrad"),u=zDe(t,"input","avgPool3dGrad"),c=s,l=u,p=!1;4===u.rank&&(p=!0,c=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=YMe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),WAe(5===c.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),WAe(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")})),WAe($Le(r,a),(function(){return"Error in avgPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&WAe(qAe(i),(function(){return"Error in avgPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var h={dy:c,input:l},d={filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o},f=RDe.runKernel("AvgPool3DGrad",h,d);return p?YMe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),tze={kernelName:NRe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return eze(e,r,a,i,c,s,u)}}}};var nze=BDe({avgPoolGrad_:function(e,t,n,r,a){var i=zDe(e,"dy","avgPoolGrad"),o=zDe(t,"input","avgPoolGrad");WAe(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=YMe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=YMe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),WAe(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),WAe(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},h=RDe.runKernel("AvgPoolGrad",l,p);return c?YMe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),rze={kernelName:SRe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return nze(e,r,a,i,o)}}}},aze={kernelName:TRe,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return vLe(e,i,!1,!1)},b:function(){return vLe(e,a,!0,!1)}}:o&&!s?{a:function(){return vLe(i,e,!1,!0)},b:function(){return vLe(a,e,!1,!1)}}:{a:function(){return vLe(i,e,!0,!0)},b:function(){return vLe(e,a,!0,!0)}}:{a:function(){return vLe(e,i,!1,!0)},b:function(){return vLe(a,e,!0,!1)}}}};var ize=BDe({spaceToBatchND_:function(e,t,n){var r=zDe(e,"x","spaceToBatchND");WAe(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),WAe(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),WAe(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return RDe.runKernel(RFe,a,i)}}),oze={kernelName:CRe,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return ize(e,r,a)}}}},sze={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return iLe(e,u,!0)}}}},uze={kernelName:ERe,gradFunc:function(e){return{x:function(){return e.clone()}}}},cze={kernelName:_Re,gradFunc:function(e){return{x:function(){return uOe(e)}}}},lze={kernelName:ARe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return YOe(qOe(HOe(r,a),jOe(r,i)),e,uOe(e))}}}},pze={kernelName:RRe,inputsToSave:["x"],gradFunc:OLe.gradFunc},hze={kernelName:FRe,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=XAe(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return oOe(e,i,a).map((function(e){return function(){return e}}))}};var dze=BDe({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=YMe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2]])),WAe(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),WAe(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),WAe(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];WAe(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),WAe(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),null!=o&&WAe(qAe(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var p={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return RDe.runKernel("Conv2DBackpropFilter",p,h)}});var fze=BDe({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;WAe(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),WAe(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),WAe(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),WAe(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];WAe(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),WAe(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),null!=o&&WAe(qAe(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var h={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=RDe.runKernel(MRe,h,d);return c?YMe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),mze={kernelName:DRe,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return WAe(ZLe(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return fze(a.shape,e,i,s,u,c)},filter:function(){return dze(a,e,i.shape,s,u,c)}}}};var vze=BDe({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=zDe(e,"x","conv2d"),u=zDe(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),WAe(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),WAe(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),null!=o&&WAe(qAe(r),(function(){return"Error in conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];WAe(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),WAe($Le(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=RDe.runKernel(DRe,h,d);return l?YMe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),gze={kernelName:MRe,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return vze(e,i,o,s,u,1,c)},filter:function(){return dze(e,a,i.shape,o,s,u,c)}}}};var yze=BDe({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=YMe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),WAe(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),WAe(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),WAe(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),WAe(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),WAe(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return RDe.runKernel("Conv3DBackpropFilterV2",s,u)}});var bze=BDe({conv3DBackpropInput_:function(e,t,n,r,a){WAe(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];WAe(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),WAe(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),WAe(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),WAe(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),WAe(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},h=RDe.runKernel("Conv3DBackpropInputV2",l,p);return s?YMe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),xze={kernelName:ORe,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;WAe(ZLe(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=C(t,2),s=o[0],u=o[1];return{x:function(){return bze(s.shape,e,u,a,i)},filter:function(){return yze(s,e,u.shape,a,i)}}}};var kze=BDe({sin_:function(e){var t={x:zDe(e,"x","sin")};return RDe.runKernel("Sin",t)}}),wze={kernelName:"Cos",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(gLe(kze(CMe(n,"float32"))),e)}}}};var Ize=BDe({sinh_:function(e){var t={x:zDe(e,"x","sinh")};return RDe.runKernel(TFe,t)}}),Sze={kernelName:LRe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(Ize(CMe(n,"float32")),e)}}}};var Nze=BDe({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:zDe(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return RDe.runKernel(zRe,a,i)}}),Tze={kernelName:zRe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=function(e,t){if(QOe(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}([a],r.rank),n=Nze(e,a,i,!o);return null!=t&&(n=yLe(n,t)),n}}}};var Cze=BDe({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=YMe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return RDe.runKernel("DepthwiseConv2dNativeBackpropFilter",c,l)}});var Eze=BDe({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=YMe(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=RDe.runKernel("DepthwiseConv2dNativeBackpropInput",c,l);return u?YMe(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),_ze={kernelName:PRe,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;WAe(ZLe(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=C(t,2),c=u[0],l=u[1];return WAe(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),WAe(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),WAe(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),WAe($Le(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),null!=o&&WAe(qAe(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return Eze(c.shape,e,l,a,i,r,o)},filter:function(){return Cze(c,e,l.shape,a,i,r,o)}}}},Aze={kernelName:BRe,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return RDe.runKernel("Dilation2DBackpropInput",o,n)},filter:function(){return RDe.runKernel("Dilation2DBackpropFilter",s,n)}}}},Rze={kernelName:"Elu",outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:C(t,1)[0]};return{x:function(){return RDe.runKernel("EluGrad",n)}}}},Fze={kernelName:"Erf",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=XMe(_Le(gLe(aLe(n))),2/Math.sqrt(Math.PI));return{x:function(){return XMe(e,r)}}}},Dze={kernelName:"Exp",outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,n)}}}},Mze={kernelName:VRe,inputsToSave:["input"],gradFunc:function(e,t){var n=C(t,1)[0];return{input:function(){return YMe(e,n.shape)}}}},Oze={kernelName:URe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,_Le(n))}}}},Lze={kernelName:HRe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},zze={kernelName:jRe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=KMe(e,CMe(a,"float32")),n=UOe(r.shape,i);return n.length>0?YMe(iLe(t,n),r.shape):t},b:function(){var t=XMe(e,CMe(r,"float32")),n=UOe(a.shape,i);n.length>0&&(t=YMe(iLe(t,n),a.shape));var o=aLe(a);return gLe(KMe(t,CMe(o,"float32")))}}}};var Pze=BDe({rsqrt_:function(e){var t={x:zDe(e,"x","rsqrt")};return RDe.runKernel(wFe,t)}}),Bze={kernelName:qRe,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=C(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?JMe(1):u,l=UOe(o.shape,i.shape),p=[];if(1===o.rank){for(var h=0;h<i.shape.length-1;++h)p.push(i.shape[h]);p.push(1)}var d=eOe(i,o),f=XMe(e,c),m=Pze(GMe(s,JMe(r))),v=XMe(XMe(XMe(m,m),m),JMe(-.5));return{x:function(){return 1===o.rank?YMe(XMe(XMe(e,dLe(YMe(m,[1,1,1,o.shape[0]]),p)),c),i.shape):YMe(XMe(XMe(e,m),c),i.shape)},mean:function(){var e=XMe(XMe(m,JMe(-1)),f);return 1===o.rank&&(e=iLe(e,l)),YMe(e,o.shape)},variance:function(){var e=XMe(XMe(v,d),f);return 1===o.rank&&(e=iLe(e,l)),YMe(e,o.shape)},scale:function(){var t=XMe(d,m),n=XMe(e,t);return 1===o.rank&&(n=iLe(n,l)),YMe(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=iLe(t,l)),YMe(t,o.shape)}}}};var Wze=BDe({unsortedSegmentSum_:function(e,t,n){var r=zDe(e,"x","unsortedSegmentSum"),a=zDe(t,"segmentIds","unsortedSegmentSum","int32");WAe(qAe(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return RDe.runKernel(BFe,i,o)}}),Vze={kernelName:KRe,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.axis,s=XAe(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=Uze(0,u),h=Uze(u+1,u+1+l),d=Gze([r,[n],c]),f=YMe(e,d),m=YMe(i,[n]),v=Gze([[u],p,h]),g=yLe(f,v),y=Wze(g,m,a.shape[s]),b=$Oe(v);return y=yLe(y,b)},indices:function(){return i}}}};function Uze(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Gze(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Hze={kernelName:XRe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return uOe(r)},b:function(){return uOe(a)}}}},jze={kernelName:YRe,gradFunc:function(e){return{x:function(){return CMe(e,"float32")}}}},qze={kernelName:JRe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},Kze={kernelName:QRe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},Xze={kernelName:ZRe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},Yze={kernelName:$Re,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.alpha,i=mLe(r,0);return{x:function(){return YOe(i,e,XMe(e,a))}}}},Jze={kernelName:eFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,GMe(n,1))}}}},Qze={kernelName:"Log",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,CMe(n,"float32"))}}}},Zze={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.axis;return{logits:function(){var t=_Le(r);return eOe(e,XMe(iLe(e,a,!0),t))}}}};var $ze=BDe({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return RDe.runKernel("LRNGrad",r,a)}}),ePe={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return $ze(a,i,e,o,s,u,c)}}}};var tPe=BDe({equal_:function(e,t){var n=zDe(e,"a","equal"),r=zDe(t,"b","equal"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel("Equal",i)}});function nPe(e,t,n,r){return t.rank<n.rank&&(t=YMe(t,ZOe(t.shape,r))),e.rank<n.rank&&(e=YMe(e,ZOe(e.shape,r))),{x:function(){return XMe(e,CMe(tPe(n,t),e.dtype))}}}var rPe={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=nPe(e,t[1],a,XAe(r,a.shape));return{x:function(){return i.x()}}}};var aPe=BDe({less_:function(e,t){var n=zDe(e,"a","less"),r=zDe(t,"b","less"),a=C(NDe(n,r),2);n=a[0],r=a[1],GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel("Less",i)}}),iPe={kernelName:tFe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return XMe(e,CMe(HOe(r,a),"float32"))},b:function(){return XMe(e,CMe(aPe(r,a),"float32"))}}}};var oPe=BDe({maxPool3dGrad_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=zDe(e,"dy","maxPool3dGrad"),c=zDe(t,"input","maxPool3dGrad"),l=zDe(n,"output","maxPool3dGrad"),p=u,h=c,d=l,f=!1;4===c.rank&&(f=!0,p=YMe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=YMe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=YMe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),WAe(5===p.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(p.rank,".")})),WAe(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")})),WAe(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")})),WAe($Le(a,i),(function(){return"Error in maxPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&WAe(qAe(o),(function(){return"Error in maxPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var m={dy:p,input:h,output:d},v={filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s},g=RDe.runKernel("MaxPool3DGrad",m,v);return f?YMe(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),sPe={kernelName:rFe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,p=null==u?[1,1,1]:u;return{x:function(){return oPe(e,a,i,o,s,p,c,l)}}}};var uPe=BDe({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=zDe(e,"dy","maxPoolGrad"),u=zDe(t,"input","maxPoolGrad"),c=zDe(n,"output","maxPoolGrad");WAe(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),WAe(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),WAe(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),null!=o&&WAe(qAe(i),(function(){return"Error in maxPoolGrad: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return RDe.runKernel("MaxPoolGrad",l,p)}}),cPe={kernelName:nFe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return uPe(e,a,i,o,s,u)}}}},lPe={kernelName:aFe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=XAe(n.axis,r.shape),i=function(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}(r.shape,a),o=HAe(i[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=YMe(e,t);return KMe(XMe(n,ILe(r.shape,"float32")),o)}}}},pPe={kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=C(t,2),i=a[0],o=nPe(e,a[1],i,XAe(r,i.shape));return{x:function(){return o.x()}}}},hPe={kernelName:iFe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1];return{a:function(){return XMe(e,CMe(jOe(r,a),"float32"))},b:function(){return XMe(e,CMe(mLe(r,a),"float32"))}}}},dPe={kernelName:oFe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return ZMe(e,a,r.shape)}}}};var fPe=BDe({floor_:function(e){var t={x:zDe(e,"x","floor")};return RDe.runKernel(HRe,t)}}),mPe={kernelName:"Mod",inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=UOe(r.shape,i);return t.length>0?YMe(iLe(e,t),r.shape):e},b:function(){var t=XMe(e,gLe(fPe(KMe(r,a)))),n=UOe(a.shape,i);return n.length>0?YMe(iLe(t,n),a.shape):t}}}},vPe={kernelName:sFe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=XMe(e,CMe(a,"float32")),n=UOe(r.shape,i);return n.length>0?YMe(iLe(t,n),r.shape):t},b:function(){var t=XMe(e,CMe(r,"float32")),n=UOe(a.shape,i);return n.length>0?YMe(iLe(t,n),a.shape):t}}}},gPe={kernelName:"Neg",gradFunc:function(e){return{x:function(){return gLe(e)}}}},yPe={kernelName:cFe,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return sOe(n.shape,"float32")}}}},bPe={kernelName:uFe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},xPe={kernelName:lFe,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return rOe(e,r).map((function(e){return function(){return e}}))}},kPe={kernelName:pFe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return ZMe(e,a,r.shape)}}}},wPe={kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=GOe(o.shape,s.shape);return{a:function(){var t=CMe(s,"float32"),n=XMe(e,XMe(t,nLe(o,eOe(t,JMe(1))))),r=UOe(o.shape,u);return r.length>0&&(n=iLe(n,r)),YMe(n,o.shape)},b:function(){var t=mLe(o,0),n=YOe(t,CLe(o),uOe(o)),r=XMe(e,XMe(i,n)),a=UOe(s.shape,u);return a.length>0&&(r=iLe(r,a)),YMe(r,s.shape)}}}},IPe={kernelName:hFe,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=mLe(r,0);return{x:function(){return YOe(i,e,XMe(e,a))},alpha:function(){var t=YOe(i,uOe(e),XMe(e,r)),n=UOe(a.shape,e.shape);return n.length>0&&(t=iLe(t,n)),YMe(t,a.shape)}}}},SPe={kernelName:WRe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=KMe(e,CMe(a,"float32")),n=UOe(r.shape,i);return n.length>0?YMe(iLe(t,n),r.shape):t},b:function(){var t=XMe(e,CMe(r,"float32")),n=UOe(a.shape,i);n.length>0&&(t=YMe(iLe(t,n),a.shape));var o=aLe(a);return gLe(KMe(t,CMe(o,"float32")))}}}},NPe={kernelName:fFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,gLe(aLe(n)))}}}},TPe={kernelName:bFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0],r=XMe(jOe(n,6),MLe(n));return{x:function(){return XMe(e,CMe(r,"float32"))}}}},CPe={kernelName:mFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,CMe(MLe(n),"float32"))}}}},EPe={kernelName:vFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return YMe(e,n.shape)}}}},_Pe={kernelName:yFe,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return RDe.runKernel("ResizeBilinearGrad",r,n)}}}},APe={kernelName:gFe,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:C(t,1)[0]};return{images:function(){return RDe.runKernel("ResizeNearestNeighborGrad",r,n)}}}},RPe={kernelName:xFe,gradFunc:function(e,t,n){var r=XAe(n.dims,e.shape);return{x:function(){return hOe(e,r)}}}},FPe={kernelName:kFe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},DPe={kernelName:wFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return gLe(KMe(e,XMe(nLe(n,1.5),2)))}}}};var MPe=BDe({logicalNot_:function(e){var t={x:zDe(e,"x","logicalNot","bool")};return RDe.runKernel("LogicalNot",t)}}),OPe={kernelName:IFe,inputsToSave:["condition"],gradFunc:function(e,t){var n=C(t,1)[0];return{condition:function(){return CMe(uOe(n),"float32")},t:function(){return XMe(e,CMe(n,e.dtype))},e:function(){return XMe(e,CMe(MPe(n),e.dtype))}}}},LPe={kernelName:SFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){var t=mLe(n,JMe(0)),r=JMe(1.7580993408473768),a=JMe(1.0507009873554805),i=XMe(e,a),o=XMe(XMe(e,r),_Le(CMe(n,"float32")));return YOe(t,i,o)}}}},zPe={kernelName:EFe,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,XMe(n,eOe(JMe(1),n)))}}}},PPe={kernelName:CFe,gradFunc:function(e){return{x:function(){return uOe(e)}}}};var BPe=BDe({cos_:function(e){var t={x:zDe(e,"x","cos")};return RDe.runKernel("Cos",t)}}),WPe={kernelName:"Sin",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(BPe(CMe(n,"float32")),e)}}}};var VPe=BDe({cosh_:function(e){var t={x:zDe(e,"x","cosh")};return RDe.runKernel(LRe,t)}}),UPe={kernelName:TFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(VPe(CMe(n,"float32")),e)}}}};var GPe=BDe({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=zDe(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return RDe.runKernel(pFe,i,a)}});var HPe={kernelName:NFe,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=C(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=function(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Ie(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){WAe(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Ie(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(WAe(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}(r,a,i),u=C(s,2),c=u[0],l=u[1],p=[],h=0;h<e.rank;h++)p.push([c[h],o[h]-c[h]-l[h]]);return{x:function(){return GPe(e,p)}}}},jPe={kernelName:DFe,outputsToSave:[!0],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.dim,i=XMe(e,r);return{logits:function(){return eOe(i,XMe(iLe(i,[a],true),r))}}}},qPe={kernelName:_Fe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,QMe(n))}}}};var KPe=BDe({batchToSpaceND_:function(e,t,n){var r=zDe(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));WAe(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),WAe(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),WAe(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return RDe.runKernel(CRe,i,o)}}),XPe={kernelName:RFe,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return KPe(e,r,a)}}}},YPe={kernelName:FFe,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return HMe(e,r)}}}},JPe={kernelName:AFe,inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,XMe(rLe(CMe(n,"float32")),2))}}}},QPe={kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(e,XMe(CMe(n,"float32"),2))}}}},ZPe={kernelName:MFe,inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=JMe(2);return{a:function(){return XMe(e,XMe(i,eOe(r,a)))},b:function(){return XMe(e,XMe(i,eOe(a,r)))}}}},$Pe={kernelName:VFe,gradFunc:function(e){return{x:function(){return uOe(e)}}}},eBe={kernelName:"Sub",inputsToSave:["a","b"],gradFunc:function(e,t){var n=C(t,2),r=n[0],a=n[1],i=GOe(r.shape,a.shape);return{a:function(){var t=e,n=UOe(r.shape,i);return n.length>0&&(t=iLe(t,n)),YMe(t,r.shape)},b:function(){var t=e,n=UOe(a.shape,i);return n.length>0&&(t=iLe(t,n)),YMe(gLe(t),a.shape)}}}},tBe={kernelName:"Sum",inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=r.shape.slice();XAe(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=YMe(e,a),o=XMe(i,ILe(r.shape,"float32"));return{x:function(){return o}}}},nBe={kernelName:"Tan",inputsToSave:["x"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return KMe(e,aLe(BPe(n)))}}}},rBe={kernelName:OFe,outputsToSave:[!0],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return XMe(eOe(JMe(1),aLe(n)),e)}}}},aBe={kernelName:LFe,inputsToSave:["x"],gradFunc:function(e,t,n){var r=C(t,1)[0],a=n.reps;return{x:function(){var t=uOe(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=GMe(t,ZMe(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=GMe(t,ZMe(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=GMe(t,ZMe(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var h=0;h<a[2];++h)for(var d=0;d<a[3];++d)t=GMe(t,ZMe(e,[l*r.shape[0],p*r.shape[1],h*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},iBe={kernelName:zFe,gradFunc:function(e,t,n){var r=$Oe(n.perm);return{x:function(){return yLe(e,r)}}}},oBe={kernelName:PFe,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return $Me(e,r)}}}};var sBe=BDe({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:zDe(e,"x","gather"),indices:zDe(t,"indices","gather","int32")},i={axis:n,batchDims:r};return RDe.runKernel(KRe,a,i)}});var uBe=BDe({maximum_:function(e,t){var n=zDe(e,"a","maximum"),r=zDe(t,"b","maximum"),a=C(NDe(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=CMe(n,"int32"),r=CMe(r,"int32")),GOe(n.shape,r.shape);var i={a:n,b:r};return RDe.runKernel(tFe,i)}}),cBe={kernelName:BFe,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=C(t,1)[0];return{x:function(){return function(e,t){for(var n=uBe(t,uOe(t)),r=sBe(e,n),a=HOe(t,JMe(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=hLe(a,o+1);a=qOe(a,ILe(r.shape,"bool"));var s=uOe(r);return YOe(a,r,s)}(e,n)}}}};for(var lBe=0,pBe=[OLe,LLe,zLe,PLe,BLe,WLe,VLe,ULe,GLe,HLe,jLe,qLe,tze,rze,aze,oze,sze,uze,cze,lze,pze,hze,gze,mze,xze,wze,Sze,Tze,_ze,Aze,SPe,Rze,Fze,Dze,Mze,Oze,zze,Lze,Bze,Vze,Hze,jze,qze,Kze,Xze,Yze,Jze,Qze,Zze,ePe,rPe,rPe,iPe,sPe,cPe,lPe,pPe,hPe,dPe,mPe,vPe,gPe,yPe,bPe,xPe,kPe,kPe,wPe,IPe,NPe,TPe,CPe,EPe,_Pe,APe,RPe,FPe,DPe,OPe,LPe,zPe,PPe,WPe,UPe,HPe,jPe,qPe,XPe,XPe,YPe,YPe,JPe,ZPe,QPe,$Pe,eBe,tBe,nBe,rBe,aBe,iBe,oBe,cBe,{kernelName:WFe,gradFunc:function(e){return{x:function(){return uOe(e)}}}}];lBe<pBe.length;lBe++){QFe(pBe[lBe])}vDe.prototype.abs=function(){return this.throwIfDisposed(),JOe(this)};var hBe=BDe({acos_:function(e){var t={x:zDe(e,"x","acos")};return RDe.runKernel(dRe,t)}});vDe.prototype.acos=function(){return this.throwIfDisposed(),hBe(this)};var dBe=BDe({acosh_:function(e){var t={x:zDe(e,"x","acosh")};return RDe.runKernel(fRe,t)}});vDe.prototype.acosh=function(){return this.throwIfDisposed(),dBe(this)};var fBe=BDe({mod_:function(e,t){var n=zDe(e,"a","mod"),r=zDe(t,"b","mod"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel("Mod",i)}});var mBe=BDe({addStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","addStrict"),r=zDe(t,"b","addStrict");return VAe(n.shape,r.shape,"Error in addStrict: "),GMe(n,r)}}),vBe=BDe({divStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","div"),r=zDe(t,"b","div");return VAe(n.shape,r.shape,"Error in divideStrict: "),KMe(n,r)}}),gBe=BDe({maximumStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","maximumStrict"),r=zDe(t,"b","maximumStrict");return VAe(n.shape,r.shape,"Error in maximumStrict: "),uBe(n,r)}}),yBe=BDe({minimumStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","minimumStrict"),r=zDe(t,"b","minimumStrict");return VAe(n.shape,r.shape,"Error in minimumStrict: "),TLe(n,r)}}),bBe=BDe({modStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","modStrict"),r=zDe(t,"b","modStrict");return VAe(n.shape,r.shape,"Error in modStrict: "),fBe(n,r)}}),xBe=BDe({mulStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","mul"),r=zDe(t,"b","mul");return VAe(n.shape,r.shape,"Error in multiplyStrict: "),XMe(n,r)}}),kBe=BDe({powStrict_:function(e,t){return cLe("strict variants of ops have been deprecated and will be removed in future"),VAe(e.shape,t.shape,"Error in powStrict: "),nLe(e,t)}}),wBe=BDe({squaredDifferenceStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","squaredDifferenceStrict"),r=zDe(t,"b","squaredDifferenceStrict");return VAe(n.shape,r.shape,"Error in squaredDifferenceStrict: "),ELe(n,r)}}),IBe=BDe({subStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","subStrict"),r=zDe(t,"b","subStrict");return VAe(n.shape,r.shape,"Error in subStrict: "),eOe(n,r)}});vDe.prototype.addStrict=function(e){return this.throwIfDisposed(),mBe(this,e)},vDe.prototype.add=function(e){return this.throwIfDisposed(),GMe(this,e)};var SBe=BDe({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:zDe(e,"x","all","bool")},a={axis:t,keepDims:n};return RDe.runKernel("All",r,a)}});vDe.prototype.all=function(e,t){return this.throwIfDisposed(),SBe(this,e,t)};var NBe=BDe({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:zDe(e,"x","any","bool")},a={axis:t,keepDims:n};return RDe.runKernel("Any",r,a)}});vDe.prototype.any=function(e,t){return this.throwIfDisposed(),NBe(this,e,t)};var TBe=BDe({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:zDe(e,"x","argMax")},r={axis:t};return RDe.runKernel(gRe,n,r)}});vDe.prototype.argMax=function(e){return this.throwIfDisposed(),TBe(this,e)};var CBe=BDe({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:zDe(e,"x","argMin")},r={axis:t};return RDe.runKernel(yRe,n,r)}});vDe.prototype.argMin=function(e){return this.throwIfDisposed(),CBe(this,e)},vDe.prototype.asScalar=function(){return this.throwIfDisposed(),WAe(1===this.size,(function(){return"The array must have only 1 element."})),YMe(this,[])},vDe.prototype.asType=function(e){return this.throwIfDisposed(),CMe(this,e)},vDe.prototype.as1D=function(){return this.throwIfDisposed(),YMe(this,[this.size])},vDe.prototype.as2D=function(e,t){return this.throwIfDisposed(),YMe(this,[e,t])},vDe.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),YMe(this,[e,t,n])},vDe.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),YMe(this,[e,t,n,r])},vDe.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),YMe(this,[e,t,n,r,a])};var EBe=BDe({asin_:function(e){var t={x:zDe(e,"x","asin")};return RDe.runKernel(bRe,t)}});vDe.prototype.asin=function(){return this.throwIfDisposed(),EBe(this)};var _Be=BDe({asinh_:function(e){var t={x:zDe(e,"x","asinh")};return RDe.runKernel(xRe,t)}});vDe.prototype.asinh=function(){return this.throwIfDisposed(),_Be(this)};var ABe=BDe({atan_:function(e){var t={x:zDe(e,"x","atan")};return RDe.runKernel(kRe,t)}});vDe.prototype.atan=function(){return this.throwIfDisposed(),ABe(this)};var RBe=BDe({atan2_:function(e,t){var n=zDe(e,"a","atan2"),r=zDe(t,"b","atan2"),a=C(NDe(n,r),2),i={a:n=a[0],b:r=a[1]};return RDe.runKernel(IRe,i)}});vDe.prototype.atan2=function(e){return this.throwIfDisposed(),RBe(this,e)};var FBe=BDe({atanh_:function(e){var t={x:zDe(e,"x","atanh")};return RDe.runKernel(wRe,t)}});vDe.prototype.atanh=function(){return this.throwIfDisposed(),FBe(this)};var DBe=BDe({avgPool_:function(e,t,n,r,a){var i=zDe(e,"x","avgPool","float32");WAe($Le(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=YMe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),WAe(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&WAe(qAe(r),(function(){return"Error in avgPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=RDe.runKernel(SRe,u,c);return l=CMe(l,i.dtype),s?YMe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});vDe.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),DBe(this,e,t,n,r)},vDe.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),KPe(this,e,t)};var MBe=BDe({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=zDe(e,"x","batchNorm"),c=zDe(t,"mean","batchNorm"),l=zDe(n,"variance","batchNorm");null!=a&&(o=zDe(a,"scale","batchNorm")),null!=r&&(s=zDe(r,"offset","batchNorm")),WAe(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),WAe(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),WAe(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p=function(e){return 0===e.rank||1===e.rank?YMe(e,[1,1,1,e.size]):2===e.rank?YMe(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?YMe(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),h={x:p,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},f=RDe.runKernel(qRe,h,d);return YMe(f,u.shape)}});vDe.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),MBe(this,e,t,n,r,a)},vDe.prototype.broadcastTo=function(e){return this.throwIfDisposed(),XOe(this,e)},vDe.prototype.cast=function(e){return this.throwIfDisposed(),CMe(this,e)};var OBe=BDe({ceil_:function(e){var t={x:zDe(e,"x","ceil")};return RDe.runKernel(_Re,t)}});vDe.prototype.ceil=function(){return this.throwIfDisposed(),OBe(this)};var LBe=BDe({clipByValue_:function(e,t,n){var r=zDe(e,"x","clipByValue");WAe(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return RDe.runKernel(ARe,a,i)}});vDe.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),LBe(this,e,t)},vDe.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof vDe&&(e=[e]),HMe([this].concat(Ie(e)),t)};var zBe=BDe({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=zDe(e,"x","conv1d"),u=zDe(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=YMe(s,[1,s.shape[0],s.shape[1]])),WAe(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),WAe(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),null!=o&&WAe(qAe(r),(function(){return"Error in conv1d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),WAe(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),WAe($Le(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),WAe("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=YMe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=YMe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=vze(h,p,[1,n],r,"NHWC",[1,i],o);return YMe(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});vDe.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),zBe(this,e,t,n,r,a,i)};var PBe=BDe({conv2dTranspose_:function(e,t,n,r,a,i){var o=zDe(e,"x","conv2dTranspose"),s=zDe(t,"filter","conv2dTranspose");return fze(n,o,s,r,a,"NHWC",i)}});vDe.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),PBe(this,e,t,n,r,a)},vDe.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),vze(this,e,t,n,r,a,i)},vDe.prototype.cos=function(){return this.throwIfDisposed(),BPe(this)},vDe.prototype.cosh=function(){return this.throwIfDisposed(),VPe(this)},vDe.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Nze(this,e,t,n)};var BBe=BDe({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=zDe(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];WAe(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),WAe(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),WAe(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return RDe.runKernel("DepthToSpace",s,u)}});vDe.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),BBe(this,e,t)};var WBe=BDe({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=zDe(e,"x","depthwiseConv2d"),u=zDe(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),WAe(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),WAe(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),WAe(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(c.shape[3],") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),null!=o&&WAe(qAe(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var p={x:c,filter:u},h={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=RDe.runKernel(PRe,p,h);return l?YMe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});vDe.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return cLe("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),WBe(this,e,t,n,r,a,i)},vDe.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),WBe(this,e,t,n,r,a,i)};var VBe=BDe({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=zDe(e,"x","dilation2d"),s=zDe(t,"filter","dilation2d");WAe(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),WAe(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),WAe("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=YMe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},h=RDe.runKernel(BRe,l,p);return c?YMe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});vDe.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),VBe(this,e,t,n,r,a)};var UBe=BDe({divNoNan_:function(e,t){var n=zDe(e,"a","div"),r=zDe(t,"b","div"),a=C(NDe(n,r),2);n=a[0],r=a[1];var i=KMe(n,r),o=uOe(i),s=tPe(r,o);return YOe(s,o,i)}});vDe.prototype.divNoNan=function(e){return this.throwIfDisposed(),UBe(this,e)},vDe.prototype.divStrict=function(e){return this.throwIfDisposed(),vBe(this,e)},vDe.prototype.div=function(e){return this.throwIfDisposed(),KMe(this,e)};var GBe=BDe({dot_:function(e,t){var n=zDe(e,"t1","dot"),r=zDe(t,"t2","dot");WAe((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(WAe(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=YMe(n,[1,-1]),s=YMe(r,[-1,1]),u=vLe(o,s);return YMe(u,[])}if(1===n.rank&&2===r.rank){var c=YMe(n,[1,-1]),l=YMe(r,[r.shape[0],r.shape[1]]),p=vLe(c,l);return YMe(p,[p.size])}if(2===n.rank&&1===r.rank){var h=YMe(r,[-1,1]),d=vLe(n,h);return YMe(d,[d.size])}var f=YMe(r,[r.shape[0],r.shape[1]]);return vLe(n,f)}});vDe.prototype.dot=function(e){return this.throwIfDisposed(),GBe(this,e)};var HBe=BDe({elu_:function(e){var t={x:zDe(e,"x","elu")};return RDe.runKernel("Elu",t)}});vDe.prototype.elu=function(){return this.throwIfDisposed(),HBe(this)};var jBe=BDe({equalStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","equalStrict"),r=zDe(t,"b","equalStrict");return VAe(n.shape,r.shape,"Error in equalStrict: "),tPe(n,r)}}),qBe=BDe({greaterEqualStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","greaterEqualStrict"),r=zDe(t,"b","greaterEqualStrict");return VAe(n.shape,r.shape,"Error in greaterEqualStrict: "),HOe(n,r)}}),KBe=BDe({greaterStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","greaterStrict"),r=zDe(t,"b","greaterStrict");return VAe(n.shape,r.shape,"Error in greaterStrict: "),mLe(n,r)}}),XBe=BDe({lessEqualStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","lessEqualStrict"),r=zDe(t,"b","lessEqualStrict");return VAe(n.shape,r.shape,"Error in lessEqualStrict: "),jOe(n,r)}}),YBe=BDe({lessStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","lessStrict"),r=zDe(t,"b","lessStrict");return VAe(n.shape,r.shape,"Error in lessStrict: "),aPe(n,r)}}),JBe=BDe({notEqualStrict_:function(e,t){cLe("strict variants of ops have been deprecated and will be removed in future");var n=zDe(e,"a","notEqualStrict"),r=zDe(t,"b","notEqualStrict");return VAe(n.shape,r.shape,"Error in notEqualStrict: "),wLe(n,r)}});vDe.prototype.equalStrict=function(e){return this.throwIfDisposed(),jBe(this,e)},vDe.prototype.equal=function(e){return this.throwIfDisposed(),tPe(this,e)};var QBe=BDe({erf_:function(e){var t=zDe(e,"x","erf");WAe("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=CMe(t,"float32"));var n={x:t};return RDe.runKernel("Erf",n)}});vDe.prototype.erf=function(){return this.throwIfDisposed(),QBe(this)},vDe.prototype.exp=function(){return this.throwIfDisposed(),_Le(this)},vDe.prototype.expandDims=function(e){return this.throwIfDisposed(),hLe(this,e)};var ZBe=BDe({expm1_:function(e){var t={x:zDe(e,"x","expm1")};return RDe.runKernel(URe,t)}});vDe.prototype.expm1=function(){return this.throwIfDisposed(),ZBe(this)},vDe.prototype.fft=function(){return this.throwIfDisposed(),cOe(this)},vDe.prototype.flatten=function(){return this.throwIfDisposed(),YMe(this,[this.size])},vDe.prototype.floor=function(){return this.throwIfDisposed(),fPe(this)},vDe.prototype.floorDiv=function(e){return this.throwIfDisposed(),qMe(this,e)},vDe.prototype.gather=function(e,t){return this.throwIfDisposed(),sBe(this,e,t)},vDe.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),qBe(this,e)},vDe.prototype.greaterEqual=function(e){return this.throwIfDisposed(),HOe(this,e)},vDe.prototype.greaterStrict=function(e){return this.throwIfDisposed(),KBe(this,e)},vDe.prototype.greater=function(e){return this.throwIfDisposed(),mLe(this,e)},vDe.prototype.ifft=function(){return this.throwIfDisposed(),pOe(this)},vDe.prototype.irfft=function(){return this.throwIfDisposed(),dOe(this)};var $Be=BDe({isFinite_:function(e){var t={x:zDe(e,"x","isFinite")};return RDe.runKernel(JRe,t)}});vDe.prototype.isFinite=function(){return this.throwIfDisposed(),$Be(this)};var eWe=BDe({isInf_:function(e){var t={x:zDe(e,"x","isInf")};return RDe.runKernel(QRe,t)}});vDe.prototype.isInf=function(){return this.throwIfDisposed(),eWe(this)};var tWe=BDe({isNaN_:function(e){var t={x:zDe(e,"x","isNaN")};return RDe.runKernel(ZRe,t)}});vDe.prototype.isNaN=function(){return this.throwIfDisposed(),tWe(this)};var nWe=BDe({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:zDe(e,"x","leakyRelu")},r={alpha:t};return RDe.runKernel($Re,n,r)}});vDe.prototype.leakyRelu=function(e){return this.throwIfDisposed(),nWe(this,e)},vDe.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),XBe(this,e)},vDe.prototype.lessEqual=function(e){return this.throwIfDisposed(),jOe(this,e)},vDe.prototype.lessStrict=function(e){return this.throwIfDisposed(),YBe(this,e)},vDe.prototype.less=function(e){return this.throwIfDisposed(),aPe(this,e)};var rWe=BDe({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=zDe(e,"x","localResponseNormalization");WAe(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),WAe(qAe(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=YMe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=RDe.runKernel("LRN",u,c);return s?YMe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});vDe.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),rWe(this,e,t,n,r)};var aWe=BDe({softplus_:function(e){var t={x:zDe(e,"x","softplus")};return RDe.runKernel(_Fe,t)}});var iWe=BDe({logSigmoid_:function(e){var t=zDe(e,"x","logSigmoid"),n=RLe((function(e){return{value:gLe(aWe(gLe(e))),gradFunc:function(t){return XMe(t,QMe(gLe(e)))}}}));return n(t)}});vDe.prototype.logSigmoid=function(){return this.throwIfDisposed(),iWe(this)};var oWe=BDe({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=zDe(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=RLe((function(e,n){var r=eLe(e,t,!0),a=eOe(e,r),i=eOe(CMe(a,"float32"),CLe(iLe(_Le(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=C(n,1)[0],a=_Le(r);return eOe(e,XMe(iLe(e,t,!0),a))}}}));return r(n)}});vDe.prototype.logSoftmax=function(e){return this.throwIfDisposed(),oWe(this,e)},vDe.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),FLe(this,e,t)},vDe.prototype.log=function(){return this.throwIfDisposed(),CLe(this)},vDe.prototype.log1p=function(){return this.throwIfDisposed(),ALe(this)},vDe.prototype.logicalAnd=function(e){return this.throwIfDisposed(),qOe(this,e)},vDe.prototype.logicalNot=function(){return this.throwIfDisposed(),MPe(this)};var sWe=BDe({logicalOr_:function(e,t){var n=zDe(e,"a","logicalOr","bool"),r=zDe(t,"b","logicalOr","bool");GOe(n.shape,r.shape);var a={a:n,b:r};return RDe.runKernel("LogicalOr",a)}});vDe.prototype.logicalOr=function(e){return this.throwIfDisposed(),sWe(this,e)};var uWe=BDe({logicalXor_:function(e,t){var n=zDe(e,"a","logicalXor","bool"),r=zDe(t,"b","logicalXor","bool");return GOe(n.shape,r.shape),qOe(sWe(e,t),MPe(qOe(e,t)))}});vDe.prototype.logicalXor=function(e){return this.throwIfDisposed(),uWe(this,e)},vDe.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),vLe(this,e,t,n)};var cWe=BDe({maxPool_:function(e,t,n,r,a){var i=zDe(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=YMe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),WAe(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),WAe($Le(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),null!=a&&WAe(qAe(r),(function(){return"Error in maxPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=RDe.runKernel(nFe,u,c);return s?YMe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});vDe.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),cWe(this,e,t,n,r)},vDe.prototype.max=function(e,t){return this.throwIfDisposed(),eLe(this,e,t)},vDe.prototype.maximumStrict=function(e){return this.throwIfDisposed(),gBe(this,e)},vDe.prototype.maximum=function(e){return this.throwIfDisposed(),uBe(this,e)},vDe.prototype.mean=function(e,t){return this.throwIfDisposed(),kLe(this,e,t)},vDe.prototype.min=function(e,t){return this.throwIfDisposed(),tLe(this,e,t)},vDe.prototype.minimumStrict=function(e){return this.throwIfDisposed(),yBe(this,e)},vDe.prototype.minimum=function(e){return this.throwIfDisposed(),TLe(this,e)};var lWe=BDe({mirrorPad_:function(e,t,n){WAe("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=zDe(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");WAe(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){WAe(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),WAe(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return RDe.runKernel(oFe,u,s)}});vDe.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),lWe(this,e,t)},vDe.prototype.modStrict=function(e){return this.throwIfDisposed(),bBe(this,e)},vDe.prototype.mod=function(e){return this.throwIfDisposed(),fBe(this,e)},vDe.prototype.mulStrict=function(e){return this.throwIfDisposed(),xBe(this,e)},vDe.prototype.mul=function(e){return this.throwIfDisposed(),XMe(this,e)},vDe.prototype.neg=function(){return this.throwIfDisposed(),gLe(this)},vDe.prototype.norm=function(e,t,n){return this.throwIfDisposed(),sLe(this,e,t,n)},vDe.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),JBe(this,e)},vDe.prototype.notEqual=function(e){return this.throwIfDisposed(),wLe(this,e)};var pWe=BDe({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a={indices:zDe(e,"indices","oneHot","int32")},i={depth:t,onValue:n,offValue:r};return RDe.runKernel(cFe,a,i)}});vDe.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),pWe(this,e,t,n)};var hWe=BDe({onesLike_:function(e){var t={x:zDe(e,"x","onesLike")};return RDe.runKernel(uFe,t)}});vDe.prototype.onesLike=function(){return this.throwIfDisposed(),hWe(this)},vDe.prototype.pad=function(e,t){return this.throwIfDisposed(),GPe(this,e,t)};var dWe=BDe({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=zDe(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=YMe(o,[1,o.shape[0],o.shape[1],o.shape[2]])),WAe($Le(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=function(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=C(YLe(t),2),c=u[0],l=u[1];if("channelsLast"===s)o=[c,l,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[c,l,e[1],e[1]]}return KLe(e,o,n,r,a,i,!1,s)}(s.shape,t,i,a,r),p=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([l.filterHeight,l.filterWidth],p):[[0,0],[0,0]];var h=1===p[0]&&1===p[1],d=C(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([l.inHeight,l.inWidth],p,c),2),f=d[0],m=d[1],v=h?r:"valid",g=h?s:ize(s,p,f),y=("avg"===n?function(){return DBe(g,t,i,v)}:function(){return cWe(g,t,i,v)})(),b=h?y:KPe(y,p,m);return u?YMe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}});vDe.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),dWe(this,e,t,n,r,a)},vDe.prototype.powStrict=function(e){return this.throwIfDisposed(),kBe(this,e)},vDe.prototype.pow=function(e){return this.throwIfDisposed(),nLe(this,e)};var fWe=BDe({prelu_:function(e,t){var n={x:zDe(e,"x","prelu"),alpha:zDe(t,"alpha","prelu")};return RDe.runKernel(hFe,n)}});vDe.prototype.prelu=function(e){return this.throwIfDisposed(),fWe(this,e)};var mWe=BDe({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=zDe(e,"x","prod");"bool"===r.dtype&&(r=CMe(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return RDe.runKernel("Prod",a,i)}});vDe.prototype.prod=function(e,t){return this.throwIfDisposed(),mWe(this,e,t)};var vWe=BDe({reciprocal_:function(e){var t={x:zDe(e,"x","reciprocal")};return RDe.runKernel(fFe,t)}});vDe.prototype.reciprocal=function(){return this.throwIfDisposed(),vWe(this)},vDe.prototype.relu=function(){return this.throwIfDisposed(),NLe(this)};var gWe=BDe({relu6_:function(e){var t={x:zDe(e,"x","relu6")};return RDe.runKernel(bFe,t)}});vDe.prototype.relu6=function(){return this.throwIfDisposed(),gWe(this)},vDe.prototype.reshapeAs=function(e){return this.throwIfDisposed(),YMe(this,e.shape)},vDe.prototype.reshape=function(e){return this.throwIfDisposed(),YMe(this,e)},vDe.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),WOe(this,e,t,n)},vDe.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),VOe(this,e,t,n)},vDe.prototype.reverse=function(e){return this.throwIfDisposed(),hOe(this,e)},vDe.prototype.rfft=function(){return this.throwIfDisposed(),lOe(this)};var yWe=BDe({round_:function(e){var t={x:zDe(e,"x","round")};return RDe.runKernel(kFe,t)}});vDe.prototype.round=function(){return this.throwIfDisposed(),yWe(this)},vDe.prototype.rsqrt=function(){return this.throwIfDisposed(),Pze(this)};var bWe=BDe({selu_:function(e){var t={x:zDe(e,"x","selu")};return RDe.runKernel(SFe,t)}});vDe.prototype.selu=function(){return this.throwIfDisposed(),bWe(this)};var xWe=BDe({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=zDe(e,"x","separableConv2d"),u=zDe(t,"depthwiseFilter","separableConv2d"),c=zDe(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");WAe(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),WAe(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),WAe(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),WAe(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),WAe(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var h=u.shape[2],d=u.shape[3];WAe(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")}));var f=WBe(l,u,r,a,o,i),m=vze(f,c,1,"valid",o);return p?YMe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});vDe.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),xWe(this,e,t,n,r,a,i)},vDe.prototype.sigmoid=function(){return this.throwIfDisposed(),QMe(this)};var kWe=BDe({sign_:function(e){var t={x:zDe(e,"x","sign")};return RDe.runKernel(CFe,t)}});vDe.prototype.sign=function(){return this.throwIfDisposed(),kWe(this)},vDe.prototype.sin=function(){return this.throwIfDisposed(),kze(this)},vDe.prototype.sinh=function(){return this.throwIfDisposed(),Ize(this)},vDe.prototype.slice=function(e,t){return this.throwIfDisposed(),ZMe(this,e,t)};var wWe=BDe({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=zDe(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return RDe.runKernel(DFe,r,a)}});vDe.prototype.softmax=function(e){return this.throwIfDisposed(),wWe(this,e)},vDe.prototype.softplus=function(){return this.throwIfDisposed(),aWe(this)},vDe.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),ize(this,e,t)},vDe.prototype.split=function(e,t){return this.throwIfDisposed(),oOe(this,e,t)},vDe.prototype.sqrt=function(){return this.throwIfDisposed(),rLe(this)},vDe.prototype.square=function(){return this.throwIfDisposed(),aLe(this)},vDe.prototype.squaredDifference=function(e){return this.throwIfDisposed(),ELe(this,e)},vDe.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),wBe(this,e)},vDe.prototype.squeeze=function(e){return this.throwIfDisposed(),uLe(this,e)},vDe.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof vDe?[this,e]:[this].concat(Ie(e));return $Me(n,t)},vDe.prototype.step=function(e){return this.throwIfDisposed(),MLe(this,e)};var IWe=BDe({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:zDe(e,"x","stridedSlice")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return RDe.runKernel("StridedSlice",c,l)}});vDe.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),IWe(this,e,t,n,r,a,i,o,s)},vDe.prototype.subStrict=function(e){return this.throwIfDisposed(),IBe(this,e)},vDe.prototype.sub=function(e){return this.throwIfDisposed(),eOe(this,e)},vDe.prototype.sum=function(e,t){return this.throwIfDisposed(),iLe(this,e,t)};var SWe=BDe({tan_:function(e){var t={x:zDe(e,"x","tan")};return RDe.runKernel("Tan",t)}});vDe.prototype.tan=function(){return this.throwIfDisposed(),SWe(this)};var NWe=BDe({tanh_:function(e){var t={x:zDe(e,"x","tanh")};return RDe.runKernel(OFe,t)}});vDe.prototype.tanh=function(){return this.throwIfDisposed(),NWe(this)},vDe.prototype.tile=function(e){return this.throwIfDisposed(),dLe(this,e)},vDe.prototype.toBool=function(){return this.throwIfDisposed(),CMe(this,"bool")},vDe.prototype.toFloat=function(){return this.throwIfDisposed(),CMe(this,"float32")},vDe.prototype.toInt=function(){return this.throwIfDisposed(),CMe(this,"int32")};var TWe=BDe({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=zDe(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=C(RDe.runKernel("TopK",i,o),2);return{values:s[0],indices:s[1]}}});vDe.prototype.topk=function(e,t){return this.throwIfDisposed(),TWe(this,e,t)},vDe.prototype.transpose=function(e){return this.throwIfDisposed(),yLe(this,e)};var CWe,EWe,_We=BDe({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=zDe(e,"x","unique","string_or_numeric");WAe(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=C(RDe.runKernel("Unique",r,a),2);return{values:i[0],indices:i[1]}}});vDe.prototype.unique=function(e){return this.throwIfDisposed(),_We(this,e)},vDe.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Wze(this,e,t)},vDe.prototype.unstack=function(e){return this.throwIfDisposed(),rOe(this,e)},vDe.prototype.where=function(e,t){return this.throwIfDisposed(),YOe(e,this,t)},vDe.prototype.zerosLike=function(){return this.throwIfDisposed(),uOe(this)},function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(CWe||(CWe={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(EWe||(EWe={}));var AWe={};function RWe(e){return AWe[e]}function FWe(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return DWe(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return DWe(e,n,r,a)}));var u=DWe(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:tRe(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function DWe(e,t,n,r){var a=C(LWe(e),2),i=a[0],o=a[1];if(null!=r){var s=r.getHashTableHandleByName(i);if(null!=s)return s}var u=n.currentContextIds.find((function(e){return!!t[OWe(i,e)]}));return void 0!==u?t[OWe(i,u)][o]:void 0}function MWe(e,t){var n=C(LWe(e),2),r=n[0],a=n[1];return[OWe(r,t&&t.currentContextId),a]}function OWe(e,t){return t?"".concat(e,"-").concat(t):e}function LWe(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function zWe(e,t,n){var r=FWe("pad",e,t,n);if("explicit"===r){r=FWe("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function PWe(e){return e.kept?e:EMe(e)}var BWe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],WWe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],VWe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],UWe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number"}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],GWe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],HWe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],jWe=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],qWe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],KWe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}],XWe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],YWe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],JWe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],QWe=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],ZWe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],$We=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],eVe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],tVe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}],nVe=function(){function e(){var n;xe(this,e);var b=[t,r,a,i,o,s,u,h,p,c,d,f,m,v,g,y,l],x=(n=[]).concat.apply(n,Ie(b.map((function(e){return e.json}))));this.opMappers=x.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return we(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):null!=n.input&&0!==n.input.length||o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var h=Object.keys(s);h.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e){var n=C(MWe(e),1)[0];t.inputs.push(s[n]),s[n].children.push(t)}))})),0===Object.keys(p).length?h.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=C(MWe(e),1)[0],n=s[t];null!=n&&(n.signatureKey=p[e],c.push(n))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=C(MWe(e),1)[0],n=s[t];n&&(n.signatureKey=l[e],u.push(n))})):u=a;var d={};null!=e.library&&null!=e.library.function&&(d=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var f={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:d};return o.length>0&&(f.initNodes=o),f}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=RWe(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=aVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=aVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=fVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=fVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=oVe(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=oVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=dVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=dVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=iVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=iVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=vVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=vVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=hVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=hVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=mVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=mVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=cVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=cVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=lVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=lVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=uVe(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=uVe(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=C(MWe(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:sVe(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=C(MWe(e),1)[0];t.inputs.push(a[n]),a[n].children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=C(MWe(s[e.name]),2),n=t[0],r=t[1],i=a[n];null!=i&&(i.defaultOutput=r,o.push(i))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function rVe(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=uRe().global;if("undefined"!==typeof t.atob)return t.atob(e);if("undefined"!==typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function aVe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?rVe(a.s,r):n}function iVe(e,t,n){var r=e[t];return r?r.b:n}function oVe(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"===typeof a?a:parseInt(a,10)}function sVe(e){switch("string"===typeof e&&(e=CWe[e]),e){case CWe.DT_FLOAT:return"float32";case CWe.DT_INT32:case CWe.DT_INT64:case CWe.DT_INT8:case CWe.DT_UINT8:return"int32";case CWe.DT_BOOL:return"bool";case CWe.DT_DOUBLE:return"float32";case CWe.DT_STRING:return"string";default:return null}}function uVe(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function cVe(e,t,n){var r=e[t];return r&&r.type?sVe(r.type):n}function lVe(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return sVe(e)})):n}function pVe(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"===typeof e.size?e.size:parseInt(e.size,10)})):[]}function hVe(e,t,n){var r=e[t];return r&&r.shape?pVe(r.shape):n}function dVe(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"===typeof e?e:parseInt(e,10)})):n}function fVe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return rVe(e,r)})):n}function mVe(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return pVe(e)})):n}function vVe(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var gVe=function(){function e(t,n,r){var a=this;xe(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return we(e,[{key:"getInput",value:function(e){return DWe(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return DWe(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return oVe(this.node.rawAttrs,e,t);if(null!=n.s)return aVe(this.node.rawAttrs,e,t);if(null!=n.b)return iVe(this.node.rawAttrs,e,t);if(null!=n.shape)return hVe(this.node.rawAttrs,e,t);if(null!=n.type)return cVe(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return dVe(this.node.rawAttrs,e,t);if(null!=n.list.s)return fVe(this.node.rawAttrs,e,t);if(null!=n.list.shape)return mVe(this.node.rawAttrs,e,t);if(null!=n.list.b)return vVe(this.node.rawAttrs,e,t);if(null!=n.list.type)return lVe(this.node.rawAttrs,e,t)}return t}}]),e}();var yVe=BDe({addN_:function(e){WAe(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),WAe(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(e.length)}));var t=e.map((function(e,t){return zDe(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!jAe(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return RDe.runKernel(vRe,r)}});function bVe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";WAe(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}var xVe=function(){function e(t,n,r,a,i,o,s){xe(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=JMe(0),pLe(this.idTensor)}return we(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),bVe(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,pLe(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return UDe([],[0].concat(this.elementShape));var r=this.readMany(e);return bVe(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),$Me(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return UDe([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return bVe(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),HMe(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Ie(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,rOe(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var i=0===r?0:t.size/r,o=[];lLe((function(){t=YMe(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=YMe(ZMe(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),kVe=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;xe(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));bVe(n,e.shape,"TensorList shape mismatch: "),pLe(e)})),this.idTensor=JMe(0),this.maxNumElements=a,pLe(this.idTensor)}return we(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(Ie(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));return bVe(e,this.elementShape,"TensorList shape mismatch: "),lLe((function(){var t=n.tensors.map((function(t){return YMe(t,e)}));return $Me(t,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=this.tensors.pop();return bVe(n.shape,e,"TensorList shape mismatch: "),YMe(n,e)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(bVe(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");pLe(e),this.tensors.push(e)}},{key:"resize",value:function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));return bVe(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));bVe(this.elementShape,t.shape,"TensorList shape mismatch: "),pLe(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));return bVe(this.elementShape,n,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?UDe([],[0].concat(this.elementShape)):lLe((function(){var t=e.map((function(e){return YMe(r.tensors[e],n)}));return $Me(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));return bVe(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?UDe([],[0].concat(this.elementShape)):lLe((function(){var e=n.tensors.map((function(e){return YMe(e,t)}));return HMe(e,0)}))}}]),e}();function wVe(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));bVe(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=rOe(e);return new kVe(a,t,r)}function IVe(e,t,n){return new kVe([],e,t,n)}function SVe(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,Ie(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new kVe([],n,e.dtype,r),o=rOe(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function NVe(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=0===r?0:e.size/r,o=lLe((function(){var o=[];e=YMe(e,[1,r,i]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],i];o[s]=YMe(ZMe(e,u,c),n)}return e.dispose(),o})),s=new kVe([],n,e.dtype,t.length),u=0;u<o.length;u++)s.setItem(u,o[u]);return s}var TVe=function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E,_,A,R,F,D,M,O,L,z,P,B,W,V,U,G,H,j,q,K,X,Y,J,Q,Z,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,he,de,fe,me,ve,ge,ye,be,xe,ke,we,Ie,Se,Ne,Te,Ce,Ee,_e,Ae,Re,Fe,De,Me,Oe,Le,ze,Pe,Be,We,Ve,Ue,Ge,He,je,qe,Ke,Xe,Ye,Je,Qe,Ze,$e;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?15:"LoopCond"===e.t0?33:"Switch"===e.t0?35:"Merge"===e.t0?46:"Enter"===e.t0?51:"Exit"===e.t0?55:"NextIteration"===e.t0?58:"TensorArrayV3"===e.t0?61:"TensorArrayWriteV3"===e.t0?71:"TensorArrayReadV3"===e.t0?77:"TensorArrayGatherV3"===e.t0?81:"TensorArrayScatterV3"===e.t0?86:"TensorArrayConcatV3"===e.t0?92:"TensorArraySplitV3"===e.t0?96:"TensorArraySizeV3"===e.t0?102:"TensorArrayCloseV3"===e.t0?105:"TensorListSetItem"===e.t0?109:"TensorListGetItem"===e.t0?115:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?121:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?128:"TensorListGather"===e.t0?135:"TensorListStack"===e.t0?141:"TensorListFromTensor"===e.t0?147:"TensorListConcat"===e.t0?153:"TensorListPushBack"===e.t0?158:"TensorListPopBack"===e.t0?163:"TensorListSplit"===e.t0?168:174;break;case 3:return a=FWe("thenBranch",t,n,r),i=FWe("elseBranch",t,n,r),o=FWe("cond",t,n,r),s=FWe("args",t,n,r),e.next=9,o.data();case 9:if(!e.sent[0]){e.next=14;break}return e.abrupt("return",r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 14:return e.abrupt("return",r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap));case 15:return u=FWe("body",t,n,r),c=FWe("cond",t,n,r),l=FWe("args",t,n,r),e.next=20,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 20:return p=e.sent,h=l.map((function(e){return e.id})),e.next=24,p[0].data();case 24:d=e.sent,p.forEach((function(e){e.kept||-1!==h.indexOf(e.id)||e.dispose()})),f=l,m=w().mark((function e(){var t,n,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f,e.next=3,r.functionMap[u].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 3:return f=e.sent,n=f.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==h.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(f,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:d=e.sent,a.forEach((function(e){e.kept||-1!==h.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 28:if(!d[0]){e.next=32;break}return e.delegateYield(m(),"t1",30);case 30:e.next=28;break;case 32:return e.abrupt("return",f);case 33:return v=FWe("pred",t,n,r),e.abrupt("return",[PWe(v)]);case 35:return g=FWe("pred",t,n,r),(y=FWe("data",t,n,r)).kept||(y=PWe(y)),e.next=40,g.data();case 40:if(!e.sent[0]){e.next=44;break}e.t2=[void 0,y],e.next=45;break;case 44:e.t2=[y,void 0];case 45:return e.abrupt("return",e.t2);case 46:if(b=t.inputNames.find((function(e){return void 0!==DWe(e,n,r)})),!b){e.next=50;break}return x=DWe(b,n,r),e.abrupt("return",[PWe(x)]);case 50:return e.abrupt("return",void 0);case 51:return k=FWe("frameName",t,n,r),I=FWe("tensor",t,n,r),r.enterFrame(k),e.abrupt("return",[PWe(I)]);case 55:return S=FWe("tensor",t,n,r),r.exitFrame(),e.abrupt("return",[PWe(S)]);case 58:return N=FWe("tensor",t,n,r),r.nextIteration(),e.abrupt("return",[PWe(N)]);case 61:return T=FWe("size",t,n,r),C=FWe("dtype",t,n,r),E=FWe("elementShape",t,n,r),_=FWe("dynamicSize",t,n,r),A=FWe("clearAfterRead",t,n,r),R=FWe("identicalElementShapes",t,n,r),F=FWe("name",t,n,r),D=new xVe(F,C,T,E,R,_,A),r.addTensorArray(D),e.abrupt("return",[D.idTensor,JMe(1)]);case 71:return M=FWe("tensorArrayId",t,n,r),O=FWe("index",t,n,r),L=FWe("tensor",t,n,r),(z=r.getTensorArray(M.id)).write(O,L),e.abrupt("return",[z.idTensor]);case 77:return P=FWe("tensorArrayId",t,n,r),B=FWe("index",t,n,r),W=r.getTensorArray(P.id),e.abrupt("return",[W.read(B)]);case 81:return V=FWe("tensorArrayId",t,n,r),U=FWe("indices",t,n,r),G=FWe("dtype",t,n,r),H=r.getTensorArray(V.id),e.abrupt("return",[H.gather(U,G)]);case 86:return j=FWe("tensorArrayId",t,n,r),q=FWe("indices",t,n,r),K=FWe("tensor",t,n,r),(X=r.getTensorArray(j.id)).scatter(q,K),e.abrupt("return",[X.idTensor]);case 92:return Y=FWe("tensorArrayId",t,n,r),J=r.getTensorArray(Y.id),Q=FWe("dtype",t,n,r),e.abrupt("return",[J.concat(Q)]);case 96:return Z=FWe("tensorArrayId",t,n,r),$=FWe("tensor",t,n,r),ee=FWe("lengths",t,n,r),(te=r.getTensorArray(Z.id)).split(ee,$),e.abrupt("return",[te.idTensor]);case 102:return ne=FWe("tensorArrayId",t,n,r),re=r.getTensorArray(ne.id),e.abrupt("return",[JMe(re.size(),"int32")]);case 105:return ae=FWe("tensorArrayId",t,n,r),(ie=r.getTensorArray(ae.id)).clearAndClose(),e.abrupt("return",[ie.idTensor]);case 109:return oe=FWe("tensorListId",t,n,r),se=FWe("index",t,n,r),ue=FWe("tensor",t,n,r),(ce=r.getTensorList(oe.id)).setItem(se,ue),e.abrupt("return",[ce.idTensor]);case 115:return le=FWe("tensorListId",t,n,r),pe=FWe("index",t,n,r),he=FWe("elementShape",t,n,r),de=FWe("elementDType",t,n,r),fe=r.getTensorList(le.id),e.abrupt("return",[fe.getItem(pe,he,de)]);case 121:return me=FWe("indices",t,n,r),ve=FWe("tensor",t,n,r),ge=FWe("elementShape",t,n,r),ye=FWe("numElements",t,n,r),be=SVe(ve,me,ge,ye),r.addTensorList(be),e.abrupt("return",[be.idTensor]);case 128:return xe=FWe("elementShape",t,n,r),ke=FWe("elementDType",t,n,r),we="TensorListReserve"===t.op?"numElements":"maxNumElements",Ie=FWe(we,t,n,r),Se=IVe(xe,ke,Ie),r.addTensorList(Se),e.abrupt("return",[Se.idTensor]);case 135:return Ne=FWe("tensorListId",t,n,r),Te=FWe("indices",t,n,r),Ce=FWe("elementShape",t,n,r),Ee=FWe("elementDType",t,n,r),_e=r.getTensorList(Ne.id),e.abrupt("return",[_e.gather(Te,Ee,Ce)]);case 141:return Ae=FWe("tensorListId",t,n,r),Re=FWe("elementShape",t,n,r),Fe=FWe("elementDType",t,n,r),De=FWe("numElements",t,n,r),Me=r.getTensorList(Ae.id),e.abrupt("return",[Me.stack(Re,Fe,De)]);case 147:return Oe=FWe("tensor",t,n,r),Le=FWe("elementShape",t,n,r),ze=FWe("elementDType",t,n,r),Pe=wVe(Oe,Le,ze),r.addTensorList(Pe),e.abrupt("return",[Pe.idTensor]);case 153:return Be=FWe("tensorListId",t,n,r),We=r.getTensorList(Be.id),Ve=FWe("dtype",t,n,r),Ue=FWe("elementShape",t,n,r),e.abrupt("return",[We.concat(Ve,Ue)]);case 158:return Ge=FWe("tensorListId",t,n,r),He=FWe("tensor",t,n,r),(je=r.getTensorList(Ge.id)).pushBack(He),e.abrupt("return",[je.idTensor]);case 163:return qe=FWe("tensorListId",t,n,r),Ke=FWe("elementShape",t,n,r),Xe=FWe("elementDType",t,n,r),Ye=r.getTensorList(qe.id),e.abrupt("return",[Ye.popBack(Ke,Xe)]);case 168:return Je=FWe("tensor",t,n,r),Qe=FWe("elementShape",t,n,r),Ze=FWe("lengths",t,n,r),$e=NVe(Je,Ze,Qe),r.addTensorList($e),e.abrupt("return",[$e.idTensor]);case 174:throw TypeError("Node type ".concat(t.op," is not implemented"));case 175:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function CVe(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return XMe(e,MLe(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function EVe(e,t){var n=t,r=UOe(e.shape,t.shape);return r.length>0&&(n=iLe(n,r)),YMe(n,e.shape)}function _Ve(e,t,n,r){if("linear"===t)return e;if("relu"===t)return NLe(e);if("elu"===t)return HBe(e);if("relu6"===t)return gWe(e);if("prelu"===t)return fWe(e,n);if("leakyrelu"===t)return nWe(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}var AVe=function(e,t){return!(e>0)||"linear"===t};var RVe=BDe({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,p=e.activation,h=void 0===p?"linear":p,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(h=h||"linear",!1===AVe(RDe.state.gradientDepth,h)){var m=vze(t,n,r,a,o,u,c);return null!=l&&(m=GMe(m,l)),_Ve(m,h,d,f)}var v=zDe(t,"x","conv2d"),g=zDe(n,"filter","conv2d"),y=v,b=!1;3===v.rank&&(b=!0,y=YMe(v,[1,v.shape[0],v.shape[1],v.shape[2]])),WAe(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(y.rank,".")})),WAe(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(g.rank,".")})),null!=c&&WAe(qAe(a),(function(){return"Error in fused conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(c," but got pad ").concat(a,".")})),WAe(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input (".concat(y.shape[3],") must match ")+"input depth for filter ".concat(g.shape[2],".")})),WAe($Le(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")})),WAe("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var x,k,w=KLe(y.shape,g.shape,r,u,a,c);null!=l&&(x=C(NDe(x=zDe(l,"bias","fused conv2d"),v),1)[0],GOe(w.outShape,x.shape)),null!=d&&(k=zDe(d,"prelu weights","fused conv2d"));var I=function(e,t){var n=C(t,4),i=n[0],o=n[1],s=n[2],c=n[3],l=CVe(e,s,h);WAe(ZLe(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var p=[fze(o.shape,l,i,r,a),dze(o,l,i.shape,r,a)];if(null!=c){var d=EVe(c,l);p.push(d)}return p},S={x:y,filter:g,bias:x,preluActivationWeights:k},N={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:h,leakyreluAlpha:f};if(null==l){var T=RLe((function(e,t,n){var r=RDe.runKernel(HFe,S,N);return n([t,e,r]),b&&(r=YMe(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:I}}));return T(y,g)}var E=RLe((function(e,t,n,r){var a=RDe.runKernel(HFe,S,N);return r([t,e,a,n]),b&&(a=YMe(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:I}}));return E(y,g,x)}});var FVe=BDe({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,p=e.activation,h=void 0===p?"linear":p,d=e.preluActivationWeights,f=e.leakyreluAlpha;if(!1===AVe(RDe.state.gradientDepth,h)){var m=WBe(t,n,r,a,o,u,c);return null!=l&&(m=GMe(m,l)),_Ve(m,h,d,f)}var v=zDe(t,"x","depthwiseConv2d"),g=zDe(n,"filter","depthwiseConv2d"),y=v,b=!1;3===v.rank&&(b=!0,y=YMe(v,[1,v.shape[0],v.shape[1],v.shape[2]])),WAe(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(y.rank,".")})),WAe(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(g.rank,".")})),WAe(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(y.shape[3],") must match the inChannels dimension in ")+"filter ".concat(g.shape[2],".")})),null==u&&(u=[1,1]),WAe($Le(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),null!=c&&WAe(qAe(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when "+"using dimRoundingMode ".concat(c," but got pad ").concat(a,".")}));var x,k,w=KLe(y.shape,g.shape,r,u,a,c,!0);if(null!=l){var I=C(NDe(x=zDe(l,"bias","fused conv2d"),v),1);x=I[0],GOe(w.outShape,x.shape)}null!=d&&(k=zDe(d,"prelu weights","fused depthwiseConv2d"));var S=function(e,t){WAe(ZLe(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var n=C(t,4),i=n[0],o=n[1],s=n[2],l=n[3],p=CVe(e,s,h),d=Eze(o.shape,p,i,r,a,u,c),f=Cze(o,p,i.shape,r,a,u,c);return null!=l?[d,f,EVe(x,p)]:[d,f]},N={x:y,filter:g,bias:x,preluActivationWeights:k},T={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:h,leakyreluAlpha:f};if(null==l){var E=RLe((function(e,t,n){var r=RDe.runKernel(jFe,N,T);return n([t,e,r]),b&&(r=YMe(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:S}}));return E(y,g)}var _=RLe((function(e,t,n,r){var a=RDe.runKernel(jFe,N,T);return r([t,e,a,n]),b&&(a=YMe(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:S}}));return _(y,g,x)}});var DVe=BDe({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,p=e.leakyreluAlpha;if(!1===AVe(RDe.state.gradientDepth,c)){var h=vLe(t,n,a,o);return null!=s&&(h=GMe(h,s)),_Ve(h,c,l,p)}var d=zDe(t,"a","fused matMul"),f=zDe(n,"b","fused matMul"),m=C(NDe(d,f),2);d=m[0],f=m[1];var v=a?d.shape[d.rank-2]:d.shape[d.rank-1],g=o?f.shape[f.rank-1]:f.shape[f.rank-2],y=a?d.shape[d.rank-1]:d.shape[d.rank-2],b=o?f.shape[f.rank-2]:f.shape[f.rank-1],x=d.shape.slice(0,-2),k=f.shape.slice(0,-2),w=HAe(x),I=HAe(k);WAe(d.rank>=2&&f.rank>=2&&d.rank===f.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at "+"least 2, got ranks ".concat(d.rank," and ").concat(f.rank,".")})),WAe(jAe(x,k),(function(){return"Error in fused matMul: outer dimensions (".concat(x,") and (")+"".concat(k,") of Tensors with shapes ").concat(d.shape," and ")+"".concat(f.shape," must match.")})),WAe(v===g,(function(){return"Error in fused matMul: inner shapes (".concat(v,") and (")+"".concat(g,") of Tensors with shapes ").concat(d.shape," and ")+"".concat(f.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var S,N,T=d.shape.slice(0,-2).concat([y,b]),E=YMe(d,a?[w,v,y]:[w,y,v]),_=YMe(f,o?[I,b,g]:[I,g,b]);null!=s&&(S=C(NDe(S=zDe(s,"bias","fused matMul"),d),1)[0],GOe(T,S.shape)),null!=l&&(N=zDe(l,"prelu weights","fused matMul"));var A=function(e,t){var n,r,i=C(t,4),u=i[0],l=i[1],p=i[2],h=i[3],d=CVe(YMe(e,p.shape),p,c);return a||o?!a&&o?(n=vLe(d,l,!1,!1),r=vLe(d,u,!0,!1)):a&&!o?(n=vLe(l,d,!1,!0),r=vLe(u,d,!1,!1)):(n=vLe(l,d,!0,!0),r=vLe(d,u,!0,!0)):(n=vLe(d,l,!1,!0),r=vLe(u,d,!0,!1)),null!=s?[n,r,EVe(h,d)]:[n,r]},R={a:E,b:_,bias:S,preluActivationWeights:N},F={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:p};if(null==s){var D=RLe((function(e,t,n){var r=RDe.runKernel(GFe,R,F);return n([e,t,r]),{value:YMe(r,T),gradFunc:A}}));return D(E,_)}var M=RLe((function(e,t,n,r){var a=RDe.runKernel(GFe,R,F);return r([e,t,a,n]),{value:YMe(a,T),gradFunc:A}}));return M(E,_,S)}});var MVe=BDe({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=zDe(e,"x","conv3d"),s=zDe(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=YMe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),WAe(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),WAe(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),WAe(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),WAe($Le(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),WAe("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},h=RDe.runKernel(ORe,l,p);return c?YMe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var OVe=BDe({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:zDe(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=RDe.runKernel("MaxPoolWithArgmax",i,o);return{result:s[0],indexes:s[1]}}});var LVe=BDe({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:cLe("dilations is deprecated, this field will be gone in v3.0.0.");var s=zDe(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),WAe(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),WAe("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),WAe($Le(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&WAe(qAe(r),(function(){return"Error in avgPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:u},p={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o},h=RDe.runKernel(NRe,l,p);return h=CMe(h,u.dtype),c?YMe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var zVe=BDe({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:cLe("dilations is deprecated, this field will be gone in v3.0.0.");var s=zDe(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=YMe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),WAe(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),WAe("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),WAe($Le(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&WAe(qAe(r),(function(){return"Error in maxPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:u},p={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o},h=RDe.runKernel(rFe,l,p);return c?YMe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});function PVe(e,t,n){var r=C(FWe("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u="fusedbatchnorm"===a,c=FWe("numArgs",e,t,n);if(o){if(s&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var l=FWe("strides",e,t,n),p=zWe(e,t,n),h=FWe("dataFormat",e,t,n).toUpperCase(),d=FWe("dilations",e,t,n),f=C(FWe("args",e,t,n),2);return{stride:l,pad:p,dataFormat:h,dilations:d,biasArg:f[0],preluArg:f[1],activationFunc:i,leakyreluAlpha:FWe("leakyreluAlpha",e,t,n)}}function BVe(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return RDe.runKernel("LinSpace",{},r)}var WVe=BDe({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=zDe(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?YMe(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=RDe.runKernel("Multinomial",s,u);return 1===o?YMe(c,[c.size]):c}}),VVe=n(282),UVe=function(){function e(t,n,r,a,i){xe(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=VVe.alea(o.toString())}return we(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),GVe=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(xe(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=VVe.alea(i)}return we(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var HVe=BDe({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>4?arguments[4]:void 0,a=TMe(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),i=new GVe(t,n,null,r),o=0;o<a.values.length;o++)a.values[o]=i.nextValue();return a.toTensor()}});var jVe=BDe({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new UVe(t,n,r,!0,a),o=TMe(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});function qVe(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=TMe(e,"int32"),i=TMe([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function KVe(){return(KVe=S(w().mark((function e(t){var n,r,a;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=zDe(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=qVe(n.shape,r),t!==n&&n.dispose(),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var XVe=function(e){return KVe.apply(this,arguments)};function YVe(){return YVe=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=zDe(t,"x","setdiff1d"),a=zDe(n,"y","setdiff1d"),WAe(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),WAe(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),WAe(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=7,r.data();case 7:return i=e.sent,e.next=10,a.data();case 10:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new dDe([u],r.dtype),p=new dDe([u],"int32"),h=0,d=0;h<i.length;h++)s.has(i[h])||(l.values[d]=i[h],p.values[d]=h,d++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 18:case"end":return e.stop()}}),e)}))),YVe.apply(this,arguments)}var JVe=function(e,t){return YVe.apply(this,arguments)};function QVe(e,t,n){return{boxes:FWe("boxes",e,t,n),scores:FWe("scores",e,t,n),maxOutputSize:FWe("maxOutputSize",e,t,n),iouThreshold:FWe("iouThreshold",e,t,n),scoreThreshold:FWe("scoreThreshold",e,t,n),softNmsSigma:FWe("softNmsSigma",e,t,n)}}var ZVe=function(){var e=S(w().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I,S,N,T,C,E;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?3:"NonMaxSuppressionV4"===e.t0?8:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?14:"Where"===e.t0?19:"ListDiff"===e.t0?26:27;break;case 3:return a=QVe(t,n,r),i=a.boxes,o=a.scores,s=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,l=a.softNmsSigma,e.next=6,DLe.nonMaxSuppressionWithScoreAsync(i,o,s,u,c,l);case 6:return p=e.sent,e.abrupt("return",[p.selectedIndices,p.selectedScores]);case 8:return h=QVe(t,n,r),d=h.boxes,f=h.scores,m=h.maxOutputSize,v=h.iouThreshold,g=h.scoreThreshold,y=FWe("padToMaxOutputSize",t,n,r),e.next=12,DLe.nonMaxSuppressionPaddedAsync(d,f,m,v,g,y);case 12:return b=e.sent,e.abrupt("return",[b.selectedIndices,b.validOutputs]);case 14:return x=QVe(t,n,r),k=x.boxes,I=x.scores,S=x.maxOutputSize,N=x.iouThreshold,T=x.scoreThreshold,e.next=17,DLe.nonMaxSuppressionAsync(k,I,S,N,T);case 17:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 19:return C=CMe(FWe("condition",t,n,r),"bool"),e.next=22,XVe(C);case 22:return e.t2=e.sent,E=[e.t2],C.dispose(),e.abrupt("return",E);case 26:return e.abrupt("return",JVe(FWe("x",t,n,r),FWe("y",t,n,r)));case 27:throw TypeError("Node type ".concat(t.op," is not implemented"));case 28:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),$Ve=function(){function e(t,n){xe(this,e),this.keyDType=t,this.valueDType=n,this.handle=JMe(0),this.tensorMap=new Map,pLe(this.handle)}return we(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"import",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),e.abrupt("return",lLe((function(){var e=rOe(n),t=r.length,i=e.length;WAe(t===i,(function(){return"The number of elements doesn't match, keys has "+"".concat(t," elements, the values has ").concat(i," ")+"elements."}));for(var o=0;o<t;o++){var s=r[o],u=e[o];pLe(u),a.tensorMap.set(s,u)}return a.handle})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=S(w().mark((function e(t,n){var r,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",lLe((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return $Me(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))}}]),e}(),eUe=function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f,m;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?16:24;break;case 3:return i=FWe("keyDType",t,n,r),o=FWe("valueDType",t,n,r),s=new $Ve(i,o),a.addHashTable(t.name,s),e.abrupt("return",[s.handle]);case 8:return u=FWe("tableHandle",t,n,r,a),c=FWe("keys",t,n,r),l=FWe("values",t,n,r),p=a.getHashTableById(u.id),e.next=14,p.import(c,l);case 14:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 16:return h=FWe("tableHandle",t,n,r,a),d=FWe("keys",t,n,r),f=FWe("defaultValue",t,n,r),m=a.getHashTableById(h.id),e.next=22,m.find(d,f);case 22:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 24:throw TypeError("Node type ".concat(t.op," is not implemented"));case 25:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}();var tUe=BDe({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=zDe(e,"sparseIndices","sparseToDense","int32"),i=zDe(t,"sparseValues","sparseToDense"),o=zDe(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape "+"".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return RDe.runKernel("SparseToDense",s,u)}});var nUe=BDe({bincount_:function(e,t,n){var r=zDe(e,"x","bincount"),a=zDe(t,"weights","bincount");WAe("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),WAe(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),WAe(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return RDe.runKernel("Bincount",i,o)}});var rUe=BDe({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=zDe(e,"x","denseBincount"),i=zDe(t,"weights","denseBincount");WAe("int32"===a.dtype,(function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)})),WAe(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")})),WAe(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),WAe(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return RDe.runKernel("DenseBincount",o,s)}});function aUe(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}!function(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(n.shape)+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}(n,t,e)}var iUe=BDe({scatterND_:function(e,t,n){var r=zDe(e,"indices","scatterND","int32"),a=zDe(t,"updates","scatterND");aUe(a,r,n);var i={indices:r,updates:a},o={shape:n};return RDe.runKernel("ScatterNd",i,o)}});var oUe=BDe({gatherND_:function(e,t){var n=zDe(t,"indices","gatherND","int32"),r={params:zDe(e,"x","gatherND"),indices:n};return RDe.runKernel("GatherNd",r)}});function sUe(e,t,n,r){var a=function(e,t,n){switch(e.category){case"arithmetic":return lLe((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[GMe(FWe("a",e,t,n),FWe("b",e,t,n))];case"AddN":return[yVe(FWe("tensors",e,t,n))];case"FloorMod":case"Mod":return[fBe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Mul":return[XMe(FWe("a",e,t,n),FWe("b",e,t,n))];case"RealDiv":case"Div":return[KMe(FWe("a",e,t,n),FWe("b",e,t,n))];case"DivNoNan":return[UBe(FWe("a",e,t,n),FWe("b",e,t,n))];case"FloorDiv":return[qMe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Sub":return[eOe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Minimum":return[TLe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Maximum":return[uBe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Pow":return[nLe(FWe("a",e,t,n),FWe("b",e,t,n))];case"SquaredDifference":return[ELe(FWe("a",e,t,n),FWe("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return lLe((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[JOe(FWe("x",e,t,n))];case"Acos":return[hBe(FWe("x",e,t,n))];case"Acosh":return[dBe(FWe("x",e,t,n))];case"Asin":return[EBe(FWe("x",e,t,n))];case"Asinh":return[_Be(FWe("x",e,t,n))];case"Atan":return[ABe(FWe("x",e,t,n))];case"Atan2":return[RBe(FWe("x",e,t,n),FWe("y",e,t,n))];case"Atanh":return[FBe(FWe("x",e,t,n))];case"Ceil":return[OBe(FWe("x",e,t,n))];case"Complex":return[WDe(FWe("real",e,t,n),FWe("imag",e,t,n))];case"Cos":return[BPe(FWe("x",e,t,n))];case"Cosh":return[VPe(FWe("x",e,t,n))];case"Elu":return[HBe(FWe("x",e,t,n))];case"Erf":return[QBe(FWe("x",e,t,n))];case"Exp":return[_Le(FWe("x",e,t,n))];case"Expm1":return[ZBe(FWe("x",e,t,n))];case"Floor":return[fPe(FWe("x",e,t,n))];case"Log":return[CLe(FWe("x",e,t,n))];case"Log1p":return[ALe(FWe("x",e,t,n))];case"Imag":return[aOe(FWe("x",e,t,n))];case"Neg":return[gLe(FWe("x",e,t,n))];case"Reciprocal":return[vWe(FWe("x",e,t,n))];case"Real":return[iOe(FWe("x",e,t,n))];case"Relu":return[NLe(FWe("x",e,t,n))];case"Round":return[yWe(FWe("x",e,t,n))];case"Selu":return[bWe(FWe("x",e,t,n))];case"Sigmoid":return[QMe(FWe("x",e,t,n))];case"Sin":return[kze(FWe("x",e,t,n))];case"Sign":return[kWe(FWe("x",e,t,n))];case"Sinh":return[Ize(FWe("x",e,t,n))];case"Softplus":return[aWe(FWe("x",e,t,n))];case"Sqrt":return[rLe(FWe("x",e,t,n))];case"Square":return[aLe(FWe("x",e,t,n))];case"Tanh":return[NWe(FWe("x",e,t,n))];case"Tan":return[SWe(FWe("x",e,t,n))];case"ClipByValue":return[LBe(FWe("x",e,t,n),FWe("clipValueMin",e,t,n),FWe("clipValueMax",e,t,n))];case"Relu6":return[gWe(FWe("x",e,t,n))];case"Rsqrt":return[Pze(DWe(e.inputNames[0],t,n))];case"Prod":return[mWe(FWe("x",e,t,n),FWe("axes",e,t,n))];case"LeakyRelu":return[nWe(FWe("x",e,t,n),FWe("alpha",e,t,n))];case"Prelu":return[fWe(FWe("x",e,t,n),FWe("alpha",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return TVe(e,t,n);case"convolution":return lLe((function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=FWe("stride",e,t,n),a=FWe("pad",e,t,n),i=FWe("dataFormat",e,t,n).toUpperCase(),o=FWe("dilation",e,t,n);return[zBe(FWe("x",e,t,n),FWe("filter",e,t,n),r,a,i,o)];case"Conv2D":var s=FWe("strides",e,t,n),u=zWe(e,t,n),c=FWe("dataFormat",e,t,n).toUpperCase(),l=FWe("dilations",e,t,n);return[vze(FWe("x",e,t,n),FWe("filter",e,t,n),[s[1],s[2]],u,c,[l[1],l[2]])];case"_FusedConv2D":var p=PVe(e,t,n),h=p.stride,d=p.pad,f=p.dataFormat,m=p.dilations,v=p.biasArg,g=p.preluArg,y=p.activationFunc,b=p.leakyreluAlpha;return[RVe({x:FWe("x",e,t,n),filter:FWe("filter",e,t,n),strides:[h[1],h[2]],pad:d,dataFormat:f,dilations:[m[1],m[2]],bias:v,activation:y,preluActivationWeights:g,leakyreluAlpha:b})];case"FusedDepthwiseConv2dNative":var x=PVe(e,t,n),k=x.stride,w=x.pad,I=x.dataFormat,S=x.dilations,N=x.biasArg,T=x.preluArg,C=x.activationFunc,E=x.leakyreluAlpha;return[FVe({x:FWe("x",e,t,n),filter:FWe("filter",e,t,n),strides:[k[1],k[2]],pad:w,dataFormat:I,dilations:[S[1],S[2]],bias:N,activation:C,preluActivationWeights:T,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var _=FWe("outputShape",e,t,n),A=FWe("strides",e,t,n),R=zWe(e,t,n);return[PBe(FWe("x",e,t,n),FWe("filter",e,t,n),_,[A[1],A[2]],R)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var F=FWe("strides",e,t,n),D=zWe(e,t,n),M=FWe("dilations",e,t,n),O=FWe("dataFormat",e,t,n).toUpperCase();return[WBe(FWe("input",e,t,n),FWe("filter",e,t,n),[F[1],F[2]],D,O,[M[1],M[2]])];case"Conv3D":var L=FWe("strides",e,t,n),z=FWe("pad",e,t,n),P=FWe("dataFormat",e,t,n).toUpperCase(),B=FWe("dilations",e,t,n);return[MVe(FWe("x",e,t,n),FWe("filter",e,t,n),[L[1],L[2],L[3]],z,P,[B[1],B[2],B[3]])];case"AvgPool":var W=FWe("strides",e,t,n),V=FWe("pad",e,t,n),U=FWe("kernelSize",e,t,n);return[DBe(FWe("x",e,t,n),[U[1],U[2]],[W[1],W[2]],V)];case"MaxPool":var G=FWe("strides",e,t,n),H=FWe("pad",e,t,n),j=FWe("kernelSize",e,t,n);return[cWe(FWe("x",e,t,n),[j[1],j[2]],[G[1],G[2]],H)];case"MaxPoolWithArgmax":var q=FWe("strides",e,t,n),K=FWe("pad",e,t,n),X=FWe("kernelSize",e,t,n),Y=FWe("includeBatchInIndex",e,t,n),J=OVe(FWe("x",e,t,n),[X[1],X[2]],[q[1],q[2]],K,Y);return[J.result,J.indexes];case"AvgPool3D":var Q=FWe("strides",e,t,n),Z=FWe("pad",e,t,n),$=FWe("kernelSize",e,t,n);return[LVe(FWe("x",e,t,n),[$[1],$[2],$[3]],[Q[1],Q[2],Q[3]],Z)];case"MaxPool3D":var ee=FWe("strides",e,t,n),te=FWe("pad",e,t,n),ne=FWe("kernelSize",e,t,n);return[zVe(FWe("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"Dilation2D":var re=FWe("strides",e,t,n),ae=FWe("pad",e,t,n),ie=FWe("dilations",e,t,n),oe=re[1],se=re[2],ue=ie[1],ce=ie[2];return[VBe(FWe("x",e,t,n),FWe("filter",e,t,n),[oe,se],ae,[ue,ce],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return lLe((function(){return function(e,t,n){switch(e.op){case"Fill":var r=FWe("shape",e,t,n),a=FWe("dtype",e,t,n);return[vOe(r,FWe("value",e,t,n),a)];case"LinSpace":return[BVe(FWe("start",e,t,n),FWe("stop",e,t,n),FWe("num",e,t,n))];case"Multinomial":var i=FWe("logits",e,t,n),o=FWe("numSamples",e,t,n),s=FWe("seed",e,t,n);return[WVe(i,o,s)];case"OneHot":var u=FWe("indices",e,t,n),c=FWe("depth",e,t,n),l=FWe("onValue",e,t,n),p=FWe("offValue",e,t,n);return[pWe(u,c,l,p)];case"Ones":return[ILe(FWe("shape",e,t,n),FWe("dtype",e,t,n))];case"OnesLike":return[hWe(FWe("x",e,t,n))];case"RandomUniform":return[HVe(FWe("shape",e,t,n),FWe("minval",e,t,n),FWe("maxval",e,t,n),FWe("dtype",e,t,n))];case"Range":return[KOe(FWe("start",e,t,n),FWe("stop",e,t,n),FWe("step",e,t,n),FWe("dtype",e,t,n))];case"TruncatedNormal":var h=FWe("shape",e,t,n),d=FWe("mean",e,t,n),f=FWe("stdDev",e,t,n),m=FWe("seed",e,t,n);return[jVe(h,d,f,FWe("dtype",e,t,n),m)];case"Zeros":return[sOe(FWe("shape",e,t,n),FWe("dtype",e,t,n))];case"ZerosLike":return[uOe(FWe("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return ZVe(e,t,n);case"evaluation":return lLe((function(){return function(e,t,n){switch(e.op){case"TopKV2":var r=FWe("x",e,t,n),a=FWe("k",e,t,n),i=FWe("sorted",e,t,n),o=TWe(r,a,i);return[o.values,o.indices];case"Unique":var s=FWe("x",e,t,n),u=_We(s);return[u.values,u.indices];case"UniqueV2":var c=FWe("x",e,t,n),l=FWe("axis",e,t,n),p=_We(c,l);return[p.values,p.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return lLe((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=FWe("images",e,t,n),a=FWe("size",e,t,n),i=FWe("alignCorners",e,t,n),o=FWe("halfPixelCenters",e,t,n);return[DLe.resizeBilinear(r,[a[0],a[1]],i,o)];case"ResizeNearestNeighbor":var s=FWe("images",e,t,n),u=FWe("size",e,t,n),c=FWe("alignCorners",e,t,n),l=FWe("halfPixelCenters",e,t,n);return[DLe.resizeNearestNeighbor(s,[u[0],u[1]],c,l)];case"CropAndResize":var p=FWe("image",e,t,n),h=FWe("boxes",e,t,n),d=FWe("boxInd",e,t,n),f=FWe("cropSize",e,t,n),m=FWe("method",e,t,n),v=FWe("extrapolationValue",e,t,n);return[DLe.cropAndResize(p,h,d,f,m,v)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return lLe((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=FWe("default",e,t,n);return[DWe(e.name,t,n)||r];case"Placeholder":return[DWe(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[PWe(FWe("x",e,t,n))];case"IdentityN":return FWe("x",e,t,n).map((function(e){return PWe(e)}));case"Shape":return[tOe(FWe("x",e,t,n).shape,"int32")];case"ShapeN":return FWe("x",e,t,n).map((function(e){return tOe(e.shape)}));case"Size":return[JMe(FWe("x",e,t,n).size,"int32")];case"Rank":return[JMe(FWe("x",e,t,n).rank,"int32")];case"NoOp":return[JMe(1)];case"Print":var a=FWe("x",e,t,n),i=FWe("data",e,t,n),o=FWe("message",e,t,n),s=FWe("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return lLe((function(){return function(e,t,n){switch(e.op){case"Equal":return[tPe(FWe("a",e,t,n),FWe("b",e,t,n))];case"NotEqual":return[wLe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Greater":return[mLe(FWe("a",e,t,n),FWe("b",e,t,n))];case"GreaterEqual":return[HOe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Less":return[aPe(FWe("a",e,t,n),FWe("b",e,t,n))];case"LessEqual":return[jOe(FWe("a",e,t,n),FWe("b",e,t,n))];case"LogicalAnd":return[qOe(FWe("a",e,t,n),FWe("b",e,t,n))];case"LogicalNot":return[MPe(FWe("a",e,t,n))];case"LogicalOr":return[sWe(FWe("a",e,t,n),FWe("b",e,t,n))];case"Select":case"SelectV2":return[YOe(FWe("condition",e,t,n),FWe("a",e,t,n),FWe("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return lLe((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[vLe(FWe("a",e,t,n),FWe("b",e,t,n),FWe("transposeA",e,t,n),FWe("transposeB",e,t,n))];case"Transpose":return[yLe(FWe("x",e,t,n),FWe("perm",e,t,n))];case"_FusedMatMul":var r=C(FWe("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u=FWe("numArgs",e,t,n),c=FWe("leakyreluAlpha",e,t,n);if(o){if(s&&2!==u)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==u)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var l=C(FWe("args",e,t,n),2),p=l[0],h=l[1];return[DVe({a:FWe("a",e,t,n),b:FWe("b",e,t,n),transposeA:FWe("transposeA",e,t,n),transposeB:FWe("transposeB",e,t,n),bias:p,activation:i,preluActivationWeights:h,leakyreluAlpha:c})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return lLe((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[MBe(FWe("x",e,t,n),FWe("mean",e,t,n),FWe("variance",e,t,n),FWe("offset",e,t,n),FWe("scale",e,t,n),FWe("epsilon",e,t,n))];case"LRN":return[rWe(FWe("x",e,t,n),FWe("radius",e,t,n),FWe("bias",e,t,n),FWe("alpha",e,t,n),FWe("beta",e,t,n))];case"Softmax":return[wWe(FWe("x",e,t,n))];case"LogSoftmax":return[oWe(FWe("x",e,t,n))];case"SparseToDense":return[tUe(FWe("sparseIndices",e,t,n),FWe("outputShape",e,t,n),FWe("sparseValues",e,t,n),FWe("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return lLe((function(){return function(e,t,n){switch(e.op){case"Max":var r=FWe("axis",e,t,n),a=FWe("keepDims",e,t,n);return[eLe(FWe("x",e,t,n),r,a)];case"Mean":var i=FWe("axis",e,t,n),o=FWe("keepDims",e,t,n);return[kLe(FWe("x",e,t,n),i,o)];case"Min":var s=FWe("axis",e,t,n),u=FWe("keepDims",e,t,n);return[tLe(FWe("x",e,t,n),s,u)];case"Sum":var c=FWe("axis",e,t,n),l=FWe("keepDims",e,t,n);return[iLe(FWe("x",e,t,n),c,l)];case"All":var p=FWe("axis",e,t,n),h=FWe("keepDims",e,t,n);return[SBe(FWe("x",e,t,n),p,h)];case"Any":var d=FWe("axis",e,t,n),f=FWe("keepDims",e,t,n);return[NBe(FWe("x",e,t,n),d,f)];case"ArgMax":var m=FWe("axis",e,t,n);return[TBe(FWe("x",e,t,n),m)];case"ArgMin":var v=FWe("axis",e,t,n);return[CBe(FWe("x",e,t,n),v)];case"Prod":var g=FWe("axis",e,t,n),y=FWe("keepDims",e,t,n);return[mWe(FWe("x",e,t,n),g,y)];case"Cumsum":var b=FWe("axis",e,t,n),x=FWe("exclusive",e,t,n),k=FWe("reverse",e,t,n);return[Nze(FWe("x",e,t,n),b,x,k)];case"Bincount":var w=FWe("x",e,t,n),I=FWe("weights",e,t,n),S=FWe("size",e,t,n);return[nUe(w,I,S)];case"DenseBincount":var N=FWe("x",e,t,n),T=FWe("weights",e,t,n),C=FWe("size",e,t,n),E=FWe("binaryOutput",e,t,n);return[rUe(N,T,C,E)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return lLe((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var r=FWe("n",e,t,n),a=FWe("axis",e,t,n),i=FWe("tensors",e,t,n);return i=i.slice(0,r),[HMe(i,a)];case"Gather":var o=FWe("x",e,t,n),s=FWe("indices",e,t,n);return[sBe(o,CMe(s,"int32"),0)];case"GatherV2":var u=FWe("axis",e,t,n),c=FWe("batchDims",e,t,n),l=FWe("x",e,t,n),p=FWe("indices",e,t,n);return[sBe(l,CMe(p,"int32"),u,c)];case"Reverse":for(var h=FWe("dims",e,t,n),d=[],f=0;f<h.length;f++)h[f]&&d.push(f);var m=FWe("x",e,t,n);return[hOe(m,d)];case"ReverseV2":var v=FWe("axis",e,t,n),g=FWe("x",e,t,n);return[hOe(g,v)];case"Slice":var y=FWe("begin",e,t,n),b=FWe("size",e,t,n);return[ZMe(FWe("x",e,t,n),y,b)];case"StridedSlice":var x=FWe("begin",e,t,n),k=FWe("end",e,t,n),w=FWe("strides",e,t,n),I=FWe("beginMask",e,t,n),S=FWe("endMask",e,t,n),N=FWe("ellipsisMask",e,t,n),T=FWe("newAxisMask",e,t,n),C=FWe("shrinkAxisMask",e,t,n),E=FWe("x",e,t,n);return[IWe(E,x,k,w,I,S,N,T,C)];case"Pack":return lLe((function(){var r=FWe("axis",e,t,n),a=FWe("tensors",e,t,n),i=a[0].shape,o=uLe(a[0]).shape,s=a.map((function(e){var t=jAe(e.shape,i);if(!t&&!jAe(uLe(e).shape,o))throw new Error("the input tensors shape does not match");return t?e:YMe(e,i)}));return[$Me(s,r)]}));case"Unpack":var _=FWe("axis",e,t,n),A=FWe("tensor",e,t,n);return rOe(A,_);case"Tile":var R=FWe("reps",e,t,n);return[dLe(FWe("x",e,t,n),R)];case"Split":case"SplitV":var F=FWe("axis",e,t,n),D=FWe("numOrSizeSplits",e,t,n),M=FWe("x",e,t,n);return oOe(M,D,F);case"ScatterNd":var O=FWe("indices",e,t,n),L=FWe("values",e,t,n),z=FWe("shape",e,t,n);return[iUe(O,L,z)];case"GatherNd":var P=FWe("x",e,t,n),B=FWe("indices",e,t,n);return[oUe(P,B)];case"SparseToDense":var W=FWe("sparseIndices",e,t,n),V=FWe("outputShape",e,t,n),U=FWe("sparseValues",e,t,n),G=FWe("defaultValue",e,t,n);return[tUe(W,U,V,U.dtype===G.dtype?G:CMe(G,U.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return lLe((function(){return function(e,t,n){switch(e.op){case"FFT":return[cOe(FWe("x",e,t,n))];case"IFFT":return[pOe(FWe("x",e,t,n))];case"RFFT":return[lOe(FWe("x",e,t,n))];case"IRFFT":return[dOe(FWe("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return lLe((function(){return function(e,t,n){switch(e.op){case"Cast":return[CMe(FWe("x",e,t,n),FWe("dtype",e,t,n))];case"ExpandDims":var r=FWe("axis",e,t,n);return[hLe(FWe("x",e,t,n),r)];case"Squeeze":var a=FWe("axis",e,t,n);return[uLe(FWe("x",e,t,n),a)];case"Reshape":return[YMe(FWe("x",e,t,n),FWe("shape",e,t,n))];case"MirrorPad":return[lWe(FWe("x",e,t,n),FWe("padding",e,t,n),FWe("mode",e,t,n))];case"PadV2":case"Pad":return[GPe(FWe("x",e,t,n),FWe("padding",e,t,n),FWe("constantValue",e,t,n))];case"SpaceToBatchND":var i=FWe("blockShape",e,t,n),o=FWe("paddings",e,t,n);return[ize(FWe("x",e,t,n),i,o)];case"BatchToSpaceND":var s=FWe("blockShape",e,t,n),u=FWe("crops",e,t,n);return[KPe(FWe("x",e,t,n),s,u)];case"DepthToSpace":var c=FWe("blockSize",e,t,n),l=FWe("dataFormat",e,t,n).toUpperCase();return[BBe(FWe("x",e,t,n),c,l)];case"BroadcastTo":return[XOe(FWe("x",e,t,n),FWe("shape",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return eUe(e,t,n,r);case"custom":var a=RWe(e.op);if(a&&a.customExecutor)return a.customExecutor(new gVe(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(e,t,n);return iRe(a)?a.then((function(e){return[].concat(e)})):[].concat(a)}var uUe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};xe(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return we(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function cUe(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return LWe(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return LWe(e.name)[0]})));for(var p=Ie(t);p.length>0;){var h=p.pop();(dUe(h)||fUe(h)||mUe(h))&&null==o&&(s=(o=h).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(h.name),null==n[h.name]&&(-1===c.indexOf(h.name)&&-1===l.indexOf(h.name)&&(0!==h.inputs.length?h.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))})):i.push(h.name)))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var lUe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],pUe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],hUe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"];function dUe(e){return lUe.indexOf(e.op)>=0}function fUe(e){return pUe.indexOf(e.op)>=0}function mUe(e){return hUe.indexOf(e.op)>=0}var vUe=function(){function e(t,n){var r=this;xe(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return we(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Ie(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=cUe(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has ")+"the dynamic op '".concat(a.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs ")+"[".concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return LWe(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[LWe(e)[0]]})),i=t.map((function(e){return LWe(e)[0]})),o=i.map((function(e){return n.graph.nodes[e]}));0===o.length&&(o=this._outputs);var s=this.getCompilationKey(a,o),u=this.compiledMap.get(s);null==u&&(u=this.compile(e,o),this.compiledMap.set(s,u));var c={},l={};return lLe((function(){var r=new uUe(n.weightMap,c,l,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=C(LWe(t),2),r=n[0],i=[];i[n[1]]=e[t],a[r]=i}));for(var o=n.getFrozenTensorIds(a),s={},p=0;p<u.length;p++){var h=u[p];if(!a[h.name]){var d=sUe(h,a,r,n._resourceManager);if(iRe(d))throw new Error("The execution of the op '".concat(h.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");a[h.name]=d,n.checkTensorForDisposal(h.name,h,a,r,o,i,s)}}return null==n.parent&&r.dispose(o),t.map((function(e){return DWe(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[OWe(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:{},i=h.length>4&&void 0!==h[4]?h[4]:{},(r=h.length>2&&void 0!==h[2]&&h[2])||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n)),o=new uUe(this.weightMap,a,i,this.functionExecutorMap),e.next=7,this.executeWithControlFlow(t,o,n,r);case 7:return s=e.sent,u=n.map((function(e){return DWe(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),p=new Set([].concat(Ie(c),Ie(l),Ie(this.weightIds))),Object.keys(s).forEach((function(e){s[e].forEach((function(e){!e||e.isDisposed||p.has(e.id)||e.dispose()}))})),null==this.parent&&o.dispose(p),e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=S(w().mark((function e(t,n,r){var a,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=S(w().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,d,f,m,v,g,y,b,x,k,I=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return I.graph.nodes[LWe(e)[0]]})),s=r.map((function(e){return LWe(e)[0]})),0===(u=s.map((function(e){return I.graph.nodes[e]}))).length&&(u=this._outputs),c=cUe(t,u,this.weightMap,this._initNodes),l=c.usedNodes,p=c.missingInputs,h=c.dynamicNode,d=c.syncInputs,f=[].concat(Ie(o),Ie(this.graph.weights),Ie(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),m=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=C(LWe(e),2),r=n[0],a=[];a[n[1]]=t[e],m[r]=a})),v={},g=this.getFrozenTensorIds(m),y={};case 12:if(!(f.length>0)){e.next=18;break}return b=this.processStack(o,f,n,m,y,g,s,v,l),e.next=16,Promise.all(b);case 16:e.next=12;break;case 18:if(null!=h||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((x=u.filter((function(e){return!dUe(e)&&!DWe(e.name,m,n)})).map((function(e){return e.name}))).length>0)){e.next=24;break}throw k="",null!=h&&(k="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(p,"]. ").concat(k));case 24:return e.abrupt("return",m);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e=t.pop();n.currentContext=e.contexts;var p="";if("Enter"===e.node.op&&FWe("isConstant",e.node,r,n)){var h=C(MWe(e.node.name,n),1);p=h[0]}if(null==r[e.node.name]){var d=sUe(e.node,r,n,c._resourceManager);if(!p){var f=C(MWe(e.node.name,n),1);p=f[0]}var m=n.currentContext;iRe(d)?l.push(d.then((function(l){return r[p]=l,n.currentContext=m,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u),l}))):(r[p]=d,c.checkTensorForDisposal(p,e.node,r,n,i,o,s),c.processChildNodes(e.node,t,n,r,a,u))}else c.processChildNodes(e.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=C(MWe(e.name,n),1)[0];!a[o]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!DWe(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!DWe(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=C(LWe(n),1)[0],i=t.graph.nodes[a];if(i.attrParams.shape&&i.attrParams.shape.value){var o=i.attrParams.shape.value;WAe(o.length===r.shape.length&&r.shape.every((function(e,t){return-1===o[t]||o[t]===e})),(function(){return"The shape of dict['".concat(i.name,"'] provided in ")+"model.execute(dict) must be [".concat(o,"], but was ")+"[".concat(r.shape,"]")}))}i.attrParams.dtype&&i.attrParams.dtype.value&&WAe(r.dtype===i.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(i.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(i.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e){if(null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n])t[this._signature.inputs[n].name]=e[n];else t[n]=e[n]}return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=C(LWe(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=C(LWe(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),gUe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xe(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return we(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),yUe="?tfjs-format=file",bUe="model.json",xUe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};xe(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",null==n&&(this.loadOptions={}),this.resourceManager=new gUe}return we(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"findIOHandler",value:function(){var e,t,n=this.modelUrl;if(null!=n.load)this.handler=n;else if(null!=this.loadOptions.requestInit)this.handler=WMe(n,this.loadOptions);else{var r=(e=n,t=this.loadOptions,$De.getLoadHandlers(e,t));if(0===r.length)r.push(WMe(n,this.loadOptions));else if(r.length>1)throw new Error("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat([n],"'"));this.handler=r[0]}}},{key:"load",value:function(){var e=S(w().mark((function e(){var t;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findIOHandler(),null!=this.handler.load){e.next=3;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,this.handler.load();case 5:return t=e.sent,e.abrupt("return",this.loadSync(t));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadSync",value:function(e){this.artifacts=e;var t,n=this.artifacts.modelTopology;t=null!=this.artifacts.userDefinedMetadata&&null!=this.artifacts.userDefinedMetadata.signature?this.artifacts.userDefinedMetadata.signature:this.artifacts.signature,this.signature=t,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer);var r=jDe(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new vUe(nVe.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var a=nVe.Instance.transformGraph(e.modelInitializer);this.initializer=new vUe(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=9;break}if(n=t,0!==(r=$De.getSaveHandlers(n)).length){e.next=6;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 6:if(!(r.length>1)){e.next=8;break}throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(t,"'"));case 8:t=r[0];case 9:if(null!=t.save){e.next=11;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.abrupt("return",t.save(this.artifacts));case 12:case"end":return e.stop()}var n}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function(e){if(!(e instanceof vDe)&&!Array.isArray(e))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+"the graph model has ".concat(this.inputNodes.length," placeholders, ")+"while there are ".concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=S(w().mark((function e(t,n){var r;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=4,this.executor.executeAsync(t,n);case 4:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]),e}();function kUe(e){return wUe.apply(this,arguments)}function wUe(){return wUe=S(w().mark((function e(t){var n,r,a=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},null!=t){e.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==n&&(n={}),n.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t="".concat(t).concat(bUe).concat(yUe)),r=new xUe(t,n),e.next=8,r.load();case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)}))),wUe.apply(this,arguments)}var IUe=function(){return(IUe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function SUe(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function NUe(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var TUe=function(e){return{startEndTensor:e,startPoint:ZMe(e,[0,0],[-1,2]),endPoint:ZMe(e,[0,2],[-1,2])}},CUe={strides:[8,16],anchors:[2,6]};function EUe(e,t){var n,r,a;if(e.topLeft instanceof vDe&&e.bottomRight instanceof vDe){var i=C(lLe((function(){return[HMe([eOe(t-1,e.topLeft.slice(0,1)),e.topLeft.slice(1,1)]),HMe([eOe(t-1,e.bottomRight.slice(0,1)),e.bottomRight.slice(1,1)])]})),2);n=i[0],r=i[1],null!=e.landmarks&&(a=lLe((function(){var n=eOe(tOe([t-1,0]),e.landmarks),r=tOe([1,-1]);return XMe(n,r)})))}else{var o=C(e.topLeft,2),s=o[0],u=o[1],c=C(e.bottomRight,2),l=c[0],p=c[1];n=[t-1-s,u],r=[t-1-l,p],null!=e.landmarks&&(a=e.landmarks.map((function(e){return[t-1-e[0],e[1]]})))}var h={topLeft:n,bottomRight:r};return null!=a&&(h.landmarks=a),null!=e.probability&&(h.probability=e.probability instanceof vDe?e.probability.clone():e.probability),h}function _Ue(e,t){return lLe((function(){return function(e,t){var n=XMe(e.startPoint,t),r=XMe(e.endPoint,t),a=jMe([n,r],1);return TUe(a)}(e.hasOwnProperty("box")?e.box:e,t).startEndTensor.squeeze()}))}var AUe=function(){function e(t,n,r,a,i,o){xe(this,e),this.blazeFaceModel=t,this.width=n,this.height=r,this.maxFaces=a,this.anchorsData=function(e,t,n){for(var r=[],a=0;a<n.strides.length;a++)for(var i=n.strides[a],o=Math.floor((t+i-1)/i),s=Math.floor((e+i-1)/i),u=n.anchors[a],c=0;c<o;c++)for(var l=i*(c+.5),p=0;p<s;p++)for(var h=i*(p+.5),d=0;d<u;d++)r.push([h,l]);return r}(n,r,CUe),this.anchors=nOe(this.anchorsData),this.inputSizeData=[n,r],this.inputSize=tOe([n,r]),this.iouThreshold=i,this.scoreThreshold=o}return we(e,[{key:"getBoundingBoxes",value:function(){var e=S(w().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,d,f,m,v,g,y,b=this,x=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(x.length>2&&void 0!==x[2])||x[2],a=lLe((function(){var e=t.resizeBilinear([b.width,b.height]),n=XMe(eOe(e.div(255),.5),2),r=b.blazeFaceModel.predict(n).squeeze(),a=function(e,t,n){var r=ZMe(e,[0,1],[-1,2]),a=GMe(r,t),i=ZMe(e,[0,3],[-1,2]),o=KMe(i,n),s=KMe(a,n),u=KMe(o,2),c=eOe(s,u),l=GMe(s,u),p=XMe(c,n),h=XMe(l,n);return jMe([p,h],1)}(r,b.anchors,b.inputSize),i=ZMe(r,[0,0],[-1,1]);return[r,a,QMe(i).squeeze()]})),i=C(a,3),o=i[0],s=i[1],u=i[2],c=console.warn,console.warn=function(){},l=DLe.nonMaxSuppression(s,u,this.maxFaces,this.iouThreshold,this.scoreThreshold),console.warn=c,e.next=7,l.array();case 7:if(p=e.sent,l.dispose(),h=p.map((function(e){return ZMe(s,[e,0],[1,-1])})),e.t0=n,e.t0){e.next=15;break}return e.next=14,Promise.all(h.map(function(){var e=S(w().mark((function e(t){var n;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.array();case 2:return n=e.sent,e.abrupt("return",(t.dispose(),n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:h=e.sent;case 15:d=t.shape[1],f=t.shape[2],m=n?KMe([f,d],this.inputSize):[f/this.inputSizeData[0],d/this.inputSizeData[1]],v=[],g=w().mark((function e(t){var a,i;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=h[t],i=lLe((function(){var e=TUe(a instanceof vDe?a:nOe(a));if(!r)return e;var i,s=p[t];return i=n?b.anchors.slice([s,0],[1,2]):b.anchorsData[s],{box:e,landmarks:ZMe(o,[s,5],[1,-1]).squeeze().reshape([6,-1]),probability:ZMe(u,[s],[1]),anchor:i}})),v.push(i);case 2:case"end":return e.stop()}}),e)})),y=0;case 20:if(!(y<h.length)){e.next=25;break}return e.delegateYield(g(y),"t1",22);case 22:y++,e.next=20;break;case 25:return e.abrupt("return",(s.dispose(),u.dispose(),o.dispose(),{boxes:v,scaleFactor:m}));case 26:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"estimateFaces",value:function(){var e=S(w().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]&&h[1],r=h.length>2&&void 0!==h[2]&&h[2],a=!(h.length>3&&void 0!==h[3])||h[3],i=function(e){return e instanceof vDe?[e.shape[0],e.shape[1]]:[e.height,e.width]}(t),o=C(i,2),s=o[1],u=lLe((function(){return t instanceof vDe||(t=UMe(t)),t.toFloat().expandDims(0)})),e.next=9,this.getBoundingBoxes(u,n,a);case 9:return c=e.sent,l=c.boxes,p=c.scaleFactor,e.abrupt("return",(u.dispose(),n?l.map((function(e){var t=_Ue(e,p),n={topLeft:t.slice([0],[2]),bottomRight:t.slice([2],[2])};if(a){var i=e.landmarks,o=e.probability,u=e.anchor,c=i.add(u).mul(p);n.landmarks=c,n.probability=o}return r&&(n=EUe(n,s)),n})):Promise.all(l.map(function(){var e=S(w().mark((function e(t){var n,i,o,u,c,l,h,d,f,m,v,g,y;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=_Ue(t,p),!a){e.next=17;break}return e.next=4,Promise.all([t.landmarks,n,t.probability].map(function(){var e=S(w().mark((function e(t){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.array());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:o=e.sent,u=C(o,3),c=u[0],l=u[1],h=u[2],d=t.anchor,f=C(p,2),m=f[0],v=f[1],g=c.map((function(e){return[(e[0]+d[0])*m,(e[1]+d[1])*v]})),i={topLeft:l.slice(0,2),bottomRight:l.slice(2),landmarks:g,probability:h},function(e){e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose()}(t.box),t.landmarks.dispose(),t.probability.dispose(),e.next=21;break;case 17:return e.next=19,n.array();case 19:y=e.sent,i={topLeft:y.slice(0,2),bottomRight:y.slice(2)};case 21:return e.abrupt("return",(n.dispose(),r&&(i=EUe(i,s)),i));case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function RUe(){return FUe.apply(this,arguments)}function FUe(){return FUe=S(w().mark((function e(){var t,n,r,a,i,o,s,u,c,l,p,h,d=arguments;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=d.length>0&&void 0!==d[0]?d[0]:{}).maxFaces,r=void 0===n?10:n,a=t.inputWidth,i=void 0===a?128:a,o=t.inputHeight,s=void 0===o?128:o,u=t.iouThreshold,c=void 0===u?.3:u,l=t.scoreThreshold,p=void 0===l?.75:l,e.next=3,kUe("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0});case 3:return h=e.sent,e.abrupt("return",new AUe(h,i,s,r,c,p));case 5:case"end":return e.stop()}}),e)}))),FUe.apply(this,arguments)}var DUe={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function MUe(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}function OUe(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}function LUe(e,t){void 0===t&&(t=1.5);var n=OUe(e),r=MUe(e),a=[t*r[0]/2,t*r[1]/2];return{startPoint:[n[0]-a[0],n[1]-a[1]],endPoint:[n[0]+a[0],n[1]+a[1]],landmarks:e.landmarks}}function zUe(e,t){var n;return(n=Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]))-2*Math.PI*Math.floor((n+Math.PI)/(2*Math.PI))}function PUe(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}function BUe(e,t){for(var n=0,r=0;r<e.length;r++)n+=e[r]*t[r];return n}function WUe(e,t){for(var n=[],r=0;r<e.length;r++)n.push(e[r][t]);return n}function VUe(e,t){for(var n=[],r=e.length,a=0;a<r;a++){n.push([]);for(var i=0;i<r;i++)n[a].push(BUe(e[a],WUe(t,i)))}return n}function UUe(e,t){var n=Math.cos(e),r=Math.sin(e),a=[[n,-r,0],[r,n,0],[0,0,1]],i=VUe(PUe(t[0],t[1]),a);return VUe(i,PUe(-t[0],-t[1]))}var GUe=[1,168],HUe=[3,2],jUe=function(){function e(e,t,n,r,a,i){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.meshWidth=n,this.meshHeight=r,this.maxContinuousChecks=a,this.maxFaces=i}return e.prototype.transformRawCoords=function(e,t,n,r){var a,i,o,s,u=this,c=MUe({startPoint:t.startPoint,endPoint:t.endPoint}),l=[c[0]/this.meshWidth,c[1]/this.meshHeight],p=e.map((function(e){return[l[0]*(e[0]-u.meshWidth/2),l[1]*(e[1]-u.meshHeight/2),e[2]]})),h=UUe(n,[0,0]),d=p.map((function(e){return function(e,t){return[BUe(e,t[0]),BUe(e,t[1])]}(e,h).concat([e[2]])})),f=(i=[[(a=r)[0][0],a[1][0]],[a[0][1],a[1][1]]],o=[a[0][2],a[1][2]],s=[-BUe(i[0],o),-BUe(i[1],o)],[i[0].concat(s[0]),i[1].concat(s[1]),[0,0,1]]),m=OUe({startPoint:t.startPoint,endPoint:t.endPoint}).concat([1]),v=[BUe(m,f[0]),BUe(m,f[1])];return d.map((function(e){return[e[0]+v[0],e[1]+v[1],e[2]]}))},e.prototype.predict=function(e){return SUe(this,void 0,void 0,(function(){var t,n,r,a,i=this;return NUe(this,(function(o){switch(o.label){case 0:return this.shouldUpdateRegionsOfInterest()?[4,this.boundingBoxDetector.getBoundingBoxes(e,!1,!0)]:[3,2];case 1:return t=o.sent(),n=t.boxes,r=t.scaleFactor,0===n.length?(this.regionsOfInterest=[],[2,null]):(a=n.map((function(e){var t,n,a={startPoint:e.box.startPoint.squeeze().arraySync(),endPoint:e.box.endPoint.squeeze().arraySync()},i=LUe((n=r,{startPoint:[(t=a).startPoint[0]*n[0],t.startPoint[1]*n[1]],endPoint:[t.endPoint[0]*n[0],t.endPoint[1]*n[1]]}));return IUe({},i,{landmarks:e.landmarks.arraySync()})})),n.forEach((function(e){null!=e&&null!=e.startPoint&&(e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose())})),this.updateRegionsOfInterest(a),this.runsWithoutFaceDetector=0,[3,3]);case 2:this.runsWithoutFaceDetector++,o.label=3;case 3:return[2,lLe((function(){return i.regionsOfInterest.map((function(t,n){var r;if(468===t.landmarks.length){var a=GUe[0],o=GUe[1];r=zUe(t.landmarks[a],t.landmarks[o])}else a=HUe[0],o=HUe[1],r=zUe(t.landmarks[a],t.landmarks[o]);var s=OUe({startPoint:t.startPoint,endPoint:t.endPoint}),u=[s[0]/e.shape[2],s[1]/e.shape[1]],c=DLe.rotateWithOffset(e,r,0,u),l=UUe(-r,s),p=function(e,t,n){var r=t.shape[1],a=t.shape[2],i=[[e.startPoint[1]/r,e.startPoint[0]/a,e.endPoint[1]/r,e.endPoint[0]/a]];return DLe.cropAndResize(t,i,[0],n)}({startPoint:t.startPoint,endPoint:t.endPoint},c,[i.meshHeight,i.meshWidth]).div(255),h=i.meshDetector.predict(p),d=h[1],f=h[2],m=YMe(f,[-1,3]),v=m.arraySync(),g=i.transformRawCoords(v,t,r,l),y=nOe(g),b=i.calculateLandmarksBoundingBox(g);return i.regionsOfInterest[n]=IUe({},b,{landmarks:y.arraySync()}),{coords:m,scaledCoords:y,box:b,flag:d.squeeze()}}))}))]}}))}))},e.prototype.updateRegionsOfInterest=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.regionsOfInterest[t],a=0;if(r&&r.startPoint){var i=n.startPoint,o=i[0],s=i[1],u=n.endPoint,c=u[0],l=u[1],p=r.startPoint,h=p[0],d=p[1],f=r.endPoint,m=f[0],v=f[1],g=Math.max(o,h),y=Math.max(s,d),b=(Math.min(c,m)-g)*(Math.min(l,v)-y);a=b/((c-o)*(l-s)+(m-h)*(v-s)-b)}a<.25&&(this.regionsOfInterest[t]=n)}this.regionsOfInterest=this.regionsOfInterest.slice(0,e.length)},e.prototype.clearRegionOfInterest=function(e){null!=this.regionsOfInterest[e]&&(this.regionsOfInterest=this.regionsOfInterest.slice(0,e).concat(this.regionsOfInterest.slice(e+1)))},e.prototype.shouldUpdateRegionsOfInterest=function(){var e=this.regionsOfInterest.length,t=0===e;return 1===this.maxFaces||t?t:e!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks},e.prototype.calculateLandmarksBoundingBox=function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]})),r={startPoint:[Math.min.apply(Math,t),Math.min.apply(Math,n)],endPoint:[Math.max.apply(Math,t),Math.max.apply(Math,n)]};return LUe({startPoint:r.startPoint,endPoint:r.endPoint})},e}(),qUe=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]];function KUe(e){var t=void 0===e?{}:e,n=t.maxContinuousChecks,r=void 0===n?5:n,a=t.detectionConfidence,i=void 0===a?.9:a,o=t.maxFaces,s=void 0===o?10:o,u=t.iouThreshold,c=void 0===u?.3:u,l=t.scoreThreshold,p=void 0===l?.75:l;return SUe(this,void 0,void 0,(function(){var e,t,n;return NUe(this,(function(a){switch(a.label){case 0:return[4,Promise.all([XUe(s,c,p),YUe()])];case 1:return e=a.sent(),t=e[0],n=e[1],[2,new QUe(t,n,r,i,s)]}}))}))}function XUe(e,t,n){return SUe(this,void 0,void 0,(function(){return NUe(this,(function(r){return[2,RUe({maxFaces:e,iouThreshold:t,scoreThreshold:n})]}))}))}function YUe(){return SUe(this,void 0,void 0,(function(){return NUe(this,(function(e){return[2,kUe("https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",{fromTFHub:!0})]}))}))}function JUe(e,t){if(e.mesh instanceof vDe){var n=lLe((function(){var n=tOe([t-1,0,0]),r=tOe([1,-1,1]);return lLe((function(){return[HMe([eOe(t-1,e.boundingBox.topLeft.slice(0,1)),e.boundingBox.topLeft.slice(1,1)]),HMe([eOe(t-1,e.boundingBox.bottomRight.slice(0,1)),e.boundingBox.bottomRight.slice(1,1)]),eOe(n,e.mesh).mul(r),eOe(n,e.scaledMesh).mul(r)]}))})),r=n[0],a=n[1],i=n[2],o=n[3];return Object.assign({},e,{boundingBox:{topLeft:r,bottomRight:a},mesh:i,scaledMesh:o})}return Object.assign({},e,{boundingBox:{topLeft:[t-1-e.boundingBox.topLeft[0],e.boundingBox.topLeft[1]],bottomRight:[t-1-e.boundingBox.bottomRight[0],e.boundingBox.bottomRight[1]]},mesh:e.mesh.map((function(e){var n=e.slice(0);return n[0]=t-1-e[0],n})),scaledMesh:e.scaledMesh.map((function(e){var n=e.slice(0);return n[0]=t-1-e[0],n}))})}var QUe=function(){function e(e,t,n,r,a){this.pipeline=new jUe(e,t,192,192,n,a),this.detectionConfidence=r}return e.getAnnotations=function(){return DUe},e.getUVCoords=function(){return qUe},e.prototype.estimateFaces=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),SUe(this,void 0,void 0,(function(){var r,a,i,o,s,u=this;return NUe(this,(function(c){switch(c.label){case 0:return r=function(e){return e instanceof vDe?[e.shape[0],e.shape[1]]:[e.height,e.width]}(e),a=r[1],i=lLe((function(){return e instanceof vDe||(e=UMe(e)),e.toFloat().expandDims(0)})),"webgl"!==RDe.backendName?[3,2]:(s=uRe().get("WEBGL_PACK_DEPTHWISECONV"),uRe().set("WEBGL_PACK_DEPTHWISECONV",!0),[4,this.pipeline.predict(i)]);case 1:return o=c.sent(),uRe().set("WEBGL_PACK_DEPTHWISECONV",s),[3,4];case 2:return[4,this.pipeline.predict(i)];case 3:o=c.sent(),c.label=4;case 4:return i.dispose(),null!=o&&o.length>0?[2,Promise.all(o.map((function(e,r){return SUe(u,void 0,void 0,(function(){var i,o,s,u,c,l,p,h,d,f,m,v,g,y,b=this;return NUe(this,(function(x){switch(x.label){case 0:return i=e.coords,o=e.scaledCoords,s=e.box,u=e.flag,c=[u],t||(c=c.concat([i,o])),[4,Promise.all(c.map((function(e){return SUe(b,void 0,void 0,(function(){return NUe(this,(function(t){return[2,e.array()]}))}))})))];case 1:if(l=x.sent(),p=l[0],u.dispose(),p<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(r),t)return h={faceInViewConfidence:p,mesh:i,scaledMesh:o,boundingBox:{topLeft:tOe(s.startPoint),bottomRight:tOe(s.endPoint)}},n?[2,JUe(h,a)]:[2,h];for(y in d=l.slice(1),f=d[0],m=d[1],o.dispose(),i.dispose(),v={faceInViewConfidence:p,boundingBox:{topLeft:s.startPoint,bottomRight:s.endPoint},mesh:f,scaledMesh:m},n&&(v=JUe(v,a)),g={},DUe)g[y]=DUe[y].map((function(e){return v.scaledMesh[e]}));return v.annotations=g,[2,v]}}))}))})))]:[2,[]]}}))}))},e}(),ZUe=n(97),$Ue=n.n(ZUe),eGe=n(184);var tGe=function(){var e=(0,b.useRef)(null),t=(0,b.useRef)(null),n=(0,b.useRef)(null),r=C((0,b.useState)(0),2),a=r[0],i=r[1];return(0,b.useEffect)((function(){document.getElementById("canvas").style.width=document.getElementById("webcam").style.width,document.getElementById("canvas").style.height=document.getElementById("webcam").style.height;var n=function(){var n=S(w().mark((function n(){var r;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r="/frame-api-co-I/models",document.getElementById("info").textContent="Model Loading... Please Wait!!!",Promise.all([i(10),P2.tinyFaceDetector.loadFromUri(r),i(20),P2.faceLandmark68Net.loadFromUri(r),i(40),P2.faceRecognitionNet.loadFromUri(r),i(50),P2.faceExpressionNet.loadFromUri(r),i(70),P2.ageGenderNet.loadFromUri(r),i(90)]).then(S(w().mark((function n(){var r;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,KUe({inputResolution:{width:640,height:480},scale:.8});case 2:r=n.sent,i(100),console.log(a),document.getElementById("info").textContent="Models Loaded! \n You are in Shop #".concat(1,"."),document.getElementById("progressBar").classList.add("d-none"),console.log("done"),setInterval((function(){zAe(r,e,t,1)}),1e3);case 9:case"end":return n.stop()}}),n)}))));case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()})),(0,eGe.jsxs)(eGe.Fragment,{children:[(0,eGe.jsxs)("div",{className:"container mt-md-4 mt-sm-2 mx-auto d-flex flex-column justify-content-center ",children:[(0,eGe.jsx)("div",{className:"justify-content-center",children:(0,eGe.jsx)("span",{className:"fs-2 mb-4 justify-content-center",children:"Frame Api"})}),(0,eGe.jsx)("span",{id:"info",className:"fs-3 justify-content-center",children:"text"})]}),(0,eGe.jsx)("div",{id:"progressBar",className:"progress",children:(0,eGe.jsx)("div",{className:"progress-bar progress-bar-striped progress-bar-animated my-4",role:"progressbar","aria-label":"Animated striped example","aria-valuemin":"0","aria-valuemax":"100",style:{width:"".concat(a)}})}),(0,eGe.jsxs)("div",{className:"container my-5 d-flex justify-content-center",style:{margin:0,padding:0},children:[(0,eGe.jsx)($Ue(),{id:"webcam",ref:e,style:{position:"absolute",width:"70%",objectFit:"fill",height:"80%",maxHeight:"800px",maxWidth:"600px"}}),(0,eGe.jsx)("canvas",{id:"canvas",ref:t,style:{position:"absolute",objectFit:"fill",height:"80%",maxHeight:"800px",maxWidth:"600px"}})]}),(0,eGe.jsxs)("div",{id:"results",className:"container mt-lg-4 mt-md-3 mt-sm-2 d-flex justify-content-center flex-column",children:[(0,eGe.jsx)("span",{id:"txt_recom",hidden:!0,className:"fs-3 my-md-4 my-sm-2",children:"Recommendations"}),(0,eGe.jsx)("div",{className:"container",children:(0,eGe.jsx)("div",{id:"cardContainer",className:"row"})})]}),(0,eGe.jsx)("span",{hidden:!0,id:"decision",ref:n,style:{position:"relative",color:"red"},children:"Detecting..."}),(0,eGe.jsx)("span",{hidden:!0,id:"genderAge",ref:n,style:{position:"relative",color:"blue"},children:"Detecting..."})]})},nGe=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};x.createRoot(document.getElementById("root")).render((0,eGe.jsx)(tGe,{})),nGe()}()}();
//# sourceMappingURL=main.21741427.js.map